/**
 * text2lesson 1.0.53
 * Text2Lesson: create quizzes and lessons from plain text files.
 * Copyright 2023 Steve Butler (henspace.com)
 * 
 * This program is free software: you can redistribute it and/or modify
 * it under the terms of the GNU General Public License as published by
 * the Free Software Foundation, either version 3 of the License, or
 * (at your option) any later version.
 * 
 * This program is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
 * GNU General Public License for more details.
 * 
 * You should have received a copy of the GNU General Public License
 * along with this program.  If not, see <https://www.gnu.org/licenses/>.
 * 
 */
"use strict";function _typeof(obj){return _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(obj){return typeof obj}:function(obj){return obj&&"function"==typeof Symbol&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj},_typeof(obj)}var _templateObject,_templateObject2,_templateObject3,_templateObject4,_templateObject5,_templateObject6,_templateObject7,_templateObject8,_templateObject9,_templateObject10,_templateObject11,_templateObject12,_templateObject13,_templateObject14,_templateObject15,_templateObject16,_templateObject17,_templateObject18,_templateObject19,_templateObject20,_templateObject21,_templateObject22,_templateObject23,_templateObject24,_templateObject25,_templateObject26,_templateObject27,_templateObject28,_templateObject29,_templateObject30,_templateObject31,_templateObject32,_templateObject33,_templateObject34,_templateObject35,_templateObject36,_templateObject37,_templateObject38,_templateObject39,_templateObject40,_templateObject41,_templateObject42,_templateObject43,_templateObject44,_templateObject45,_templateObject46,_templateObject47,_templateObject48,_templateObject49,_templateObject50,_templateObject51,_templateObject52,_templateObject53,_templateObject54,_templateObject55,_templateObject56,_templateObject57,_templateObject58,_templateObject59,_templateObject60,_templateObject61,_templateObject62,_templateObject63,_templateObject64,_templateObject65,_templateObject66,_templateObject67,_templateObject68,_templateObject69,_templateObject70,_templateObject71,_templateObject72,_templateObject73,_templateObject74,_templateObject75,_templateObject76,_templateObject77,_templateObject78,_templateObject79,_templateObject80,_templateObject81,_templateObject82,_templateObject83,_templateObject84,_templateObject85,_templateObject86,_templateObject87,_templateObject88,_templateObject89,_templateObject90,_templateObject91,_templateObject92,_templateObject93,_templateObject94,_templateObject95,_templateObject96,_templateObject97,_templateObject98,_templateObject99,_templateObject100,_templateObject101,_templateObject102,_templateObject103,_templateObject104,_templateObject105,_templateObject106,_templateObject107,_templateObject108,_templateObject109,_templateObject110,_templateObject111,_templateObject112,_templateObject113,_templateObject114,_templateObject115,_templateObject116,_templateObject117,_templateObject118,_templateObject119,_templateObject120,_templateObject121,_templateObject122,_templateObject123,_templateObject124,_templateObject125,_templateObject126,_templateObject127,_templateObject128,_templateObject129,_templateObject130,_templateObject131,_templateObject132,_templateObject133,_templateObject134,_templateObject135,_templateObject136,_templateObject137,_templateObject138,_templateObject139,_templateObject140,_templateObject141,_templateObject142,_templateObject143,_templateObject144,_templateObject145,_templateObject146,_templateObject147,_templateObject148,_templateObject149,_templateObject150,_templateObject151;function _get(){return _get="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(target,property,receiver){var base=_superPropBase(target,property);if(base){var desc=Object.getOwnPropertyDescriptor(base,property);return desc.get?desc.get.call(arguments.length<3?target:receiver):desc.value}},_get.apply(this,arguments)}function _superPropBase(object,property){for(;!Object.prototype.hasOwnProperty.call(object,property)&&null!==(object=_getPrototypeOf(object)););return object}function _regeneratorRuntime(){_regeneratorRuntime=function(){return exports};var exports={},Op=Object.prototype,hasOwn=Op.hasOwnProperty,defineProperty=Object.defineProperty||function(obj,key,desc){obj[key]=desc.value},$Symbol="function"==typeof Symbol?Symbol:{},iteratorSymbol=$Symbol.iterator||"@@iterator",asyncIteratorSymbol=$Symbol.asyncIterator||"@@asyncIterator",toStringTagSymbol=$Symbol.toStringTag||"@@toStringTag";function define(obj,key,value){return Object.defineProperty(obj,key,{value:value,enumerable:!0,configurable:!0,writable:!0}),obj[key]}try{define({},"")}catch(err){define=function(obj,key,value){return obj[key]=value}}function wrap(innerFn,outerFn,self,tryLocsList){var protoGenerator=outerFn&&outerFn.prototype instanceof Generator?outerFn:Generator,generator=Object.create(protoGenerator.prototype),context=new Context(tryLocsList||[]);return defineProperty(generator,"_invoke",{value:makeInvokeMethod(innerFn,self,context)}),generator}function tryCatch(fn,obj,arg){try{return{type:"normal",arg:fn.call(obj,arg)}}catch(err){return{type:"throw",arg:err}}}exports.wrap=wrap;var ContinueSentinel={};function Generator(){}function GeneratorFunction(){}function GeneratorFunctionPrototype(){}var IteratorPrototype={};define(IteratorPrototype,iteratorSymbol,(function(){return this}));var getProto=Object.getPrototypeOf,NativeIteratorPrototype=getProto&&getProto(getProto(values([])));NativeIteratorPrototype&&NativeIteratorPrototype!==Op&&hasOwn.call(NativeIteratorPrototype,iteratorSymbol)&&(IteratorPrototype=NativeIteratorPrototype);var Gp=GeneratorFunctionPrototype.prototype=Generator.prototype=Object.create(IteratorPrototype);function defineIteratorMethods(prototype){["next","throw","return"].forEach((function(method){define(prototype,method,(function(arg){return this._invoke(method,arg)}))}))}function AsyncIterator(generator,PromiseImpl){function invoke(method,arg,resolve,reject){var record=tryCatch(generator[method],generator,arg);if("throw"!==record.type){var result=record.arg,value=result.value;return value&&"object"==_typeof(value)&&hasOwn.call(value,"__await")?PromiseImpl.resolve(value.__await).then((function(value){invoke("next",value,resolve,reject)}),(function(err){invoke("throw",err,resolve,reject)})):PromiseImpl.resolve(value).then((function(unwrapped){result.value=unwrapped,resolve(result)}),(function(error){return invoke("throw",error,resolve,reject)}))}reject(record.arg)}var previousPromise;defineProperty(this,"_invoke",{value:function(method,arg){function callInvokeWithMethodAndArg(){return new PromiseImpl((function(resolve,reject){invoke(method,arg,resolve,reject)}))}return previousPromise=previousPromise?previousPromise.then(callInvokeWithMethodAndArg,callInvokeWithMethodAndArg):callInvokeWithMethodAndArg()}})}function makeInvokeMethod(innerFn,self,context){var state="suspendedStart";return function(method,arg){if("executing"===state)throw new Error("Generator is already running");if("completed"===state){if("throw"===method)throw arg;return doneResult()}for(context.method=method,context.arg=arg;;){var delegate=context.delegate;if(delegate){var delegateResult=maybeInvokeDelegate(delegate,context);if(delegateResult){if(delegateResult===ContinueSentinel)continue;return delegateResult}}if("next"===context.method)context.sent=context._sent=context.arg;else if("throw"===context.method){if("suspendedStart"===state)throw state="completed",context.arg;context.dispatchException(context.arg)}else"return"===context.method&&context.abrupt("return",context.arg);state="executing";var record=tryCatch(innerFn,self,context);if("normal"===record.type){if(state=context.done?"completed":"suspendedYield",record.arg===ContinueSentinel)continue;return{value:record.arg,done:context.done}}"throw"===record.type&&(state="completed",context.method="throw",context.arg=record.arg)}}}function maybeInvokeDelegate(delegate,context){var methodName=context.method,method=delegate.iterator[methodName];if(void 0===method)return context.delegate=null,"throw"===methodName&&delegate.iterator.return&&(context.method="return",context.arg=void 0,maybeInvokeDelegate(delegate,context),"throw"===context.method)||"return"!==methodName&&(context.method="throw",context.arg=new TypeError("The iterator does not provide a '"+methodName+"' method")),ContinueSentinel;var record=tryCatch(method,delegate.iterator,context.arg);if("throw"===record.type)return context.method="throw",context.arg=record.arg,context.delegate=null,ContinueSentinel;var info=record.arg;return info?info.done?(context[delegate.resultName]=info.value,context.next=delegate.nextLoc,"return"!==context.method&&(context.method="next",context.arg=void 0),context.delegate=null,ContinueSentinel):info:(context.method="throw",context.arg=new TypeError("iterator result is not an object"),context.delegate=null,ContinueSentinel)}function pushTryEntry(locs){var entry={tryLoc:locs[0]};1 in locs&&(entry.catchLoc=locs[1]),2 in locs&&(entry.finallyLoc=locs[2],entry.afterLoc=locs[3]),this.tryEntries.push(entry)}function resetTryEntry(entry){var record=entry.completion||{};record.type="normal",delete record.arg,entry.completion=record}function Context(tryLocsList){this.tryEntries=[{tryLoc:"root"}],tryLocsList.forEach(pushTryEntry,this),this.reset(!0)}function values(iterable){if(iterable){var iteratorMethod=iterable[iteratorSymbol];if(iteratorMethod)return iteratorMethod.call(iterable);if("function"==typeof iterable.next)return iterable;if(!isNaN(iterable.length)){var i=-1,next=function next(){for(;++i<iterable.length;)if(hasOwn.call(iterable,i))return next.value=iterable[i],next.done=!1,next;return next.value=void 0,next.done=!0,next};return next.next=next}}return{next:doneResult}}function doneResult(){return{value:void 0,done:!0}}return GeneratorFunction.prototype=GeneratorFunctionPrototype,defineProperty(Gp,"constructor",{value:GeneratorFunctionPrototype,configurable:!0}),defineProperty(GeneratorFunctionPrototype,"constructor",{value:GeneratorFunction,configurable:!0}),GeneratorFunction.displayName=define(GeneratorFunctionPrototype,toStringTagSymbol,"GeneratorFunction"),exports.isGeneratorFunction=function(genFun){var ctor="function"==typeof genFun&&genFun.constructor;return!!ctor&&(ctor===GeneratorFunction||"GeneratorFunction"===(ctor.displayName||ctor.name))},exports.mark=function(genFun){return Object.setPrototypeOf?Object.setPrototypeOf(genFun,GeneratorFunctionPrototype):(genFun.__proto__=GeneratorFunctionPrototype,define(genFun,toStringTagSymbol,"GeneratorFunction")),genFun.prototype=Object.create(Gp),genFun},exports.awrap=function(arg){return{__await:arg}},defineIteratorMethods(AsyncIterator.prototype),define(AsyncIterator.prototype,asyncIteratorSymbol,(function(){return this})),exports.AsyncIterator=AsyncIterator,exports.async=function(innerFn,outerFn,self,tryLocsList,PromiseImpl){void 0===PromiseImpl&&(PromiseImpl=Promise);var iter=new AsyncIterator(wrap(innerFn,outerFn,self,tryLocsList),PromiseImpl);return exports.isGeneratorFunction(outerFn)?iter:iter.next().then((function(result){return result.done?result.value:iter.next()}))},defineIteratorMethods(Gp),define(Gp,toStringTagSymbol,"Generator"),define(Gp,iteratorSymbol,(function(){return this})),define(Gp,"toString",(function(){return"[object Generator]"})),exports.keys=function(val){var object=Object(val),keys=[];for(var key in object)keys.push(key);return keys.reverse(),function next(){for(;keys.length;){var key=keys.pop();if(key in object)return next.value=key,next.done=!1,next}return next.done=!0,next}},exports.values=values,Context.prototype={constructor:Context,reset:function(skipTempReset){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(resetTryEntry),!skipTempReset)for(var name in this)"t"===name.charAt(0)&&hasOwn.call(this,name)&&!isNaN(+name.slice(1))&&(this[name]=void 0)},stop:function(){this.done=!0;var rootRecord=this.tryEntries[0].completion;if("throw"===rootRecord.type)throw rootRecord.arg;return this.rval},dispatchException:function(exception){if(this.done)throw exception;var context=this;function handle(loc,caught){return record.type="throw",record.arg=exception,context.next=loc,caught&&(context.method="next",context.arg=void 0),!!caught}for(var i=this.tryEntries.length-1;i>=0;--i){var entry=this.tryEntries[i],record=entry.completion;if("root"===entry.tryLoc)return handle("end");if(entry.tryLoc<=this.prev){var hasCatch=hasOwn.call(entry,"catchLoc"),hasFinally=hasOwn.call(entry,"finallyLoc");if(hasCatch&&hasFinally){if(this.prev<entry.catchLoc)return handle(entry.catchLoc,!0);if(this.prev<entry.finallyLoc)return handle(entry.finallyLoc)}else if(hasCatch){if(this.prev<entry.catchLoc)return handle(entry.catchLoc,!0)}else{if(!hasFinally)throw new Error("try statement without catch or finally");if(this.prev<entry.finallyLoc)return handle(entry.finallyLoc)}}}},abrupt:function(type,arg){for(var i=this.tryEntries.length-1;i>=0;--i){var entry=this.tryEntries[i];if(entry.tryLoc<=this.prev&&hasOwn.call(entry,"finallyLoc")&&this.prev<entry.finallyLoc){var finallyEntry=entry;break}}finallyEntry&&("break"===type||"continue"===type)&&finallyEntry.tryLoc<=arg&&arg<=finallyEntry.finallyLoc&&(finallyEntry=null);var record=finallyEntry?finallyEntry.completion:{};return record.type=type,record.arg=arg,finallyEntry?(this.method="next",this.next=finallyEntry.finallyLoc,ContinueSentinel):this.complete(record)},complete:function(record,afterLoc){if("throw"===record.type)throw record.arg;return"break"===record.type||"continue"===record.type?this.next=record.arg:"return"===record.type?(this.rval=this.arg=record.arg,this.method="return",this.next="end"):"normal"===record.type&&afterLoc&&(this.next=afterLoc),ContinueSentinel},finish:function(finallyLoc){for(var i=this.tryEntries.length-1;i>=0;--i){var entry=this.tryEntries[i];if(entry.finallyLoc===finallyLoc)return this.complete(entry.completion,entry.afterLoc),resetTryEntry(entry),ContinueSentinel}},catch:function(tryLoc){for(var i=this.tryEntries.length-1;i>=0;--i){var entry=this.tryEntries[i];if(entry.tryLoc===tryLoc){var record=entry.completion;if("throw"===record.type){var thrown=record.arg;resetTryEntry(entry)}return thrown}}throw new Error("illegal catch attempt")},delegateYield:function(iterable,resultName,nextLoc){return this.delegate={iterator:values(iterable),resultName:resultName,nextLoc:nextLoc},"next"===this.method&&(this.arg=void 0),ContinueSentinel}},exports}function asyncGeneratorStep(gen,resolve,reject,_next,_throw,key,arg){try{var info=gen[key](arg),value=info.value}catch(error){return void reject(error)}info.done?resolve(value):Promise.resolve(value).then(_next,_throw)}function _asyncToGenerator(fn){return function(){var self=this,args=arguments;return new Promise((function(resolve,reject){var gen=fn.apply(self,args);function _next(value){asyncGeneratorStep(gen,resolve,reject,_next,_throw,"next",value)}function _throw(err){asyncGeneratorStep(gen,resolve,reject,_next,_throw,"throw",err)}_next(void 0)}))}}function _wrapNativeSuper(Class){var _cache="function"==typeof Map?new Map:void 0;return _wrapNativeSuper=function(Class){if(null===Class||!_isNativeFunction(Class))return Class;if("function"!=typeof Class)throw new TypeError("Super expression must either be null or a function");if(void 0!==_cache){if(_cache.has(Class))return _cache.get(Class);_cache.set(Class,Wrapper)}function Wrapper(){return _construct(Class,arguments,_getPrototypeOf(this).constructor)}return Wrapper.prototype=Object.create(Class.prototype,{constructor:{value:Wrapper,enumerable:!1,writable:!0,configurable:!0}}),_setPrototypeOf(Wrapper,Class)},_wrapNativeSuper(Class)}function _construct(Parent,args,Class){return _construct=_isNativeReflectConstruct()?Reflect.construct.bind():function(Parent,args,Class){var a=[null];a.push.apply(a,args);var instance=new(Function.bind.apply(Parent,a));return Class&&_setPrototypeOf(instance,Class.prototype),instance},_construct.apply(null,arguments)}function _isNativeFunction(fn){return-1!==Function.toString.call(fn).indexOf("[native code]")}function _classStaticPrivateMethodGet(receiver,classConstructor,method){return _classCheckPrivateStaticAccess(receiver,classConstructor),method}function _classStaticPrivateFieldSpecSet(receiver,classConstructor,descriptor,value){return _classCheckPrivateStaticAccess(receiver,classConstructor),_classCheckPrivateStaticFieldDescriptor(descriptor,"set"),_classApplyDescriptorSet(receiver,descriptor,value),value}function _classStaticPrivateFieldSpecGet(receiver,classConstructor,descriptor){return _classCheckPrivateStaticAccess(receiver,classConstructor),_classCheckPrivateStaticFieldDescriptor(descriptor,"get"),_classApplyDescriptorGet(receiver,descriptor)}function _classCheckPrivateStaticFieldDescriptor(descriptor,action){if(void 0===descriptor)throw new TypeError("attempted to "+action+" private static field before its declaration")}function _classCheckPrivateStaticAccess(receiver,classConstructor){if(receiver!==classConstructor)throw new TypeError("Private static access of wrong provenance")}function _toConsumableArray(arr){return _arrayWithoutHoles(arr)||_iterableToArray(arr)||_unsupportedIterableToArray(arr)||_nonIterableSpread()}function _nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _iterableToArray(iter){if("undefined"!=typeof Symbol&&null!=iter[Symbol.iterator]||null!=iter["@@iterator"])return Array.from(iter)}function _arrayWithoutHoles(arr){if(Array.isArray(arr))return _arrayLikeToArray(arr)}function _inherits(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function");subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,writable:!0,configurable:!0}}),Object.defineProperty(subClass,"prototype",{writable:!1}),superClass&&_setPrototypeOf(subClass,superClass)}function _setPrototypeOf(o,p){return _setPrototypeOf=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(o,p){return o.__proto__=p,o},_setPrototypeOf(o,p)}function _createSuper(Derived){var hasNativeReflectConstruct=_isNativeReflectConstruct();return function(){var result,Super=_getPrototypeOf(Derived);if(hasNativeReflectConstruct){var NewTarget=_getPrototypeOf(this).constructor;result=Reflect.construct(Super,arguments,NewTarget)}else result=Super.apply(this,arguments);return _possibleConstructorReturn(this,result)}}function _possibleConstructorReturn(self,call){if(call&&("object"===_typeof(call)||"function"==typeof call))return call;if(void 0!==call)throw new TypeError("Derived constructors may only return object or undefined");return _assertThisInitialized(self)}function _assertThisInitialized(self){if(void 0===self)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return self}function _isNativeReflectConstruct(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}function _getPrototypeOf(o){return _getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(o){return o.__proto__||Object.getPrototypeOf(o)},_getPrototypeOf(o)}function _taggedTemplateLiteral(strings,raw){return raw||(raw=strings.slice(0)),Object.freeze(Object.defineProperties(strings,{raw:{value:Object.freeze(raw)}}))}function ownKeys(object,enumerableOnly){var keys=Object.keys(object);if(Object.getOwnPropertySymbols){var symbols=Object.getOwnPropertySymbols(object);enumerableOnly&&(symbols=symbols.filter((function(sym){return Object.getOwnPropertyDescriptor(object,sym).enumerable}))),keys.push.apply(keys,symbols)}return keys}function _objectSpread(target){for(var i=1;i<arguments.length;i++){var source=null!=arguments[i]?arguments[i]:{};i%2?ownKeys(Object(source),!0).forEach((function(key){_defineProperty(target,key,source[key])})):Object.getOwnPropertyDescriptors?Object.defineProperties(target,Object.getOwnPropertyDescriptors(source)):ownKeys(Object(source)).forEach((function(key){Object.defineProperty(target,key,Object.getOwnPropertyDescriptor(source,key))}))}return target}function _defineProperty(obj,key,value){return(key=_toPropertyKey(key))in obj?Object.defineProperty(obj,key,{value:value,enumerable:!0,configurable:!0,writable:!0}):obj[key]=value,obj}function _classPrivateFieldSet(receiver,privateMap,value){return _classApplyDescriptorSet(receiver,_classExtractFieldDescriptor(receiver,privateMap,"set"),value),value}function _classApplyDescriptorSet(receiver,descriptor,value){if(descriptor.set)descriptor.set.call(receiver,value);else{if(!descriptor.writable)throw new TypeError("attempted to set read only private field");descriptor.value=value}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}function _defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,_toPropertyKey(descriptor.key),descriptor)}}function _createClass(Constructor,protoProps,staticProps){return protoProps&&_defineProperties(Constructor.prototype,protoProps),staticProps&&_defineProperties(Constructor,staticProps),Object.defineProperty(Constructor,"prototype",{writable:!1}),Constructor}function _toPropertyKey(arg){var key=_toPrimitive(arg,"string");return"symbol"===_typeof(key)?key:String(key)}function _toPrimitive(input,hint){if("object"!==_typeof(input)||null===input)return input;var prim=input[Symbol.toPrimitive];if(void 0!==prim){var res=prim.call(input,hint||"default");if("object"!==_typeof(res))return res;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===hint?String:Number)(input)}function _classPrivateMethodInitSpec(obj,privateSet){_checkPrivateRedeclaration(obj,privateSet),privateSet.add(obj)}function _classPrivateFieldInitSpec(obj,privateMap,value){_checkPrivateRedeclaration(obj,privateMap),privateMap.set(obj,value)}function _checkPrivateRedeclaration(obj,privateCollection){if(privateCollection.has(obj))throw new TypeError("Cannot initialize the same private elements twice on an object")}function _classPrivateMethodGet(receiver,privateSet,fn){if(!privateSet.has(receiver))throw new TypeError("attempted to get private field on non-instance");return fn}function _classPrivateFieldGet(receiver,privateMap){return _classApplyDescriptorGet(receiver,_classExtractFieldDescriptor(receiver,privateMap,"get"))}function _classExtractFieldDescriptor(receiver,privateMap,action){if(!privateMap.has(receiver))throw new TypeError("attempted to "+action+" private field on non-instance");return privateMap.get(receiver)}function _classApplyDescriptorGet(receiver,descriptor){return descriptor.get?descriptor.get.call(receiver):descriptor.value}function _createForOfIteratorHelper(o,allowArrayLike){var it="undefined"!=typeof Symbol&&o[Symbol.iterator]||o["@@iterator"];if(!it){if(Array.isArray(o)||(it=_unsupportedIterableToArray(o))||allowArrayLike&&o&&"number"==typeof o.length){it&&(o=it);var i=0,F=function(){};return{s:F,n:function(){return i>=o.length?{done:!0}:{done:!1,value:o[i++]}},e:function(_e){throw _e},f:F}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var err,normalCompletion=!0,didErr=!1;return{s:function(){it=it.call(o)},n:function(){var step=it.next();return normalCompletion=step.done,step},e:function(_e2){didErr=!0,err=_e2},f:function(){try{normalCompletion||null==it.return||it.return()}finally{if(didErr)throw err}}}}function _unsupportedIterableToArray(o,minLen){if(o){if("string"==typeof o)return _arrayLikeToArray(o,minLen);var n=Object.prototype.toString.call(o).slice(8,-1);return"Object"===n&&o.constructor&&(n=o.constructor.name),"Map"===n||"Set"===n?Array.from(o):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?_arrayLikeToArray(o,minLen):void 0}}function _arrayLikeToArray(arr,len){(null==len||len>arr.length)&&(len=arr.length);for(var i=0,arr2=new Array(len);i<len;i++)arr2[i]=arr[i];return arr2}!function(){String.prototype.replaceAll||(String.prototype.replaceAll=function(pattern,replacement){if(pattern instanceof RegExp){if(pattern.flags.indexOf("g")<0)throw new TypeError("String.prototype.replaceAll called with a non-global RegExp argument");return this.replace(pattern,replacement)}return this.replace(new RegExp(pattern,"g"),replacement)});var BuildInfo={isBuilt:function(){return BuildInfo.getMode().indexOf("$")<0},getBuildDate:function(){return"2023-09-18 10:10:43Z"},getBundleName:function(){return"text2lesson.js"},getProductName:function(){return"Text2Lesson"},getMode:function(){return"production"},getVersion:function(){return"1.0.53 "}};function extractWikiMediaLicence(attribution){var match=/^([\s\S]+?),\s*([^&,<]+)\s*(?:(?:<|&lt;)([\s\S]+)(?:>|&gt;))?,\s*via Wikimedia Commons$/g.exec(attribution);return match?{attribution:match[1],shortName:match[2],url:match[3]}:{attribution:attribution,shortName:"",url:""}}function formMarkdownUrl(data){var _data$alignment,_data$authors,_data$licenceName,_data$licenceUrl,_data$notes,prefix="<"===data.alignment?"!<":"".concat(null!==(_data$alignment=data.alignment)&&void 0!==_data$alignment?_data$alignment:"","!");return function(data){return null==data?void 0:data.replace(/\s/g," ")}("".concat(prefix,"[").concat(data.altText,"](").concat(data.imageUrl,' "').concat(data.altText,": ").concat(data.attribution,"|").concat(data.imageSourceUrl,"|").concat(null!==(_data$authors=data.authors)&&void 0!==_data$authors?_data$authors:"","|").concat(null!==(_data$licenceName=data.licenceName)&&void 0!==_data$licenceName?_data$licenceName:"","|").concat(null!==(_data$licenceUrl=data.licenceUrl)&&void 0!==_data$licenceUrl?_data$licenceUrl:"","|").concat(null!==(_data$notes=data.notes)&&void 0!==_data$notes?_data$notes:"",'")'))}var attributionPatterns={WikimediaHtml:{re:/([<])?<a\s+title="([^"]+Wikimedia Commons)"\s+href="([^"]+)"><img\s+(?:width="(\d+)")?\s?alt="([^"]+)"\s+src="([^"]+)">\s*<\/a>/g,rep:function(match,alignment,attribution,imageSourceUrl,width,altText,imageUrl){var _licence$attribution,_licence$shortName,licence=extractWikiMediaLicence(attribution);return formMarkdownUrl({alignment:alignment,altText:null==altText?void 0:altText.trim(),imageUrl:imageUrl,imageSourceUrl:imageSourceUrl,attribution:null===(_licence$attribution=licence.attribution)||void 0===_licence$attribution?void 0:_licence$attribution.trim(),authors:"",licenceName:null===(_licence$shortName=licence.shortName)||void 0===_licence$shortName?void 0:_licence$shortName.trim(),licenceUrl:licence.url,notes:"via Wikimedia Commons"})}},WikimediaBbcode:{re:/\{bbcode\}\s*([<])?\[url=([^\]]+?)\]\s*\[img\]([^[]+?)\[\/img\]\s*\[\/url\]\s*\[url=([^\]]+?)\]([^[]+?)\[\/url\]\s*([\s\S]*?)\{bbcode\}/g,rep:function(match,alignment,imageSourceUrl,imageUrl,imageSourceUrlRepeated,altText,attribution){var _licence$attribution2,_licence$shortName2,licence=extractWikiMediaLicence(attribution);return formMarkdownUrl({alignment:alignment,altText:null==altText?void 0:altText.trim(),imageUrl:imageUrl,imageSourceUrl:imageSourceUrl,attribution:null===(_licence$attribution2=licence.attribution)||void 0===_licence$attribution2?void 0:_licence$attribution2.trim(),authors:"",licenceName:null===(_licence$shortName2=licence.shortName)||void 0===_licence$shortName2?void 0:_licence$shortName2.trim(),licenceUrl:licence.url,notes:"via Wikimedia Commons"})}}};var DOCS_ROOT_URL="https://henspace.github.io/text2lesson-docs/";function parseMathMl(data,warden){return data.replace(/<math[^>]*?>[\s\S]*<\/math>/g,(function(match){return function(html,warden){return html=(html=html.replace(/href\s*="[^"]*"/g,"")).replace(/<(?!semantics|annotation|[m/])/g,"&lt;"),warden.protect(html)}(match,warden)}))}var Entities={Maths:{CENTRE_DOT:{html:"&sdot;",unicode:"⋅"},DIVIDE:{html:"&divide;",unicode:"÷"},EQUALS:{html:"&equals;",unicode:"="},FUNCTION:{html:"&fnof;",unicode:"ƒ"},GREATER_THAN:{html:"&gt;",unicode:">"},GREATER_THAN_OR_EQUAL:{html:"&ge;",unicode:"≥"},INTEGRAL:{html:"&int;",unicode:"∫"},LESS_THAN:{html:"&lt;",unicode:"<"},LESS_THAN_OR_EQUAL:{html:"&le;",unicode:"≤"},MINUS:{html:"&minus;",unicode:"−"},NOT_EQUAL:{html:"&ne;",unicode:"≠"},PARTIAL:{html:"&part;",unicode:"∂"},PLUS:{html:"&plus;",unicode:"+"},SQRT:{html:"&radic;",unicode:"√"},SUM:{html:"&sum;",unicode:"∑"},TIMES:{html:"&times;",unicode:"×"}},Greek:{Alpha:{html:"&Alpha;",unicode:"Α"},Beta:{html:"&Beta;",unicode:"Β"},Gamma:{html:"&Gamma;",unicode:"Γ"},Delta:{html:"&Delta;",unicode:"Δ"},Epsilon:{html:"&Epsilon;",unicode:"Ε"},Zeta:{html:"&Zeta;",unicode:"Ζ"},Eta:{html:"&Eta;",unicode:"Η"},Theta:{html:"&Theta;",unicode:"Θ"},Iota:{html:"&Iota;",unicode:"Ι"},Kappa:{html:"&Kappa;",unicode:"Κ"},Lambda:{html:"&Lambda;",unicode:"Λ"},Mu:{html:"&Mu;",unicode:"Μ"},Nu:{html:"&Nu;",unicode:"Ν"},Xi:{html:"&Xi;",unicode:"Ξ"},Omicron:{html:"&Omicron;",unicode:"Ο"},Pi:{html:"&Pi;",unicode:"Π"},Rho:{html:"&Rho;",unicode:"Ρ"},Sigma:{html:"&Sigma;",unicode:"Σ"},Tau:{html:"&Tau;",unicode:"Τ"},Upsilon:{html:"&Upsilon;",unicode:"Υ"},Phi:{html:"&Phi;",unicode:"Φ"},Chi:{html:"&Chi;",unicode:"Χ"},Psi:{html:"&Psi;",unicode:"Ψ"},Omega:{html:"&Omega;",unicode:"Ω"},alpha:{html:"&alpha;",unicode:"α"},beta:{html:"&beta;",unicode:"β"},gamma:{html:"&gamma;",unicode:"γ"},delta:{html:"&delta;",unicode:"δ"},epsilon:{html:"&epsilon;",unicode:"ε"},zeta:{html:"&zeta;",unicode:"ζ"},eta:{html:"&eta;",unicode:"η"},theta:{html:"&theta;",unicode:"θ"},iota:{html:"&iota;",unicode:"ι"},kappa:{html:"&kappa;",unicode:"κ"},lambda:{html:"&lambda;",unicode:"λ"},mu:{html:"&mu;",unicode:"μ"},nu:{html:"&nu;",unicode:"ν"},xi:{html:"&xi;",unicode:"ξ"},omicron:{html:"&omicron;",unicode:"ο"},pi:{html:"&pi;",unicode:"π"},rho:{html:"&rho;",unicode:"ρ"},sigmaf:{html:"&sigmaf;",unicode:"ς"},sigma:{html:"&sigma;",unicode:"σ"},tau:{html:"&tau;",unicode:"τ"},upsilon:{html:"&upsilon;",unicode:"υ"},phi:{html:"&phi;",unicode:"φ"},chi:{html:"&chi;",unicode:"χ"},psi:{html:"&psi;",unicode:"ψ"},omega:{html:"&omega;",unicode:"ω"}}},CHAR_CODE_UC_A="A".charCodeAt(0),CHAR_CODE_LC_A="a".charCodeAt(0),CHAR_CODE_ZERO="0".charCodeAt(0),CHAR_PLANKS_CONSTANT=String.fromCodePoint(8462);function getMathsCharacter(chr){var mathsChr;if(chr>="A"&&chr<="Z")mathsChr=String.fromCodePoint(119860+chr.charCodeAt(0)-CHAR_CODE_UC_A);else if("h"===chr)mathsChr=CHAR_PLANKS_CONSTANT;else if(chr>="a"&&chr<="z")mathsChr=String.fromCodePoint(119886+chr.charCodeAt(0)-CHAR_CODE_LC_A);else{if(!(chr>="0"&&chr<="9"))return chr;mathsChr=String.fromCodePoint(120822+chr.charCodeAt(0)-CHAR_CODE_ZERO)}return mathsChr}function replaceWordWithEntity(data,word,entity){var re=new RegExp("(^|[^a-zA-Z])".concat(word,"($|[^a-zA-Z])"),"g");return data.replace(re,"$1".concat(entity,"$2"))}var replacementEntities=[{re:/\s*[-]\s*/g,rep:" ".concat(Entities.Maths.MINUS.unicode," ")},{re:/\s*[*]\s*/g,rep:" ".concat(Entities.Maths.TIMES.unicode," ")},{re:/\s+ne(?= )/g,rep:" ".concat(Entities.Maths.NOT_EQUAL.unicode," ")},{re:/\s*(!=|\/=)\s*/g,rep:" ".concat(Entities.Maths.NOT_EQUAL.unicode," ")},{re:/\s*(<|&lt;)=/g,rep:" ".concat(Entities.Maths.LESS_THAN_OR_EQUAL.unicode," ")},{re:/\s*(>|&gt;)=/g,rep:" ".concat(Entities.Maths.GREATER_THAN_OR_EQUAL.unicode," ")},{re:/(^|[^a-zA-Z])sqrt(?=[^a-zA-Z])/gi,rep:"$1".concat(Entities.Maths.SQRT.unicode)},{re:/(^|[^a-zA-Z])sum(?=[^a-zA-Z])/gi,rep:"$1".concat(Entities.Maths.SUM.unicode)},{re:/(^|[^a-zA-Z])int(?=[^a-zA-Z])/gi,rep:"$1".concat(Entities.Maths.INTEGRAL.unicode)},{re:/(^|\s*)d:/g,rep:" ".concat(Entities.Maths.PARTIAL.unicode)},{re:/([a-zA-Z0-9])\.(?=[a-zA-Z])/g,rep:"$1".concat(Entities.Maths.CENTRE_DOT.unicode)}],replacementCharacters=[{re:/((?:^|[^&a-zA-Z])[a-zA-Z]+)/g,rep:function(match,data){console.log("parse maths ".concat(data));var _step,str="",_iterator=_createForOfIteratorHelper(data);try{for(_iterator.s();!(_step=_iterator.n()).done;){str+=getMathsCharacter(_step.value)}}catch(err){_iterator.e(err)}finally{_iterator.f()}return str}}],replacementDigits=[{re:/([0-9]+)/g,rep:function(match,data){console.log("parse maths ".concat(data));var _step2,str="",_iterator2=_createForOfIteratorHelper(data);try{for(_iterator2.s();!(_step2=_iterator2.n()).done;){str+=getMathsCharacter(_step2.value)}}catch(err){_iterator2.e(err)}finally{_iterator2.f()}return str}}],replacementsWithTagsBlockOnly=[{re:/((?:\(.*?\))|[^\s]+)\s*\/\s*((?:\(.*?\))|[^\s]+)/g,rep:"<table><tr><td>$1</td></tr><tr><td>$2</td></tr></table>"}],replacementsWithTagsInlineOnly=[{re:/\//g,rep:"".concat(Entities.Maths.DIVIDE.unicode)}],replacementsWithTags=[{re:/\s*\^\s*((?:\(.*?\))|[^\s)]+)/g,rep:"<sup>$1</sup>"},{re:/\s*_\s*((?:\(.*?\))|[^\s)]+)/g,rep:"<sub>$1</sub>"},{re:/:/g,rep:""},{re:/ +/g,rep:"&nbsp;"},{re:new RegExp("".concat(Entities.Maths.INTEGRAL.unicode),"gu"),rep:'<span class="high-symbol">'.concat(Entities.Maths.INTEGRAL.unicode,"</span>")},{re:new RegExp("".concat(Entities.Maths.SQRT.unicode,"\\[([^\\]]*?)\\]"),"gu"),rep:'<span class="radic">'.concat(Entities.Maths.SQRT.unicode,'</span><span class="sqrt">$1</span>')}];function implementReplacements(target,replacements){var _step3,_iterator3=_createForOfIteratorHelper(replacements);try{for(_iterator3.s();!(_step3=_iterator3.n()).done;){var sub=_step3.value;target=target.replace(sub.re,sub.rep)}}catch(err){_iterator3.e(err)}finally{_iterator3.f()}return target}function parseMaths(data,inline){var tag=inline?"span":"div";return data=implementReplacements(data=function(data){for(var letter in Entities.Greek)data=replaceWordWithEntity(data,letter,Entities.Greek[letter].unicode);return data}(data),replacementEntities),data=implementReplacements(data,replacementDigits),data=implementReplacements(data,replacementCharacters),data=implementReplacements(data,inline?replacementsWithTagsInlineOnly:replacementsWithTagsBlockOnly),data=implementReplacements(data,replacementsWithTags)," <".concat(tag,' class="maths">').concat(data,"</").concat(tag,"> ")}function stringToBase64(str){return window.btoa(encodeURIComponent(str))}function base64ToString(base64){return decodeURIComponent(window.atob(base64))}var _wards=new WeakMap,_createKeyCode=new WeakSet;function _createKeyCode2(data){return stringToBase64(data).replace(/=/g,":")}var parsingWarden=new(function(){function ParsingWarden(){_classCallCheck(this,ParsingWarden),_classPrivateMethodInitSpec(this,_createKeyCode),_classPrivateFieldInitSpec(this,_wards,{writable:!0,value:new Map})}return _createClass(ParsingWarden,[{key:"clear",value:function(){_classPrivateFieldGet(this,_wards).clear()}},{key:"protect",value:function(data){if(!data)return data;var key="???".concat(_classPrivateFieldGet(this,_wards).size).concat(_classPrivateMethodGet(this,_createKeyCode,_createKeyCode2).call(this,data),"???");return _classPrivateFieldGet(this,_wards).set(key,data),key}},{key:"retrieve",value:function(key){var value=_classPrivateFieldGet(this,_wards).get(key);return _classPrivateFieldGet(this,_wards).delete(key),value||(console.error("Could not find ".concat(key," in protected data.")),key)}},{key:"reinstate",value:function(data){var _this=this;return data.replace(/[?]{3}\d+[a-zA-Z0-9+/]+:{0,2}[?]{3}/g,(function(match){return _this.retrieve(match)}))}}]),ParsingWarden}());function getPrintableLink(href,parentheses){return'<span class="printable-link for-print-only">'.concat(parentheses?"(":"").concat(href).concat(parentheses?")":"","</span>")}var blockReps=[{re:/(?:(.+)\n=+\n)/g,rep:"\n\n<h1>$1</h1>\n\n"},{re:/(?:(.+)\n-+\n)/g,rep:"\n\n<h2>$1</h2>\n\n"},{re:/^(#+)(?: *)(.+?)(?:#*)[ \t]*$/gm,rep:function(matched,hashes,txt){var level=Math.min(hashes.length,6);return"\n\n<h".concat(level,">").concat(txt.trim(),"</h").concat(level,">\n")}},reAllLinesStartWith(">[ \t]*",{blockPrefix:"<blockquote>",blockSuffix:"</blockquote>"}),reAllLinesStartWith("(?: {4}|\t)",{blockPrefix:"<pre><code>",blockSuffix:"</code></pre>",trimContents:!0,useWarden:!0}),{re:/^(?:[*_-] *){3,}\s*$/gm,rep:"\n\n<hr>\n\n"},reAllLinesStartWith(" {0,3}[*+-][ \t]+",{blockPrefix:"<ul>",blockSuffix:"</ul>",linePrefix:"<li>",lineSuffix:"</li>"}),reAllLinesStartWith(" {0,3}\\d+\\.[ \t]+",{blockPrefix:"<ol>",blockSuffix:"</ol>",linePrefix:"<li>",lineSuffix:"</li>"}),{re:/^\s*maths?:\s*(.+?)\s*$/gm,rep:function(match,equation){return parseMaths(equation,!1)}}],paragraphReps=[{re:/(?:(?:^|\n{2,})(?!<\w+>))((?:.(?:\n(?!\n))?)+)/g,rep:"\n\n<p>$1</p>\n\n"},{re:/\n{2,}/g,rep:"\n\n"}],spanReps=[{re:/{maths?}(.+?){maths?}/gm,rep:function(match,equation){return parseMaths(equation,!0)}},{re:/!(&lt;)?\[(.*?)\]\((https?:\/\/[-\w@:%.+~#=/]+?)(?: +"(.*?)")?\)/gm,rep:function(match,floatLeft,altText,src,title){var additionalClass=floatLeft?"floatable":"",html='<img alt="'.concat(null!=altText?altText:"",'" class="').concat(additionalClass,'" src="').concat(src,'" title="').concat(null!=title?title:"",'"/>');return parsingWarden.protect(html)}},{re:/\[(.*?)\]\((https?:\/\/[-\w@:%.+~#=/]+?)(?: +"(.*?)")?\)/gm,rep:function(match,label,href,title){var _label;label=function(href,label){var iconHtml="";return/^https:\/\/vimeo.com\//.test(href)?iconHtml='<i class="fa-brands fa-vimeo"></i>':/^https:\/\/(www\.)?youtube.com\//.test(href)&&(iconHtml='<i class="fa-brands fa-youtube"></i>'),iconHtml&&(iconHtml="<span class='link-icon'>".concat(iconHtml,"</span>")),"".concat(label).concat(iconHtml)}(href,label);var html='<a target="_blank" href="'.concat(href,'" title="').concat(null!=title?title:"",'">').concat(null!==(_label=label)&&void 0!==_label?_label:"","</a>").concat(getPrintableLink(href,!0));return parsingWarden.protect(html)}},{re:/(?:&lt;|<)(https?:\/\/[-\w@:%.+~#=/]+?)>/gm,rep:function(match,href){var html='<a target="_blank" href="'.concat(href,'">').concat(href,"</a>").concat(getPrintableLink(href,!0));return parsingWarden.protect(html)}},{re:/(?:&lt;|<)([\w.-]+@(?:[\w-]+\.)+[\w-]+)/gm,rep:function(match,address){var encoded=function(data){var _step4,result="",_iterator4=_createForOfIteratorHelper(data);try{for(_iterator4.s();!(_step4=_iterator4.n()).done;){result+=encodeCharToEntity(_step4.value)}}catch(err){_iterator4.e(err)}finally{_iterator4.f()}return result}(address),html='<a href="'.concat(encoded,'">').concat(encoded,"</a>");return parsingWarden.protect(html)}},{re:/(?:`{2,}(.*?)`{2,}|`(.*?)`)/gm,rep:function(match,codeA,codeB){var html="<code>".concat(null!=codeA?codeA:codeB,"</code>");return parsingWarden.protect(html)}},{re:/\*\*([^\s])(.*?)([^\s])\*\*/gm,rep:"<strong>$1$2$3</strong>"},{re:/__([^\s])(.*?)([^\s])__/gm,rep:"<strong>$1$2$3</strong>"},{re:/\*([^\s])(.*?)([^\s])\*/gm,rep:"<em>$1$2$3</em>"},{re:/_([^\s])(.*?)([^\s])_/gm,rep:"<em>$1$2$3</em>"}],markdownEscReps=[{re:/\\([\\`*_{}[\]()#+.!-])/g,rep:function(match,chr){return encodeCharToEntity(chr)}}],securityReps=[{re:"\0",rep:"�"}],htmlEscIgnoringBrReps=[{re:/&(?![\w#]+?;)/gm,rep:"&amp;"},{re:/<(?!\/?(?:br|sub|sup)>)/gim,rep:"&lt;"}],htmlEscAllReps=[{re:/&(?![\w#]+?;)/gm,rep:"&amp;"},{re:/</gim,rep:"&lt;"}],htmlCleanUpReps=[{re:/^\s*$/gm,rep:""},{re:/<(?:p|div)>\s*?<\/(?:p|div)>/gim,rep:""}];function processReplacements(data,replacements){return data?(replacements.forEach((function(sub){data=data.replaceAll(sub.re,sub.rep)})),data):data}function reAllLinesStartWith(reStart,options){var _options$linePrefix,_options$lineSuffix,reBlockSearchRe=new RegExp("(?:^|\\n)".concat(reStart,"(?:.|\\n)*?(?:(\\n(?!").concat(reStart,"))|$)"),"g"),lineReplacementRe=new RegExp("^".concat(reStart,"([ \\t]*.*)$"),"gm"),lineReplacement="".concat(null!==(_options$linePrefix=null==options?void 0:options.linePrefix)&&void 0!==_options$linePrefix?_options$linePrefix:"","$1").concat(null!==(_options$lineSuffix=null==options?void 0:options.lineSuffix)&&void 0!==_options$lineSuffix?_options$lineSuffix:"");return{re:reBlockSearchRe,rep:function(match){var _options$blockPrefix,_options$blockSuffix,blockContents=match.replaceAll(lineReplacementRe,lineReplacement);return options.trimContents&&(blockContents=blockContents.replace(/^[\n\r]*/,"").trimEnd()),options.useWarden&&(blockContents=parsingWarden.protect(blockContents)),"\n\n".concat(null!==(_options$blockPrefix=null==options?void 0:options.blockPrefix)&&void 0!==_options$blockPrefix?_options$blockPrefix:"").concat(blockContents).concat(null!==(_options$blockSuffix=null==options?void 0:options.blockSuffix)&&void 0!==_options$blockSuffix?_options$blockSuffix:"","\n\n")}}}function encodeCharToEntity(chr){return"&#".concat(chr.charCodeAt(0).toString(),";")}function parseMarkdown(data,options){parsingWarden.clear();var result=data.replaceAll(/\r/g,"");return result=function(data){for(var key in attributionPatterns){var pattern=attributionPatterns[key];data=data.replace(pattern.re,pattern.rep)}return data}(result),result=processReplacements(result,securityReps),null!=options&&options.pre&&(result=processReplacements(result,options.pre)),result=processReplacements(result=parseMathMl(result,parsingWarden),htmlEscIgnoringBrReps),result=processReplacements(result,markdownEscReps),result=processReplacements(result,blockReps),result=processReplacements(result,paragraphReps),result=processReplacements(result,spanReps),result=processReplacements(result,htmlCleanUpReps),null!=options&&options.post&&(result=processReplacements(result,options.post)),parsingWarden.reinstate(result)}function parseMarkdownSpanOnly(data){parsingWarden.clear();var result=data.replaceAll(/\r/g,"");return result=processReplacements(result,securityReps),result=processReplacements(result=parseMathMl(result,parsingWarden),htmlEscIgnoringBrReps),result=processReplacements(result,markdownEscReps),result=processReplacements(result,spanReps),result=processReplacements(result,htmlCleanUpReps),parsingWarden.reinstate(result)}function escapeHtml(data){return data=processReplacements(data,securityReps),processReplacements(data,htmlEscAllReps)}function getPlainTextFromHtml(html){var plain=html.replace(/<table><tr><td>([^<]*)<\/td><\/tr><tr><td>([^<]*)<\/td><\/tr><\/table>/g,"$1 ".concat(Entities.Maths.DIVIDE.unicode," $2")).replace("<sup>","^").replace("</sup>","").replace("<sub>","_").replace("</sub>","");return function(data){var decoded=data.replaceAll(/&#([0-9]{1,4});/g,(function(match,value){return String.fromCharCode(parseInt(value))+"­"}));return(decoded=(decoded=(decoded=(decoded=(decoded=decoded.replace(/&lt;/gi,"<")).replace(/&gt;/gi,">")).replace(/&nbsp;/gi," ")).replace(/&amp;/gi,"&")).replace(/</gi,"<­")).replace(/&/gi,"&­")}(plain=plain.replace(/<[^>]*>/g,"").replace(/\s+/g," "))}var activeTranslations=null,fallbackTranslations=null;function setActiveTranslations(translations){!function(translations){for(var key in translations)translations[key]=escapeHtml(translations[key])}(translations),activeTranslations&&(fallbackTranslations=activeTranslations),activeTranslations=translations}function i18n(strings){var keyMatch=strings[0].match(/(\w+?)::(.*)/),keyword="",result=[];keyMatch?(keyword=keyMatch[1],result.push(keyMatch[2])):result.push(strings[0]);var output,template=activeTranslations?activeTranslations[keyword]:null;template||(template=fallbackTranslations?fallbackTranslations[keyword]:null);for(var _len=arguments.length,values=new Array(_len>1?_len-1:0),_key=1;_key<_len;_key++)values[_key-1]=arguments[_key];return template?output=function(template,values){var defaultIndex=0;return template.replace(/\${(.*?)}/g,(function(match,index){return index=parseInt(index),isNaN(index)&&(index=defaultIndex++),index<values.length?values[index]:(console.error("Cannot find {".concat(index,'} for "').concat(template,'"')),"${?}")}))}(template,values):(values.forEach((function(value,i){result.push(value),result.push(strings[i+1])})),output=result.join("")),output}function extractLanguageSubTags(languageTag){var language="",extlang="",script="",region="",matches=(languageTag=languageTag.toLowerCase()).match(/^([a-z]{2,3})(-[a-z]{3}(?:-[a-z]{3}){0,2})?(-[a-z]{4})?(-(?:[a-z]{2}|[0-9]{3}))?([-].{5,})?$/);return matches&&(language=matches[1],extlang=matches[2]?matches[2].substring(1):"",script=matches[3]?matches[3].substring(1):"",region=matches[4]?matches[4].substring(1):""),{language:language,extlang:extlang,script:script,region:region}}function RGB(red,green,blue){this.red=red,this.green=green,this.blue=blue}function HSL(hue,saturation,luminance){this.hue=hue,this.saturation=saturation,this.luminance=luminance}function relativeLuminance(rgbColor){var RsRGB=rgbColor.red/255,GsRGB=rgbColor.green/255,BsRGB=rgbColor.blue/255;return 100*(.2126*(RsRGB<=.03928?RsRGB/12.92:Math.pow((RsRGB+.055)/1.055,2.4))+.7152*(GsRGB<=.03928?GsRGB/12.92:Math.pow((GsRGB+.055)/1.055,2.4))+.0722*(BsRGB<=.03928?BsRGB/12.92:Math.pow((BsRGB+.055)/1.055,2.4)))}function isDark(rgbColor){return relativeLuminance(rgbColor)<50}function rgbToHsl(rgbValue){var RsRGB=rgbValue.red/255,GsRGB=rgbValue.green/255,BsRGB=rgbValue.blue/255,minChannelValue=Math.min(RsRGB,GsRGB,BsRGB),maxChannelValue=Math.max(RsRGB,GsRGB,BsRGB),channelRange=maxChannelValue-minChannelValue,luminance=(minChannelValue+maxChannelValue)/2;if(Math.abs(channelRange)<.001)return{hue:0,saturation:0,luminance:Math.round(100*luminance)};var saturation=0;saturation=luminance<=.5?channelRange/(minChannelValue+maxChannelValue):channelRange/(2-maxChannelValue-minChannelValue);var hue=0;return 0!==channelRange&&(hue=Math.abs(maxChannelValue-RsRGB)<.001?(GsRGB-BsRGB)/channelRange:Math.abs(maxChannelValue-GsRGB)<.001?2+(BsRGB-RsRGB)/channelRange:4+(RsRGB-GsRGB)/channelRange),(hue*=60)<0&&(hue+=360),{hue:Math.round(hue),saturation:Math.round(100*saturation),luminance:Math.round(100*luminance)}}function hslToRgb(hslValue){var S=hslValue.saturation/100,L=hslValue.luminance/100,C=(1-Math.abs(2*L-1))*S,Htick=hslValue.hue/60,X=C*(1-Math.abs(Htick%2-1)),RGBtick={};RGBtick=0<=Htick&&Htick<1?{red:C,green:X,blue:0}:Htick<2?{red:X,green:C,blue:0}:Htick<3?{red:0,green:C,blue:X}:Htick<4?{red:0,green:X,blue:C}:Htick<5?{red:X,green:0,blue:C}:{red:C,green:0,blue:X};var m=L-C/2;return new RGB(Math.round(255*(RGBtick.red+m)),Math.round(255*(RGBtick.green+m)),Math.round(255*(RGBtick.blue+m)))}function getDarker(rgbColor,delta){var hslColor=rgbToHsl(rgbColor);return hslColor.luminance-=delta,hslColor.luminance=Math.max(hslColor.luminance,0),hslToRgb(hslColor)}function getLighter(rgbColor,delta){var hslColor=rgbToHsl(rgbColor);return hslColor.luminance+=delta,hslColor.luminance=Math.min(hslColor.luminance,100),hslToRgb(hslColor)}function shiftHue(rgbValue,degrees){var hsl=rgbToHsl(rgbValue);return hsl.hue,hsl.hue+=degrees,hsl.hue%=360,hsl.hue<0&&(hsl.hue+=360),hslToRgb(hsl)}var root=document.querySelector(":root");function setProperty(propertyName,propertyValue){root.style.setProperty(propertyName,propertyValue)}function PaletteEntry(base,contrast,highlight){this.base=base,this.contrast=contrast,this.highlight=highlight}function Palette(config){this.primary=config.primary,this.secondary=config.secondary,this.tertiary=config.tertiary,this.background=config.background,this.window=config.window,this.error=config.error}function getPaletteEntry(rgbColor){var highlight;highlight=isDark(rgbColor)?getLighter(rgbColor,10):getDarker(rgbColor,10);var contrastColor=function(rgbColor){return isDark(rgbColor)?{red:255,green:255,blue:255}:{red:0,green:0,blue:0}}(rgbColor);return new PaletteEntry(rgbColor=function(rgbColor,rgbColorReference,minContrast){for(var rgbColorB,contrast,refIsDark=isDark(rgbColorReference),loopLimit=Math.floor(20);loopLimit--&&(rgbColorB=rgbColorReference,contrast=void 0,((contrast=(relativeLuminance(rgbColor)/100+.05)/(relativeLuminance(rgbColorB)/100+.05))<1?1/contrast:contrast)<minContrast);)rgbColor=refIsDark?getLighter(rgbColor,5):getDarker(rgbColor,5);return rgbColor}(rgbColor,contrastColor,7.5),contrastColor,highlight)}function setCssFromPaletteEntry(key,paletteEntry){for(var subkey in paletteEntry)relativeLuminance(paletteEntry.base),relativeLuminance(paletteEntry.contrast),setProperty("--".concat(key,"-").concat(subkey),(rgbColor=paletteEntry[subkey],"rgb(".concat(rgbColor.red,", ").concat(rgbColor.green,", ").concat(rgbColor.blue,")")));var rgbColor}function fetchJson(url){return fetchFile(url,"json")}function fetchFile(url,responseType){return console.debug("Fetch ".concat(url)),fetch(url).then((function(response){return response.ok?"json"===responseType.toLocaleLowerCase()?response.json():response.text():Promise.reject(new Error("".concat(response.status,": ").concat(response.statusText,"; ").concat(url)))}))}var _info=new WeakMap,_content=new WeakMap,CachedLesson=function(){function CachedLesson(info,content){_classCallCheck(this,CachedLesson),_classPrivateFieldInitSpec(this,_info,{writable:!0,value:void 0}),_classPrivateFieldInitSpec(this,_content,{writable:!0,value:void 0}),_classPrivateFieldSet(this,_info,info),_classPrivateFieldSet(this,_content,content)}return _createClass(CachedLesson,[{key:"content",get:function(){return _classPrivateFieldGet(this,_content)},set:function(content){_classPrivateFieldSet(this,_content,content)}},{key:"info",get:function(){return _classPrivateFieldGet(this,_info)}}],[{key:"clone",value:function(other){var cloned=new CachedLesson(null);return _classPrivateFieldSet(cloned,_info,_objectSpread({},other.info)),_classPrivateFieldSet(cloned,_content,other.content),cloned}}]),CachedLesson}(),_element=new WeakMap,_listeningTargets=new WeakMap,_managedChildren=new WeakMap,_elementRemovable=new WeakMap,ManagedElement=function(){function ManagedElement(tagOrElement,className){_classCallCheck(this,ManagedElement),_classPrivateFieldInitSpec(this,_element,{writable:!0,value:void 0}),_classPrivateFieldInitSpec(this,_listeningTargets,{writable:!0,value:void 0}),_classPrivateFieldInitSpec(this,_managedChildren,{writable:!0,value:void 0}),_classPrivateFieldInitSpec(this,_elementRemovable,{writable:!0,value:void 0}),tagOrElement instanceof Element?(_classPrivateFieldSet(this,_element,tagOrElement),_classPrivateFieldSet(this,_elementRemovable,!1)):(_classPrivateFieldSet(this,_element,document.createElement(tagOrElement)),_classPrivateFieldSet(this,_elementRemovable,!0)),className&&(_classPrivateFieldGet(this,_element).className=className),_classPrivateFieldSet(this,_listeningTargets,[]),_classPrivateFieldSet(this,_managedChildren,[])}return _createClass(ManagedElement,[{key:"element",get:function(){return _classPrivateFieldGet(this,_element)}},{key:"$",get:function(){return _classPrivateFieldGet(this,_element)}},{key:"disabled",get:function(){return _classPrivateFieldGet(this,_element).disabled},set:function(value){_classPrivateFieldGet(this,_element).disabled=value}},{key:"id",get:function(){return _classPrivateFieldGet(this,_element).id},set:function(value){_classPrivateFieldGet(this,_element).id=value}},{key:"managedChildren",get:function(){return _classPrivateFieldGet(this,_managedChildren)}},{key:"classList",get:function(){return _classPrivateFieldGet(this,_element).classList}},{key:"className",get:function(){return _classPrivateFieldGet(this,_element).className},set:function(value){_classPrivateFieldGet(this,_element).className=value}},{key:"checked",get:function(){return _classPrivateFieldGet(this,_element).checked},set:function(state){_classPrivateFieldGet(this,_element).checked=state}},{key:"children",get:function(){return _classPrivateFieldGet(this,_element).children}},{key:"innerHTML",get:function(){return _classPrivateFieldGet(this,_element).innerHTML},set:function(data){_classPrivateFieldGet(this,_element).innerHTML=data}},{key:"lastElementChild",get:function(){return _classPrivateFieldGet(this,_element).lastElementChild}},{key:"offsetHeight",get:function(){return _classPrivateFieldGet(this,_element).offsetHeight}},{key:"offsetWidth",get:function(){return _classPrivateFieldGet(this,_element).offsetWidth}},{key:"parentElement",get:function(){return _classPrivateFieldGet(this,_element).parentElement}},{key:"style",get:function(){return _classPrivateFieldGet(this,_element).style}},{key:"tagName",get:function(){return _classPrivateFieldGet(this,_element).tagName}},{key:"textContent",get:function(){return _classPrivateFieldGet(this,_element).textContent},set:function(data){_classPrivateFieldGet(this,_element).textContent=data}},{key:"value",get:function(){return _classPrivateFieldGet(this,_element).value},set:function(data){_classPrivateFieldGet(this,_element).value=data}},{key:"appendChild",value:function(managedElement){return _classPrivateFieldGet(this,_element).appendChild(managedElement.element),_classPrivateFieldGet(this,_managedChildren).push(managedElement),managedElement}},{key:"appendChildTo",value:function(managedElement,parent){var _managedElement$eleme;parent.appendChild(null!==(_managedElement$eleme=managedElement.element)&&void 0!==_managedElement$eleme?_managedElement$eleme:managedElement),_classPrivateFieldGet(this,_managedChildren).push(managedElement)}},{key:"appendTo",value:function(parent){parent.appendChild(_classPrivateFieldGet(this,_element))}},{key:"createAndAppendChild",value:function(tagName,cssClass,html){var managedElement=new ManagedElement(tagName);return cssClass&&managedElement.classList.add(cssClass),html&&(managedElement.innerHTML=html),this.appendChild(managedElement),managedElement}},{key:"dispatchEvent",value:function(event){return _classPrivateFieldGet(this,_element).dispatchEvent(event)}},{key:"fadeOut",value:function(){_classPrivateFieldGet(this,_element).classList.remove("fade-in"),_classPrivateFieldGet(this,_element).classList.add("fade-out")}},{key:"fadeIn",value:function(){_classPrivateFieldGet(this,_element).classList.remove("fade-out"),_classPrivateFieldGet(this,_element).classList.add("fade-in")}},{key:"focus",value:function(){_classPrivateFieldGet(this,_element).focus()}},{key:"getBoundingClientRect",value:function(){return _classPrivateFieldGet(this,_element).getBoundingClientRect()}},{key:"handleEvent",value:function(event){var _this$handlerName;console.debug("Event ".concat(event.type," fired on <").concat(event.currentTarget.tagName,">: class ").concat(event.target.className,"."));var handlerName="handle"+event.type.charAt(0).toUpperCase()+event.type.substring(1)+"Event",eventId=event.currentTarget.getAttribute("data-event-id");null===(_this$handlerName=this[handlerName])||void 0===_this$handlerName||_this$handlerName.call(this,event,eventId)}},{key:"hide",value:function(){_classPrivateFieldGet(this,_element).style.display="none"}},{key:"insertChildAtTop",value:function(managedElement){var _managedElement$eleme2;return _classPrivateFieldGet(this,_element).insertBefore(null!==(_managedElement$eleme2=managedElement.element)&&void 0!==_managedElement$eleme2?_managedElement$eleme2:managedElement,_classPrivateFieldGet(this,_element).firstChild),_classPrivateFieldGet(this,_managedChildren).push(managedElement),managedElement}},{key:"listenToOwnEvent",value:function(eventType,eventIdOrHandler,options){this.listenToEventOn(eventType,this,eventIdOrHandler,options)}},{key:"listenToEventOn",value:function(eventType,target,eventIdOrHandler,options){if(!(target instanceof ManagedElement))throw new Error("Expect ManagedElement");_classPrivateFieldGet(this,_listeningTargets).push({managedElement:target,eventType:eventType,options:options}),eventIdOrHandler instanceof Function?target.$.addEventListener(eventType,eventIdOrHandler,options):(null!=eventIdOrHandler&&target.setAttribute("data-event-id",eventIdOrHandler),target.$.addEventListener(eventType,this,options))}},{key:"querySelector",value:function(selectors){return _classPrivateFieldGet(this,_element).querySelector(selectors)}},{key:"querySelectorAll",value:function(selectors){return _classPrivateFieldGet(this,_element).querySelectorAll(selectors)}},{key:"remove",value:function(){this.removeListeners(),this.removeChildren(),_classPrivateFieldGet(this,_elementRemovable)&&_classPrivateFieldGet(this,_element).remove()}},{key:"removeChildren",value:function(){for(_classPrivateFieldGet(this,_managedChildren).forEach((function(child){child.remove()})),_classPrivateFieldSet(this,_managedChildren,[]);_classPrivateFieldGet(this,_element).firstChild;)_classPrivateFieldGet(this,_element).removeChild(_classPrivateFieldGet(this,_element).lastChild)}},{key:"removeListeners",value:function(){var _this2=this;_classPrivateFieldGet(this,_listeningTargets).forEach((function(target){target.managedElement.element.removeEventListener(target.eventType,_this2,target.options)})),_classPrivateFieldGet(this,_managedChildren).forEach((function(child){child.removeListeners()})),_classPrivateFieldSet(this,_listeningTargets,[])}},{key:"setSafeAttribute",value:function(name,value){_classPrivateFieldGet(this,_element).setAttribute(name,ManagedElement.encodeString(value))}},{key:"setAttribute",value:function(name,value){return _classPrivateFieldGet(this,_element).setAttribute(name,value)}},{key:"show",value:function(){_classPrivateFieldGet(this,_element).style.display="unset"}},{key:"getSafeAttribute",value:function(name){return ManagedElement.decodeString(_classPrivateFieldGet(this,_element).getAttribute(name))}},{key:"setAttributes",value:function(attributes){for(var key in attributes){var value=attributes[key];null!=value&&null!=value&&""!==value&&_classPrivateFieldGet(this,_element).setAttribute(key,value)}}}],[{key:"getElement",value:function(item){return item instanceof ManagedElement?item.element:item}},{key:"$",value:function(item){return item instanceof ManagedElement?item.element:item}},{key:"decodeString",value:function(value){return base64ToString(value)}},{key:"encodeString",value:function(value){return stringToBase64(value)}},{key:"getSafeAttribute",value:function(element,name){return ManagedElement.decodeString(element.getAttribute(name))}}]),ManagedElement}(),HTML_SEMANTIC_ROLES={A:"link",BUTTON:"button"},_cache=new WeakMap,_hideText=new WeakMap,_getIconHtml=new WeakSet,IconGenerator=function(){function IconGenerator(){_classCallCheck(this,IconGenerator),_classPrivateMethodInitSpec(this,_getIconHtml),_classPrivateFieldInitSpec(this,_cache,{writable:!0,value:new Map}),_classPrivateFieldInitSpec(this,_hideText,{writable:!0,value:void 0})}return _createClass(IconGenerator,[{key:"hideText",get:function(){return _classPrivateFieldGet(this,_hideText)},set:function(value){_classPrivateFieldSet(this,_hideText,value)}},{key:"addLesson",get:function(){return{content:_classPrivateMethodGet(this,_getIconHtml,_getIconHtml2).call(this,"--icon-add-lesson-html"),accessibleName:i18n(_templateObject||(_templateObject=_taggedTemplateLiteral(["d6e44bc735e33192ee2ddce4af2f2be6::"])))}}},{key:"back",get:function(){return{content:_classPrivateMethodGet(this,_getIconHtml,_getIconHtml2).call(this,"--icon-back-nav-html"),accessibleName:i18n(_templateObject2||(_templateObject2=_taggedTemplateLiteral(["0557fa923dcee4d0f86b1409f5c2167f::"])))}}},{key:"cancel",get:function(){return{content:_classPrivateMethodGet(this,_getIconHtml,_getIconHtml2).call(this,"--icon-cancel-html"),accessibleName:i18n(_templateObject3||(_templateObject3=_taggedTemplateLiteral(["ea4788705e6873b424c65e91c2846b19::"])))}}},{key:"closeEditor",get:function(){return{content:_classPrivateMethodGet(this,_getIconHtml,_getIconHtml2).call(this,"--icon-close-editor-html"),accessibleName:i18n(_templateObject4||(_templateObject4=_taggedTemplateLiteral(["218ed7e6bf7ff30555652c87feff7cd7::"])))}}},{key:"closeMenu",get:function(){return{content:_classPrivateMethodGet(this,_getIconHtml,_getIconHtml2).call(this,"--icon-close-menu-html"),accessibleName:i18n(_templateObject5||(_templateObject5=_taggedTemplateLiteral(["68f18f6b55f955ad05e4a174341bf3f1::"])))}}},{key:"delete",get:function(){return{content:_classPrivateMethodGet(this,_getIconHtml,_getIconHtml2).call(this,"--icon-delete-html"),accessibleName:i18n(_templateObject6||(_templateObject6=_taggedTemplateLiteral(["f2a6c498fb90ee345d997f888fce3b18::"])))}}},{key:"edit",get:function(){return{content:_classPrivateMethodGet(this,_getIconHtml,_getIconHtml2).call(this,"--icon-edit-html"),accessibleName:i18n(_templateObject7||(_templateObject7=_taggedTemplateLiteral(["7dce122004969d56ae2e0245cb754d35::"])))}}},{key:"email",get:function(){return{content:_classPrivateMethodGet(this,_getIconHtml,_getIconHtml2).call(this,"--icon-email-html"),accessibleName:i18n(_templateObject8||(_templateObject8=_taggedTemplateLiteral(["ce8ae9da5b7cd6c3df2929543a9af92d::"])))}}},{key:"error",get:function(){return{content:_classPrivateMethodGet(this,_getIconHtml,_getIconHtml2).call(this,"--icon-error-html"),accessibleName:i18n(_templateObject9||(_templateObject9=_taggedTemplateLiteral(["64d2cc43035360eddf790efbef5ddb30::"])))}}},{key:"exit",get:function(){return{content:_classPrivateMethodGet(this,_getIconHtml,_getIconHtml2).call(this,"--icon-exit-html"),accessibleName:i18n(_templateObject10||(_templateObject10=_taggedTemplateLiteral(["cfce38c3725a96fb69d437d1f6af351c::"])))}}},{key:"export",get:function(){return{content:_classPrivateMethodGet(this,_getIconHtml,_getIconHtml2).call(this,"--icon-export-html"),accessibleName:i18n(_templateObject11||(_templateObject11=_taggedTemplateLiteral(["3a7ff7e7931df81408c4e1465364c699::"])))}}},{key:"exportAutoRun",get:function(){return{content:_classPrivateMethodGet(this,_getIconHtml,_getIconHtml2).call(this,"--icon-export-autorun-html"),accessibleName:i18n(_templateObject12||(_templateObject12=_taggedTemplateLiteral(["65b03512ff197b6b8899ba755db630f9::"])))}}},{key:"fatal",get:function(){return{content:_classPrivateMethodGet(this,_getIconHtml,_getIconHtml2).call(this,"--icon-fatal-html"),accessibleName:i18n(_templateObject13||(_templateObject13=_taggedTemplateLiteral(["64d2cc43035360eddf790efbef5ddb30::"])))}}},{key:"flag",get:function(){return{content:_classPrivateMethodGet(this,_getIconHtml,_getIconHtml2).call(this,"--icon-flagged-html"),accessibleName:i18n(_templateObject14||(_templateObject14=_taggedTemplateLiteral(["c5836008c1649301e29351a55db8f65c::"])))}}},{key:"image",get:function(){return{content:_classPrivateMethodGet(this,_getIconHtml,_getIconHtml2).call(this,"--icon-image-html"),accessibleName:i18n(_templateObject15||(_templateObject15=_taggedTemplateLiteral(["be53a0541a6d36f6ecb879fa2c584b08::"])))}}},{key:"imageInfo",get:function(){return{content:_classPrivateMethodGet(this,_getIconHtml,_getIconHtml2).call(this,"--icon-image-info-html"),accessibleName:i18n(_templateObject16||(_templateObject16=_taggedTemplateLiteral(["d5aed5edc660d95bd24c074fb36974ec::"])))}}},{key:"hourglass",get:function(){return{content:_classPrivateMethodGet(this,_getIconHtml,_getIconHtml2).call(this,"--icon-hourglass-html"),accessibleName:i18n(_templateObject17||(_templateObject17=_taggedTemplateLiteral(["07f484e89e3e82f48cb7cbebd115cbce::"])))}}},{key:"openFolder",get:function(){return{content:_classPrivateMethodGet(this,_getIconHtml,_getIconHtml2).call(this,"--icon-open-folder-html"),accessibleName:i18n(_templateObject18||(_templateObject18=_taggedTemplateLiteral(["a6e75eb31dc77e8d077fb6f92909e191::"])))}}},{key:"fontSize",get:function(){return{content:_classPrivateMethodGet(this,_getIconHtml,_getIconHtml2).call(this,"--icon-font-size-html"),accessibleName:i18n(_templateObject19||(_templateObject19=_taggedTemplateLiteral(["c4943062b634c56348c67fdebba808eb::"])))}}},{key:"forward",get:function(){return{content:_classPrivateMethodGet(this,_getIconHtml,_getIconHtml2).call(this,"--icon-forward-nav-html"),accessibleName:i18n(_templateObject20||(_templateObject20=_taggedTemplateLiteral(["67d2f6740a8eaebf4d5c6f79be8da481::"])))}}},{key:"help",get:function(){return{content:_classPrivateMethodGet(this,_getIconHtml,_getIconHtml2).call(this,"--icon-help-html"),accessibleName:i18n(_templateObject21||(_templateObject21=_taggedTemplateLiteral(["6a26f548831e6a8c26bfbbd9f6ec61e0::"])))}}},{key:"home",get:function(){return{content:_classPrivateMethodGet(this,_getIconHtml,_getIconHtml2).call(this,"--icon-home-html"),accessibleName:i18n(_templateObject22||(_templateObject22=_taggedTemplateLiteral(["8cf04a9734132302f96da8e113e80ce5::"])))}}},{key:"import",get:function(){return{content:_classPrivateMethodGet(this,_getIconHtml,_getIconHtml2).call(this,"--icon-import-html"),accessibleName:i18n(_templateObject23||(_templateObject23=_taggedTemplateLiteral(["28dd16bcceda4431550c96dfc257dd22::"])))}}},{key:"info",get:function(){return{content:_classPrivateMethodGet(this,_getIconHtml,_getIconHtml2).call(this,"--icon-info-html"),accessibleName:i18n(_templateObject24||(_templateObject24=_taggedTemplateLiteral(["c5836008c1649301e29351a55db8f65c::"])))}}},{key:"selectLesson",get:function(){return{content:_classPrivateMethodGet(this,_getIconHtml,_getIconHtml2).call(this,"--icon-lesson-html"),accessibleName:i18n(_templateObject25||(_templateObject25=_taggedTemplateLiteral(["666258634f2ea689eac1e01b184a3cea::"])))}}},{key:"library",get:function(){return{content:_classPrivateMethodGet(this,_getIconHtml,_getIconHtml2).call(this,"--icon-library-html"),accessibleName:i18n(_templateObject26||(_templateObject26=_taggedTemplateLiteral(["d6e5c296474cad126efdfa515a47f1f8::"])))}}},{key:"load",get:function(){return{content:_classPrivateMethodGet(this,_getIconHtml,_getIconHtml2).call(this,"--icon-load-html"),accessibleName:i18n(_templateObject27||(_templateObject27=_taggedTemplateLiteral(["74540c79e377bea903e1023a46df5574::"])))}}},{key:"nextProblem",get:function(){return{content:_classPrivateMethodGet(this,_getIconHtml,_getIconHtml2).call(this,"--icon-next-problem-html"),accessibleName:i18n(_templateObject28||(_templateObject28=_taggedTemplateLiteral(["a0bfb8e59e6c13fc8d990781f77694fe::"])))}}},{key:"no",get:function(){return{content:_classPrivateMethodGet(this,_getIconHtml,_getIconHtml2).call(this,"--icon-no-html"),accessibleName:i18n(_templateObject29||(_templateObject29=_taggedTemplateLiteral(["bafd7322c6e97d25b6299b5d6fe8920b::"])))}}},{key:"ok",get:function(){return{content:_classPrivateMethodGet(this,_getIconHtml,_getIconHtml2).call(this,"--icon-ok-html"),accessibleName:i18n(_templateObject30||(_templateObject30=_taggedTemplateLiteral(["e0aa021e21dddbd6d8cecec71e9cf564::"])))}}},{key:"pause",get:function(){return{content:_classPrivateMethodGet(this,_getIconHtml,_getIconHtml2).call(this,"--icon-pause-html"),accessibleName:i18n(_templateObject31||(_templateObject31=_taggedTemplateLiteral(["105b296a83f9c105355403f3332af50f::"])))}}},{key:"play",get:function(){return{content:_classPrivateMethodGet(this,_getIconHtml,_getIconHtml2).call(this,"--icon-play-html"),accessibleName:i18n(_templateObject32||(_templateObject32=_taggedTemplateLiteral(["de3c731be5633838089a07179d301d7b::"])))}}},{key:"playLesson",get:function(){return{content:_classPrivateMethodGet(this,_getIconHtml,_getIconHtml2).call(this,"--icon-play-html"),accessibleName:i18n(_templateObject33||(_templateObject33=_taggedTemplateLiteral(["afd061e2316f7ab6f934ef5b43f994b6::"])))}}},{key:"print",get:function(){return{content:_classPrivateMethodGet(this,_getIconHtml,_getIconHtml2).call(this,"--icon-print-html"),accessibleName:i18n(_templateObject34||(_templateObject34=_taggedTemplateLiteral(["13dba24862cf9128167a59100e154c8d::"])))}}},{key:"printPreview",get:function(){return{content:_classPrivateMethodGet(this,_getIconHtml,_getIconHtml2).call(this,"--icon-print-preview-html"),accessibleName:i18n(_templateObject35||(_templateObject35=_taggedTemplateLiteral(["d729a3a8d63daef5c5fb1739207f2377::"])))}}},{key:"privacy",get:function(){return{content:_classPrivateMethodGet(this,_getIconHtml,_getIconHtml2).call(this,"--icon-privacy-html"),accessibleName:i18n(_templateObject36||(_templateObject36=_taggedTemplateLiteral(["c5f29bb36f9158d2e00f5d4dc213a0ff::"])))}}},{key:"question",get:function(){return{content:_classPrivateMethodGet(this,_getIconHtml,_getIconHtml2).call(this,"--icon-question-html"),accessibleName:i18n(_templateObject37||(_templateObject37=_taggedTemplateLiteral(["c5836008c1649301e29351a55db8f65c::"])))}}},{key:"repeatLesson",get:function(){return{content:_classPrivateMethodGet(this,_getIconHtml,_getIconHtml2).call(this,"--icon-repeat-lesson-html"),accessibleName:i18n(_templateObject38||(_templateObject38=_taggedTemplateLiteral(["87a0a633db4ae5246df7ebf3e417a805::"])))}}},{key:"resetToFactory",get:function(){return{content:_classPrivateMethodGet(this,_getIconHtml,_getIconHtml2).call(this,"--icon-reset-to-factory-html"),accessibleName:i18n(_templateObject39||(_templateObject39=_taggedTemplateLiteral(["5dcd7aaf263cdf5f7d1de6aa2264e29f::"])))}}},{key:"save",get:function(){return{content:_classPrivateMethodGet(this,_getIconHtml,_getIconHtml2).call(this,"--icon-save-html"),accessibleName:i18n(_templateObject40||(_templateObject40=_taggedTemplateLiteral(["c9cc8cce247e49bae79f15173ce97354::"])))}}},{key:"settings",get:function(){return{content:_classPrivateMethodGet(this,_getIconHtml,_getIconHtml2).call(this,"--icon-settings-html"),accessibleName:i18n(_templateObject41||(_templateObject41=_taggedTemplateLiteral(["f4f70727dc34561dfde1a3c529b6205c::"])))}}},{key:"skip",get:function(){return{content:_classPrivateMethodGet(this,_getIconHtml,_getIconHtml2).call(this,"--icon-skip-html"),accessibleName:i18n(_templateObject42||(_templateObject42=_taggedTemplateLiteral(["72ef2b9b6965d078e3c7f95487a82d1c::"])))}}},{key:"submitAnswer",get:function(){return{content:_classPrivateMethodGet(this,_getIconHtml,_getIconHtml2).call(this,"--icon-submit-answer-html"),accessibleName:i18n(_templateObject43||(_templateObject43=_taggedTemplateLiteral(["4e095ee5de137300bfa0042a6b442b0e::"])))}}},{key:"openMenu",get:function(){return{content:_classPrivateMethodGet(this,_getIconHtml,_getIconHtml2).call(this,"--icon-open-menu-html"),accessibleName:i18n(_templateObject44||(_templateObject44=_taggedTemplateLiteral(["64d2cc43035360eddf790efbef5ddb30::"])))}}},{key:"vimeo",get:function(){return{content:_classPrivateMethodGet(this,_getIconHtml,_getIconHtml2).call(this,"--icon-vimeo-html"),accessibleName:i18n(_templateObject45||(_templateObject45=_taggedTemplateLiteral(["74a8353a68978f6d4c3076113c032973::"])))}}},{key:"warning",get:function(){return{content:_classPrivateMethodGet(this,_getIconHtml,_getIconHtml2).call(this,"--icon-warning-html"),accessibleName:i18n(_templateObject46||(_templateObject46=_taggedTemplateLiteral(["64d2cc43035360eddf790efbef5ddb30::"])))}}},{key:"webshare",get:function(){return{content:_classPrivateMethodGet(this,_getIconHtml,_getIconHtml2).call(this,"--icon-webshare-html"),accessibleName:i18n(_templateObject47||(_templateObject47=_taggedTemplateLiteral(["5a95a425f74314a96f13a2f136992178::"])))}}},{key:"webshareCertificate",get:function(){return{content:_classPrivateMethodGet(this,_getIconHtml,_getIconHtml2).call(this,"--icon-webshare-certificate-html"),accessibleName:i18n(_templateObject48||(_templateObject48=_taggedTemplateLiteral(["a62912ed921dd0ca71b134c7dfd5a094::"])))}}},{key:"webshareAutorun",get:function(){return{content:_classPrivateMethodGet(this,_getIconHtml,_getIconHtml2).call(this,"--icon-webshare-autorun-html"),accessibleName:i18n(_templateObject49||(_templateObject49=_taggedTemplateLiteral(["e3645e6e8f00b30125af6cd6838a9921::"])))}}},{key:"yes",get:function(){return{content:_classPrivateMethodGet(this,_getIconHtml,_getIconHtml2).call(this,"--icon-yes-html"),accessibleName:i18n(_templateObject50||(_templateObject50=_taggedTemplateLiteral(["93cba07454f06a4a960172bbd6e2a435::"])))}}},{key:"youtube",get:function(){return{content:_classPrivateMethodGet(this,_getIconHtml,_getIconHtml2).call(this,"--icon-youtube-html"),accessibleName:i18n(_templateObject51||(_templateObject51=_taggedTemplateLiteral(["789a34726ee00e1c6c8f259509ad832f::"])))}}},{key:"semanticsAddressRole",value:function(element,role){return!role||HTML_SEMANTIC_ROLES[element.tagName][element.tagName]==role}},{key:"applyIconToElement",value:function(icon,item){var _options$hideText,_options$overrideText,_options$role,options=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},hideText=null!==(_options$hideText=options.hideText)&&void 0!==_options$hideText?_options$hideText:_classPrivateFieldGet(this,_hideText),label=null!==(_options$overrideText=options.overrideText)&&void 0!==_options$overrideText?_options$overrideText:icon.accessibleName,element=ManagedElement.getElement(item),role=null===(_options$role=options.role)||void 0===_options$role?void 0:_options$role.toLowerCase();element.innerHTML=icon.content,icon.accessibleName&&!hideText?element.innerHTML+="&nbsp;".concat(label):element.title=label,this.semanticsAddressRole(element,role)?options.hideText&&element.setAttribute("aria-label",label):(element.setAttribute("role",role),element.setAttribute("aria-label",label))}}]),IconGenerator}();function _getIconHtml2(key){var _classPrivateFieldGet12;if(!_classPrivateFieldGet(this,_cache).has(key)){var cssValue=getComputedStyle(document.documentElement).getPropertyValue(key);cssValue=cssValue.trim(),_classPrivateFieldGet(this,_cache).set(key,cssValue.substring(1,cssValue.length-1).replace(/\\"/g,'"'))}return null!==(_classPrivateFieldGet12=_classPrivateFieldGet(this,_cache).get(key))&&void 0!==_classPrivateFieldGet12?_classPrivateFieldGet12:"!?"}var icons=new IconGenerator,_focusOnStage=new WeakMap,FocusManager=function(){function FocusManager(){var _this3=this;_classCallCheck(this,FocusManager),_classPrivateFieldInitSpec(this,_focusOnStage,{writable:!0,value:!1}),window.addEventListener("focus",(function(event){console.debug("Window has focus. Restore focus to active element. Active element ".concat(document.activeElement.tagName," ").concat(document.activeElement.className),document.activeElement,event.relatedTarget),document.activeElement!==document.body?(console.debug("Set focus to active element"),document.activeElement.focus()):_this3.findBestFocus()}))}return _createClass(FocusManager,[{key:"focusOnStage",set:function(value){_classPrivateFieldSet(this,_focusOnStage,value)}},{key:"focusWithin",value:function(){var _containingElement$el,_step5,containingElement=arguments.length>0&&void 0!==arguments[0]?arguments[0]:document.body,element=null!==(_containingElement$el=containingElement.element)&&void 0!==_containingElement$el?_containingElement$el:containingElement,_iterator5=_createForOfIteratorHelper(element.querySelectorAll("button,select,input,.selectable").values());try{for(_iterator5.s();!(_step5=_iterator5.n()).done;){var candidate=_step5.value;if("none"!==candidate.style.display&&"hidden"!==candidate.style.visibility)return candidate.focus(),!0}}catch(err){_iterator5.e(err)}finally{_iterator5.f()}return console.debug("Couldn't find anything to focus on within ".concat(null==element?void 0:element.tagName,":").concat(null==element?void 0:element.className)),!1}},{key:"focusWithinElements",value:function(elements){var _step6,_iterator6=_createForOfIteratorHelper(elements);try{for(_iterator6.s();!(_step6=_iterator6.n()).done;){var element=_step6.value;if(this.focusWithin(element))return!0}}catch(err){_iterator6.e(err)}finally{_iterator6.f()}return!1}},{key:"findBestFocus",value:function(){var element=document.querySelector(".selectable.always-on-top");if(element)element.focus();else if(element=document.querySelector(".modal"))this.focusWithin(element);else{var candidates=[];_classPrivateFieldGet(this,_focusOnStage)&&candidates.push(document.getElementById("stage")),candidates.push(document.getElementById("footer")),this.focusWithinElements(candidates)}}},{key:"setFocus",value:function(element){return element.focus(),document.activeElement===element}}]),FocusManager}(),focusManager=new FocusManager,_dismiss=new WeakSet,Toast=function(_ManagedElement){_inherits(Toast,_ManagedElement);var _super=_createSuper(Toast);function Toast(message,rawHtml){var _this4;_classCallCheck(this,Toast),_classPrivateMethodInitSpec(_assertThisInitialized(_this4=_super.call(this,"div","utils-toast")),_dismiss),_this4.classList.add("selectable","always-on-top"),_this4.setAttributes({"aria-role":"alert",tabindex:"0"});var content=new ManagedElement("div","container"),icon=new ManagedElement("div");return icons.applyIconToElement(icons.closeMenu,icon.element,{hideText:!0}),_this4.appendChild(content),_this4.appendChild(icon),rawHtml?content.innerHTML=message:content.textContent=message,_this4.listenToOwnEvent("click",""),_this4.listenToOwnEvent("keydown",""),_this4}return _createClass(Toast,[{key:"handleClickEvent",value:function(eventIgnored){_classPrivateMethodGet(this,_dismiss,_dismiss2).call(this)}},{key:"handleKeydownEvent",value:function(event){console.debug("Key ".concat(event.key)),"Escape"!==event.key&&" "!==event.key&&"Enter"!==event.key||_classPrivateMethodGet(this,_dismiss,_dismiss2).call(this)}}]),Toast}(ManagedElement);function _dismiss2(){this.style.opacity=0,this.remove(),focusManager.findBestFocus()}function toast(message){var toast=new Toast(message,!0);document.body.appendChild(toast.element),setTimeout((function(){toast.style.top="50vh",toast.focus()}))}var _storage=new WeakMap,_keyPrefix=new WeakMap,persistentData=new(function(){function DataStoreManager(storage){_classCallCheck(this,DataStoreManager),_classPrivateFieldInitSpec(this,_storage,{writable:!0,value:void 0}),_classPrivateFieldInitSpec(this,_keyPrefix,{writable:!0,value:"app"}),_classPrivateFieldSet(this,_storage,storage)}return _createClass(DataStoreManager,[{key:"createStorageKey",value:function(key){return"".concat(_classPrivateFieldGet(this,_keyPrefix)).concat(key)}},{key:"getFromStorage",value:function(key,defaultValue){key=this.createStorageKey(key);var value=_classPrivateFieldGet(this,_storage).getItem(key);if(value)try{var parsedValue=JSON.parse(value);return null==parsedValue?defaultValue:parsedValue}catch(error){console.error(error)}return defaultValue}},{key:"saveToStorage",value:function(key,value){key=this.createStorageKey(key);try{_classPrivateFieldGet(this,_storage).setItem(key,JSON.stringify(value))}catch(error){toast(i18n(_templateObject52||(_templateObject52=_taggedTemplateLiteral(["e6b3e01861eefd23bb3caa9acd6d0c42::",""])),error.message))}}},{key:"removeFromStorage",value:function(key){key=this.createStorageKey(key),_classPrivateFieldGet(this,_storage).removeItem(key)}},{key:"setStorageKeyPrefix",value:function(prefix){_classPrivateFieldSet(this,_keyPrefix,prefix)}}]),DataStoreManager}())(localStorage),_key2=new WeakMap,_title=new WeakMap,_contentLoader=new WeakMap,_getDefaultLessonKeys=new WeakSet,_getLessonKeys=new WeakSet,_saveLessonKeys=new WeakSet,_getLibraryContent=new WeakSet,_getStorageKeyForLessonKey=new WeakSet,_loadLocalLesson=new WeakSet,_getFreeKey=new WeakSet,LocalLibrary=function(){function LocalLibrary(){var _this5=this;_classCallCheck(this,LocalLibrary),_classPrivateMethodInitSpec(this,_getFreeKey),_classPrivateMethodInitSpec(this,_loadLocalLesson),_classPrivateMethodInitSpec(this,_getStorageKeyForLessonKey),_classPrivateMethodInitSpec(this,_getLibraryContent),_classPrivateMethodInitSpec(this,_saveLessonKeys),_classPrivateMethodInitSpec(this,_getLessonKeys),_classPrivateMethodInitSpec(this,_getDefaultLessonKeys),_classPrivateFieldInitSpec(this,_key2,{writable:!0,value:void 0}),_classPrivateFieldInitSpec(this,_title,{writable:!0,value:void 0}),_classPrivateFieldInitSpec(this,_contentLoader,{writable:!0,value:void 0}),_classPrivateFieldSet(this,_key2,LocalLibrary.LOCAL_LIBRARY_KEY),_classPrivateFieldSet(this,_title,i18n(_templateObject53||(_templateObject53=_taggedTemplateLiteral(["72393b3cb338d9556ecd072e26907479::"])))),_classPrivateFieldSet(this,_contentLoader,(function(){return _classPrivateMethodGet(_this5,_getLibraryContent,_getLibraryContent2).call(_this5)}))}return _createClass(LocalLibrary,[{key:"okayToDeleteSlot",get:function(){return _classPrivateMethodGet(this,_getLessonKeys,_getLessonKeys2).call(this).length>LocalLibrary.NUMBER_OF_INITIAL_LESSONS}},{key:"key",get:function(){return _classPrivateFieldGet(this,_key2)}},{key:"info",get:function(){return{title:_classPrivateFieldGet(this,_title),contentLoader:_classPrivateFieldGet(this,_contentLoader)}}},{key:"saveLocalLessonAtIndex",value:function(index,localLesson){var keys=_classPrivateMethodGet(this,_getLessonKeys,_getLessonKeys2).call(this);if(index<0||index>=keys.length)console.error("Attempt to store to index ".concat(index," ignored."));else{var key=keys[index];persistentData.saveToStorage(_classPrivateMethodGet(this,_getStorageKeyForLessonKey,_getStorageKeyForLessonKey2).call(this,key),localLesson)}}},{key:"addNewLessonSlot",value:function(){var key=_classPrivateMethodGet(this,_getFreeKey,_getFreeKey2).call(this),keys=_classPrivateMethodGet(this,_getLessonKeys,_getLessonKeys2).call(this);keys.push(key),_classPrivateMethodGet(this,_saveLessonKeys,_saveLessonKeys2).call(this,keys)}},{key:"deleteLessonAtIndex",value:function(index){var keys=_classPrivateMethodGet(this,_getLessonKeys,_getLessonKeys2).call(this);if(this.okayToDeleteSlot){var key=keys[index];null!=key&&(console.debug("Removing lesson storage index: ".concat(index,"; key:").concat(key)),persistentData.removeFromStorage(_classPrivateMethodGet(this,_getStorageKeyForLessonKey,_getStorageKeyForLessonKey2).call(this,key)),keys.splice(index,1),_classPrivateMethodGet(this,_saveLessonKeys,_saveLessonKeys2).call(this,keys))}else console.error("Attempt made to reduce number of local lessons to below ".concat(LocalLibrary.NUMBER_OF_INITIAL_LESSONS,". Ignored."))}}]),LocalLibrary}();function _getDefaultLessonKeys2(){for(var indexes=[],index=0;index<LocalLibrary.NUMBER_OF_INITIAL_LESSONS;index++)indexes.push(index);return indexes}function _getLessonKeys2(){return persistentData.getFromStorage(LocalLibrary.LOCAL_LIBRARY_INDEX_KEY,_classPrivateMethodGet(this,_getDefaultLessonKeys,_getDefaultLessonKeys2).call(this))}function _saveLessonKeys2(keys){persistentData.saveToStorage(LocalLibrary.LOCAL_LIBRARY_INDEX_KEY,keys)}function _getLibraryContent2(){var _this54=this,book={title:i18n(_templateObject117||(_templateObject117=_taggedTemplateLiteral(["c025e43a825a053fc668cef35cfa9ef5::"]))),location:"",chapters:[{title:i18n(_templateObject118||(_templateObject118=_taggedTemplateLiteral(["8fe1f2e455ff223c81a6441733982773::"]))),lessons:[]}]};return _classPrivateMethodGet(this,_getLessonKeys,_getLessonKeys2).call(this).forEach((function(key){var localLesson=_classPrivateMethodGet(_this54,_loadLocalLesson,_loadLocalLesson2).call(_this54,key);book.chapters[0].lessons.push({title:localLesson.title,contentLoader:function(){return localLesson.content}})})),[book]}function _getStorageKeyForLessonKey2(key){return"".concat(LocalLibrary.LOCAL_LESSON_KEY_PREFIX).concat(key)}function _loadLocalLesson2(key){var defaultLesson={title:i18n(_templateObject119||(_templateObject119=_taggedTemplateLiteral(["b1e0c142cc722f03dfad078c22369435::"]))),content:""};return persistentData.getFromStorage(_classPrivateMethodGet(this,_getStorageKeyForLessonKey,_getStorageKeyForLessonKey2).call(this,key),defaultLesson)}function _getFreeKey2(){var indexes=_classPrivateMethodGet(this,_getLessonKeys,_getLessonKeys2).call(this);indexes.sort((function(a,b){return a-b}));for(var n=0;n<indexes.length-1;n++)if(indexes[n+1]-indexes[n]>1)return indexes[n]+1;return indexes[indexes.length-1]+1}_defineProperty(LocalLibrary,"LOCAL_LIBRARY_KEY","LOCAL_LIBRARY"),_defineProperty(LocalLibrary,"LOCAL_LIBRARY_INDEX_KEY","LOCAL_LIBRARY_INDEX"),_defineProperty(LocalLibrary,"LOCAL_LESSON_KEY_PREFIX","LocalLesson_"),_defineProperty(LocalLibrary,"NUMBER_OF_INITIAL_LESSONS",4);var PREDEFINED_EMOJIS={GRINNING:"&#x1F600;",")":"@GRINNING","-)":"@GRINNING",SMILEY:"@GRINNING",SMILING:"@GRINNING",HAPPY:"@GRINNING",WORRIED:"&#x1F61F;",SAD:"@WORRIED",LAUGHING:"&#x1F602;",LAUGH:"@LAUGHING",CRYING:"&#x1F622;",TEAR:"@CRYING",FROWNING:"&#x1F641;","(":"@FROWNING","-(":"@FROWNING",NEUTRAL:"&#x1F610;",ANGRY:"&#x1F620;",GRUMPY:"@ANGRY",WINK:"&#x1F609;",WINKY:"@WINK",WINKING:"@WINK",WARNING:"&#x26A0;&#xFE0F;",ALERT:"@WARNING",ERROR:"@WARNING","WHITE-QUESTION-MARK":"&#x2754;"};function getErrorAttributeHtml(message){return'data-error="'.concat(stringToBase64(message),'"')}var SAFE_CLASSES=["big","bigger","biggest","massive","giant","column"];function getOrientationClass(requestedClass){return/^col(?:$|umn$)/i.test(requestedClass)?"align-column":/^(?:row|line)$/i.test(requestedClass)?"align-row":/^(?:left)$/i.test(requestedClass)?"align-left":""}function makeClassSafe(requestedClass){if(!requestedClass)return"";var index=SAFE_CLASSES.indexOf(requestedClass.toLowerCase());return index<0?"":SAFE_CLASSES[index]}var _missingWords=new WeakMap,_replacements=new WeakMap,TrackedReplacements=function(){function TrackedReplacements(metadata){_classCallCheck(this,TrackedReplacements),_classPrivateFieldInitSpec(this,_missingWords,{writable:!0,value:void 0}),_classPrivateFieldInitSpec(this,_replacements,{writable:!0,value:void 0}),_classPrivateFieldSet(this,_missingWords,[]);var tracker=this;_classPrivateFieldSet(this,_replacements,[{re:/\\>/g,rep:"&gt;"},{re:/ 123(?:>([a-zA_Z]*))?(\s|<\/p>)*$/gm,rep:function(match,orientation){var classes="missing-word ".concat(getOrientationClass(orientation)).trim();return _classPrivateFieldGet(tracker,_missingWords).push(null),' <span class="'.concat(classes,'" data-missing-word="').concat(ManagedElement.encodeString("..."),'"></span>')}},getItemReplacement("[.]{3}",(function(match,startChr,word,orientation){if(!word)return match;var classes="missing-word ".concat(getOrientationClass(orientation)).trim();return _classPrivateFieldGet(tracker,_missingWords).push(word),"".concat(startChr,'<span class="').concat(classes,'" data-missing-word="').concat(ManagedElement.encodeString(word),'"></span>')})),getItemReplacement("emoji:",(function(match,startChr,word,emojiClass){var requiredClasses="emoji";return(emojiClass=makeClassSafe(emojiClass))&&(requiredClasses="".concat(requiredClasses," ").concat(emojiClass)),"".concat(startChr,'<span class="').concat(requiredClasses,'">').concat(function(originalDefinition){if(!originalDefinition)return" ";var definition=originalDefinition.toUpperCase();if(definition.startsWith("U+"))return definition.replaceAll(/U\+([A-F0-9]+)/g,"&#x$1;");var _code,code=PREDEFINED_EMOJIS[definition];return null!==(_code=code)&&void 0!==_code&&_code.startsWith("@")&&(code=PREDEFINED_EMOJIS[code.substring(1)]),code||originalDefinition}(word),"</span>")})),getItemReplacement("meta:",(function(match,startChr,word){var metavalue=null==metadata?void 0:metadata.getValue(word);if(!metavalue){var errorAttribute=getErrorAttributeHtml(i18n(_templateObject54||(_templateObject54=_taggedTemplateLiteral(["20f59a970faebddc0d41220837f3b4ad::",""])),word));return"".concat(startChr,"<span ").concat(errorAttribute,">").concat(word,"</span>")}return"".concat(startChr).concat(metavalue)})),getItemReplacement("icon:",(function(match,startChr,iconName,iconClass){return iconClass=makeClassSafe(iconClass),"".concat(startChr).concat(function(iconName){var _iconName,additionalClass=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",matches=(iconName=null===(_iconName=iconName)||void 0===_iconName?void 0:_iconName.toLowerCase()).match(/^(?:fa-)?([a-z-]{2,})$/),iconClass=matches?matches[1]:"notdef";return additionalClass=/^[a-zA-Z_-]{2,}$/.test(additionalClass)?" ".concat(additionalClass):"",'<i class="'.concat("fa-solid"," fa-").concat(iconClass).concat(additionalClass,'"></i>')}(iconName,iconClass),"</span>")})),getItemReplacement("text:",(function(match,startChr,text,textClass){return textClass=makeClassSafe(textClass),"".concat(startChr).concat(function(text,className){return'<span class="'.concat(className,'">').concat(text,"</span>")}(text,textClass),"</span>")}))])}return _createClass(TrackedReplacements,[{key:"missingWords",get:function(){return _toConsumableArray(_classPrivateFieldGet(this,_missingWords))}},{key:"replacements",get:function(){return _classPrivateFieldGet(this,_replacements)}}]),TrackedReplacements}(),_html=new WeakMap,_missingWords2=new WeakMap,_metadata=new WeakMap,TextItem=function(){function TextItem(metadata){if(_classCallCheck(this,TextItem),_classPrivateFieldInitSpec(this,_html,{writable:!0,value:""}),_classPrivateFieldInitSpec(this,_missingWords2,{writable:!0,value:[]}),_classPrivateFieldInitSpec(this,_metadata,{writable:!0,value:void 0}),!_classStaticPrivateFieldSpecGet(TextItem,TextItem,_isConstructing))throw new Error("Private constructor. Use createTextItem");_classPrivateFieldSet(this,_metadata,metadata)}return _createClass(TextItem,[{key:"html",get:function(){return _classPrivateFieldGet(this,_html)}},{key:"plainText",get:function(){return getPlainTextFromHtml(_classPrivateFieldGet(this,_html).replace(/<(?:[^>]*missing-word[^>]*)>/g,"..."))}},{key:"missingWords",get:function(){return _classPrivateFieldGet(this,_missingWords2)}},{key:"firstWord",get:function(){var _classPrivateFieldGet2,match=null===(_classPrivateFieldGet2=_classPrivateFieldGet(this,_html))||void 0===_classPrivateFieldGet2?void 0:_classPrivateFieldGet2.match(/^(?:\s*(?:<\/?[^\r\n\f\t]*?>)*\s*)*([^\s<]*)/);return match?match[1]:""}}],[{key:"createFromSource",value:function(source,metadata){_classStaticPrivateFieldSpecSet(TextItem,TextItem,_isConstructing,!0);var textItem=new TextItem;if(_classStaticPrivateFieldSpecSet(TextItem,TextItem,_isConstructing,!1),source){var tracker=new TrackedReplacements(metadata);_classPrivateFieldSet(textItem,_html,parseMarkdown(source,{post:tracker.replacements})),_classPrivateFieldSet(textItem,_missingWords2,tracker.missingWords)}return textItem}}]),TextItem}(),_isConstructing={writable:!0,value:!1};function getItemReplacement(prefix,replace){return{re:new RegExp("".concat("(^|[ >])").concat(prefix).concat("((?:&#?[a-zA-Z0-9]+?;|[^\\s<>])+?)?").concat("(?:>([a-zA_Z]*))?").concat("(?=[\\s,;:.?!]|$|</.+?>)"),"gmi"),rep:replace}}var _map=new WeakMap,Metadata=function(){function Metadata(){if(_classCallCheck(this,Metadata),_classPrivateFieldInitSpec(this,_map,{writable:!0,value:new Map}),!_classStaticPrivateFieldSpecGet(Metadata,Metadata,_isConstructing2))throw new Error("Private constructor. Use createMetaData")}return _createClass(Metadata,[{key:"getValue",value:function(key,defaultValue){var value=_classPrivateFieldGet(this,_map).get(key.toUpperCase());return null!=value?value:defaultValue}}],[{key:"createFromSource",value:function(source){_classStaticPrivateFieldSpecSet(Metadata,Metadata,_isConstructing2,!0);var metadata=new Metadata;return _classStaticPrivateFieldSpecSet(Metadata,Metadata,_isConstructing2,!1),source.split("\n").forEach((function(element){var match=element.match(/^\s*(\w+)\s*[:;.]-?\s*(.*?)\s*$/);match&&_classPrivateFieldGet(metadata,_map).set(match[1].toUpperCase(),escapeHtml(match[2]))})),metadata}}]),Metadata}(),_isConstructing2={writable:!0,value:!1},QuestionType={SIMPLE:"simple",MULTI:"multi",FILL:"fill",ORDER:"order",SLIDE:"slide"},_intro=new WeakMap,_question=new WeakMap,_explanation=new WeakMap,_rightAnswers=new WeakMap,_wrongAnswers=new WeakMap,_questionType=new WeakMap,_extractFirstWords=new WeakSet,_deriveQuestionType=new WeakSet,_isSimpleQuestion=new WeakSet,_isMultiQuestion=new WeakSet,_isFillQuestion=new WeakSet,_isOrderQuestion=new WeakSet,Problem=function(){function Problem(){_classCallCheck(this,Problem),_classPrivateMethodInitSpec(this,_isOrderQuestion),_classPrivateMethodInitSpec(this,_isFillQuestion),_classPrivateMethodInitSpec(this,_isMultiQuestion),_classPrivateMethodInitSpec(this,_isSimpleQuestion),_classPrivateMethodInitSpec(this,_deriveQuestionType),_classPrivateMethodInitSpec(this,_extractFirstWords),_classPrivateFieldInitSpec(this,_intro,{writable:!0,value:void 0}),_classPrivateFieldInitSpec(this,_question,{writable:!0,value:void 0}),_classPrivateFieldInitSpec(this,_explanation,{writable:!0,value:void 0}),_classPrivateFieldInitSpec(this,_rightAnswers,{writable:!0,value:void 0}),_classPrivateFieldInitSpec(this,_wrongAnswers,{writable:!0,value:void 0}),_classPrivateFieldInitSpec(this,_questionType,{writable:!0,value:QuestionType.SLIDE})}return _createClass(Problem,[{key:"intro",get:function(){return _classPrivateFieldGet(this,_intro)},set:function(value){_classPrivateFieldSet(this,_intro,value)}},{key:"question",get:function(){return _classPrivateFieldGet(this,_question)},set:function(value){_classPrivateFieldSet(this,_question,value),_classPrivateMethodGet(this,_deriveQuestionType,_deriveQuestionType2).call(this)}},{key:"explanation",get:function(){return _classPrivateFieldGet(this,_explanation)},set:function(value){_classPrivateFieldSet(this,_explanation,value)}},{key:"rightAnswers",get:function(){return _classPrivateFieldGet(this,_rightAnswers)},set:function(value){_classPrivateFieldSet(this,_rightAnswers,value),_classPrivateMethodGet(this,_deriveQuestionType,_deriveQuestionType2).call(this)}},{key:"wrongAnswers",get:function(){return _classPrivateFieldGet(this,_wrongAnswers)},set:function(value){_classPrivateFieldSet(this,_wrongAnswers,value),_classPrivateMethodGet(this,_deriveQuestionType,_deriveQuestionType2).call(this)}},{key:"firstWordsOfWrongAnswers",get:function(){return _classPrivateMethodGet(this,_extractFirstWords,_extractFirstWords2).call(this,this.wrongAnswers)}},{key:"firstWordsOfRightAnswers",get:function(){return _classPrivateMethodGet(this,_extractFirstWords,_extractFirstWords2).call(this,this.rightAnswers)}},{key:"questionType",get:function(){return _classPrivateFieldGet(this,_questionType)}}]),Problem}();function _extractFirstWords2(data){var words=[];return data.forEach((function(textItem){words.push(textItem.firstWord)})),words}function _deriveQuestionType2(){var _classPrivateFieldGet13;if(null===(_classPrivateFieldGet13=_classPrivateFieldGet(this,_question))||void 0===_classPrivateFieldGet13||!_classPrivateFieldGet13.html)return QuestionType.SLIDE;_classPrivateMethodGet(this,_isOrderQuestion,_isOrderQuestion2).call(this)?_classPrivateFieldSet(this,_questionType,QuestionType.ORDER):_classPrivateMethodGet(this,_isFillQuestion,_isFillQuestion2).call(this)?_classPrivateFieldSet(this,_questionType,QuestionType.FILL):_classPrivateMethodGet(this,_isMultiQuestion,_isMultiQuestion2).call(this)?_classPrivateFieldSet(this,_questionType,QuestionType.MULTI):_classPrivateMethodGet(this,_isSimpleQuestion,_isSimpleQuestion2).call(this)?_classPrivateFieldSet(this,_questionType,QuestionType.SIMPLE):_classPrivateFieldSet(this,_questionType,QuestionType.SLIDE)}function _isSimpleQuestion2(){return!!_classPrivateFieldGet(this,_rightAnswers)&&1===_classPrivateFieldGet(this,_rightAnswers).length}function _isMultiQuestion2(){return!!_classPrivateFieldGet(this,_rightAnswers)&&_classPrivateFieldGet(this,_rightAnswers).length>1}function _isFillQuestion2(){if(0===_classPrivateFieldGet(this,_question).missingWords.length)return!1;var _step8,_iterator8=_createForOfIteratorHelper(_classPrivateFieldGet(this,_question).missingWords);try{for(_iterator8.s();!(_step8=_iterator8.n()).done;){if(!_step8.value)return!1}}catch(err){_iterator8.e(err)}finally{_iterator8.f()}return!0}function _isOrderQuestion2(){return/<span +class *= *"missing-word(?: [a-zA-Z-]*?)*?".*?><\/span>(?:\s*<\/p>\s*)*$/.test(_classPrivateFieldGet(this,_question).html)&&1===_classPrivateFieldGet(this,_question).missingWords.length&&!_classPrivateFieldGet(this,_question).missingWords[0]}var MarkState={UNDEFINED:-1,CORRECT:0,INCORRECT:1,SKIPPED:2},_markedItems=new WeakMap,_lastUpdated=new WeakMap,ItemMarker=function(){function ItemMarker(){_classCallCheck(this,ItemMarker),_classPrivateFieldInitSpec(this,_markedItems,{writable:!0,value:void 0}),_classPrivateFieldInitSpec(this,_lastUpdated,{writable:!0,value:void 0}),this.reset()}return _createClass(ItemMarker,[{key:"reset",value:function(){_classPrivateFieldSet(this,_lastUpdated,new Date),_classPrivateFieldSet(this,_markedItems,[])}},{key:"lastUpdated",get:function(){return _classPrivateFieldGet(this,_lastUpdated)}},{key:"marks",get:function(){var marks={correct:0,incorrect:0,skipped:0,markedItems:_classPrivateFieldGet(this,_markedItems)};return _classPrivateFieldGet(this,_markedItems).forEach((function(markedItem){switch(markedItem.state){case MarkState.CORRECT:marks.correct++;break;case MarkState.INCORRECT:marks.incorrect++;break;case MarkState.SKIPPED:marks.skipped++}})),marks}},{key:"markItem",value:function(item,state){_classPrivateFieldGet(this,_markedItems).push({item:item,state:state}),_classPrivateFieldSet(this,_lastUpdated,new Date)}}]),ItemMarker}(),_rawSource=new WeakMap,_metadata2=new WeakMap,_problems=new WeakMap,_problemIndex=new WeakMap,_marker=new WeakMap,Lesson=function(){function Lesson(rawSource){_classCallCheck(this,Lesson),_classPrivateFieldInitSpec(this,_rawSource,{writable:!0,value:void 0}),_classPrivateFieldInitSpec(this,_metadata2,{writable:!0,value:void 0}),_classPrivateFieldInitSpec(this,_problems,{writable:!0,value:[]}),_classPrivateFieldInitSpec(this,_problemIndex,{writable:!0,value:0}),_classPrivateFieldInitSpec(this,_marker,{writable:!0,value:new ItemMarker}),_classPrivateFieldSet(this,_rawSource,rawSource),_classPrivateFieldGet(this,_marker).reset()}return _createClass(Lesson,[{key:"rawSource",get:function(){return _classPrivateFieldGet(this,_rawSource)}},{key:"metadata",get:function(){return _classPrivateFieldGet(this,_metadata2)},set:function(value){_classPrivateFieldSet(this,_metadata2,value)}},{key:"problems",get:function(){return _classPrivateFieldGet(this,_problems)}},{key:"marks",get:function(){return _classPrivateFieldGet(this,_marker).marks}},{key:"lastUpdated",get:function(){return _classPrivateFieldGet(this,_marker).lastUpdated}},{key:"progress",get:function(){return 0===_classPrivateFieldGet(this,_problems).length?1:_classPrivateFieldGet(this,_problemIndex)/_classPrivateFieldGet(this,_problems).length}},{key:"addProblem",value:function(problem){_classPrivateFieldGet(this,_problems).push(problem)}},{key:"restart",value:function(){_classPrivateFieldGet(this,_marker).reset(),_classPrivateFieldSet(this,_problemIndex,0)}},{key:"hasMoreProblems",get:function(){return _classPrivateFieldGet(this,_problemIndex)<_classPrivateFieldGet(this,_problems).length}},{key:"isEmpty",get:function(){return 0===_classPrivateFieldGet(this,_problems).length||!(null!==(_classPrivateFieldGet3=_classPrivateFieldGet(this,_problems)[0].intro)&&void 0!==_classPrivateFieldGet3&&_classPrivateFieldGet3.html||null!==(_classPrivateFieldGet4=_classPrivateFieldGet(this,_problems)[0].question)&&void 0!==_classPrivateFieldGet4&&_classPrivateFieldGet4.html);var _classPrivateFieldGet3,_classPrivateFieldGet4}},{key:"getNextProblem",value:function(){var _this$problemIndex,_this$problemIndex2;return _classPrivateFieldGet(this,_problemIndex)<_classPrivateFieldGet(this,_problems).length?_classPrivateFieldGet(this,_problems)[(_classPrivateFieldSet(this,_problemIndex,(_this$problemIndex=_classPrivateFieldGet(this,_problemIndex),_this$problemIndex2=_this$problemIndex++,_this$problemIndex)),_this$problemIndex2)]:null}},{key:"peekAtNextProblem",value:function(){return _classPrivateFieldGet(this,_problemIndex)<_classPrivateFieldGet(this,_problems).length?_classPrivateFieldGet(this,_problems)[_classPrivateFieldGet(this,_problemIndex)]:null}},{key:"markProblem",value:function(problem,state){_classPrivateFieldGet(this,_marker).markItem(problem,state)}}]),Lesson}(),_introSource=new WeakMap,_questionSource=new WeakMap,_rightAnswerSources=new WeakMap,_wrongAnswerSources=new WeakMap,_explanationSource=new WeakMap,ProblemSource=function(){function ProblemSource(){_classCallCheck(this,ProblemSource),_classPrivateFieldInitSpec(this,_introSource,{writable:!0,value:void 0}),_classPrivateFieldInitSpec(this,_questionSource,{writable:!0,value:void 0}),_classPrivateFieldInitSpec(this,_rightAnswerSources,{writable:!0,value:void 0}),_classPrivateFieldInitSpec(this,_wrongAnswerSources,{writable:!0,value:void 0}),_classPrivateFieldInitSpec(this,_explanationSource,{writable:!0,value:void 0}),_classPrivateFieldSet(this,_introSource,""),_classPrivateFieldSet(this,_questionSource,""),_classPrivateFieldSet(this,_rightAnswerSources,[]),_classPrivateFieldSet(this,_wrongAnswerSources,[]),_classPrivateFieldSet(this,_explanationSource,"")}return _createClass(ProblemSource,[{key:"introSource",get:function(){return _classPrivateFieldGet(this,_introSource)},set:function(data){_classPrivateFieldSet(this,_introSource,data)}},{key:"questionSource",get:function(){return _classPrivateFieldGet(this,_questionSource)},set:function(data){_classPrivateFieldSet(this,_questionSource,data)}},{key:"explanationSource",get:function(){return _classPrivateFieldGet(this,_explanationSource)},set:function(data){_classPrivateFieldSet(this,_explanationSource,data)}},{key:"rightAnswerSources",get:function(){return _classPrivateFieldGet(this,_rightAnswerSources)}},{key:"wrongAnswerSources",get:function(){return _classPrivateFieldGet(this,_wrongAnswerSources)}},{key:"addRightAnswerSource",value:function(data){_classPrivateFieldGet(this,_rightAnswerSources).push(data)}},{key:"addWrongAnswerSource",value:function(data){_classPrivateFieldGet(this,_wrongAnswerSources).push(data)}}]),ProblemSource}(),ProblemItemKey_INTRO="i",ProblemItemKey_QUESTION="?",ProblemItemKey_RIGHT_ANSWER="=",ProblemItemKey_WRONG_ANSWER="x",ProblemItemKey_EXPLANATION="&",ProblemItemKey_QUESTION_BREAK="_",_metaSource=new WeakMap,_problemSources=new WeakMap,_rawSource2=new WeakMap,LessonSource=function(){function LessonSource(source){if(_classCallCheck(this,LessonSource),_classPrivateFieldInitSpec(this,_metaSource,{writable:!0,value:void 0}),_classPrivateFieldInitSpec(this,_problemSources,{writable:!0,value:void 0}),_classPrivateFieldInitSpec(this,_rawSource2,{writable:!0,value:void 0}),!_classStaticPrivateFieldSpecGet(LessonSource,LessonSource,_isConstructing3))throw new Error("Private constructor. Use createFromSource");_classPrivateFieldSet(this,_problemSources,[]),_classPrivateFieldSet(this,_rawSource2,source)}return _createClass(LessonSource,[{key:"metaSource",get:function(){return _classPrivateFieldGet(this,_metaSource)},set:function(value){_classPrivateFieldSet(this,_metaSource,value)}},{key:"problemSources",get:function(){return _classPrivateFieldGet(this,_problemSources)}},{key:"isNewProblem",value:function(lastKey,newKey,currentProblem){if(lastKey===ProblemItemKey_QUESTION_BREAK)return!0;switch(newKey){case ProblemItemKey_INTRO:return!(!currentProblem.introSource&&!currentProblem.questionSource);case ProblemItemKey_QUESTION:return!!currentProblem.questionSource}return!1}},{key:"addDataToProblemSource",value:function(problem,itemType,data){switch(itemType){case ProblemItemKey_INTRO:problem.introSource=data;break;case ProblemItemKey_QUESTION:problem.questionSource=data;break;case ProblemItemKey_RIGHT_ANSWER:problem.addRightAnswerSource(data);break;case ProblemItemKey_WRONG_ANSWER:problem.addWrongAnswerSource(data);break;case ProblemItemKey_EXPLANATION:problem.explanationSource=data;break;case ProblemItemKey_QUESTION_BREAK:break;default:this.metaSource=data}}},{key:"createProblemSource",value:function(){var block=new ProblemSource;return this.problemSources.push(block),block}},{key:"getLineDetails",value:function(line){var _match$,match=line.match(/^[-#_* ]{0,3}(?:\(*([i?=xX&_\xD7])\1*[_) ]+)(.*)$/);if(!match)return{key:void 0,content:line};var key=match[1].toLowerCase();return"×"===key&&(key="x"),{key:key,content:null!==(_match$=match[2])&&void 0!==_match$?_match$:""}}},{key:"convertToLesson",value:function(){var lesson=new Lesson(_classPrivateFieldGet(this,_rawSource2));return lesson.metadata=Metadata.createFromSource(this.metaSource),this.problemSources.forEach((function(problemSource){var problem=new Problem;problem.intro=TextItem.createFromSource(problemSource.introSource,lesson.metadata),problem.question=TextItem.createFromSource(problemSource.questionSource,lesson.metadata),problem.explanation=TextItem.createFromSource(problemSource.explanationSource,lesson.metadata),problem.rightAnswers=problemSource.rightAnswerSources.map((function(source){return TextItem.createFromSource(source,lesson.metadata)})),problem.wrongAnswers=problemSource.wrongAnswerSources.map((function(source){return TextItem.createFromSource(source,lesson.metadata)})),lesson.addProblem(problem)})),lesson}}],[{key:"createFromSource",value:function(source){_classStaticPrivateFieldSpecSet(LessonSource,LessonSource,_isConstructing3,!0);var lessonSource=new LessonSource(source);_classStaticPrivateFieldSpecSet(LessonSource,LessonSource,_isConstructing3,!1);var lines=source.split(/\r\n|\n/),currentItemKey=null,problemSource=lessonSource.createProblemSource(),data="";return lines.forEach((function(line){var details=lessonSource.getLineDetails(line);details.key?(lessonSource.addDataToProblemSource(problemSource,currentItemKey,data),data=details.content?"".concat(details.content,"\n"):"",lessonSource.isNewProblem(currentItemKey,details.key,problemSource)&&(problemSource=lessonSource.createProblemSource()),currentItemKey=details.key):data+="".concat(details.content,"\n")})),data&&lessonSource.addDataToProblemSource(problemSource,currentItemKey,data),lessonSource}}]),LessonSource}(),_isConstructing3={writable:!0,value:!1},_data=new WeakMap,_title2=new WeakMap,_lesson=new WeakMap,_origin=new WeakMap,_convertDataToLesson=new WeakSet,_getUnmanagedLessonInfo=new WeakSet,UnmanagedLesson=function(){function UnmanagedLesson(title,_data2,_origin2){_classCallCheck(this,UnmanagedLesson),_classPrivateMethodInitSpec(this,_getUnmanagedLessonInfo),_classPrivateMethodInitSpec(this,_convertDataToLesson),_classPrivateFieldInitSpec(this,_data,{writable:!0,value:void 0}),_classPrivateFieldInitSpec(this,_title2,{writable:!0,value:void 0}),_classPrivateFieldInitSpec(this,_lesson,{writable:!0,value:void 0}),_classPrivateFieldInitSpec(this,_origin,{writable:!0,value:void 0}),_classPrivateFieldSet(this,_title2,title),_data2&&_classPrivateFieldSet(this,_lesson,_classPrivateMethodGet(this,_convertDataToLesson,_convertDataToLesson2).call(this,_data2)),_classPrivateFieldSet(this,_origin,_origin2)}return _createClass(UnmanagedLesson,[{key:"hasLesson",get:function(){return!!_classPrivateFieldGet(this,_lesson)}},{key:"lesson",get:function(){return _classPrivateFieldGet(this,_lesson)}},{key:"lessonInfo",get:function(){return _classPrivateMethodGet(this,_getUnmanagedLessonInfo,_getUnmanagedLessonInfo2).call(this,escapeHtml(_classPrivateFieldGet(this,_title2)),_classPrivateFieldGet(this,_origin))}}]),UnmanagedLesson}();function _convertDataToLesson2(data){return LessonSource.createFromSource(data).convertToLesson()}function _getUnmanagedLessonInfo2(lessonTitle,origin){return{origin:origin,usingLocalLibrary:!1,libraryKey:void 0,file:void 0,url:void 0,indexes:{book:0,chapter:0,lesson:0},titles:{library:"",book:"",chapter:"",lesson:lessonTitle}}}var LessonOrigin={REMOTE:"remote",LOCAL:"local",EMBEDDED:"embedded",FILE_SYSTEM:"file_system"};function _getEmbeddedItem(name,data){if(data)try{return base64ToString(data)}catch(error){console.error("Could not decoded embedded variable ".concat(name,". Data: ").concat(data," "))}return null}var embeddedLesson=new(function(_UnmanagedLesson){_inherits(EmbeddedLesson,_UnmanagedLesson);var _super2=_createSuper(EmbeddedLesson);function EmbeddedLesson(){var _window$text2LessonEm,_window$text2LessonEm2;return _classCallCheck(this,EmbeddedLesson),_super2.call(this,_classStaticPrivateMethodGet(EmbeddedLesson,EmbeddedLesson,_getEmbeddedItem).call(EmbeddedLesson,"Embedded title",null===(_window$text2LessonEm=window.text2LessonEmbeddedData)||void 0===_window$text2LessonEm?void 0:_window$text2LessonEm.title),_classStaticPrivateMethodGet(EmbeddedLesson,EmbeddedLesson,_getEmbeddedItem).call(EmbeddedLesson,"Embedded source",null===(_window$text2LessonEm2=window.text2LessonEmbeddedData)||void 0===_window$text2LessonEm2?void 0:_window$text2LessonEm2.source),LessonOrigin.EMBEDDED)}return _createClass(EmbeddedLesson,[{key:"rootUrl",get:function(){var _window$text2LessonEm3;return null===(_window$text2LessonEm3=window.text2LessonEmbeddedData)||void 0===_window$text2LessonEm3?void 0:_window$text2LessonEm3.rootUrl}},{key:"translations",get:function(){var _window$text2LessonEm4;return null===(_window$text2LessonEm4=window.text2LessonEmbeddedData)||void 0===_window$text2LessonEm4?void 0:_window$text2LessonEm4.translations}}]),EmbeddedLesson}(UnmanagedLesson)),_usingLocalLibrary=new WeakMap,_libraries=new WeakMap,_remoteLibraryKey=new WeakMap,_currentLibraryKey=new WeakMap,_currentBookIndex=new WeakMap,_currentChapterIndex=new WeakMap,_currentLessonIndex=new WeakMap,_cachedLesson=new WeakMap,_buildCurrentLessonInfo=new WeakSet,_ensurePositiveInt=new WeakSet,_ensureIndexesValid=new WeakSet,_indexInvalid=new WeakSet,_getCurrentBook=new WeakSet,_loadLibraryContent=new WeakSet,_escapeAllTitles=new WeakSet,_loadLessonUsingContentLoader=new WeakSet,_loadRemoteLesson=new WeakSet,LessonManager=function(){function LessonManager(){_classCallCheck(this,LessonManager),_classPrivateMethodInitSpec(this,_loadRemoteLesson),_classPrivateMethodInitSpec(this,_loadLessonUsingContentLoader),_classPrivateMethodInitSpec(this,_escapeAllTitles),_classPrivateMethodInitSpec(this,_loadLibraryContent),_classPrivateMethodInitSpec(this,_getCurrentBook),_classPrivateMethodInitSpec(this,_indexInvalid),_classPrivateMethodInitSpec(this,_ensureIndexesValid),_classPrivateMethodInitSpec(this,_ensurePositiveInt),_classPrivateMethodInitSpec(this,_buildCurrentLessonInfo),_classPrivateFieldInitSpec(this,_usingLocalLibrary,{writable:!0,value:!1}),_classPrivateFieldInitSpec(this,_libraries,{writable:!0,value:new Map}),_classPrivateFieldInitSpec(this,_remoteLibraryKey,{writable:!0,value:void 0}),_classPrivateFieldInitSpec(this,_currentLibraryKey,{writable:!0,value:void 0}),_classPrivateFieldInitSpec(this,_currentBookIndex,{writable:!0,value:0}),_classPrivateFieldInitSpec(this,_currentChapterIndex,{writable:!0,value:0}),_classPrivateFieldInitSpec(this,_currentLessonIndex,{writable:!0,value:0}),_classPrivateFieldInitSpec(this,_cachedLesson,{writable:!0,value:void 0})}return _createClass(LessonManager,[{key:"getFirstRemoteKey",value:function(){var _step7,_iterator7=_createForOfIteratorHelper(_classPrivateFieldGet(this,_libraries).keys());try{for(_iterator7.s();!(_step7=_iterator7.n()).done;){var key=_step7.value;if(key!==LocalLibrary.LOCAL_LIBRARY_KEY)return key}}catch(err){_iterator7.e(err)}finally{_iterator7.f()}return""}},{key:"remoteLibraryKey",set:function(key){_classPrivateFieldGet(this,_libraries).has(key)||(console.error("Ignored attempt to set invalid remote library key ".concat(key,".")),key=this.getFirstRemoteKey()),_classPrivateFieldSet(this,_remoteLibraryKey,key),_classPrivateFieldGet(this,_usingLocalLibrary)||_classPrivateFieldSet(this,_currentLibraryKey,_classPrivateFieldGet(this,_remoteLibraryKey))}},{key:"usingLocalLibrary",get:function(){return _classPrivateFieldGet(this,_usingLocalLibrary)},set:function(value){_classPrivateFieldSet(this,_usingLocalLibrary,value),_classPrivateFieldSet(this,_currentLibraryKey,_classPrivateFieldGet(this,_usingLocalLibrary)?LocalLibrary.LOCAL_LIBRARY_KEY:_classPrivateFieldGet(this,_remoteLibraryKey))}},{key:"isRemoteLibraryAvailable",get:function(){var _classPrivateFieldGet5;return(null===(_classPrivateFieldGet5=_classPrivateFieldGet(this,_libraries).get(_classPrivateFieldGet(this,_remoteLibraryKey)))||void 0===_classPrivateFieldGet5?void 0:_classPrivateFieldGet5.books.length)>0}},{key:"bookIndex",set:function(index){_classPrivateFieldGet(this,_libraries).get(_classPrivateFieldGet(this,_currentLibraryKey))?_classPrivateFieldSet(this,_currentBookIndex,_classPrivateMethodGet(this,_ensurePositiveInt,_ensurePositiveInt2).call(this,index)):_classPrivateFieldSet(this,_currentBookIndex,0)}},{key:"chapterIndex",set:function(index){_classPrivateFieldSet(this,_currentChapterIndex,_classPrivateMethodGet(this,_ensurePositiveInt,_ensurePositiveInt2).call(this,index))}},{key:"lessonIndex",set:function(index){_classPrivateFieldSet(this,_currentLessonIndex,_classPrivateMethodGet(this,_ensurePositiveInt,_ensurePositiveInt2).call(this,index))}},{key:"remoteLibraryTitle",get:function(){var _classPrivateFieldGet6,title=null===(_classPrivateFieldGet6=_classPrivateFieldGet(this,_libraries).get(_classPrivateFieldGet(this,_remoteLibraryKey)))||void 0===_classPrivateFieldGet6?void 0:_classPrivateFieldGet6.title;return null!=title?title:""}},{key:"libraryTitle",get:function(){var _classPrivateFieldGet7,title=null===(_classPrivateFieldGet7=_classPrivateFieldGet(this,_libraries).get(_classPrivateFieldGet(this,_currentLibraryKey)))||void 0===_classPrivateFieldGet7?void 0:_classPrivateFieldGet7.title;return null!=title?title:""}},{key:"libraryTitles",get:function(){var options=new Map;return _classPrivateFieldGet(this,_libraries).forEach((function(value,key){options.set(key,value.title)})),options}},{key:"remoteLibraryTitles",get:function(){var options=new Map;return _classPrivateFieldGet(this,_libraries).forEach((function(value,key){key!==LocalLibrary.LOCAL_LIBRARY_KEY&&options.set(key,value.title)})),options}},{key:"bookTitle",get:function(){var _classPrivateMethodGe,title=null===(_classPrivateMethodGe=_classPrivateMethodGet(this,_getCurrentBook,_getCurrentBook2).call(this))||void 0===_classPrivateMethodGe?void 0:_classPrivateMethodGe.title;return null!=title?title:""}},{key:"bookTitles",get:function(){var _classPrivateFieldGet8,titles=[];return null===(_classPrivateFieldGet8=_classPrivateFieldGet(this,_libraries).get(_classPrivateFieldGet(this,_currentLibraryKey)))||void 0===_classPrivateFieldGet8||_classPrivateFieldGet8.books.forEach((function(value){titles.push(value.title)})),titles}},{key:"chapterTitle",get:function(){var _classPrivateMethodGe2,title=null===(_classPrivateMethodGe2=_classPrivateMethodGet(this,_getCurrentBook,_getCurrentBook2).call(this))||void 0===_classPrivateMethodGe2||null===(_classPrivateMethodGe2=_classPrivateMethodGe2.chapters[_classPrivateFieldGet(this,_currentChapterIndex)])||void 0===_classPrivateMethodGe2?void 0:_classPrivateMethodGe2.title;return null!=title?title:""}},{key:"chapterTitles",get:function(){var titles=[];return _classPrivateMethodGet(this,_getCurrentBook,_getCurrentBook2).call(this).chapters.forEach((function(value){titles.push(value.title)})),titles}},{key:"lessonTitle",get:function(){var _classPrivateMethodGe3,title=null===(_classPrivateMethodGe3=_classPrivateMethodGet(this,_getCurrentBook,_getCurrentBook2).call(this))||void 0===_classPrivateMethodGe3||null===(_classPrivateMethodGe3=_classPrivateMethodGe3.chapters[_classPrivateFieldGet(this,_currentChapterIndex)])||void 0===_classPrivateMethodGe3||null===(_classPrivateMethodGe3=_classPrivateMethodGe3.lessons[_classPrivateFieldGet(this,_currentLessonIndex)])||void 0===_classPrivateMethodGe3?void 0:_classPrivateMethodGe3.title;return null!=title?title:""}},{key:"lessonTitles",get:function(){var titles=[];return _classPrivateMethodGet(this,_getCurrentBook,_getCurrentBook2).call(this).chapters[_classPrivateFieldGet(this,_currentChapterIndex)].lessons.forEach((function(value){titles.push(value.title)})),titles}},{key:"currentLessonInfo",get:function(){return _classPrivateMethodGet(this,_buildCurrentLessonInfo,_buildCurrentLessonInfo2).call(this)}},{key:"formUrlForLesson",value:function(){var books=_classPrivateFieldGet(this,_libraries).get(_classPrivateFieldGet(this,_currentLibraryKey)).books,fileLocation=books[_classPrivateFieldGet(this,_currentBookIndex)].location,fileName=books[_classPrivateFieldGet(this,_currentBookIndex)].chapters[_classPrivateFieldGet(this,_currentChapterIndex)].lessons[_classPrivateFieldGet(this,_currentLessonIndex)].file;return"".concat(fileLocation).concat(fileName)}},{key:"loadAllLibraries",value:function(librariesFileLocation){var _this6=this;_classPrivateFieldSet(this,_libraries,new Map);var localLibrary=new LocalLibrary;return _classPrivateFieldGet(this,_libraries).set(localLibrary.key,localLibrary.info),librariesFileLocation?fetchJson(librariesFileLocation).then((function(entries){for(var key in entries){var entry=entries[key];entry.title=escapeHtml(entry.title),_classPrivateFieldGet(_this6,_libraries).set(key,entries[key]),_classPrivateFieldGet(_this6,_libraries).get(key).books=[]}return null})).catch((function(errorIgnored){return new Error(i18n(_templateObject55||(_templateObject55=_taggedTemplateLiteral(["65bd72f2c7d25e779a582b1600fc665b::",""])),librariesFileLocation))})):Promise.resolve(null)}},{key:"loadAllLibraryContent",value:function(){var _this7=this;return _classPrivateMethodGet(this,_loadLibraryContent,_loadLibraryContent2).call(this,LocalLibrary.LOCAL_LIBRARY_KEY).then((function(){return _classPrivateMethodGet(_this7,_loadLibraryContent,_loadLibraryContent2).call(_this7,_classPrivateFieldGet(_this7,_remoteLibraryKey))}))}},{key:"loadCurrentLesson",value:function(){_classPrivateMethodGet(this,_ensureIndexesValid,_ensureIndexesValid2).call(this);var contentLoader=_classPrivateMethodGet(this,_getCurrentBook,_getCurrentBook2).call(this).chapters[_classPrivateFieldGet(this,_currentChapterIndex)].lessons[_classPrivateFieldGet(this,_currentLessonIndex)].contentLoader;return contentLoader?_classPrivateMethodGet(this,_loadLessonUsingContentLoader,_loadLessonUsingContentLoader2).call(this,contentLoader):_classPrivateMethodGet(this,_loadRemoteLesson,_loadRemoteLesson2).call(this).catch((function(error){return console.error(error),null}))}},{key:"updateCurrentLessonContent",value:function(title,content){if(!_classPrivateFieldGet(this,_usingLocalLibrary))throw new Error("Attempt made to update a remote library.");return(new LocalLibrary).saveLocalLessonAtIndex(_classPrivateFieldGet(this,_currentLessonIndex),{title:title,content:content}),_classPrivateMethodGet(this,_loadLibraryContent,_loadLibraryContent2).call(this,LocalLibrary.LOCAL_LIBRARY_KEY,!0)}},{key:"addLessonToLocalLibrary",value:function(){var localLibrary=new LocalLibrary;return localLibrary.addNewLessonSlot(),_classPrivateFieldGet(this,_libraries).set(localLibrary.key,localLibrary.info),_classPrivateMethodGet(this,_loadLibraryContent,_loadLibraryContent2).call(this,localLibrary.key,!0)}},{key:"deleteLocalLibraryCurrentLesson",value:function(){if(!_classPrivateFieldGet(this,_usingLocalLibrary))return console.error("Ignored attempt to delete local library when it is not the active library."),Promise.resolve();var localLibrary=new LocalLibrary;return localLibrary.deleteLessonAtIndex(_classPrivateFieldGet(this,_currentLessonIndex)),_classPrivateFieldGet(this,_libraries).set(localLibrary.key,localLibrary.info),_classPrivateMethodGet(this,_loadLibraryContent,_loadLibraryContent2).call(this,localLibrary.key,!0)}}]),LessonManager}();function _buildCurrentLessonInfo2(url){var _book$chapters$_class,_classPrivateFieldGet14,_book$chapters$_class2,_book$chapters$_class3;_classPrivateMethodGet(this,_ensureIndexesValid,_ensureIndexesValid2).call(this);var book=_classPrivateMethodGet(this,_getCurrentBook,_getCurrentBook2).call(this);return{origin:_classPrivateFieldGet(this,_usingLocalLibrary)?LessonOrigin.LOCAL:LessonOrigin.REMOTE,usingLocalLibrary:_classPrivateFieldGet(this,_usingLocalLibrary),libraryKey:_classPrivateFieldGet(this,_currentLibraryKey),file:null==book||null===(_book$chapters$_class=book.chapters[_classPrivateFieldGet(this,_currentChapterIndex)])||void 0===_book$chapters$_class||null===(_book$chapters$_class=_book$chapters$_class.lessons[_classPrivateFieldGet(this,_currentLessonIndex)])||void 0===_book$chapters$_class?void 0:_book$chapters$_class.file,url:url,indexes:{book:_classPrivateFieldGet(this,_currentBookIndex),chapter:_classPrivateFieldGet(this,_currentChapterIndex),lesson:_classPrivateFieldGet(this,_currentLessonIndex)},titles:{library:null===(_classPrivateFieldGet14=_classPrivateFieldGet(this,_libraries).get(_classPrivateFieldGet(this,_currentLibraryKey)))||void 0===_classPrivateFieldGet14?void 0:_classPrivateFieldGet14.title,book:null==book?void 0:book.title,chapter:null==book||null===(_book$chapters$_class2=book.chapters[_classPrivateFieldGet(this,_currentChapterIndex)])||void 0===_book$chapters$_class2?void 0:_book$chapters$_class2.title,lesson:null==book||null===(_book$chapters$_class3=book.chapters[_classPrivateFieldGet(this,_currentChapterIndex)])||void 0===_book$chapters$_class3||null===(_book$chapters$_class3=_book$chapters$_class3.lessons[_classPrivateFieldGet(this,_currentLessonIndex)])||void 0===_book$chapters$_class3?void 0:_book$chapters$_class3.title}}}function _ensurePositiveInt2(index){return index=parseInt(index),isNaN(index)||index<0?0:index}function _ensureIndexesValid2(){var library=_classPrivateFieldGet(this,_libraries).get(_classPrivateFieldGet(this,_currentLibraryKey));_classPrivateMethodGet(this,_indexInvalid,_indexInvalid2).call(this,_classPrivateFieldGet(this,_currentBookIndex),null==library?void 0:library.books)&&_classPrivateFieldSet(this,_currentBookIndex,0);var book=null==library?void 0:library.books[_classPrivateFieldGet(this,_currentBookIndex)];_classPrivateMethodGet(this,_indexInvalid,_indexInvalid2).call(this,_classPrivateFieldGet(this,_currentChapterIndex),null==book?void 0:book.chapters)&&_classPrivateFieldSet(this,_currentChapterIndex,0);var chapter=null==book?void 0:book.chapters[_classPrivateFieldGet(this,_currentChapterIndex)];_classPrivateMethodGet(this,_indexInvalid,_indexInvalid2).call(this,_classPrivateFieldGet(this,_currentLessonIndex),null==chapter?void 0:chapter.lessons.length)&&_classPrivateFieldSet(this,_currentLessonIndex,0)}function _indexInvalid2(index,arrayData){return null!=arrayData&&(isNaN(index)||index<0||index>=arrayData.length)}function _getCurrentBook2(){return _classPrivateFieldGet(this,_libraries).get(_classPrivateFieldGet(this,_currentLibraryKey)).books[_classPrivateFieldGet(this,_currentBookIndex)]}function _loadLibraryContent2(key,force){var _library$books,_this55=this,library=_classPrivateFieldGet(this,_libraries).get(key);return(null===(_library$books=library.books)||void 0===_library$books?void 0:_library$books.length)>0&&!force?Promise.resolve():library.contentLoader?(library.books=library.contentLoader(),_classPrivateMethodGet(this,_escapeAllTitles,_escapeAllTitles2).call(this,library.books),_classPrivateMethodGet(this,_ensureIndexesValid,_ensureIndexesValid2).call(this),Promise.resolve(null)):fetchJson(library.url).then((function(value){return library.books=value,_classPrivateMethodGet(_this55,_escapeAllTitles,_escapeAllTitles2).call(_this55,library.books),_classPrivateMethodGet(_this55,_ensureIndexesValid,_ensureIndexesValid2).call(_this55),null})).catch((function(errorIgnored){return new Error(i18n(_templateObject120||(_templateObject120=_taggedTemplateLiteral(["c79030f53fb54a65f7f7b8294cf6b87c::",""])),library.url))}))}function _escapeAllTitles2(books){books.forEach((function(book){book.title=escapeHtml(book.title),book.chapters.forEach((function(chapter){chapter.title=escapeHtml(chapter.title),chapter.lessons.forEach((function(lesson){lesson.title=escapeHtml(lesson.title)}))}))}))}function _loadLessonUsingContentLoader2(contentLoader){return Promise.resolve(new CachedLesson(_classPrivateMethodGet(this,_buildCurrentLessonInfo,_buildCurrentLessonInfo2).call(this,""),contentLoader()))}function _loadRemoteLesson2(){var _classPrivateFieldGet15,_classPrivateFieldGet16,_this56=this,url=this.formUrlForLesson();return(null===(_classPrivateFieldGet15=_classPrivateFieldGet(this,_cachedLesson))||void 0===_classPrivateFieldGet15?void 0:_classPrivateFieldGet15.info.url)===url&&null!==(_classPrivateFieldGet16=_classPrivateFieldGet(this,_cachedLesson))&&void 0!==_classPrivateFieldGet16&&_classPrivateFieldGet16.content?(console.info("Using cached version of lesson: ".concat(url)),Promise.resolve(CachedLesson.clone(_classPrivateFieldGet(this,_cachedLesson)))):(_classPrivateFieldSet(this,_cachedLesson,new CachedLesson(_classPrivateMethodGet(this,_buildCurrentLessonInfo,_buildCurrentLessonInfo2).call(this,url))),function(url){return fetchFile(url,"text")}(url).then((function(text){return console.info("Loaded lesson: ".concat(url)),_classPrivateFieldGet(_this56,_cachedLesson).content=text,CachedLesson.clone(_classPrivateFieldGet(_this56,_cachedLesson))})))}var EmbeddedLessonManager=function(){function EmbeddedLessonManager(){_classCallCheck(this,EmbeddedLessonManager)}return _createClass(EmbeddedLessonManager,[{key:"loadAllLibraries",value:function(librariesFileLocation){console.debug("Embedded lesson manager ignore attempt to load ".concat(librariesFileLocation))}},{key:"loadAllLibraryContent",value:function(){console.debug("Embedded lesson manager ignored attempt to load all library content")}}]),EmbeddedLessonManager}(),lessonManager=embeddedLesson.hasLesson?new EmbeddedLessonManager:new LessonManager,GOOD_SOUND_URLS=[null,"assets/audio/good1.mp3","assets/audio/good2.mp3"],BAD_SOUND_URLS=[null,"assets/audio/bad1.mp3","assets/audio/bad2.mp3"],Enthusiasm={OFF:0,LOW:1,HIGH:2},_enthusiasm=new WeakMap,_goodAudio=new WeakMap,_badAudio=new WeakMap,_loadAudio=new WeakSet,_createAudioIfNotNull=new WeakSet;function _loadAudio2(){_classPrivateFieldSet(this,_goodAudio,_classPrivateMethodGet(this,_createAudioIfNotNull,_createAudioIfNotNull2).call(this,GOOD_SOUND_URLS[_classPrivateFieldGet(this,_enthusiasm)])),_classPrivateFieldSet(this,_badAudio,_classPrivateMethodGet(this,_createAudioIfNotNull,_createAudioIfNotNull2).call(this,BAD_SOUND_URLS[_classPrivateFieldGet(this,_enthusiasm)]))}function _createAudioIfNotNull2(url){return url?new Audio(url):null}var soundManager=new(function(){function SoundManager(){_classCallCheck(this,SoundManager),_classPrivateMethodInitSpec(this,_createAudioIfNotNull),_classPrivateMethodInitSpec(this,_loadAudio),_classPrivateFieldInitSpec(this,_enthusiasm,{writable:!0,value:void 0}),_classPrivateFieldInitSpec(this,_goodAudio,{writable:!0,value:void 0}),_classPrivateFieldInitSpec(this,_badAudio,{writable:!0,value:void 0}),_classPrivateFieldSet(this,_enthusiasm,Enthusiasm.OFF),_classPrivateMethodGet(this,_loadAudio,_loadAudio2).call(this)}return _createClass(SoundManager,[{key:"enthusiasm",get:function(){return _classPrivateFieldGet(this,_enthusiasm)},set:function(value){isNaN(value)||value<Enthusiasm.OFF||value>Enthusiasm.HIGH?console.error("Attempt to set enthusiasm to invalid level of ".concat(value," ignored.")):value!==_classPrivateFieldGet(this,_enthusiasm)&&(_classPrivateFieldSet(this,_enthusiasm,value),_classPrivateMethodGet(this,_loadAudio,_loadAudio2).call(this))}},{key:"playGood",value:function(){var _classPrivateFieldGet9;null===(_classPrivateFieldGet9=_classPrivateFieldGet(this,_goodAudio))||void 0===_classPrivateFieldGet9||_classPrivateFieldGet9.play()}},{key:"playBad",value:function(){var _classPrivateFieldGet10;null===(_classPrivateFieldGet10=_classPrivateFieldGet(this,_badAudio))||void 0===_classPrivateFieldGet10||_classPrivateFieldGet10.play()}}]),SoundManager}()),DEFAULT_HUE=120,DEFAULT_SATURATION=50,DEFAULT_COLOR_SPREAD=120,DEFAULT_DARK_MODE=!1,DEFAULT_FONT_SIZE=15,DEFAULT_LIBRARY_KEY="EN",DEFAULT_READING_SPEED="180";function setPalette(settings){var _settings$hue,_settings$saturation,_settings$spread,_settings$dark;settings.hue=null!==(_settings$hue=settings.hue)&&void 0!==_settings$hue?_settings$hue:persistentData.getFromStorage("hue",DEFAULT_HUE),settings.saturation=null!==(_settings$saturation=settings.saturation)&&void 0!==_settings$saturation?_settings$saturation:persistentData.getFromStorage("saturation",DEFAULT_SATURATION),settings.spread=null!==(_settings$spread=settings.spread)&&void 0!==_settings$spread?_settings$spread:persistentData.getFromStorage("spread",DEFAULT_COLOR_SPREAD),settings.dark=null!==(_settings$dark=settings.dark)&&void 0!==_settings$dark?_settings$dark:persistentData.getFromStorage("darkMode",DEFAULT_DARK_MODE),function(palette){for(var entryKey in palette)setCssFromPaletteEntry(entryKey,palette[entryKey])}(function(settings){var primaryRgb=hslToRgb(new HSL(settings.hue,settings.saturation,settings.dark?70:30)),colors=[primaryRgb],complementA=shiftHue(primaryRgb,settings.spread),complementB=shiftHue(primaryRgb,-settings.spread);colors.push(complementA,complementB),colors.sort((function(a,b){var relLuminanceA=relativeLuminance(a),relLuminanceB=relativeLuminance(b);return relLuminanceA>relLuminanceB?1:relLuminanceA<relLuminanceB?-1:0})),colors[0]=getDarker(colors[0],5),colors[2]=getLighter(colors[0],5);var errorHsl=new HSL(0,settings.saturation,50),backgroundHsl=new HSL(settings.hue,0,settings.dark?5:95),windowHsl=new HSL(settings.hue,0,settings.dark?0:100);return new Palette({primary:getPaletteEntry(primaryRgb),secondary:getPaletteEntry(complementA),tertiary:getPaletteEntry(complementB),background:getPaletteEntry(hslToRgb(backgroundHsl)),window:getPaletteEntry(hslToRgb(windowHsl)),error:getPaletteEntry(hslToRgb(errorHsl))})}(settings))}var hourglass,BarButton=function(_ManagedElement2){_inherits(BarButton,_ManagedElement2);var _super3=_createSuper(BarButton);function BarButton(detail){var _this8;return _classCallCheck(this,BarButton),_this8=_super3.call(this,"button"),detail.content?icons.applyIconToElement(detail,_this8.element):_this8.innerHTML=detail,_this8}return _createClass(BarButton)}(ManagedElement),ButtonBar=function(_ManagedElement3){_inherits(ButtonBar,_ManagedElement3);var _super4=_createSuper(ButtonBar);function ButtonBar(){return _classCallCheck(this,ButtonBar),_super4.call(this,"div","utils-button-bar")}return _createClass(ButtonBar,[{key:"showButtons",value:function(buttons,focusedButtonIndex){var _buttons,_this9=this;null!==(_buttons=buttons)&&void 0!==_buttons&&_buttons.length||(buttons=[icons.ok]),this.resolutionFunction=null;var promise=new Promise((function(resolve){_this9.resolutionFunction=resolve})),focusSet=!1;return buttons.forEach((function(value,index){var button=new BarButton(value);button.setAttribute("data-index",index),_this9.appendChild(button,index),_this9.listenToEventOn("click",button,index),index===focusedButtonIndex&&(button.focus(),focusSet=!0)})),focusSet||focusManager.findBestFocus(),promise}},{key:"handleClickEvent",value:function(eventIgnored,eventId){var index=parseInt(eventId);this.resolutionFunction(index)}}]),ButtonBar}(ManagedElement),mask=document.getElementById("modal-mask"),standardSelectionIds=["title-bar","content","footer"],referenceCount=0,itemsToRestore=[];function deactivateItems(){standardSelectionIds.forEach((function(id){document.getElementById(id).querySelectorAll("button,.selectable,input,textarea").forEach((function(element){!function(element){console.debug("Deactivating ".concat(element.tagName,": ").concat(element.className));var elementDetails={element:element,"aria-hidden":element.getAttribute("aria-hidden"),disabled:element.disabled,tabIndex:element.tabIndex};itemsToRestore.push(elementDetails),element.setAttribute("aria-hidden",!0),void 0!==element.disabled&&(element.disabled=!0),element.tabIndex=-1}(element)}))}))}function showMask(withHourglass){mask.style.visibility="visible",0===referenceCount?deactivateItems():console.debug("Reference count ".concat(referenceCount," is > 0 so mask already in place.")),withHourglass&&(hourglass||((hourglass=document.createElement("div")).className="hourglass",mask.appendChild(hourglass))),referenceCount++}function hideMask(){var _hourglass;null===(_hourglass=hourglass)||void 0===_hourglass||_hourglass.remove(),hourglass=null,--referenceCount>0?console.debug("Reference count ".concat(referenceCount," is > 0 so leave mask in place.")):(itemsToRestore.forEach((function(item){item.ariaHidden?item.element.setAttribute("aria-hidden",item.ariaHidden):item.element.removeAttribute("aria-hidden"),void 0!==item.disabled&&(item.element.disabled=item.disabled),void 0!==item.tabIndex&&(item.element.tabIndex=item.tabIndex)})),itemsToRestore=[],mask.style.visibility="hidden")}function getIconDetailsForType(dialogType){switch(dialogType){case ModalDialog.DialogType.WARNING:return icons.warning;case ModalDialog.DialogType.ERROR:return icons.error;case ModalDialog.DialogType.FATAL:return icons.fatal;case ModalDialog.DialogType.QUESTION:return icons.question;case ModalDialog.DialogType.SETTINGS:return icons.settings;case ModalDialog.DialogType.INFO:default:return icons.info}}var _dialog=new WeakMap,_titleText=new WeakMap,_icon=new WeakMap,_content2=new WeakMap,_buttonBar=new WeakMap,_createHtml=new WeakSet,_showDialogDefinition=new WeakSet,_hideDialog=new WeakSet,ModalDialog=function(){function ModalDialog(){if(_classCallCheck(this,ModalDialog),_classPrivateMethodInitSpec(this,_hideDialog),_classPrivateMethodInitSpec(this,_showDialogDefinition),_classPrivateMethodInitSpec(this,_createHtml),_classPrivateFieldInitSpec(this,_dialog,{writable:!0,value:void 0}),_classPrivateFieldInitSpec(this,_titleText,{writable:!0,value:void 0}),_classPrivateFieldInitSpec(this,_icon,{writable:!0,value:void 0}),_classPrivateFieldInitSpec(this,_content2,{writable:!0,value:void 0}),_classPrivateFieldInitSpec(this,_buttonBar,{writable:!0,value:void 0}),!_classStaticPrivateFieldSpecGet(ModalDialog,ModalDialog,_isConstructing4))throw new Error("ModalDialog should be instantiated via factory method.");_classPrivateMethodGet(this,_createHtml,_createHtml2).call(this)}return _createClass(ModalDialog,null,[{key:"showDialog",value:function(title,content,options){var dialog=_classStaticPrivateMethodGet(ModalDialog,ModalDialog,_constructDialog).call(ModalDialog);(null==options?void 0:options.dialogType)===ModalDialog.DialogType.FATAL&&(content=_classStaticPrivateMethodGet(ModalDialog,ModalDialog,_addReloadWarning).call(ModalDialog,content));var iconDetails=getIconDetailsForType(null==options?void 0:options.dialogType),dialogDefinition={title:title&&title.length>0?title:":",buttons:null==options?void 0:options.buttons,content:content,dialogType:null==options?void 0:options.dialogType,iconDetails:iconDetails,focusedButtonIndex:options.focusedButtonIndex};return _classPrivateMethodGet(dialog,_showDialogDefinition,_showDialogDefinition2).call(dialog,dialogDefinition)}},{key:"showSettingsDialog",value:function(content){var options={dialogType:ModalDialog.DialogType.SETTINGS,buttons:[icons.ok,icons.resetToFactory]};return ModalDialog.showDialog(i18n(_templateObject70||(_templateObject70=_taggedTemplateLiteral(["f4f70727dc34561dfde1a3c529b6205c::"]))),content,options)}},{key:"showWarning",value:function(content,title){return ModalDialog.showDialog(null!=title?title:i18n(_templateObject71||(_templateObject71=_taggedTemplateLiteral(["0eaadb4fcb48a0a0ed7bc9868be9fbaa::"]))),content,{dialogType:ModalDialog.DialogType.WARNING})}},{key:"showError",value:function(content,title){return ModalDialog.showDialog(null!=title?title:i18n(_templateObject72||(_templateObject72=_taggedTemplateLiteral(["902b0d55fddef6f8d651fe1035b7d4bd::"]))),content,{dialogType:ModalDialog.DialogType.ERROR})}},{key:"showInfo",value:function(content,title){return ModalDialog.showDialog(null!=title?title:i18n(_templateObject73||(_templateObject73=_taggedTemplateLiteral(["a82be0f551b8708bc08eb33cd9ded0cf::"]))),content,{dialogType:ModalDialog.DialogType.INFO})}},{key:"showConfirm",value:function(content,title){var defaultToYes=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];return ModalDialog.showDialog(null!=title?title:i18n(_templateObject74||(_templateObject74=_taggedTemplateLiteral(["a97ea56b0e00b2379736ae60869ff66a::"]))),content,{dialogType:ModalDialog.DialogType.QUESTION,buttons:[icons.yes,icons.no],focusedButtonIndex:defaultToYes?0:1})}},{key:"showFatal",value:function(content,title){return ModalDialog.showDialog(null!=title?title:i18n(_templateObject75||(_templateObject75=_taggedTemplateLiteral(["355f26b47eff3302c93a1c49676f078e::"]))),content,{dialogType:ModalDialog.DialogType.FATAL})}}]),ModalDialog}();function _constructDialog(){_classStaticPrivateFieldSpecSet(ModalDialog,ModalDialog,_isConstructing4,!0);var dialog=new ModalDialog;return _classStaticPrivateFieldSpecSet(ModalDialog,ModalDialog,_isConstructing4,!1),dialog}function _createHtml2(){_classPrivateFieldSet(this,_dialog,new ManagedElement("div","utils-dialog")),_classPrivateFieldGet(this,_dialog).classList.add("framed","modal");var titleBar=new ManagedElement("div","utils-title-bar");titleBar.classList.add("container"),_classPrivateFieldSet(this,_icon,new ManagedElement("span","utils-dialog-icon")),titleBar.appendChild(_classPrivateFieldGet(this,_icon)),_classPrivateFieldSet(this,_titleText,new ManagedElement("span")),titleBar.appendChild(_classPrivateFieldGet(this,_titleText));var contentFrame=new ManagedElement("div","utils-dialog-content-frame");contentFrame.classList.add("container"),_classPrivateFieldSet(this,_content2,new ManagedElement("div","utils-dialog-content")),contentFrame.appendChild(_classPrivateFieldGet(this,_content2)),_classPrivateFieldSet(this,_buttonBar,new ButtonBar),_classPrivateFieldGet(this,_dialog).appendChild(titleBar),_classPrivateFieldGet(this,_dialog).appendChild(contentFrame),_classPrivateFieldGet(this,_dialog).appendChild(_classPrivateFieldGet(this,_buttonBar)),_classPrivateFieldGet(this,_dialog).appendTo(document.body)}function _showDialogDefinition2(dialogDefinition){var _this57=this;return _classPrivateFieldGet(this,_titleText).textContent=dialogDefinition.title,dialogDefinition.content instanceof Element||dialogDefinition.content instanceof ManagedElement?(_classPrivateFieldGet(this,_content2).textContent="",_classPrivateFieldGet(this,_content2).appendChild(dialogDefinition.content)):_classPrivateFieldGet(this,_content2).innerHTML=dialogDefinition.content,icons.applyIconToElement(dialogDefinition.iconDetails,_classPrivateFieldGet(this,_icon),{hideText:!0}),showMask(),_classPrivateFieldGet(this,_buttonBar).showButtons(dialogDefinition.buttons,dialogDefinition.focusedButtonIndex).then((function(index){return _classPrivateMethodGet(_this57,_hideDialog,_hideDialog2).call(_this57),focusManager.findBestFocus(),index}))}function _hideDialog2(){hideMask(),_classPrivateFieldGet(this,_dialog).remove()}function _addReloadWarning(content){var reloadText=i18n(_templateObject121||(_templateObject121=_taggedTemplateLiteral(["b33bb0b4617140c80c80b10436a0dbb2::"])));if(""===reloadText&&(reloadText="A serious error has occurred and languages cannot be loaded. Wait a few minutes and then close this dialog to try to reload the application."),content instanceof Element){var para=document.createElement("p");return para.textContent=reloadText,content.appendChild(para),content}return"".concat(content,"<p>").concat(reloadText,"</p>")}_defineProperty(ModalDialog,"DialogType",{ERROR:"error",FATAL:"fatal",INFO:"info",QUESTION:"question",SETTINGS:"settings",WARNING:"warning"}),_defineProperty(ModalDialog,"DialogIndex",{SETTINGS_OK:0,SETTINGS_RESET:1,CONFIRM_YES:0,CONFIRM_NO:1});var _isConstructing4={writable:!0,value:!1},_reloadRequired=new WeakMap,_reason=new WeakMap,reloader=new(function(){function Reloader(){_classCallCheck(this,Reloader),_classPrivateFieldInitSpec(this,_reloadRequired,{writable:!0,value:!1}),_classPrivateFieldInitSpec(this,_reason,{writable:!0,value:""})}return _createClass(Reloader,[{key:"flagAsRequired",value:function(reason){_classPrivateFieldSet(this,_reason,reason),_classPrivateFieldSet(this,_reloadRequired,!0)}},{key:"reloadIfRequired",value:function(){if(_classPrivateFieldGet(this,_reloadRequired)){var warning=i18n(_templateObject76||(_templateObject76=_taggedTemplateLiteral(["5a1ee4a311c51fa4b76d3c7edd6bdda6::"])));return ModalDialog.showWarning("<p>".concat(warning,"</p><p>").concat(_classPrivateFieldGet(this,_reason),"</p>")).then((function(){window.location.reload()}))}return Promise.resolve()}}]),Reloader}()),_storedValues=new WeakMap,SettingsValueCache=function(){function SettingsValueCache(definitions){for(var key in _classCallCheck(this,SettingsValueCache),_classPrivateFieldInitSpec(this,_storedValues,{writable:!0,value:new Map}),definitions)if(definitions[key].reloadIfChanged){var cachedValue={value:persistentData.getFromStorage(key),label:definitions[key].label};_classPrivateFieldGet(this,_storedValues).set(key,cachedValue)}}return _createClass(SettingsValueCache,[{key:"changes",get:function(){var labels=[];return _classPrivateFieldGet(this,_storedValues).forEach((function(cachedValue,key){persistentData.getFromStorage(key)!==cachedValue.value&&labels.push(cachedValue.label)})),labels.join(", ")}}]),SettingsValueCache}(),RangeIndicator=function(_ManagedElement4){_inherits(RangeIndicator,_ManagedElement4);var _super5=_createSuper(RangeIndicator);function RangeIndicator(control){var _this10;return _classCallCheck(this,RangeIndicator),(_this10=_super5.call(this,"div","utils-range-value")).classList.add("on-top"),_this10.control=control,_this10.listenToEventOn("input",_this10.control,""),_this10.hide(),_this10}return _createClass(RangeIndicator,[{key:"handleInputEvent",value:function(event){var _controlEl$min,_controlEl$max,_this11=this;this.timerId||(this.timerId=setTimeout((function(){_this11.hide(),_this11.timerId=null}),500));var controlEl=this.control.element,minValue=parseFloat(null!==(_controlEl$min=controlEl.min)&&void 0!==_controlEl$min?_controlEl$min:0),maxValue=parseFloat(null!==(_controlEl$max=controlEl.max)&&void 0!==_controlEl$max?_controlEl$max:100),proportion=(parseFloat(controlEl.value)-minValue)/(maxValue-minValue);this.textContent=event.target.value,this.style.opacity=100;var top=controlEl.offsetTop-this.offsetHeight,left=controlEl.offsetLeft+controlEl.offsetWidth*proportion-this.offsetWidth/2;left=Math.max(controlEl.offsetLeft,left),left=Math.min(controlEl.offsetLeft+controlEl.offsetWidth-this.offsetWidth,left),this.style.left="".concat(left,"px"),this.style.top="".concat(top,"px"),this.show()}},{key:"hide",value:function(){this.style.opacity=0,this.style.visibility="hidden"}},{key:"show",value:function(){this.style.visibility="visible",this.style.opacity=100}}]),RangeIndicator}(ManagedElement),SeparatorControl=function(_ManagedElement5){_inherits(SeparatorControl,_ManagedElement5);var _super6=_createSuper(SeparatorControl);function SeparatorControl(key,definition){var _this12;return _classCallCheck(this,SeparatorControl),(_this12=_super6.call(this,"div","utils-separator")).innerHTML='<span class="utils-hr"><hr></span>'+"<span> ".concat(escapeHtml(definition.label)," </span>")+'<span class="utils-hr"><hr></span>',_this12}return _createClass(SeparatorControl)}(ManagedElement),InputControl=function(_ManagedElement6){_inherits(InputControl,_ManagedElement6);var _super7=_createSuper(InputControl);function InputControl(key,definition){var _this13;return _classCallCheck(this,InputControl),(_this13=_super7.call(this,"input")).type=definition.type,_this13.setAttribute("type",definition.type),_this13.setAttribute("min",definition.min),_this13.setAttribute("max",definition.max),_this13.className=definition.type,_this13}return _createClass(InputControl,[{key:"setValue",value:function(value){"checkbox"!==this.type?this.value=value:this.checked=value}},{key:"getValue",value:function(){switch(this.type){case"checkbox":return this.checked;case"range":return parseFloat(this.value);default:return this.value}}}]),InputControl}(ManagedElement),_addOptions=new WeakSet,SelectControl=function(_ManagedElement7){_inherits(SelectControl,_ManagedElement7);var _super8=_createSuper(SelectControl);function SelectControl(_key3,definition){var _this14;return _classCallCheck(this,SelectControl),_classPrivateMethodInitSpec(_assertThisInitialized(_this14=_super8.call(this,"select")),_addOptions),_this14.definition=definition,definition.type&&(_this14.className=definition.type),_classPrivateMethodGet(_assertThisInitialized(_this14),_addOptions,_addOptions2).call(_assertThisInitialized(_this14)),_this14}return _createClass(SelectControl,[{key:"setValue",value:function(value){console.log(value);var index=_toConsumableArray(this.$.options).findIndex((function(option){return option.value===value}));index>=0?this.$.selectedIndex=index:console.warn("Could not set select control to value of ".concat(value))}},{key:"getValue",value:function(){return this.$.selectedOptions[0].value}},{key:"getText",value:function(){return this.$.selectedOptions[0].text}},{key:"reloadOptions",value:function(){if(this.options=this.definition.options,"function"==typeof this.definition.options)for(var n=this.$.length;n-- >0;)this.$.remove(0);_classPrivateMethodGet(this,_addOptions,_addOptions2).call(this)}}]),SelectControl}(ManagedElement);function _addOptions2(){var _this$options,_this58=this;this.options=this.definition.options,"function"==typeof this.options&&(this.options=this.options.call(this)),"function"==typeof this.options&&(this.options=this.options.call(this)),null===(_this$options=this.options)||void 0===_this$options||_this$options.forEach((function(value,key){var option=new Option(value,key);_this58.$.add(option)}))}var _managedControls=new WeakMap,LabeledControlManager=function(){function LabeledControlManager(){_classCallCheck(this,LabeledControlManager),_classPrivateFieldInitSpec(this,_managedControls,{writable:!0,value:[]})}return _createClass(LabeledControlManager,[{key:"createLabeledControl",value:function(key,definition,storage){var control=new LabeledControl(key,definition,{storage:storage,manager:this});return _classPrivateFieldGet(this,_managedControls).push(control),control}},{key:"removeControls",value:function(){_classPrivateFieldGet(this,_managedControls).forEach((function(control){control.remove()}))}},{key:"reloadSelectOptions",value:function(keys){var _this15=this;null==keys||keys.forEach((function(value){var dependentControl=_classPrivateFieldGet(_this15,_managedControls).find((function(control){return control.key===value}));dependentControl&&(dependentControl.control instanceof SelectControl?dependentControl.control.reloadOptions():console.log("Ignoring dependent ".concat(value," as it is not a select type.")))}))}}]),LabeledControlManager}(),_storage2=new WeakMap,_manager=new WeakMap,LabeledControl=function(_ManagedElement8){_inherits(LabeledControl,_ManagedElement8);var _super9=_createSuper(LabeledControl);function LabeledControl(key,definition,options){var _this16;return _classCallCheck(this,LabeledControl),_classPrivateFieldInitSpec(_assertThisInitialized(_this16=_super9.call(this,"div")),_storage2,{writable:!0,value:void 0}),_classPrivateFieldInitSpec(_assertThisInitialized(_this16),_manager,{writable:!0,value:void 0}),_classPrivateFieldSet(_assertThisInitialized(_this16),_storage2,null==options?void 0:options.storage),_classPrivateFieldSet(_assertThisInitialized(_this16),_manager,null==options?void 0:options.manager),_this16.className="labeled-control-container",_this16.label=new ManagedElement("label"),_this16.appendChild(_this16.label),_this16.key=key,_this16.definition=definition,_this16.label.innerHTML="<span>".concat(escapeHtml(definition.label),"</span>"),"select"===definition.type?_this16.control=new SelectControl(key,definition):_this16.control=new InputControl(key,definition),_this16.control.setValue(_classPrivateFieldGet(_assertThisInitialized(_this16),_storage2)?_classPrivateFieldGet(_assertThisInitialized(_this16),_storage2).getFromStorage(key,definition.defaultValue):definition.defaultValue),_this16.label.appendChild(_this16.control),_this16.error=_this16.appendChild(new ManagedElement("div","utils-input-error-message")),"range"===definition.type&&_this16.label.appendChild(new RangeIndicator(_this16.control)),_this16.listenToEventOn("input",_this16.control,""),_this16}return _createClass(LabeledControl,[{key:"setValue",value:function(value){var _this$control;null===(_this$control=this.control)||void 0===_this$control||_this$control.setValue(value)}},{key:"handleInputEvent",value:function(eventIgnored){var _classPrivateFieldGet11,value=this.control.getValue();if(this.definition.validate){var validation=this.definition.validate(value);if(!validation.pass)return this.error.textContent=validation.errorMessage,void this.classList.add("utils-error")}this.classList.remove("utils-error"),null===(_classPrivateFieldGet11=_classPrivateFieldGet(this,_storage2))||void 0===_classPrivateFieldGet11||_classPrivateFieldGet11.saveToStorage(this.key,value),this.definition.onupdate&&(this.definition.onupdate(value),_classPrivateFieldGet(this,_manager)?_classPrivateFieldGet(this,_manager).reloadSelectOptions(this.definition.dependents):console.debug("LabeledControl has no manager, so unable to handle dependencies."))}}]),LabeledControl}(ManagedElement),manager=null,settingDefinitions={};function resetIfConfirmed(){return ModalDialog.showConfirm(i18n(_templateObject77||(_templateObject77=_taggedTemplateLiteral(["0ee1cf8d6fe2d39a293bc82ddbc60666::"])))).then((function(value){if(value===ModalDialog.DialogIndex.CONFIRM_YES)return function(){for(var key in settingDefinitions){console.info("Resetting ".concat(key," to its default."));var definition=settingDefinitions[key];if(!isSeparator(definition)){var _definition$onupdate,value=definition.defaultValue;persistentData.saveToStorage(key,value),null===(_definition$onupdate=definition.onupdate)||void 0===_definition$onupdate||_definition$onupdate.call(definition,value)}}}()}))}function isSeparator(definition){return"separator"===definition.type}function loadSettingDefinitions(definitions){!function(definitions){for(var key in definitions){var _definitions$key$init,_definitions$key;null===(_definitions$key$init=(_definitions$key=definitions[key]).initialise)||void 0===_definitions$key$init||_definitions$key$init.call(_definitions$key)}}(definitions),function(definitions){for(var key in settingDefinitions=definitions)if(!isSeparator(settingDefinitions[key])){var _settingDefinitions$k,storedValue=persistentData.getFromStorage(key,settingDefinitions[key].defaultValue);null===(_settingDefinitions$k=settingDefinitions[key].onupdate)||void 0===_settingDefinitions$k||_settingDefinitions$k.call(this,storedValue)}}(definitions)}var rootUrl=embeddedLesson.hasLesson?embeddedLesson.rootUrl:window.location.href.replace(/index\.html(\?.*)?$/,"");rootUrl.endsWith("/")||(rootUrl+="/");var Urls={NON_LOCAL_ROOT:"https://henspace.github.io/text2lesson/",ROOT:"".concat(rootUrl),LOGO:"".concat(rootUrl,"assets/images/logo/bordered_logo_128.png"),HELP:"".concat(DOCS_ROOT_URL,"app-help.html"),PRIVACY:"".concat(DOCS_ROOT_URL,"privacy.html"),DOCS_HOME:"".concat(DOCS_ROOT_URL,"index.html")};function getMainMenuItems(){return[{iconDetails:icons.settings,command:{execute:function(){return function(){if(manager)return Promise.reject(new Error("Attempt made to show settings on top of another."));manager=new LabeledControlManager;var dialogContent=new ManagedElement("div");for(var key in dialogContent.innerHTML="\n    <div class='utils-palette'>\n    <span class='utils-primary'></span>\n    <span class='utils-secondary'></span>\n    <span class='utils-tertiary'></span>\n    </div>\n  ",settingDefinitions){var setting=settingDefinitions[key],control=void 0;control=isSeparator(setting)?new SeparatorControl(key,setting):manager.createLabeledControl(key,setting,persistentData),dialogContent.appendChild(control)}var settingsValueCache=new SettingsValueCache(settingDefinitions);return ModalDialog.showSettingsDialog(dialogContent).then((function(value){return value===ModalDialog.DialogIndex.SETTINGS_RESET?resetIfConfirmed():value})).then((function(value){return manager.removeControls(),manager=null,reloader.reloadIfRequired(),value})).then((function(value){var changes=settingsValueCache.changes;return""!==changes&&(reloader.flagAsRequired("".concat(i18n(_templateObject78||(_templateObject78=_taggedTemplateLiteral(["3c5d22824f5b26b56b4edfc952f083f7::"])))," ").concat(changes,".")),reloader.reloadIfRequired()),value}))}()}}},{iconDetails:null,command:null},{iconDetails:icons.privacy,command:{execute:function(){return window.open(Urls.PRIVACY,"_blank"),Promise.resolve()}}}]}function registerServiceWorker(buildMode){try{!function(buildMode){"production"===buildMode&&"serviceWorker"in navigator&&window.addEventListener("load",(function(){navigator.serviceWorker.register("./sw.js").then((function(registration){console.info("SW registered: ",registration);var controller=navigator.serviceWorker.controller;console.info("Page controlled by ".concat(controller,"."))})).catch((function(registrationError){console.error("SW registration failed: ",registrationError)}))}))}(buildMode)}catch(error){console.error("Error during service worker registration",error)}}var I18nResolutionError=function(_Error){_inherits(I18nResolutionError,_wrapNativeSuper(Error));var _super10=_createSuper(I18nResolutionError);function I18nResolutionError(error,fetchSummary){var _this17;return _classCallCheck(this,I18nResolutionError),error instanceof Error?(_this17=_super10.call(this,error.message)).cause=error:_this17=_super10.call(this,error),_this17.fetchSummary=fetchSummary,_possibleConstructorReturn(_this17)}return _createClass(I18nResolutionError)}();function resolveLanguages(languagesListingUrl){var languagesListing={},languagesBaseUrl="",fetchSummary=[];return fetchJson(languagesListingUrl).then((function(languages){languagesListing=languages,languagesBaseUrl=new URL(languages.location,window.location.href);var url=new URL(languages.meta.master,languagesBaseUrl);return fetchSummary.push({url:url,read:!1}),fetchJson(url.href)})).then((function(masterTranslations){fetchSummary[0].read=!0,setActiveTranslations(masterTranslations);var preferredLanguages,availableLanguageFiles,availableSubTags,preferredSubTags,bestMatch,bestFile=(preferredLanguages=navigator.languages,availableLanguageFiles=languagesListing.files,availableSubTags=availableLanguageFiles.map((function(entry){return extractLanguageSubTags(entry.toLowerCase().replace(/\.json$/i,""))})),preferredSubTags=preferredLanguages.map((function(entry){return extractLanguageSubTags(entry)})),bestMatch={weight:0,file:null},preferredSubTags.forEach((function(prefSubTag,prefIndexIgnored){var languageIndex=preferredSubTags.findIndex((function(element){return element.language===prefSubTag.language})),prefSubTagRank=preferredSubTags.length-languageIndex;availableSubTags.forEach((function(availSubTag,availIndex){var weight=0;prefSubTag.language===availSubTag.language&&(weight+=100*prefSubTagRank,""!==prefSubTag.region&&prefSubTag.region===availSubTag.region&&(weight+=10),""!==prefSubTag.script&&prefSubTag.script===availSubTag.script&&(weight+=1),weight>bestMatch.weight&&(bestMatch.weight=weight,bestMatch.file=availableLanguageFiles[availIndex]))}))})),bestMatch.file);if(bestFile===languagesListing.meta.master)return Promise.resolve(null);var url=new URL(bestFile,languagesBaseUrl);return fetchSummary.push({url:url,read:!1}),fetchJson(url.href)})).then((function(bestTranslations){return bestTranslations&&(fetchSummary[1].read=!0,setActiveTranslations(bestTranslations)),fetchSummary})).catch((function(error){return Promise.reject(new I18nResolutionError(error,fetchSummary))}))}function getLanguages(embeddedLanguages){if(!BuildInfo.isBuilt())return Promise.resolve(void 0);if(embeddedLanguages)try{var languages=JSON.parse(base64ToString(embeddedLanguages));return languages.fallback&&setActiveTranslations(languages.fallback),setActiveTranslations(languages.active),Promise.resolve(void 0)}catch(error){console.error("Unable to decode embedded languages ${embeddedLanguages}.",error)}return resolveLanguages("./languages.json").then((function(){console.info("Build information: ".concat(BuildInfo.getBundleName," ").concat(BuildInfo.getVersion()," ").concat(BuildInfo.getMode()))})).catch((function(error){var fetchSummary=error.fetchSummary;if(!(fetchSummary&&fetchSummary.length>0&&fetchSummary[0].read))return console.error(error.message),Promise.reject(error);console.error("".concat(error,"\nUsing translation ").concat(fetchSummary[0].url))}))}var _stage=new WeakMap,StageManager=function(){function StageManager(stageElement){_classCallCheck(this,StageManager),_classPrivateFieldInitSpec(this,_stage,{writable:!0,value:void 0}),_classPrivateFieldSet(this,_stage,new ManagedElement(stageElement))}var _startShow;return _createClass(StageManager,[{key:"startShow",value:(_startShow=_asyncToGenerator(_regeneratorRuntime().mark((function _callee(presenter){return _regeneratorRuntime().wrap((function(_context){for(;;)switch(_context.prev=_context.next){case 0:_classPrivateFieldGet(this,_stage).removeChildren();case 1:return _context.next=3,presenter.presentOnStage(_classPrivateFieldGet(this,_stage));case 3:if(presenter=_context.sent,_classPrivateFieldGet(this,_stage).removeChildren(),null!==presenter){_context.next=7;break}return _context.abrupt("return");case 7:_context.next=1;break;case 9:case"end":return _context.stop()}}),_callee,this)}))),function(_x){return _startShow.apply(this,arguments)})}]),StageManager}(),_items=new WeakMap,_wrap=new WeakMap,_index=new WeakMap,ArrayIndexer=function(){function ArrayIndexer(items){var wrap=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];_classCallCheck(this,ArrayIndexer),_classPrivateFieldInitSpec(this,_items,{writable:!0,value:void 0}),_classPrivateFieldInitSpec(this,_wrap,{writable:!0,value:void 0}),_classPrivateFieldInitSpec(this,_index,{writable:!0,value:void 0}),_classPrivateFieldSet(this,_items,items),_classPrivateFieldSet(this,_wrap,wrap),_classPrivateFieldSet(this,_index,0)}return _createClass(ArrayIndexer,[{key:"items",get:function(){return _classPrivateFieldGet(this,_items)}},{key:"reset",value:function(){_classPrivateFieldSet(this,_index,0)}},{key:"decrement",value:function(){var _this$index;_classPrivateFieldGet(this,_index)>0?_classPrivateFieldSet(this,_index,(_this$index=_classPrivateFieldGet(this,_index),--_this$index)):_classPrivateFieldSet(this,_index,_classPrivateFieldGet(this,_wrap)?_classPrivateFieldGet(this,_items).length-1:_classPrivateFieldGet(this,_index)-1);return _classPrivateFieldGet(this,_items)[_classPrivateFieldGet(this,_index)]}},{key:"increment",value:function(){var _this$index2;_classPrivateFieldGet(this,_index)<_classPrivateFieldGet(this,_items).length-1?_classPrivateFieldSet(this,_index,(_this$index2=_classPrivateFieldGet(this,_index),++_this$index2)):_classPrivateFieldSet(this,_index,_classPrivateFieldGet(this,_wrap)?0:_classPrivateFieldGet(this,_index));return _classPrivateFieldGet(this,_items)[_classPrivateFieldGet(this,_index)]}}]),ArrayIndexer}(),HelpButton=function(_ManagedElement9){_inherits(HelpButton,_ManagedElement9);var _super11=_createSuper(HelpButton);function HelpButton(){var _this18;return _classCallCheck(this,HelpButton),(_this18=_super11.call(this,"button","help-button")).classList.add("icon-only-button"),icons.applyIconToElement(icons.help,_assertThisInitialized(_this18),{hideText:!0}),_this18.listenToOwnEvent("click","HELP"),_this18}return _createClass(HelpButton,[{key:"handleClickEvent",value:function(eventIgnored,eventIdIgnored){var presenter=document.querySelector(".Presenter");console.debug("Help triggered from ".concat(null==presenter?void 0:presenter.className)),window.open(Urls.HELP,"_blank")}}],[{key:"createInside",value:function(container){var button=new HelpButton(container);return button.appendTo(container),button}}]),HelpButton}(ManagedElement),_menuContent=new WeakMap,_menuItems=new WeakMap,_createMenuContentHtml=new WeakSet,_showMenuItems=new WeakSet,_hideMenuItems=new WeakSet,Menu=function(_ManagedElement10){_inherits(Menu,_ManagedElement10);var _super12=_createSuper(Menu);function Menu(){var _this19;return _classCallCheck(this,Menu),_classPrivateMethodInitSpec(_assertThisInitialized(_this19=_super12.call(this,"button")),_hideMenuItems),_classPrivateMethodInitSpec(_assertThisInitialized(_this19),_showMenuItems),_classPrivateMethodInitSpec(_assertThisInitialized(_this19),_createMenuContentHtml),_classPrivateFieldInitSpec(_assertThisInitialized(_this19),_menuContent,{writable:!0,value:void 0}),_classPrivateFieldInitSpec(_assertThisInitialized(_this19),_menuItems,{writable:!0,value:void 0}),_this19.setAttribute("aria-haspopup",!0),icons.applyIconToElement(icons.openMenu,_assertThisInitialized(_this19),{hideText:!0}),_this19.classList.add("utils-menu-icon-open","icon-only-button"),_classPrivateMethodGet(_assertThisInitialized(_this19),_createMenuContentHtml,_createMenuContentHtml2).call(_assertThisInitialized(_this19)),_classPrivateFieldSet(_assertThisInitialized(_this19),_menuItems,new MenuItems),_this19}return _createClass(Menu,[{key:"setMenuItems",value:function(items){_classPrivateFieldGet(this,_menuItems).setMenuItems(items)}},{key:"handleClickEvent",value:function(eventIgnored,eventId){if("OPEN"===eventId)_classPrivateMethodGet(this,_showMenuItems,_showMenuItems2).call(this);else _classPrivateMethodGet(this,_hideMenuItems,_hideMenuItems2).call(this)}},{key:"handleKeydownEvent",value:function(event,eventIdIgnored){"Escape"===event.key&&_classPrivateMethodGet(this,_hideMenuItems,_hideMenuItems2).call(this)}}]),Menu}(ManagedElement);function _createMenuContentHtml2(){var menuTitleBar=new ManagedElement("div");menuTitleBar.classList.add("utils-menu-title"),_classPrivateFieldSet(this,_menuContent,new ManagedElement("div","utils-menu-content")),_classPrivateFieldGet(this,_menuContent).style.visibility="hidden",document.body.insertBefore(_classPrivateFieldGet(this,_menuContent).element,document.getElementById("modal-mask").nextSibling);var menuItemsElement=new ManagedElement("div");menuItemsElement.classList.add("container","utils-menu-items"),menuItemsElement.setAttribute("aria-role","menu"),_classPrivateFieldGet(this,_menuContent).appendChild(menuTitleBar),_classPrivateFieldGet(this,_menuContent).appendChild(menuItemsElement),this.listenToOwnEvent("click","OPEN"),this.listenToEventOn("click",_classPrivateFieldGet(this,_menuContent),"CONTENT-ACTION"),this.listenToEventOn("keydown",_classPrivateFieldGet(this,_menuContent),"CONTENT-ACTION")}function _showMenuItems2(){showMask(),this.style.visibility="hidden",_classPrivateFieldGet(this,_menuContent).classList.add("modal"),_classPrivateFieldGet(this,_menuContent).style.visibility="visible",_classPrivateFieldGet(this,_menuContent).style.transform="translateX(0)",_classPrivateFieldGet(this,_menuContent).querySelector("button.utils-menu-item").focus()}function _hideMenuItems2(){hideMask(),this.style.visibility="visible",_classPrivateFieldGet(this,_menuContent).style.transform="translateX(-100%)",_classPrivateFieldGet(this,_menuContent).style.visibility="hidden",_classPrivateFieldGet(this,_menuContent).classList.remove("modal"),focusManager.findBestFocus()}var MenuItem=function(_ManagedElement11){_inherits(MenuItem,_ManagedElement11);var _super13=_createSuper(MenuItem);function MenuItem(iconDetails){var _this20;return _classCallCheck(this,MenuItem),_this20=_super13.call(this,"button","utils-menu-item"),icons.applyIconToElement(iconDetails,_assertThisInitialized(_this20)),_this20.setAttributes({"aria-role":"menuitem"}),_this20}return _createClass(MenuItem)}(ManagedElement),_navigator=new WeakMap,_menuIconClose=new WeakMap,MenuItems=function(_ManagedElement12){_inherits(MenuItems,_ManagedElement12);var _super14=_createSuper(MenuItems);function MenuItems(){var _this21;_classCallCheck(this,MenuItems);var parent=document.querySelector(".utils-menu-items");if(!parent)throw"Html structure not in place. createMenuHtml should have been called.";_classPrivateFieldInitSpec(_assertThisInitialized(_this21=_super14.call(this,parent)),_navigator,{writable:!0,value:void 0}),_classPrivateFieldInitSpec(_assertThisInitialized(_this21),_menuIconClose,{writable:!0,value:void 0}),_this21.setAttributes({"aria-role":"menu"}),_this21.menuDefinition=null,_classPrivateFieldSet(_assertThisInitialized(_this21),_menuIconClose,new ManagedElement("button")),icons.applyIconToElement(icons.closeMenu,_classPrivateFieldGet(_assertThisInitialized(_this21),_menuIconClose),{hideText:!0}),_classPrivateFieldGet(_assertThisInitialized(_this21),_menuIconClose).classList.add("utils-menu-icon-close","icon-only-button");var logo=new ManagedElement("img");logo.setAttribute("src",Urls.LOGO);var title=document.querySelector(".utils-menu-title");return title.appendChild(logo.element),title.appendChild(_classPrivateFieldGet(_assertThisInitialized(_this21),_menuIconClose).element),_this21.listenToEventOn("click",_classPrivateFieldGet(_assertThisInitialized(_this21),_menuIconClose),MenuItems.CLOSE_EVENT_ID),_this21}return _createClass(MenuItems,[{key:"setMenuItems",value:function(menuDefinition){var _this22=this;this.menuDefinition&&this.remove(),this.menuDefinition=menuDefinition;var commandItems=[_classPrivateFieldGet(this,_menuIconClose)];this.menuDefinition.forEach((function(menuDef,index){var item;menuDef.command?(item=new MenuItem(menuDef.iconDetails),_this22.listenToEventOn("click",item,index),_this22.listenToEventOn("keydown",item,index),commandItems.push(item)):item=new ManagedElement("hr"),_this22.appendChild(item),_classPrivateFieldSet(_this22,_navigator,new ArrayIndexer(commandItems))}))}},{key:"handleClickEvent",value:function(event,eventId){var index=parseInt(eventId);isNaN(index)||(console.debug("Handling event ".concat(event.type," with id ").concat(eventId)),this.menuDefinition[index].command.execute().then((function(value){console.debug("Finished handling menu option ".concat(value,"."))})))}}]),MenuItems}(ManagedElement);_defineProperty(MenuItems,"CLOSE_EVENT_ID","close");var Header=function(){function Header(){_classCallCheck(this,Header)}return _createClass(Header,[{key:"setup",value:function(menuItems){var _titleElement$childre,titleElement=document.getElementById("title-bar");if(titleElement)if((null===(_titleElement$childre=titleElement.children)||void 0===_titleElement$childre?void 0:_titleElement$childre.length)>0)console.error("Second attempt made to setup title bar ignored.");else{var headerTextContainer=document.createElement("span");headerTextContainer.innerHTML=BuildInfo.getProductName();var helpButtonContainer=document.createElement("span");HelpButton.createInside(helpButtonContainer);var menu=new Menu;menu.setMenuItems(menuItems),titleElement.appendChild(menu.element),titleElement.appendChild(headerTextContainer),titleElement.appendChild(helpButtonContainer)}else console.error('Cannot find element with id of "title-bar".')}}]),Header}(),_buttonBar2=new WeakMap,footer=new(function(){function Footer(){_classCallCheck(this,Footer),_classPrivateFieldInitSpec(this,_buttonBar2,{writable:!0,value:void 0})}return _createClass(Footer,[{key:"buttonBar",get:function(){return _classPrivateFieldGet(this,_buttonBar2)}},{key:"setup",value:function(){var _footerElement$childr,footerElement=document.getElementById("footer");if(footerElement)if((null===(_footerElement$childr=footerElement.children)||void 0===_footerElement$childr?void 0:_footerElement$childr.length)>0)console.error("Second attempt made to setup footer ignored.");else{_classPrivateFieldSet(this,_buttonBar2,new ManagedElement("div","button-bar")),footerElement.appendChild(_classPrivateFieldGet(this,_buttonBar2).element);var footerTextContainer=document.createElement("div");footerTextContainer.className="footer-text";var devTag="PRODUCTION"!==BuildInfo.getMode().toUpperCase()?"[".concat(BuildInfo.getMode(),"]"):"";footerTextContainer.innerHTML="".concat(BuildInfo.getProductName()," ").concat(BuildInfo.getVersion()).concat(devTag," ").concat(BuildInfo.getBuildDate()),footerElement.appendChild(footerTextContainer)}else console.error('Cannot find element with id of "footer".')}}]),Footer}()),header=new Header;function createLink(href,text){return'<a href="'.concat(href,'" target="_blank">').concat(text,"</a>").concat(getPrintableLink(href,text))}function buildAttribution(extendedTitle){var container=new ManagedElement("li","attribution");return extendedTitle.source?(function(container,imageSource,imageTitle){container.createAndAppendChild("span","",createLink(imageSource,imageTitle||"Untitled"))}(container,extendedTitle.source,extendedTitle.title),function(container,authors){authors&&container.createAndAppendChild("span",""," by ".concat(authors))}(container,extendedTitle.authors),function(container,notes){notes&&container.createAndAppendChild("span",""," [".concat(parseMarkdownSpanOnly(notes),"]"))}(container,extendedTitle.notes),function(container,licenceName,licenceUrl){var text;(licenceName||licenceUrl)&&(licenceUrl=licenceUrl||function(licenceName){if(/^\s*&CC0\s*$/.test(licenceName))return"https://creativecommons.org/publicdomain/zero/1.0/";if(/^\s*unsplash\s*$/i.test(licenceName))return"https://unsplash.com/license";var matchCC=/^\s*CC[ -](BY(?:-(?:SA|NC|NC-SA|ND|NC-ND))?) ?(\d+[.]\d)?\s*$/i.exec(licenceName);return matchCC?"https://creativecommons.org/licenses/".concat(matchCC[1].toLowerCase(),"/").concat(matchCC[2]||"4.0","/"):""}(licenceName),text=licenceUrl?", licence: ".concat(createLink(licenceUrl,licenceName||licenceUrl)):", ".concat(licenceName),container.createAndAppendChild("span","",text))}(container,extendedTitle.licenceName,extendedTitle.licenceUrl),container):(container.createAndAppendChild("span","",parseMarkdownSpanOnly(extendedTitle.title)),container)}var _resolutionExecutor=new WeakMap,_navigator2=new WeakMap,_preamble=new WeakMap,_presentation=new WeakMap,_postamble=new WeakMap,_buttonBar3=new WeakMap,_homeButton=new WeakMap,_backwardsButton=new WeakMap,_forwardsButton=new WeakMap,_creditsButton=new WeakMap,_attributions=new WeakMap,_nextInPostamble=new WeakMap,_addClassNames=new WeakSet,_buildContent=new WeakSet,_addNavigationButtons=new WeakSet,_addAttributionButton=new WeakSet,_addLinkGuardians=new WeakSet,_confirmOpeningLink=new WeakSet,Presenter=function(_ManagedElement13){_inherits(Presenter,_ManagedElement13);var _handleClickEvent,_allowNavigation,_askIfOkayToLeave,_super15=_createSuper(Presenter);function Presenter(config,nextInPostamble){var _this23;return _classCallCheck(this,Presenter),_classPrivateMethodInitSpec(_assertThisInitialized(_this23=_super15.call(this,"div")),_confirmOpeningLink),_classPrivateMethodInitSpec(_assertThisInitialized(_this23),_addLinkGuardians),_classPrivateMethodInitSpec(_assertThisInitialized(_this23),_addAttributionButton),_classPrivateMethodInitSpec(_assertThisInitialized(_this23),_addNavigationButtons),_classPrivateMethodInitSpec(_assertThisInitialized(_this23),_buildContent),_classPrivateMethodInitSpec(_assertThisInitialized(_this23),_addClassNames),_classPrivateFieldInitSpec(_assertThisInitialized(_this23),_resolutionExecutor,{writable:!0,value:void 0}),_defineProperty(_assertThisInitialized(_this23),"config",void 0),_classPrivateFieldInitSpec(_assertThisInitialized(_this23),_navigator2,{writable:!0,value:void 0}),_classPrivateFieldInitSpec(_assertThisInitialized(_this23),_preamble,{writable:!0,value:void 0}),_classPrivateFieldInitSpec(_assertThisInitialized(_this23),_presentation,{writable:!0,value:void 0}),_classPrivateFieldInitSpec(_assertThisInitialized(_this23),_postamble,{writable:!0,value:void 0}),_classPrivateFieldInitSpec(_assertThisInitialized(_this23),_buttonBar3,{writable:!0,value:void 0}),_classPrivateFieldInitSpec(_assertThisInitialized(_this23),_homeButton,{writable:!0,value:void 0}),_classPrivateFieldInitSpec(_assertThisInitialized(_this23),_backwardsButton,{writable:!0,value:void 0}),_classPrivateFieldInitSpec(_assertThisInitialized(_this23),_forwardsButton,{writable:!0,value:void 0}),_classPrivateFieldInitSpec(_assertThisInitialized(_this23),_creditsButton,{writable:!0,value:void 0}),_classPrivateFieldInitSpec(_assertThisInitialized(_this23),_attributions,{writable:!0,value:void 0}),_classPrivateFieldInitSpec(_assertThisInitialized(_this23),_nextInPostamble,{writable:!0,value:void 0}),_classPrivateFieldSet(_assertThisInitialized(_this23),_nextInPostamble,nextInPostamble),_classPrivateMethodGet(_assertThisInitialized(_this23),_addClassNames,_addClassNames2).call(_assertThisInitialized(_this23)),_this23.config=config,footer.buttonBar.removeChildren(),_classPrivateMethodGet(_assertThisInitialized(_this23),_buildContent,_buildContent2).call(_assertThisInitialized(_this23)),_this23}return _createClass(Presenter,[{key:"presentation",get:function(){return _classPrivateFieldGet(this,_presentation)}},{key:"expandPresentation",value:function(){_classPrivateFieldGet(this,_presentation).classList.add("expanded")}},{key:"addButtonToBar",value:function(managedButton){_classPrivateFieldGet(this,_buttonBar3).element.insertBefore(managedButton.element,_classPrivateFieldGet(this,_buttonBar3).element.lastElementChild)}},{key:"addPreamble",value:function(data){"string"==typeof data?_classPrivateFieldGet(this,_preamble).createAndAppendChild("div",null,data):_classPrivateFieldGet(this,_preamble).appendChild(data)}},{key:"addPostamble",value:function(data){"string"==typeof data?_classPrivateFieldGet(this,_postamble).createAndAppendChild("div",null,data):_classPrivateFieldGet(this,_postamble).appendChild(data)}},{key:"hideHomeButton",value:function(){_classPrivateFieldGet(this,_homeButton).hide()}},{key:"showBackButton",value:function(){_classPrivateFieldGet(this,_backwardsButton).show(),focus&&_classPrivateFieldGet(this,_backwardsButton).focus()}},{key:"showNextButton",value:function(focus){_classPrivateFieldGet(this,_forwardsButton).show(),focus&&_classPrivateFieldGet(this,_forwardsButton).focus()}},{key:"applyIconToNextButton",value:function(iconDetails,overrideText){icons.applyIconToElement(iconDetails,_classPrivateFieldGet(this,_forwardsButton),{overrideText:overrideText})}},{key:"autoAddKeydownEvents",value:function(managedElements){var _this24=this;if(_classPrivateFieldGet(this,_navigator2))console.error("autoAddKeydownEvents can only be called once.");else{var items=null!=managedElements?managedElements:_classPrivateFieldGet(this,_presentation).managedChildren;_classPrivateFieldSet(this,_navigator2,new ArrayIndexer(items,!0)),items.forEach((function(item,index){_this24.listenToEventOn("keydown",item,index)}))}}},{key:"next",value:function(indexIgnored){return this.config.factory.getNext(this,this.config)}},{key:"previous",value:function(){return this.config.factory.getPrevious(this,this.config)}},{key:"presentOnStage",value:function(stageElement){var _this25=this;return new Promise((function(resolve){_classPrivateFieldSet(_this25,_resolutionExecutor,resolve),stageElement.appendChild(_this25),_this25.addAttributions(),_classPrivateMethodGet(_this25,_addLinkGuardians,_addLinkGuardians2).call(_this25),_this25.onPostPresentActions(),focusManager.findBestFocus()}))}},{key:"onPostPresentActions",value:function(){}},{key:"addAttributions",value:function(){var parent,container,images;_classPrivateFieldGet(this,_attributions)&&_classPrivateFieldGet(this,_attributions).remove(),_classPrivateFieldSet(this,_attributions,(parent=document.getElementById("stage"),container=new ManagedElement("ul","attributions"),0===(images=ManagedElement.getElement(parent).querySelectorAll("img[title]")).length?null:(images.forEach((function(image){var extendedTitle=function(image){var _parts$0$trim,_parts$,_parts$1$trim,_parts$2,_parts$2$trim,_parts$3,_parts$3$trim,_parts$4,_parts$4$trim,_parts$5,_parts$5$trim,_parts$6,title=image.getAttribute("title");if(!title)return null;var parts=title.split("|");return{title:null!==(_parts$0$trim=null===(_parts$=parts[0])||void 0===_parts$?void 0:_parts$.trim())&&void 0!==_parts$0$trim?_parts$0$trim:"",source:null!==(_parts$1$trim=null===(_parts$2=parts[1])||void 0===_parts$2?void 0:_parts$2.trim())&&void 0!==_parts$1$trim?_parts$1$trim:"",authors:null!==(_parts$2$trim=null===(_parts$3=parts[2])||void 0===_parts$3?void 0:_parts$3.trim())&&void 0!==_parts$2$trim?_parts$2$trim:"",licenceName:null!==(_parts$3$trim=null===(_parts$4=parts[3])||void 0===_parts$4?void 0:_parts$4.trim())&&void 0!==_parts$3$trim?_parts$3$trim:"",licenceUrl:null!==(_parts$4$trim=null===(_parts$5=parts[4])||void 0===_parts$5?void 0:_parts$5.trim())&&void 0!==_parts$4$trim?_parts$4$trim:"",notes:null!==(_parts$5$trim=null===(_parts$6=parts[5])||void 0===_parts$6?void 0:_parts$6.trim())&&void 0!==_parts$5$trim?_parts$5$trim:""}}(image);if(extendedTitle){var attribution=buildAttribution(extendedTitle);container.appendChild(attribution)}})),container))),_classPrivateFieldGet(this,_attributions)?(_classPrivateFieldGet(this,_attributions).classList.add("for-print-only"),this.addPostamble(_classPrivateFieldGet(this,_attributions)),_classPrivateFieldGet(this,_creditsButton).show()):_classPrivateFieldGet(this,_creditsButton)&&_classPrivateFieldGet(this,_creditsButton).hide()}},{key:"askIfOkayToLeave",value:(_askIfOkayToLeave=_asyncToGenerator(_regeneratorRuntime().mark((function _callee2(message){var confirmation;return _regeneratorRuntime().wrap((function(_context2){for(;;)switch(_context2.prev=_context2.next){case 0:return _context2.next=2,ModalDialog.showConfirm(message,null,!1);case 2:return confirmation=_context2.sent,_context2.abrupt("return",confirmation===ModalDialog.DialogIndex.CONFIRM_YES);case 4:case"end":return _context2.stop()}}),_callee2)}))),function(_x2){return _askIfOkayToLeave.apply(this,arguments)})},{key:"allowNavigation",value:(_allowNavigation=_asyncToGenerator(_regeneratorRuntime().mark((function _callee3(eventIgnored,eventIdIgnored){return _regeneratorRuntime().wrap((function(_context3){for(;;)switch(_context3.prev=_context3.next){case 0:return _context3.abrupt("return",!0);case 1:case"end":return _context3.stop()}}),_callee3)}))),function(_x3,_x4){return _allowNavigation.apply(this,arguments)})},{key:"handleClickEvent",value:(_handleClickEvent=_asyncToGenerator(_regeneratorRuntime().mark((function _callee4(event,eventId){var index,upperCaseId,nextPresenter;return _regeneratorRuntime().wrap((function(_context4){for(;;)switch(_context4.prev=_context4.next){case 0:return index=parseInt(eventId),upperCaseId=eventId?eventId.toString().toUpperCase():"",_context4.next=4,this.allowNavigation(event,eventId);case 4:if(_context4.sent){_context4.next=6;break}return _context4.abrupt("return",!0);case 6:if(nextPresenter=null,upperCaseId!==Presenter.IMAGE_INFO){_context4.next=11;break}return _context4.abrupt("return",ModalDialog.showInfo(document.querySelector(".attributions").innerHTML,i18n(_templateObject79||(_templateObject79=_taggedTemplateLiteral(["0407c27180c9b019e644e8ad4c6a9324::"])))));case 11:nextPresenter=upperCaseId===Presenter.PREVIOUS_ID?this.previous():upperCaseId===Presenter.NEXT_ID?this.next(Presenter.NEXT_ID):upperCaseId===Presenter.HOME_ID?this.config.factory.getHome(this.config):this.next(isNaN(index)?eventId:index);case 12:nextPresenter&&_classPrivateFieldGet(this,_resolutionExecutor).call(this,nextPresenter);case 13:case"end":return _context4.stop()}}),_callee4,this)}))),function(_x5,_x6){return _handleClickEvent.apply(this,arguments)})},{key:"handleKeydownEvent",value:function(event,eventId){var index=parseInt(eventId);if(console.debug("Key ".concat(event.key," down for index ").concat(index)),!isNaN(index))switch(event.key){case" ":case"Enter":this.handleClickEvent(event,eventId)}}}]),Presenter}(ManagedElement);function _addClassNames2(){var item=this;do{this.classList.add(item.constructor.name),item=Object.getPrototypeOf(item)}while("Object"!==item.constructor.name)}function _buildContent2(){_classPrivateFieldSet(this,_preamble,new ManagedElement("div","preamble")),_classPrivateFieldSet(this,_presentation,new ManagedElement("div","presentation")),_classPrivateFieldSet(this,_postamble,new ManagedElement("div","postamble")),_classPrivateFieldSet(this,_buttonBar3,footer.buttonBar),_classPrivateMethodGet(this,_addNavigationButtons,_addNavigationButtons2).call(this),this.appendChild(_classPrivateFieldGet(this,_preamble)),this.appendChild(_classPrivateFieldGet(this,_presentation)),this.appendChild(_classPrivateFieldGet(this,_postamble)),_classPrivateMethodGet(this,_addAttributionButton,_addAttributionButton2).call(this)}function _addNavigationButtons2(){_classPrivateFieldSet(this,_homeButton,new ManagedElement("button","home-navigation")),icons.applyIconToElement(icons.home,_classPrivateFieldGet(this,_homeButton)),this.listenToEventOn("click",_classPrivateFieldGet(this,_homeButton),Presenter.HOME_ID),_classPrivateFieldGet(this,_buttonBar3).appendChild(_classPrivateFieldGet(this,_homeButton)),_classPrivateFieldSet(this,_backwardsButton,new ManagedElement("button","back-navigation")),icons.applyIconToElement(icons.back,_classPrivateFieldGet(this,_backwardsButton)),this.listenToEventOn("click",_classPrivateFieldGet(this,_backwardsButton),Presenter.PREVIOUS_ID),_classPrivateFieldGet(this,_buttonBar3).appendChild(_classPrivateFieldGet(this,_backwardsButton)),_classPrivateFieldGet(this,_backwardsButton).hide(),_classPrivateFieldSet(this,_forwardsButton,new ManagedElement("button","forward-navigation")),icons.applyIconToElement(icons.forward,_classPrivateFieldGet(this,_forwardsButton)),this.listenToEventOn("click",_classPrivateFieldGet(this,_forwardsButton),Presenter.NEXT_ID),_classPrivateFieldGet(this,_nextInPostamble)?this.addPostamble(_classPrivateFieldGet(this,_forwardsButton)):_classPrivateFieldGet(this,_buttonBar3).appendChild(_classPrivateFieldGet(this,_forwardsButton)),_classPrivateFieldGet(this,_forwardsButton).hide()}function _addAttributionButton2(){var attributionsContainer=new ManagedElement("div","attribution-button-container");_classPrivateFieldSet(this,_creditsButton,new ManagedElement("button")),attributionsContainer.appendChild(_classPrivateFieldGet(this,_creditsButton)),icons.applyIconToElement(icons.imageInfo,_classPrivateFieldGet(this,_creditsButton),{hideText:!0}),this.listenToEventOn("click",_classPrivateFieldGet(this,_creditsButton),Presenter.IMAGE_INFO),this.addPostamble(attributionsContainer),_classPrivateFieldGet(this,_creditsButton).hide()}function _addLinkGuardians2(){var _document$getElementB,_this59=this;null===(_document$getElementB=document.getElementById("content"))||void 0===_document$getElementB||null===(_document$getElementB=_document$getElementB.querySelectorAll("a"))||void 0===_document$getElementB||_document$getElementB.forEach((function(anchor){var href=anchor.getAttribute("href");href&&new URL(href).origin!==window.location.origin&&anchor.addEventListener("click",function(){var _ref2=_asyncToGenerator(_regeneratorRuntime().mark((function _callee9(event){return _regeneratorRuntime().wrap((function(_context9){for(;;)switch(_context9.prev=_context9.next){case 0:return _context9.abrupt("return",_classPrivateMethodGet(_this59,_confirmOpeningLink,_confirmOpeningLink2).call(_this59,event));case 1:case"end":return _context9.stop()}}),_callee9)})));return function(_x15){return _ref2.apply(this,arguments)}}())}))}function _confirmOpeningLink2(event){var destination=event.currentTarget.getAttribute("href"),question=i18n(_templateObject122||(_templateObject122=_taggedTemplateLiteral(["9204402858fd7d0731ed5eefb8e65660::",""])),destination)+"\n"+i18n(_templateObject123||(_templateObject123=_taggedTemplateLiteral(["84aa1011fb02d4087756a4a8737bae7a::",""])),BuildInfo.getProductName())+"\n"+i18n(_templateObject124||(_templateObject124=_taggedTemplateLiteral(["b67083b6acb177c627162692fceb7086::"])));confirm(question)||event.preventDefault()}_defineProperty(Presenter,"HOME_ID","HOME"),_defineProperty(Presenter,"PREVIOUS_ID","BACKWARDS"),_defineProperty(Presenter,"NEXT_ID","FORWARDS"),_defineProperty(Presenter,"IMAGE_INFO","IMAGE_INFO"),_defineProperty(Presenter,"DO_NOT_CLOSE_CLASS_NAME","do-not-close");var _input=new WeakMap,FileInputButton=function(_ManagedElement14){_inherits(FileInputButton,_ManagedElement14);var _super16=_createSuper(FileInputButton);function FileInputButton(options){var _this26;return _classCallCheck(this,FileInputButton),_classPrivateFieldInitSpec(_assertThisInitialized(_this26=_super16.call(this,"label","file-input-button")),_input,{writable:!0,value:void 0}),_this26.classList.add("selectable"),_classPrivateFieldSet(_assertThisInitialized(_this26),_input,new ManagedElement("input")),_classPrivateFieldGet(_assertThisInitialized(_this26),_input).setAttribute("type","file"),icons.applyIconToElement(icons.import,_assertThisInitialized(_this26),options),_classPrivateFieldGet(_assertThisInitialized(_this26),_input).style.visibility="hidden",_classPrivateFieldGet(_assertThisInitialized(_this26),_input).style.height="1em",_this26.appendChild(_classPrivateFieldGet(_assertThisInitialized(_this26),_input)),_this26.setAttribute("tabindex",0),_this26.listenToEventOn("change",_classPrivateFieldGet(_assertThisInitialized(_this26),_input)),_this26.listenToOwnEvent("keydown","KEY"),_this26}return _createClass(FileInputButton,[{key:"handleChangeEvent",value:function(eventIgnored,eventIdIgnored){var file=_classPrivateFieldGet(this,_input).element.files[0];if(file){var reader=new FileReader,control=this;reader.addEventListener("load",(function(){reader.result,control.dispatchEvent(new CustomEvent(FileInputButton.DATA_AVAILABLE_EVENT_NAME,{detail:{file:file,content:reader.result}}))})),reader.readAsText(file)}}},{key:"handleKeydownEvent",value:function(event,eventIdIgnored){var _this27=this;switch(event.key){case" ":case"Enter":setTimeout((function(){return _this27.element.click()}))}}}]),FileInputButton}(ManagedElement);function makeSafeFilename(filename,extension){var safename=filename.replace(/[^A-Za-z0-9_-]/g,"_").substring(0,32);return"".concat(safename,".").concat(extension)}_defineProperty(FileInputButton,"DATA_AVAILABLE_EVENT_NAME","dataAvailable");var _title3=new WeakMap,_content3=new WeakMap,_getDataUri=new WeakSet,_lessonAsString=new WeakMap,_getFilename=new WeakSet,LessonExporter=function(){function LessonExporter(title,content){_classCallCheck(this,LessonExporter),_classPrivateMethodInitSpec(this,_getFilename),_classPrivateFieldInitSpec(this,_lessonAsString,{get:_get_lessonAsString,set:void 0}),_classPrivateMethodInitSpec(this,_getDataUri),_classPrivateFieldInitSpec(this,_title3,{writable:!0,value:void 0}),_classPrivateFieldInitSpec(this,_content3,{writable:!0,value:void 0}),_classPrivateFieldSet(this,_title3,title),_classPrivateFieldSet(this,_content3,content)}return _createClass(LessonExporter,[{key:"exportLesson",value:function(){var _this28=this;return ModalDialog.showDialog(i18n(_templateObject81||(_templateObject81=_taggedTemplateLiteral(["b68686a697ec08b09db6d729aed81c71::"]))),i18n(_templateObject82||(_templateObject82=_taggedTemplateLiteral(["5ae903bf09202faef9d5fcedbf21cf14::"]))),{dialogType:ModalDialog.DialogType.QUESTION,buttons:[icons.export,icons.exportAutoRun]}).then((function(index){return 0===index?_this28.exportBase64Lesson():_this28.exportAutorunLesson()}))}},{key:"exportBase64Lesson",value:function(){this.saveDataToFile(stringToBase64(_classPrivateFieldGet(this,_lessonAsString)),"txt")}},{key:"createAutorunLessonHtml",value:function(){var html=function(data){var rootUrl=Urls.NON_LOCAL_ROOT;return'<!DOCTYPE html>\n  <html lang="en">\n    <head>\n      <meta charset="UTF-8" />\n      <meta name="viewport" content="width=device-width, initial-scale=1.0" />\n      <title>Text2Lesson</title>\n      <link\n        rel="icon"\n        type="image/png"\n        sizes="48x48"\n        href="'.concat(rootUrl,'assets/images/favicon.appiconset/favicon_48.png"\n      />\n      <link\n        rel="apple-touch-icon"\n        type="image/png"\n        sizes="167x167"\n        href="').concat(rootUrl,'assets/images/favicon.appiconset/favicon_167.png"\n      />\n      <link\n        rel="apple-touch-icon"\n        type="image/png"\n        sizes="180x180"\n        href="').concat(rootUrl,'assets/images/favicon.appiconset/favicon_180.png"\n      />\n      <link\n        rel="icon"\n        type="image/png"\n        sizes="192x192"\n        href="').concat(rootUrl,'assets/images/favicon.appiconset/favicon_192.png"\n      />\n  \n      <link rel="stylesheet" href="').concat(rootUrl,'assets/styles/style.css" />\n      <link\n        href="').concat(rootUrl,'assets/third-party/font-awesome/css/fontawesome.min.css"\n        rel="stylesheet"\n      />\n      <link\n        href="').concat(rootUrl,'assets/third-party/font-awesome/css/brands.min.css"\n        rel="stylesheet"\n      />\n      <link\n        href="').concat(rootUrl,'assets/third-party/font-awesome/css/solid.min.css"\n        rel="stylesheet"\n      />\n    </head>\n  <script>\n      window.text2LessonEmbeddedData = {\n        title: "').concat(data.b64Title,'",\n        source: "').concat(data.b64LessonData,'",\n        translations: "').concat(data.b64Translations,'",\n        rootUrl: "').concat(rootUrl,'",\n      }    \n  <\/script>\n    <body>\n      <div id="modal-mask"></div>\n      <div id="title-bar"></div>\n      <div id="content" class="container">\n        <div id="stage">\n          <p style="line-height: 100vh; text-align: center; opacity: 0.5">\n            The application is loading. Please wait a few moments.\n          </p>\n        </div>\n      </div>\n      <div id="footer" class="container"></div>\n      <script type="module" src="').concat(rootUrl,'text2lesson.js"><\/script>\n      <noscript class="always-on-top">\n        <p>\n          Your browser does not support scripts and so this application cannot\n          run. If you\'ve disabled scripts, you will need to enable them to\n          proceed. Sorry.\n        </p>\n      </noscript>\n      <div id="browser-css-not-supported">\n        <p>\n          Sorry, but your browser does not support the features necessary to run\n          this application. Try upgrading your browser to the latest version.\n        </p>\n      </div>\n    </body>\n  </html>\n  ')}({b64Title:stringToBase64(_classPrivateFieldGet(this,_title3)),b64LessonData:stringToBase64(_classPrivateFieldGet(this,_content3)),b64Translations:stringToBase64(JSON.stringify({active:activeTranslations,fallback:fallbackTranslations}))});return html}},{key:"exportAutorunLesson",value:function(){var html=this.createAutorunLessonHtml();this.saveDataToFile(html,"html")}},{key:"saveDataToFile",value:function(data,extension){var tempA=document.createElement("a");tempA.setAttribute("href",_classPrivateMethodGet(this,_getDataUri,_getDataUri2).call(this,data)),tempA.setAttribute("download",_classPrivateMethodGet(this,_getFilename,_getFilename2).call(this,extension)),tempA.addEventListener("click",(function(){document.body.removeChild(tempA)})),document.body.appendChild(tempA),tempA.click()}}]),LessonExporter}();function _getDataUri2(data){return"data:text/plain;charset=utf-8,".concat(encodeURIComponent(data))}function _get_lessonAsString(){return JSON.stringify({title:_classPrivateFieldGet(this,_title3),content:_classPrivateFieldGet(this,_content3)})}function _getFilename2(extension){return makeSafeFilename(_classPrivateFieldGet(this,_title3),extension)}var _getSummaryFromBase64File=new WeakSet,_getSummaryFromAutorunFile=new WeakSet,_getSummaryFromPlainTextFile=new WeakSet,LessonImporter=function(){function LessonImporter(){_classCallCheck(this,LessonImporter),_classPrivateMethodInitSpec(this,_getSummaryFromPlainTextFile),_classPrivateMethodInitSpec(this,_getSummaryFromAutorunFile),_classPrivateMethodInitSpec(this,_getSummaryFromBase64File)}return _createClass(LessonImporter,[{key:"convert",value:function(exportedData){var result=_classPrivateMethodGet(this,_getSummaryFromBase64File,_getSummaryFromBase64File2).call(this,exportedData);return result||((result=_classPrivateMethodGet(this,_getSummaryFromAutorunFile,_getSummaryFromAutorunFile2).call(this,exportedData))?(console.log(result.languages),result):_classPrivateMethodGet(this,_getSummaryFromPlainTextFile,_getSummaryFromPlainTextFile2).call(this,exportedData))}}]),LessonImporter}();function _getSummaryFromBase64File2(data){if(data.match(/^[a-zA-Z0-9+/=]+$/))try{return JSON.parse(base64ToString(data))}catch(error){console.error(error)}return null}function _getSummaryFromAutorunFile2(data){var match=data.match(/title:\s*['"]([a-zA-Z0-9+/=]+)['"]\s*,\s*source:\s*['"]([a-zA-Z0-9+/=]+)['"]/);if(match)try{return{title:base64ToString(match[1]),content:base64ToString(match[2])}}catch(error){console.error(error)}return null}function _getSummaryFromPlainTextFile2(data){return data.match(/^[-#_* ]{0,3}(?:\(*([i?=xX&_\xD7])\1*[_) ]+)(.*)$/m)?{title:"",content:data}:null}var _importSummary=new WeakMap,_buildContent3=new WeakSet,HomePresenter=function(_Presenter){_inherits(HomePresenter,_Presenter);var _super17=_createSuper(HomePresenter);function HomePresenter(config){var _this29;return _classCallCheck(this,HomePresenter),config.titles=[],config.itemClassName="library",_classPrivateMethodInitSpec(_assertThisInitialized(_this29=_super17.call(this,config)),_buildContent3),_classPrivateFieldInitSpec(_assertThisInitialized(_this29),_importSummary,{writable:!0,value:void 0}),_classPrivateMethodGet(_assertThisInitialized(_this29),_buildContent3,_buildContent4).call(_assertThisInitialized(_this29)),_this29.hideHomeButton(),_this29}return _createClass(HomePresenter,[{key:"handleDataAvailableEvent",value:function(event,eventIdIgnored){var _event$detail,importer=new LessonImporter;(_classPrivateFieldSet(this,_importSummary,importer.convert(event.detail.content)),_classPrivateFieldGet(this,_importSummary))?this.handleClickEvent(event,HomePresenter.FILE_LIBRARY_ID):toast("Unable to import the file ".concat(null===(_event$detail=event.detail)||void 0===_event$detail||null===(_event$detail=_event$detail.file)||void 0===_event$detail?void 0:_event$detail.name,". The file may be corrupt or the wrong type of file."))}},{key:"next",value:function(index){if(index===HomePresenter.FILE_LIBRARY_ID){var unmanagedLesson=new UnmanagedLesson(_classPrivateFieldGet(this,_importSummary).title,_classPrivateFieldGet(this,_importSummary).content,LessonOrigin.FILE_SYSTEM);return this.config.lesson=unmanagedLesson.lesson,this.config.lessonInfo=unmanagedLesson.lessonInfo,this.config.factory.getSuitableProblemPresenter(this.config)}return lessonManager.usingLocalLibrary=index===HomePresenter.LOCAL_LIBRARY_ID,_get(_getPrototypeOf(HomePresenter.prototype),"next",this).call(this,index)}}]),HomePresenter}(Presenter);function _buildContent4(){var button=new ManagedElement("button");icons.applyIconToElement(icons.library,button,{overrideText:i18n(_templateObject125||(_templateObject125=_taggedTemplateLiteral(["3f5dfb4c6fd14bfc5f2790307ab8712a::",""])),lessonManager.remoteLibraryTitle),hideText:!1}),lessonManager.isRemoteLibraryAvailable||button.setAttribute("disabled"),this.presentation.appendChild(button),this.listenToEventOn("click",button,HomePresenter.REMOTE_LIBRARY_ID),button=new ManagedElement("button"),icons.applyIconToElement(icons.library,button,{overrideText:i18n(_templateObject126||(_templateObject126=_taggedTemplateLiteral(["d63e17b8da99189aff04b37070c61c8e::"]))),hideText:!1}),this.presentation.appendChild(button),this.listenToEventOn("click",button,HomePresenter.LOCAL_LIBRARY_ID),button=new FileInputButton({overrideText:i18n(_templateObject127||(_templateObject127=_taggedTemplateLiteral(["9148a8aa9f535484f03b98ae018a76b6::"]))),hideText:!1}),this.presentation.appendChild(button),this.listenToEventOn(FileInputButton.DATA_AVAILABLE_EVENT_NAME,button,HomePresenter.FILE_LIBRARY_ID),this.addPreamble(parseMarkdown(i18n(_templateObject80||(_templateObject80=_taggedTemplateLiteral(["5a62ae5db3f4f824aa6f41465bab07da::",""])),BuildInfo.getProductName())))}_defineProperty(HomePresenter,"REMOTE_LIBRARY_ID","REMOTE"),_defineProperty(HomePresenter,"LOCAL_LIBRARY_ID","LOCAL"),_defineProperty(HomePresenter,"FILE_LIBRARY_ID","FILE_SYSTEM");var _buildContent5=new WeakSet,ListPresenter=function(_Presenter2){_inherits(ListPresenter,_Presenter2);var _super18=_createSuper(ListPresenter);function ListPresenter(config){var _this30;return _classCallCheck(this,ListPresenter),_classPrivateMethodInitSpec(_assertThisInitialized(_this30=_super18.call(this,config)),_buildContent5),_classPrivateMethodGet(_assertThisInitialized(_this30),_buildContent5,_buildContent6).call(_assertThisInitialized(_this30)),_this30}return _createClass(ListPresenter)}(Presenter);function _buildContent6(){var _this$config,_this$config2,_this60=this;null===(_this$config=this.config)||void 0===_this$config||null===(_this$config=_this$config.titles)||void 0===_this$config||_this$config.forEach((function(title,index){var itemElement=new ManagedElement("button",_this60.config.itemClassName);itemElement.setAttribute("tabindex","0"),_this60.presentation.appendChild(itemElement),itemElement.innerHTML=title,_this60.listenToEventOn("click",itemElement,index)})),null!==(_this$config2=this.config)&&void 0!==_this$config2&&null!==(_this$config2=_this$config2.factory)&&void 0!==_this$config2&&_this$config2.hasPrevious(this)&&this.showBackButton()}var _buildPreamble=new WeakSet,LibraryPresenter=function(_ListPresenter){_inherits(LibraryPresenter,_ListPresenter);var _super19=_createSuper(LibraryPresenter);function LibraryPresenter(config){var _this31;return _classCallCheck(this,LibraryPresenter),config.titles=lessonManager.bookTitles,config.itemClassName="book",_classPrivateMethodInitSpec(_assertThisInitialized(_this31=_super19.call(this,config)),_buildPreamble),_classPrivateMethodGet(_assertThisInitialized(_this31),_buildPreamble,_buildPreamble2).call(_assertThisInitialized(_this31)),_this31.autoAddKeydownEvents(),_this31}return _createClass(LibraryPresenter,[{key:"next",value:function(index){return lessonManager.bookIndex=index,_get(_getPrototypeOf(LibraryPresenter.prototype),"next",this).call(this,index)}}]),LibraryPresenter}(ListPresenter);function _buildPreamble2(){this.addPreamble("<span class='library-title'>".concat(lessonManager.libraryTitle,"</span>"))}var _buildPreamble3=new WeakSet,BookPresenter=function(_ListPresenter2){_inherits(BookPresenter,_ListPresenter2);var _super20=_createSuper(BookPresenter);function BookPresenter(config){var _this32;return _classCallCheck(this,BookPresenter),config.titles=lessonManager.chapterTitles,config.itemClassName="chapter",_classPrivateMethodInitSpec(_assertThisInitialized(_this32=_super20.call(this,config)),_buildPreamble3),_this32.autoAddKeydownEvents(),_classPrivateMethodGet(_assertThisInitialized(_this32),_buildPreamble3,_buildPreamble4).call(_assertThisInitialized(_this32)),_this32}return _createClass(BookPresenter,[{key:"next",value:function(index){return lessonManager.chapterIndex=index,_get(_getPrototypeOf(BookPresenter.prototype),"next",this).call(this,index)}}]),BookPresenter}(ListPresenter);function _buildPreamble4(){this.addPreamble("<span class='library-title'>".concat(lessonManager.libraryTitle,"</span>\n    <span class='book-title'>").concat(lessonManager.bookTitle,"</span>\n    "))}var _buildPreamble5=new WeakSet,_addNewSlotButton=new WeakSet,ChapterPresenter=function(_ListPresenter3){_inherits(ChapterPresenter,_ListPresenter3);var _super21=_createSuper(ChapterPresenter);function ChapterPresenter(config){var _this33;return _classCallCheck(this,ChapterPresenter),config.titles=lessonManager.lessonTitles,config.itemClassName="lesson",_classPrivateMethodInitSpec(_assertThisInitialized(_this33=_super21.call(this,config)),_addNewSlotButton),_classPrivateMethodInitSpec(_assertThisInitialized(_this33),_buildPreamble5),_defineProperty(_assertThisInitialized(_this33),"ADD_LESSON_EVENT_ID","add-lesson"),_classPrivateMethodGet(_assertThisInitialized(_this33),_buildPreamble5,_buildPreamble6).call(_assertThisInitialized(_this33)),lessonManager.usingLocalLibrary&&_classPrivateMethodGet(_assertThisInitialized(_this33),_addNewSlotButton,_addNewSlotButton2).call(_assertThisInitialized(_this33)),_this33.autoAddKeydownEvents(),_this33}return _createClass(ChapterPresenter,[{key:"onPostPresentActions",value:function(){if(lessonManager.usingLocalLibrary){var stage=document.getElementById("stage");stage.scrollTo({top:stage.scrollHeight,behavior:"smooth"})}}},{key:"handleClickEvent",value:function(event,eventId){var _this34=this;if(eventId===this.ADD_LESSON_EVENT_ID)return lessonManager.addLessonToLocalLibrary().then((function(){_get(_getPrototypeOf(ChapterPresenter.prototype),"handleClickEvent",_this34).call(_this34,event,eventId)}));_get(_getPrototypeOf(ChapterPresenter.prototype),"handleClickEvent",this).call(this,event,eventId)}},{key:"next",value:function(index){return index===this.ADD_LESSON_EVENT_ID?new ChapterPresenter(this.config):(lessonManager.lessonIndex=index,_get(_getPrototypeOf(ChapterPresenter.prototype),"next",this).call(this,index))}}]),ChapterPresenter}(ListPresenter);function _buildPreamble6(){lessonManager.usingLocalLibrary?this.addPreamble("<span class='library-title'>".concat(lessonManager.libraryTitle,"</span>")):this.addPreamble("<span class='library-title'>".concat(lessonManager.libraryTitle,"</span>\n        <span class='book-title'>").concat(lessonManager.bookTitle,"</span>\n        <span class='chapter-title'>").concat(lessonManager.chapterTitle,"</span>\n        "))}function _addNewSlotButton2(){var button=new ManagedElement("button");icons.applyIconToElement(icons.addLesson,button),this.listenToEventOn("click",button,this.ADD_LESSON_EVENT_ID),this.addButtonToBar(button)}var _buildCustomContent=new WeakSet,_addPrintButton=new WeakSet,_addEditButtonIfLocal=new WeakSet,_showNextButtonIfContent=new WeakSet,_loadLessonIntoConfig=new WeakSet,LessonPresenter=function(_Presenter3){_inherits(LessonPresenter,_Presenter3);var _handleClickEvent2,_super22=_createSuper(LessonPresenter);function LessonPresenter(config){var _this35$config,_this35;return _classCallCheck(this,LessonPresenter),config.titles=["placeholder"],config.itemClassName="lesson-summary",_classPrivateMethodInitSpec(_assertThisInitialized(_this35=_super22.call(this,config)),_loadLessonIntoConfig),_classPrivateMethodInitSpec(_assertThisInitialized(_this35),_showNextButtonIfContent),_classPrivateMethodInitSpec(_assertThisInitialized(_this35),_addEditButtonIfLocal),_classPrivateMethodInitSpec(_assertThisInitialized(_this35),_addPrintButton),_classPrivateMethodInitSpec(_assertThisInitialized(_this35),_buildCustomContent),_this35.config.lessonInfo=lessonManager.currentLessonInfo,_classPrivateMethodGet(_assertThisInitialized(_this35),_buildCustomContent,_buildCustomContent2).call(_assertThisInitialized(_this35)),null!==(_this35$config=_this35.config)&&void 0!==_this35$config&&null!==(_this35$config=_this35$config.factory)&&void 0!==_this35$config&&_this35$config.hasPrevious(_assertThisInitialized(_this35))&&_this35.showBackButton(),_this35}return _createClass(LessonPresenter,[{key:"handleClickEvent",value:(_handleClickEvent2=_asyncToGenerator(_regeneratorRuntime().mark((function _callee5(event,eventId){var _this36=this;return _regeneratorRuntime().wrap((function(_context5){for(;;)switch(_context5.prev=_context5.next){case 0:_context5.t0=eventId,_context5.next=_context5.t0===LessonPresenter.PRINT_EVENT_ID||_context5.t0===Presenter.NEXT_ID?3:6;break;case 3:return _context5.next=5,_classPrivateMethodGet(this,_loadLessonIntoConfig,_loadLessonIntoConfig2).call(this).then((function(loaded){if(loaded)return _get(_getPrototypeOf(LessonPresenter.prototype),"handleClickEvent",_this36).call(_this36,event,eventId);toast(i18n(_templateObject83||(_templateObject83=_taggedTemplateLiteral(["f5454c4849575729f2cd9635026e9cf5::"]))))}));case 5:return _context5.abrupt("break",8);case 6:return _context5.next=8,_get(_getPrototypeOf(LessonPresenter.prototype),"handleClickEvent",this).call(this,event,eventId);case 8:case"end":return _context5.stop()}}),_callee5,this)}))),function(_x7,_x8){return _handleClickEvent2.apply(this,arguments)})},{key:"next",value:function(eventId){switch(eventId){case LessonPresenter.EDIT_EVENT_ID:return this.config.factory.getEditor(this,this.config);case LessonPresenter.PRINT_EVENT_ID:return this.config.factory.getPrintable(this,this.config);default:return this.config.factory.getNext(this,this.config)}}},{key:"previous",value:function(){return this.config.factory.getPrevious(this,this.config)}}]),LessonPresenter}(Presenter);function _buildCustomContent2(){this.presentation.createAndAppendChild("p",null,i18n(_templateObject128||(_templateObject128=_taggedTemplateLiteral(["8f8bfb5f6d96fb3113a39f781f6fffe4::"]))));var summaryBlock=this.presentation.createAndAppendChild("button","lesson-summary");summaryBlock.createAndAppendChild("div","library-title",this.config.lessonInfo.titles.library),lessonManager.usingLocalLibrary||(summaryBlock.createAndAppendChild("div","book-title",this.config.lessonInfo.titles.book),summaryBlock.createAndAppendChild("div","chapter-title",this.config.lessonInfo.titles.chapter)),summaryBlock.createAndAppendChild("div","lesson-title",this.config.lessonInfo.titles.lesson),this.presentation.appendChild(summaryBlock),this.applyIconToNextButton(icons.playLesson),this.listenToEventOn("click",summaryBlock,Presenter.NEXT_ID),this.listenToEventOn("keydown",summaryBlock,Presenter.NEXT_ID),_classPrivateMethodGet(this,_showNextButtonIfContent,_showNextButtonIfContent2).call(this),_classPrivateMethodGet(this,_addPrintButton,_addPrintButton2).call(this),_classPrivateMethodGet(this,_addEditButtonIfLocal,_addEditButtonIfLocal2).call(this)}function _addPrintButton2(){var printButton=new ManagedElement("button");icons.applyIconToElement(icons.printPreview,printButton),this.addButtonToBar(printButton),this.listenToEventOn("click",printButton,LessonPresenter.PRINT_EVENT_ID)}function _addEditButtonIfLocal2(){if(this.config.lessonInfo.usingLocalLibrary){var editButton=new ManagedElement("button");icons.applyIconToElement(icons.edit,editButton),this.addButtonToBar(editButton),this.listenToEventOn("click",editButton,LessonPresenter.EDIT_EVENT_ID)}}function _showNextButtonIfContent2(){var _this61=this;this.config.lessonInfo.usingLocalLibrary?lessonManager.loadCurrentLesson().then((function(cachedLesson){null!=cachedLesson&&cachedLesson.content&&_this61.showNextButton()})):this.showNextButton()}function _loadLessonIntoConfig2(){var _this62=this;return lessonManager.loadCurrentLesson().then((function(cachedLesson){if(cachedLesson){var lessonSource=LessonSource.createFromSource(cachedLesson.content);return _this62.config.lesson=lessonSource.convertToLesson(),!0}return!1}))}_defineProperty(LessonPresenter,"EDIT_EVENT_ID","EDIT_LESSON"),_defineProperty(LessonPresenter,"PRINT_EVENT_ID","PRINT_LESSON");var _lessonTitleElement=new WeakMap,_lessonTitleValue=new WeakMap,_mainEditorElement=new WeakMap,_saveButton=new WeakMap,_importForm=new WeakMap,_importButton=new WeakMap,_exportButton=new WeakMap,_dirty=new WeakMap,_buildCustomContent3=new WeakSet,_setEditorAsDirty=new WeakSet,_setEditorAsClean=new WeakSet,_addSaveButton=new WeakSet,_addImportButton=new WeakSet,_addExportButton=new WeakSet,_addDeleteButton=new WeakSet,_deleteLessonIfConfirmed=new WeakSet,_deleteLesson=new WeakSet,_saveLessonLocally=new WeakSet,_exportLesson=new WeakSet,LessonEditorPresenter=function(_Presenter4){_inherits(LessonEditorPresenter,_Presenter4);var _handleClickEvent3,_allowNavigation2,_super23=_createSuper(LessonEditorPresenter);function LessonEditorPresenter(config){var _this37;return _classCallCheck(this,LessonEditorPresenter),config.titles=["placeholder"],config.itemClassName="lesson-editor",_classPrivateMethodInitSpec(_assertThisInitialized(_this37=_super23.call(this,config)),_exportLesson),_classPrivateMethodInitSpec(_assertThisInitialized(_this37),_saveLessonLocally),_classPrivateMethodInitSpec(_assertThisInitialized(_this37),_deleteLesson),_classPrivateMethodInitSpec(_assertThisInitialized(_this37),_deleteLessonIfConfirmed),_classPrivateMethodInitSpec(_assertThisInitialized(_this37),_addDeleteButton),_classPrivateMethodInitSpec(_assertThisInitialized(_this37),_addExportButton),_classPrivateMethodInitSpec(_assertThisInitialized(_this37),_addImportButton),_classPrivateMethodInitSpec(_assertThisInitialized(_this37),_addSaveButton),_classPrivateMethodInitSpec(_assertThisInitialized(_this37),_setEditorAsClean),_classPrivateMethodInitSpec(_assertThisInitialized(_this37),_setEditorAsDirty),_classPrivateMethodInitSpec(_assertThisInitialized(_this37),_buildCustomContent3),_classPrivateFieldInitSpec(_assertThisInitialized(_this37),_lessonTitleElement,{writable:!0,value:void 0}),_classPrivateFieldInitSpec(_assertThisInitialized(_this37),_lessonTitleValue,{writable:!0,value:void 0}),_classPrivateFieldInitSpec(_assertThisInitialized(_this37),_mainEditorElement,{writable:!0,value:void 0}),_classPrivateFieldInitSpec(_assertThisInitialized(_this37),_saveButton,{writable:!0,value:void 0}),_classPrivateFieldInitSpec(_assertThisInitialized(_this37),_importForm,{writable:!0,value:void 0}),_classPrivateFieldInitSpec(_assertThisInitialized(_this37),_importButton,{writable:!0,value:void 0}),_classPrivateFieldInitSpec(_assertThisInitialized(_this37),_exportButton,{writable:!0,value:void 0}),_classPrivateFieldInitSpec(_assertThisInitialized(_this37),_dirty,{writable:!0,value:void 0}),_classPrivateMethodGet(_assertThisInitialized(_this37),_buildCustomContent3,_buildCustomContent4).call(_assertThisInitialized(_this37)),_classPrivateMethodGet(_assertThisInitialized(_this37),_addSaveButton,_addSaveButton2).call(_assertThisInitialized(_this37)),_classPrivateMethodGet(_assertThisInitialized(_this37),_addImportButton,_addImportButton2).call(_assertThisInitialized(_this37)),_classPrivateMethodGet(_assertThisInitialized(_this37),_addExportButton,_addExportButton2).call(_assertThisInitialized(_this37)),(new LocalLibrary).okayToDeleteSlot&&_classPrivateMethodGet(_assertThisInitialized(_this37),_addDeleteButton,_addDeleteButton2).call(_assertThisInitialized(_this37)),_this37.expandPresentation(),_classPrivateMethodGet(_assertThisInitialized(_this37),_setEditorAsClean,_setEditorAsClean2).call(_assertThisInitialized(_this37)),_this37.applyIconToNextButton(icons.closeEditor),_this37.showNextButton(),_classPrivateFieldSet(_assertThisInitialized(_this37),_dirty,!1),_this37}return _createClass(LessonEditorPresenter,[{key:"handleDataAvailableEvent",value:function(event,eventIdIgnored){var _this38=this;_classPrivateFieldGet(this,_importForm).element.reset();var _event$detail2,importSummary=(new LessonImporter).convert(event.detail.content);if(importSummary)return ModalDialog.showConfirm(i18n(_templateObject84||(_templateObject84=_taggedTemplateLiteral(["b087a0f6368816df1cbbf2700e7de192::"])))).then((function(answer){answer===ModalDialog.DialogIndex.CONFIRM_YES&&(_classPrivateFieldGet(_this38,_lessonTitleElement).setValue(importSummary.title),_classPrivateFieldSet(_this38,_lessonTitleValue,importSummary.title),_classPrivateFieldGet(_this38,_mainEditorElement).value=importSummary.content,_classPrivateMethodGet(_this38,_setEditorAsDirty,_setEditorAsDirty2).call(_this38))}));toast("Unable to import the file ".concat(null===(_event$detail2=event.detail)||void 0===_event$detail2||null===(_event$detail2=_event$detail2.file)||void 0===_event$detail2?void 0:_event$detail2.name,". The file may be corrupt or the wrong type of file."))}},{key:"handleInputEvent",value:function(eventIgnored,eventIdIgnored){_classPrivateMethodGet(this,_setEditorAsDirty,_setEditorAsDirty2).call(this)}},{key:"allowNavigation",value:(_allowNavigation2=_asyncToGenerator(_regeneratorRuntime().mark((function _callee6(eventIgnored,eventIdIgnored){return _regeneratorRuntime().wrap((function(_context6){for(;;)switch(_context6.prev=_context6.next){case 0:if(!_classPrivateFieldGet(this,_dirty)){_context6.next=4;break}return _context6.abrupt("return",this.askIfOkayToLeave(i18n(_templateObject85||(_templateObject85=_taggedTemplateLiteral(["0fd040b4b27f744bd6c771e624f1a466::"])))));case 4:return _context6.abrupt("return",!0);case 5:case"end":return _context6.stop()}}),_callee6,this)}))),function(_x9,_x10){return _allowNavigation2.apply(this,arguments)})},{key:"handleClickEvent",value:(_handleClickEvent3=_asyncToGenerator(_regeneratorRuntime().mark((function _callee7(event,eventId){return _regeneratorRuntime().wrap((function(_context7){for(;;)switch(_context7.prev=_context7.next){case 0:_context7.t0=eventId,_context7.next=_context7.t0===LessonEditorPresenter.DELETE_EVENT_ID?3:_context7.t0===LessonEditorPresenter.SAVE_EVENT_ID?9:_context7.t0===LessonEditorPresenter.EXPORT_EVENT_ID?10:11;break;case 3:return _context7.next=5,_classPrivateMethodGet(this,_deleteLessonIfConfirmed,_deleteLessonIfConfirmed2).call(this);case 5:if(_context7.sent){_context7.next=8;break}return _context7.abrupt("return");case 8:return _context7.abrupt("break",11);case 9:return _context7.abrupt("return",_classPrivateMethodGet(this,_saveLessonLocally,_saveLessonLocally2).call(this));case 10:return _context7.abrupt("return",_classPrivateMethodGet(this,_exportLesson,_exportLesson2).call(this));case 11:return _context7.abrupt("return",_get(_getPrototypeOf(LessonEditorPresenter.prototype),"handleClickEvent",this).call(this,event,eventId));case 12:case"end":return _context7.stop()}}),_callee7,this)}))),function(_x11,_x12){return _handleClickEvent3.apply(this,arguments)})},{key:"next",value:function(eventId){return eventId===LessonEditorPresenter.DELETE_EVENT_ID?this.config.factory.getLibraryPresenter(this,this.config):_get(_getPrototypeOf(LessonEditorPresenter.prototype),"next",this).call(this,eventId)}}]),LessonEditorPresenter}(Presenter);function _buildCustomContent4(){return _buildCustomContent5.apply(this,arguments)}function _buildCustomContent5(){return(_buildCustomContent5=_asyncToGenerator(_regeneratorRuntime().mark((function _callee10(){var cachedLesson,_this73=this;return _regeneratorRuntime().wrap((function(_context10){for(;;)switch(_context10.prev=_context10.next){case 0:return _context10.next=2,lessonManager.loadCurrentLesson();case 2:cachedLesson=_context10.sent,_classPrivateFieldSet(this,_lessonTitleValue,this.config.lessonInfo.titles.lesson),_classPrivateFieldSet(this,_lessonTitleElement,new LabeledControl(LocalLibrary,{defaultValue:_classPrivateFieldGet(this,_lessonTitleValue),label:i18n(_templateObject151||(_templateObject151=_taggedTemplateLiteral(["b78a3223503896721cca1303f776159b::"]))),type:"input",onupdate:function(value){_classPrivateFieldSet(_this73,_lessonTitleValue,value),_classPrivateMethodGet(_this73,_setEditorAsDirty,_setEditorAsDirty2).call(_this73)}},{storage:null})),this.addPreamble(_classPrivateFieldGet(this,_lessonTitleElement)),_classPrivateFieldSet(this,_mainEditorElement,this.presentation.createAndAppendChild("textarea","lesson-editor",cachedLesson.content)),this.listenToEventOn("input",_classPrivateFieldGet(this,_mainEditorElement));case 8:case"end":return _context10.stop()}}),_callee10,this)})))).apply(this,arguments)}function _setEditorAsDirty2(){_classPrivateFieldGet(this,_saveButton).disabled=!1,_classPrivateFieldSet(this,_dirty,!0),this.classList.add(Presenter.DO_NOT_CLOSE_CLASS_NAME)}function _setEditorAsClean2(){_classPrivateFieldGet(this,_saveButton).disabled=!0,_classPrivateFieldSet(this,_dirty,!1),this.classList.remove(Presenter.DO_NOT_CLOSE_CLASS_NAME)}function _addSaveButton2(){_classPrivateFieldSet(this,_saveButton,new ManagedElement("button")),icons.applyIconToElement(icons.save,_classPrivateFieldGet(this,_saveButton)),this.listenToEventOn("click",_classPrivateFieldGet(this,_saveButton),LessonEditorPresenter.SAVE_EVENT_ID),this.addButtonToBar(_classPrivateFieldGet(this,_saveButton))}function _addImportButton2(){_classPrivateFieldSet(this,_importForm,new ManagedElement("form","button-wrapper")),_classPrivateFieldSet(this,_importButton,new FileInputButton),_classPrivateFieldGet(this,_importForm).appendChild(_classPrivateFieldGet(this,_importButton)),this.listenToEventOn(FileInputButton.DATA_AVAILABLE_EVENT_NAME,_classPrivateFieldGet(this,_importButton),LessonEditorPresenter.IMPORT_EVENT_ID),this.addButtonToBar(_classPrivateFieldGet(this,_importForm))}function _addExportButton2(){_classPrivateFieldSet(this,_exportButton,new ManagedElement("button")),icons.applyIconToElement(icons.export,_classPrivateFieldGet(this,_exportButton)),this.listenToEventOn("click",_classPrivateFieldGet(this,_exportButton),LessonEditorPresenter.EXPORT_EVENT_ID),this.addButtonToBar(_classPrivateFieldGet(this,_exportButton))}function _addDeleteButton2(){var deleteButton=new ManagedElement("button");icons.applyIconToElement(icons.delete,deleteButton),this.listenToEventOn("click",deleteButton,LessonEditorPresenter.DELETE_EVENT_ID),this.addButtonToBar(deleteButton)}function _deleteLessonIfConfirmed2(){var _this63=this;return ModalDialog.showConfirm(i18n(_templateObject129||(_templateObject129=_taggedTemplateLiteral(["784dc4bc7f2a0374bd038e01caf85d4d::"]))),i18n(_templateObject130||(_templateObject130=_taggedTemplateLiteral(["f89bc18e7afb05b3ac03300bec624b63::"])))).then((function(response){return response===ModalDialog.DialogIndex.CONFIRM_YES&&_classPrivateMethodGet(_this63,_deleteLesson,_deleteLesson2).call(_this63)}))}function _deleteLesson2(){return lessonManager.deleteLocalLibraryCurrentLesson().then((function(){return!0}))}function _saveLessonLocally2(){lessonManager.updateCurrentLessonContent(_classPrivateFieldGet(this,_lessonTitleValue),_classPrivateFieldGet(this,_mainEditorElement).value),_classPrivateMethodGet(this,_setEditorAsClean,_setEditorAsClean2).call(this)}function _exportLesson2(){new LessonExporter(_classPrivateFieldGet(this,_lessonTitleValue),_classPrivateFieldGet(this,_mainEditorElement).value).exportLesson()}function getRandomBetween(min,max){return Math.floor(Math.random()*(max-min)+min)}_defineProperty(LessonEditorPresenter,"SAVE_EVENT_ID","SAVE"),_defineProperty(LessonEditorPresenter,"EXPORT_EVENT_ID","EXPORT"),_defineProperty(LessonEditorPresenter,"IMPORT_EVENT_ID","IMPORT"),_defineProperty(LessonEditorPresenter,"DELETE_EVENT_ID","DELETE");var Random={between:function(min,max){return getRandomBetween(min,max)},itemFrom:function(values){return values[getRandomBetween(0,values.length)]}},CelebrationTypes={HAPPY:["smiley-face","star","party-popper"],SAD:["sad-face","grimacing-face","crying-face"]},ANIMATIONS=["celebrate-left","celebrate-top","celebrate-center"];function performCelebration(className){var celebrator=document.createElement("div");celebrator.style.animationName=Random.itemFrom(ANIMATIONS),celebrator.classList.add("celebrator",className),document.body.appendChild(celebrator),celebrator.addEventListener("animationend",(function(){return celebrator.remove()})),celebrator.addEventListener("animationcancel",(function(){return celebrator.remove()}))}var _progressIndicator=new WeakMap,ProgressBar=function(_ManagedElement15){_inherits(ProgressBar,_ManagedElement15);var _super24=_createSuper(ProgressBar);function ProgressBar(label){var _this39;return _classCallCheck(this,ProgressBar),_classPrivateFieldInitSpec(_assertThisInitialized(_this39=_super24.call(this,"div","utils-progress-bar")),_progressIndicator,{writable:!0,value:void 0}),_classPrivateFieldSet(_assertThisInitialized(_this39),_progressIndicator,_this39.createAndAppendChild("div","utils-progress-indicator")),_this39.value=0,_this39.setAttributes({"aria-role":"progressbar","aria-label":null!=label?label:i18n(_templateObject86||(_templateObject86=_taggedTemplateLiteral(["5c62df66d04dc944f18516f8cd6681aa::"])))}),_this39}return _createClass(ProgressBar,[{key:"value",set:function(value){var percentValue=Math.floor(100*value);_classPrivateFieldGet(this,_progressIndicator).style.width="".concat(percentValue,"%"),this.setAttribute("aria-valuenow",percentValue)}}]),ProgressBar}(ManagedElement),_bars=new WeakMap,StackedProgressBar=function(_ManagedElement16){_inherits(StackedProgressBar,_ManagedElement16);var _super25=_createSuper(StackedProgressBar);function StackedProgressBar(numberOfBars,labels){var _this40;_classCallCheck(this,StackedProgressBar),_classPrivateFieldInitSpec(_assertThisInitialized(_this40=_super25.call(this,"div","stacked-progress")),_bars,{writable:!0,value:[]});for(var n=0;n<numberOfBars;n++){var progressBar=_this40.appendChild(new ProgressBar(labels?labels[n]:null));_classPrivateFieldGet(_assertThisInitialized(_this40),_bars).push(progressBar)}return _this40}return _createClass(StackedProgressBar,[{key:"setValueForBar",value:function(barIndex,value){_classPrivateFieldGet(this,_bars)[barIndex].value=value}},{key:"hideBar",value:function(index){_classPrivateFieldGet(this,_bars)[index].style.display="none"}},{key:"showBar",value:function(index){_classPrivateFieldGet(this,_bars)[index].style.display="block"}}]),StackedProgressBar}(ManagedElement),ClassName={ANSWER:"problem-answer",ANSWERS:"problem-answers",INCORRECT_ANSWER:"incorrect-answer",CORRECT_ANSWER:"correct-answer",MISSED_ANSWER:"missed-answer",AVOIDED_ANSWER:"avoided-answer",QUESTION:"problem-question",SELECTED_ANSWER:"selected-answer"},ElementId={CLICKED_ANSWER:"answer",CLICKED_SUBMIT:"submit",CLICKED_NEXT:"next"},Attribute={RIGHT_OR_WRONG:"data-code"},AnswerSelectionState={UNDEFINED:0,CORRECT:1,INCORRECT:2,MISSED:3,AVOIDED:4},_problem=new WeakMap,_questionElement=new WeakMap,_answerElement=new WeakMap,_submitButton=new WeakMap,_freezeAnswers=new WeakMap,_autoAdvanceTimer=new WeakMap,_progressBars=new WeakMap,_addEditButtonIfLocal3=new WeakSet,_addProgressBars=new WeakSet,_updateLessonProgress=new WeakSet,_addSubmitButton=new WeakSet,_processClickedSubmit=new WeakSet,_handleCorrectAnswer=new WeakSet,_handleIncorrectAnswer=new WeakSet,ProblemPresenter=function(_Presenter5){_inherits(ProblemPresenter,_Presenter5);var _allowNavigation3,_super26=_createSuper(ProblemPresenter);function ProblemPresenter(config,nextInPostamble){var _this41;return _classCallCheck(this,ProblemPresenter),config.titles=[],config.itemClassName="",_classPrivateMethodInitSpec(_assertThisInitialized(_this41=_super26.call(this,config,nextInPostamble)),_handleIncorrectAnswer),_classPrivateMethodInitSpec(_assertThisInitialized(_this41),_handleCorrectAnswer),_classPrivateMethodInitSpec(_assertThisInitialized(_this41),_processClickedSubmit),_classPrivateMethodInitSpec(_assertThisInitialized(_this41),_addSubmitButton),_classPrivateMethodInitSpec(_assertThisInitialized(_this41),_updateLessonProgress),_classPrivateMethodInitSpec(_assertThisInitialized(_this41),_addProgressBars),_classPrivateMethodInitSpec(_assertThisInitialized(_this41),_addEditButtonIfLocal3),_classPrivateFieldInitSpec(_assertThisInitialized(_this41),_problem,{writable:!0,value:void 0}),_classPrivateFieldInitSpec(_assertThisInitialized(_this41),_questionElement,{writable:!0,value:void 0}),_classPrivateFieldInitSpec(_assertThisInitialized(_this41),_answerElement,{writable:!0,value:void 0}),_classPrivateFieldInitSpec(_assertThisInitialized(_this41),_submitButton,{writable:!0,value:void 0}),_classPrivateFieldInitSpec(_assertThisInitialized(_this41),_freezeAnswers,{writable:!0,value:void 0}),_classPrivateFieldInitSpec(_assertThisInitialized(_this41),_autoAdvanceTimer,{writable:!0,value:void 0}),_classPrivateFieldInitSpec(_assertThisInitialized(_this41),_progressBars,{writable:!0,value:void 0}),_classPrivateMethodGet(_assertThisInitialized(_this41),_addProgressBars,_addProgressBars2).call(_assertThisInitialized(_this41)),_classPrivateFieldSet(_assertThisInitialized(_this41),_problem,config.lesson.getNextProblem()),_classPrivateMethodGet(_assertThisInitialized(_this41),_updateLessonProgress,_updateLessonProgress2).call(_assertThisInitialized(_this41)),_classPrivateFieldSet(_assertThisInitialized(_this41),_questionElement,new ManagedElement("div",ClassName.QUESTION)),_classPrivateFieldGet(_assertThisInitialized(_this41),_questionElement).innerHTML=_classPrivateFieldGet(_assertThisInitialized(_this41),_problem).question.html,_classPrivateFieldSet(_assertThisInitialized(_this41),_answerElement,new ManagedElement("div",ClassName.ANSWERS)),_this41.presentation.appendChild(_classPrivateFieldGet(_assertThisInitialized(_this41),_questionElement)),_this41.presentation.appendChild(_classPrivateFieldGet(_assertThisInitialized(_this41),_answerElement)),_this41.addButtons(),_classPrivateFieldGet(_assertThisInitialized(_this41),_submitButton).show(),_classPrivateFieldSet(_assertThisInitialized(_this41),_freezeAnswers,!1),_this41.config.lessonInfo.origin===LessonOrigin.EMBEDDED&&_this41.hideHomeButton(),_this41.classList.add(Presenter.DO_NOT_CLOSE_CLASS_NAME),focusManager.findBestFocus(),_this41}return _createClass(ProblemPresenter,[{key:"problem",get:function(){return _classPrivateFieldGet(this,_problem)}},{key:"questionElement",get:function(){return _classPrivateFieldGet(this,_questionElement)}},{key:"answerElement",get:function(){return _classPrivateFieldGet(this,_answerElement)}},{key:"submitButton",get:function(){return _classPrivateFieldGet(this,_submitButton)}},{key:"slideshowProgress",set:function(value){_classPrivateFieldGet(this,_progressBars).setValueForBar(ProblemPresenter.SLIDE_BAR_INDEX,value)}},{key:"showSlideshowProgress",value:function(){_classPrivateFieldGet(this,_progressBars).showBar(ProblemPresenter.SLIDE_BAR_INDEX)}},{key:"addButtons",value:function(){_classPrivateMethodGet(this,_addEditButtonIfLocal3,_addEditButtonIfLocal4).call(this),_classPrivateMethodGet(this,_addSubmitButton,_addSubmitButton2).call(this)}},{key:"presentOnStage",value:function(stage){var _this42=this;return""!==_classPrivateFieldGet(this,_problem).intro.html&&_classPrivateFieldGet(this,_problem).questionType!==QuestionType.SLIDE?ModalDialog.showInfo(_classPrivateFieldGet(this,_problem).intro.html).then((function(){return _get(_getPrototypeOf(ProblemPresenter.prototype),"presentOnStage",_this42).call(_this42,stage)})):_get(_getPrototypeOf(ProblemPresenter.prototype),"presentOnStage",this).call(this,stage)}},{key:"handleClickEvent",value:function(event,eventId){switch(eventId){case ElementId.CLICKED_ANSWER:_classPrivateFieldGet(this,_freezeAnswers)||this.processClickedAnswer(event.currentTarget);break;case ElementId.CLICKED_SUBMIT:_classPrivateFieldSet(this,_freezeAnswers,!0),_classPrivateMethodGet(this,_processClickedSubmit,_processClickedSubmit2).call(this,event);break;case ProblemPresenter.EDIT_EVENT_ID:case Presenter.NEXT_ID:clearTimeout(_classPrivateFieldGet(this,_autoAdvanceTimer)),_get(_getPrototypeOf(ProblemPresenter.prototype),"handleClickEvent",this).call(this,event,eventId);break;default:_get(_getPrototypeOf(ProblemPresenter.prototype),"handleClickEvent",this).call(this,event,eventId)}}},{key:"next",value:function(eventId){return eventId===ProblemPresenter.EDIT_EVENT_ID?this.config.factory.getEditor(this,this.config):_get(_getPrototypeOf(ProblemPresenter.prototype),"next",this).call(this,eventId)}},{key:"allowNavigation",value:(_allowNavigation3=_asyncToGenerator(_regeneratorRuntime().mark((function _callee8(event,eventId){return _regeneratorRuntime().wrap((function(_context8){for(;;)switch(_context8.prev=_context8.next){case 0:if(eventId!==Presenter.HOME_ID&&eventId!==Presenter.PREVIOUS_ID&&eventId!==ProblemPresenter.EDIT_EVENT_ID){_context8.next=4;break}return _context8.abrupt("return",this.askIfOkayToLeave(i18n(_templateObject87||(_templateObject87=_taggedTemplateLiteral(["d54132fd8e2fa9a6c89e8c27bc122fc2::"])))));case 4:return _context8.abrupt("return",!0);case 5:case"end":return _context8.stop()}}),_callee8,this)}))),function(_x13,_x14){return _allowNavigation3.apply(this,arguments)})},{key:"processClickedAnswer",value:function(target){console.debug("Process ".concat(target.tagName,":").concat(target.className))}},{key:"areAnswersCorrect",value:function(){return console.debug("Override markAnswers should be overridden."),!1}}]),ProblemPresenter}(Presenter);function _addEditButtonIfLocal4(){if(this.config.lessonInfo.usingLocalLibrary){var editButton=new ManagedElement("button");icons.applyIconToElement(icons.edit,editButton),this.addButtonToBar(editButton),this.listenToEventOn("click",editButton,ProblemPresenter.EDIT_EVENT_ID)}}function _addProgressBars2(){_classPrivateFieldSet(this,_progressBars,new StackedProgressBar(2,[i18n(_templateObject131||(_templateObject131=_taggedTemplateLiteral(["41c3bc7cfe5e54b683dbf2be1e24de0d::"]))),i18n(_templateObject132||(_templateObject132=_taggedTemplateLiteral(["edce7995450d7bea756c7e3f1f51c2cd::"])))])),_classPrivateFieldGet(this,_progressBars).hideBar(ProblemPresenter.SLIDE_BAR_INDEX),_classPrivateFieldGet(this,_progressBars).setValueForBar(ProblemPresenter.LESSON_BAR_INDEX,this.config.lesson.progress),this.addPreamble(_classPrivateFieldGet(this,_progressBars))}function _updateLessonProgress2(){var _this64=this;setTimeout((function(){_classPrivateFieldGet(_this64,_progressBars).setValueForBar(ProblemPresenter.LESSON_BAR_INDEX,_this64.config.lesson.progress)}),100)}function _addSubmitButton2(){_classPrivateFieldSet(this,_submitButton,new ManagedElement("button",ClassName.ANSWER_SUBMIT)),icons.applyIconToElement(icons.submitAnswer,_classPrivateFieldGet(this,_submitButton).element),this.listenToEventOn("click",_classPrivateFieldGet(this,_submitButton),ElementId.CLICKED_SUBMIT),this.addPostamble(_classPrivateFieldGet(this,_submitButton))}function _processClickedSubmit2(){var correct=this.areAnswersCorrect();this.config.lesson.markProblem(_classPrivateFieldGet(this,_problem),correct?MarkState.CORRECT:MarkState.INCORRECT),_classPrivateFieldGet(this,_submitButton).hide(),correct?_classPrivateMethodGet(this,_handleCorrectAnswer,_handleCorrectAnswer2).call(this):_classPrivateMethodGet(this,_handleIncorrectAnswer,_handleIncorrectAnswer2).call(this)}function _handleCorrectAnswer2(){var _this65=this;performCelebration(Random.itemFrom(CelebrationTypes.HAPPY)),soundManager.playGood(),_classPrivateFieldSet(this,_autoAdvanceTimer,setTimeout((function(){return _get(_getPrototypeOf(ProblemPresenter.prototype),"handleClickEvent",_this65).call(_this65,event,Presenter.NEXT_ID)}),ProblemPresenter.ADVANCE_DELAY_MS))}function _handleIncorrectAnswer2(){var _this66=this;setTimeout((function(){return _this66.showNextButton(!0)}),ProblemPresenter.ADVANCE_DELAY_MS),performCelebration(Random.itemFrom(CelebrationTypes.SAD)),soundManager.playBad();var explanation=_classPrivateFieldGet(this,_problem).explanation;if(explanation.html)return ModalDialog.showInfo(explanation.html,i18n(_templateObject133||(_templateObject133=_taggedTemplateLiteral(["629851f3c76328ed4e32d0439fe0231a::"]))))}function shuffle(data){for(var count=data.length;count;){var index=Math.floor(Math.random()*count--),_ref=[data[index],data[count]];data[count]=_ref[0],data[index]=_ref[1]}return data}_defineProperty(ProblemPresenter,"EDIT_EVENT_ID","EDIT"),_defineProperty(ProblemPresenter,"ADVANCE_DELAY_MS",3e3),_defineProperty(ProblemPresenter,"SLIDE_BAR_INDEX",0),_defineProperty(ProblemPresenter,"LESSON_BAR_INDEX",1);var _answerListElement=new WeakMap,_buildSimpleOrMultiple=new WeakSet,_buildAnswers=new WeakSet,_pushAnswerElementsToArray=new WeakSet,_selectAnswer=new WeakSet,_deselectAnswer=new WeakSet,_deselectAllAnswers=new WeakSet,_processAnswerState=new WeakSet,_showAnswerState=new WeakSet,ChoiceProblemPresenter=function(_ProblemPresenter){_inherits(ChoiceProblemPresenter,_ProblemPresenter);var _super27=_createSuper(ChoiceProblemPresenter);function ChoiceProblemPresenter(config){var _this43;return _classCallCheck(this,ChoiceProblemPresenter),_classPrivateMethodInitSpec(_assertThisInitialized(_this43=_super27.call(this,config,!0)),_showAnswerState),_classPrivateMethodInitSpec(_assertThisInitialized(_this43),_processAnswerState),_classPrivateMethodInitSpec(_assertThisInitialized(_this43),_deselectAllAnswers),_classPrivateMethodInitSpec(_assertThisInitialized(_this43),_deselectAnswer),_classPrivateMethodInitSpec(_assertThisInitialized(_this43),_selectAnswer),_classPrivateMethodInitSpec(_assertThisInitialized(_this43),_pushAnswerElementsToArray),_classPrivateMethodInitSpec(_assertThisInitialized(_this43),_buildAnswers),_classPrivateMethodInitSpec(_assertThisInitialized(_this43),_buildSimpleOrMultiple),_classPrivateFieldInitSpec(_assertThisInitialized(_this43),_answerListElement,{writable:!0,value:void 0}),_classPrivateMethodGet(_assertThisInitialized(_this43),_buildSimpleOrMultiple,_buildSimpleOrMultiple2).call(_assertThisInitialized(_this43)),_this43}return _createClass(ChoiceProblemPresenter,[{key:"processClickedAnswer",value:function(element){switch(this.problem.questionType){case QuestionType.MULTI:element.classList.toggle(ClassName.SELECTED_ANSWER);break;case QuestionType.SIMPLE:var selected=element.classList.contains(ClassName.SELECTED_ANSWER);_classPrivateMethodGet(this,_deselectAllAnswers,_deselectAllAnswers2).call(this),selected||_classPrivateMethodGet(this,_selectAnswer,_selectAnswer2).call(this,element);break;default:console.error("Wrong presenter ".concat(this.constructor.name," being used for ").concat(this.problem.questionType))}}},{key:"areAnswersCorrect",value:function(){var _this44=this,correct=!0;return document.querySelectorAll(".".concat(ClassName.ANSWER)).forEach((function(element){_classPrivateMethodGet(_this44,_processAnswerState,_processAnswerState2).call(_this44,element)||(correct=!1),element.classList.replace("selectable","selectable-off"),element.setAttribute("tabindex","-1")})),correct}},{key:"handleKeydownEvent",value:function(event,eventId){if(eventId!==ElementId.CLICKED_ANSWER)return _get(_getPrototypeOf(ChoiceProblemPresenter.prototype),"handleKeydownEvent",this).call(this,event,eventId);switch(event.key){case" ":case"Enter":event.stopPropagation(),this.handleClickEvent(event,eventId)}}}]),ChoiceProblemPresenter}(ProblemPresenter);function _buildSimpleOrMultiple2(){_classPrivateMethodGet(this,_buildAnswers,_buildAnswers2).call(this),this.autoAddKeydownEvents(this.answerElement.managedChildren)}function _buildAnswers2(){var _this67=this;_classPrivateFieldSet(this,_answerListElement,new ManagedElement("div")),this.answerElement.appendChild(_classPrivateFieldGet(this,_answerListElement)),_classPrivateFieldGet(this,_answerListElement).setAttributes({"aria-label":i18n(_templateObject134||(_templateObject134=_taggedTemplateLiteral(["3e67adbbda024584ca573026d35039d0::"]))),"aria-role":this.problem.questionType===QuestionType.MULTI?"":"radiogroup"});var answers=[];_classPrivateMethodGet(this,_pushAnswerElementsToArray,_pushAnswerElementsToArray2).call(this,this.problem.rightAnswers,answers,!0),_classPrivateMethodGet(this,_pushAnswerElementsToArray,_pushAnswerElementsToArray2).call(this,this.problem.wrongAnswers,answers,!1),shuffle(answers),answers.forEach((function(element){_classPrivateFieldGet(_this67,_answerListElement).appendChild(element),_this67.listenToEventOn("click",element,ElementId.CLICKED_ANSWER),_this67.listenToEventOn("keydown",element,ElementId.CLICKED_ANSWER)}))}function _pushAnswerElementsToArray2(answers,destination,areRight){var role=this.problem.questionType===QuestionType.MULTI?"checkbox":"radio";answers.forEach((function(value){var element=new ManagedElement("button",ClassName.ANSWER);element.innerHTML=value.html,element.setSafeAttribute(Attribute.RIGHT_OR_WRONG,areRight),element.setAttributes({tabindex:"0","aria-role":role,"aria-checked":!1,"aria-label":i18n(_templateObject135||(_templateObject135=_taggedTemplateLiteral(["e5f965d7cf958839a31acefa71728846::"])))}),destination.push(element)}))}function _selectAnswer2(element){element.setAttribute("aria-checked","true"),element.classList.add(ClassName.SELECTED_ANSWER)}function _deselectAnswer2(element){element.setAttribute("aria-checked","false"),element.classList.remove(ClassName.SELECTED_ANSWER)}function _deselectAllAnswers2(){var _this68=this;document.querySelectorAll(".".concat(ClassName.ANSWER)).forEach((function(element){_classPrivateMethodGet(_this68,_deselectAnswer,_deselectAnswer2).call(_this68,element)}))}function _processAnswerState2(element){this.freezeAnswers=!0;var answerState,elementIsCorrect="true"===ManagedElement.getSafeAttribute(element,Attribute.RIGHT_OR_WRONG).toLowerCase(),selected=element.classList.contains(ClassName.SELECTED_ANSWER);return answerState=elementIsCorrect?selected?AnswerSelectionState.CORRECT:AnswerSelectionState.MISSED:selected?AnswerSelectionState.INCORRECT:AnswerSelectionState.AVOIDED,_classPrivateMethodGet(this,_showAnswerState,_showAnswerState2).call(this,element,answerState),answerState===AnswerSelectionState.CORRECT||answerState===AnswerSelectionState.AVOIDED}function _showAnswerState2(element,answerState){var className="";switch(answerState){case AnswerSelectionState.AVOIDED:className=ClassName.AVOIDED_ANSWER;break;case AnswerSelectionState.CORRECT:className=ClassName.CORRECT_ANSWER;break;case AnswerSelectionState.INCORRECT:className=ClassName.INCORRECT_ANSWER;break;case AnswerSelectionState.MISSED:className=ClassName.MISSED_ANSWER}element.classList.add(className)}function replaceSelectControl(selectControl,givenAnswer,expectedAnswer){var container=selectControl.parentElement;selectControl.remove();var givenElement=new ManagedElement("span","given-answer"),givenElementTextElement=new ManagedElement("span","given-answer-text");givenElementTextElement.textContent=givenAnswer,givenElement.appendChild(givenElementTextElement);var expectedElement=new ManagedElement("span","expected-answer");expectedElement.textContent=expectedAnswer,container.appendChild(givenElement.element),container.appendChild(expectedElement.element)}var _missingWordSelectors=new WeakMap,_missingWordCorrectAnswers=new WeakMap,_createMissingWordSelectors=new WeakSet,_showAnswerState3=new WeakSet,FillProblemPresenter=function(_ProblemPresenter2){_inherits(FillProblemPresenter,_ProblemPresenter2);var _super28=_createSuper(FillProblemPresenter);function FillProblemPresenter(config){var _this45;return _classCallCheck(this,FillProblemPresenter),_classPrivateMethodInitSpec(_assertThisInitialized(_this45=_super28.call(this,config,!0)),_showAnswerState3),_classPrivateMethodInitSpec(_assertThisInitialized(_this45),_createMissingWordSelectors),_classPrivateFieldInitSpec(_assertThisInitialized(_this45),_missingWordSelectors,{writable:!0,value:void 0}),_classPrivateFieldInitSpec(_assertThisInitialized(_this45),_missingWordCorrectAnswers,{writable:!0,value:void 0}),_classPrivateMethodGet(_assertThisInitialized(_this45),_createMissingWordSelectors,_createMissingWordSelectors2).call(_assertThisInitialized(_this45)),_this45.answerElement.hide(),_this45}return _createClass(FillProblemPresenter,[{key:"areAnswersCorrect",value:function(){var _this46=this,correct=!0;return _classPrivateFieldGet(this,_missingWordSelectors).forEach((function(selectControl,index){var givenAnswer=selectControl.getText(),expectedAnswer=_classPrivateFieldGet(_this46,_missingWordCorrectAnswers)[index],container=selectControl.parentElement;replaceSelectControl(selectControl,givenAnswer,expectedAnswer),givenAnswer===expectedAnswer?_classPrivateMethodGet(_this46,_showAnswerState3,_showAnswerState4).call(_this46,container,AnswerSelectionState.CORRECT):(_classPrivateMethodGet(_this46,_showAnswerState3,_showAnswerState4).call(_this46,container,AnswerSelectionState.INCORRECT),correct=!1)})),correct}}]),FillProblemPresenter}(ProblemPresenter);function _createMissingWordSelectors2(){var _this69=this,questionWordElements=this.questionElement.querySelectorAll(".missing-word");_classPrivateFieldSet(this,_missingWordCorrectAnswers,[]),questionWordElements.forEach((function(element){var correctAnswer=ManagedElement.getSafeAttribute(element,"data-missing-word");_classPrivateFieldGet(_this69,_missingWordCorrectAnswers).push(correctAnswer)}));var redHerrings=this.problem.firstWordsOfWrongAnswers,options=[].concat(_toConsumableArray(_classPrivateFieldGet(this,_missingWordCorrectAnswers)),_toConsumableArray(redHerrings)),settingDefinition={defaultValue:"...",options:options=["..."].concat(_toConsumableArray(shuffle(options)))};_classPrivateFieldSet(this,_missingWordSelectors,[]),questionWordElements.forEach((function(element,index){var selector=new SelectControl(index,settingDefinition);element.appendChild(selector.element),_classPrivateFieldGet(_this69,_missingWordSelectors).push(selector)})),this.autoAddKeydownEvents(_classPrivateFieldGet(this,_missingWordSelectors))}function _showAnswerState4(element,answerState){var className="";switch(answerState){case AnswerSelectionState.AVOIDED:className=ClassName.AVOIDED_ANSWER;break;case AnswerSelectionState.CORRECT:className=ClassName.CORRECT_ANSWER;break;case AnswerSelectionState.INCORRECT:className=ClassName.INCORRECT_ANSWER;break;case AnswerSelectionState.MISSED:className=ClassName.MISSED_ANSWER}element.classList.add(className)}var _missingWordSelectors2=new WeakMap,_missingWordCorrectAnswers2=new WeakMap,_buildOrder=new WeakSet,_showAnswerState5=new WeakSet,OrderProblemPresenter=function(_ProblemPresenter3){_inherits(OrderProblemPresenter,_ProblemPresenter3);var _super29=_createSuper(OrderProblemPresenter);function OrderProblemPresenter(config){var _this47;return _classCallCheck(this,OrderProblemPresenter),_classPrivateMethodInitSpec(_assertThisInitialized(_this47=_super29.call(this,config,!0)),_showAnswerState5),_classPrivateMethodInitSpec(_assertThisInitialized(_this47),_buildOrder),_classPrivateFieldInitSpec(_assertThisInitialized(_this47),_missingWordSelectors2,{writable:!0,value:void 0}),_classPrivateFieldInitSpec(_assertThisInitialized(_this47),_missingWordCorrectAnswers2,{writable:!0,value:void 0}),_classPrivateMethodGet(_assertThisInitialized(_this47),_buildOrder,_buildOrder2).call(_assertThisInitialized(_this47)),_this47}return _createClass(OrderProblemPresenter,[{key:"areAnswersCorrect",value:function(){var _this48=this,correct=!0;return _classPrivateFieldGet(this,_missingWordSelectors2).forEach((function(selectControl,index){var givenAnswer=selectControl.getText(),expectedAnswer=_classPrivateFieldGet(_this48,_missingWordCorrectAnswers2)[index],container=selectControl.parentElement;replaceSelectControl(selectControl,givenAnswer,expectedAnswer),givenAnswer===expectedAnswer?_classPrivateMethodGet(_this48,_showAnswerState5,_showAnswerState6).call(_this48,container,AnswerSelectionState.CORRECT):(_classPrivateMethodGet(_this48,_showAnswerState5,_showAnswerState6).call(_this48,container,AnswerSelectionState.INCORRECT),correct=!1)})),correct}}]),OrderProblemPresenter}(ProblemPresenter);function _buildOrder2(){var _this$problem$rightAn,_this$problem$wrongAn;_classPrivateFieldSet(this,_missingWordCorrectAnswers2,null===(_this$problem$rightAn=this.problem.rightAnswers)||void 0===_this$problem$rightAn?void 0:_this$problem$rightAn.map((function(value){return value instanceof TextItem?value.plainText.trim():value.trim()})));var redHerrings=null===(_this$problem$wrongAn=this.problem.wrongAnswers)||void 0===_this$problem$wrongAn?void 0:_this$problem$wrongAn.map((function(value){return value instanceof TextItem?value.plainText.trim():value.trim()})),options=[].concat(_toConsumableArray(_classPrivateFieldGet(this,_missingWordCorrectAnswers2)),_toConsumableArray(redHerrings)),settingDefinition={defaultValue:"...",options:options=["..."].concat(_toConsumableArray(shuffle(options)))},orderedAnswers=new ManagedElement("div","problem-ordered-answers");_classPrivateFieldSet(this,_missingWordSelectors2,[]);for(var index=0;index<this.problem.rightAnswers.length;index++){var span=new ManagedElement("span","missing-word"),selectControl=new SelectControl(index,settingDefinition);_classPrivateFieldGet(this,_missingWordSelectors2).push(selectControl),span.appendChild(selectControl),orderedAnswers.appendChild(span)}this.answerElement.appendChild(orderedAnswers),this.autoAddKeydownEvents(_classPrivateFieldGet(this,_missingWordSelectors2))}function _showAnswerState6(element,answerState){var className="";switch(answerState){case AnswerSelectionState.AVOIDED:className=ClassName.AVOIDED_ANSWER;break;case AnswerSelectionState.CORRECT:className=ClassName.CORRECT_ANSWER;break;case AnswerSelectionState.INCORRECT:className=ClassName.INCORRECT_ANSWER;break;case AnswerSelectionState.MISSED:className=ClassName.MISSED_ANSWER}element.classList.add(className)}var _secondsPerWord=new WeakMap,ReadSpeedCalculator=function(){function ReadSpeedCalculator(){var wordsPerMinute=arguments.length>0&&void 0!==arguments[0]?arguments[0]:130;_classCallCheck(this,ReadSpeedCalculator),_classPrivateFieldInitSpec(this,_secondsPerWord,{writable:!0,value:void 0}),this.setWordsPerMinute(wordsPerMinute)}return _createClass(ReadSpeedCalculator,[{key:"setWordsPerMinute",value:function(wordsPerMinute){var wpm=parseInt(wordsPerMinute);isNaN(wpm)?console.error("Attempt made to set words per minute to non-numeric value of ".concat(wordsPerMinute)):(wpm=Math.max(wordsPerMinute,ReadSpeedCalculator.MIN_WPM),wpm=Math.min(wpm,ReadSpeedCalculator.MAX_WPM),_classPrivateFieldSet(this,_secondsPerWord,60/wpm))}},{key:"getSecondsToRead",value:function(data){return getPlainTextFromHtml(data).trim().split(/\s+/).length*_classPrivateFieldGet(this,_secondsPerWord)}}]),ReadSpeedCalculator}();_defineProperty(ReadSpeedCalculator,"MIN_WPM",80),_defineProperty(ReadSpeedCalculator,"MAX_WPM",1e3);var _blocks=new WeakMap,_index2=new WeakMap,_readSpeedCalculator=new WeakMap,_splitHtml=new WeakSet,DisplayCards=function(){function DisplayCards(_html2){_classCallCheck(this,DisplayCards),_classPrivateMethodInitSpec(this,_splitHtml),_classPrivateFieldInitSpec(this,_blocks,{writable:!0,value:void 0}),_classPrivateFieldInitSpec(this,_index2,{writable:!0,value:void 0}),_classPrivateFieldInitSpec(this,_readSpeedCalculator,{writable:!0,value:void 0}),_classPrivateFieldSet(this,_blocks,_classPrivateMethodGet(this,_splitHtml,_splitHtml2).call(this,_html2)),_classPrivateFieldSet(this,_index2,0),_classPrivateFieldSet(this,_readSpeedCalculator,new ReadSpeedCalculator)}return _createClass(DisplayCards,[{key:"progress",get:function(){return 0===_classPrivateFieldGet(this,_blocks).length?1:_classPrivateFieldGet(this,_index2)/_classPrivateFieldGet(this,_blocks).length}},{key:"getNext",value:function(){if(_classPrivateFieldGet(this,_index2)<_classPrivateFieldGet(this,_blocks).length){var _this$index3,_this$index4,html=_classPrivateFieldGet(this,_blocks)[(_classPrivateFieldSet(this,_index2,(_this$index3=_classPrivateFieldGet(this,_index2),_this$index4=_this$index3++,_this$index3)),_this$index4)];return{html:html,readTimeSecs:_classPrivateFieldGet(this,_readSpeedCalculator).getSecondsToRead(html)}}return null}},{key:"hasMore",get:function(){return _classPrivateFieldGet(this,_index2)<_classPrivateFieldGet(this,_blocks).length}},{key:"reset",value:function(){_classPrivateFieldSet(this,_index2,0)}},{key:"setWordsPerMinute",value:function(wpm){_classPrivateFieldGet(this,_readSpeedCalculator).setWordsPerMinute(wpm)}}]),DisplayCards}();function _splitHtml2(html){for(var blocks=html.split(/(<\/(?:p|div|pre)>)/i),result=[],iterations=Math.ceil(blocks.length/2),index=0;index<iterations;index++){var _blocks2,tail=null!==(_blocks2=blocks[2*index+1])&&void 0!==_blocks2?_blocks2:"";result.push("".concat(blocks[2*index]).concat(tail).trim())}return result.filter((function(e){return!!e.replace(/(<\/?[a-zA-Z]+>|\s+)/g,"")}))}var supportsPassive=!1;try{var opts=Object.defineProperty({},"passive",{get:function(){supportsPassive=!0}});window.addEventListener("testPassive",null,opts),window.removeEventListener("testPassive",null,opts)}catch(errorIgnored){console.log("Passive option for listeners not supported.")}var _startX=new WeakMap,_startY=new WeakMap,_distanceX=new WeakMap,_distanceY=new WeakMap,_gesturing=new WeakMap,_startTime=new WeakMap,_maxTimeMs=new WeakMap,_minRadius=new WeakMap,Gesture=function(_ManagedElement17){_inherits(Gesture,_ManagedElement17);var _super30=_createSuper(Gesture);function Gesture(element){var _this49;_classCallCheck(this,Gesture),_classPrivateFieldInitSpec(_assertThisInitialized(_this49=_super30.call(this,element)),_startX,{writable:!0,value:void 0}),_classPrivateFieldInitSpec(_assertThisInitialized(_this49),_startY,{writable:!0,value:void 0}),_classPrivateFieldInitSpec(_assertThisInitialized(_this49),_distanceX,{writable:!0,value:void 0}),_classPrivateFieldInitSpec(_assertThisInitialized(_this49),_distanceY,{writable:!0,value:void 0}),_classPrivateFieldInitSpec(_assertThisInitialized(_this49),_gesturing,{writable:!0,value:!1}),_classPrivateFieldInitSpec(_assertThisInitialized(_this49),_startTime,{writable:!0,value:void 0}),_classPrivateFieldInitSpec(_assertThisInitialized(_this49),_maxTimeMs,{writable:!0,value:500}),_classPrivateFieldInitSpec(_assertThisInitialized(_this49),_minRadius,{writable:!0,value:100});var options=supportsPassive?{passive:!0}:void 0;return _this49.listenToOwnEvent("touchstart","start",options),_this49.listenToOwnEvent("touchend","end"),_this49.listenToOwnEvent("touchcancel","cancel"),_this49}return _createClass(Gesture,[{key:"handleTouchstartEvent",value:function(event,eventIdIgnored){_classPrivateFieldSet(this,_gesturing,!0),_classPrivateFieldSet(this,_startTime,(new Date).getTime()),_classPrivateFieldSet(this,_startX,event.touches[0].pageX),_classPrivateFieldSet(this,_startY,event.touches[0].pageY)}},{key:"handleTouchendEvent",value:function(event,eventIdIgnored){if(event.changedTouches.length>1)console.debug("Ignore multiple touches.");else{_classPrivateFieldSet(this,_distanceX,event.changedTouches[0].pageX-_classPrivateFieldGet(this,_startX)),_classPrivateFieldSet(this,_distanceY,_classPrivateFieldGet(this,_startY)-event.changedTouches[0].pageY),_classPrivateFieldSet(this,_gesturing,!1);var elapsedMs=(new Date).getTime()-_classPrivateFieldGet(this,_startTime);if(elapsedMs>_classPrivateFieldGet(this,_maxTimeMs))console.debug("Gesture too slow at ".concat(elapsedMs," ms"));else{var radius=Math.sqrt(_classPrivateFieldGet(this,_distanceX)*_classPrivateFieldGet(this,_distanceX)+_classPrivateFieldGet(this,_distanceY)*_classPrivateFieldGet(this,_distanceY));if(radius<_classPrivateFieldGet(this,_minRadius))console.debug("Gesture too short at ".concat(radius," px"));else{var angle=this.calcAngleInDeg(_classPrivateFieldGet(this,_distanceX),_classPrivateFieldGet(this,_distanceY));console.debug("Direction ".concat(angle," degrees"));var direction=this.getDirection(angle);this.element.dispatchEvent(new CustomEvent("gesture",{detail:direction}))}}}}},{key:"handleTouchcancelEvent",value:function(eventIgnored,eventIdIgnored){_classPrivateFieldSet(this,_gesturing,!1)}},{key:"getDirection",value:function(angle){return angle<0&&(angle+=360),angle<45?Gesture.Direction.RIGHT:angle<135?Gesture.Direction.UP:angle<225?Gesture.Direction.LEFT:angle<315?Gesture.Direction.DOWN:Gesture.Direction.RIGHT}},{key:"calcAngleInDeg",value:function(x,y){return 180*Math.atan2(y,x)/Math.PI}}]),Gesture}(ManagedElement);_defineProperty(Gesture,"Direction",{UP:0,RIGHT:1,DOWN:2,LEFT:3});var MediaClass={PAUSE:"pause",PLAY:"play",SKIP:"skip"},MediaID={PAUSE:"pause",PLAY:"play",SKIP:"skip"},CardState={INACTIVE:0,ARRIVING:1,READING:2,LEAVING:3},ENTRY_CLASS_NAMES=["card-onscreen-slide","card-onscreen-spin"],_cards=new WeakMap,_visualCard=new WeakMap,_skipButton=new WeakMap,_playButton=new WeakMap,_pauseButton=new WeakMap,_readTimerId=new WeakMap,_cardState=new WeakMap,_currentCardDetail=new WeakMap,_paused=new WeakMap,_lastAnimationClass=new WeakMap,_buildSlideShow=new WeakSet,_addMediaButtons=new WeakSet,_addButtonToButtonBar=new WeakSet,_setCardState=new WeakSet,_applyAnimationClass=new WeakSet,_removeLastAnimationClass=new WeakSet,_getExitClassForDirection=new WeakSet,_showNextCard=new WeakSet,_autoPauseIfAppropriate=new WeakSet,_readCard=new WeakSet,_removeCard=new WeakSet,_endShowIfLastCard=new WeakSet,_pauseTheShow=new WeakSet,_skip=new WeakSet,_showMediaButtons=new WeakSet,SlideProblemPresenter=function(_ProblemPresenter4){_inherits(SlideProblemPresenter,_ProblemPresenter4);var _super31=_createSuper(SlideProblemPresenter);function SlideProblemPresenter(config){var _this50;return _classCallCheck(this,SlideProblemPresenter),config.nextInPostamble=!1,_classPrivateMethodInitSpec(_assertThisInitialized(_this50=_super31.call(this,config)),_showMediaButtons),_classPrivateMethodInitSpec(_assertThisInitialized(_this50),_skip),_classPrivateMethodInitSpec(_assertThisInitialized(_this50),_pauseTheShow),_classPrivateMethodInitSpec(_assertThisInitialized(_this50),_endShowIfLastCard),_classPrivateMethodInitSpec(_assertThisInitialized(_this50),_removeCard),_classPrivateMethodInitSpec(_assertThisInitialized(_this50),_readCard),_classPrivateMethodInitSpec(_assertThisInitialized(_this50),_autoPauseIfAppropriate),_classPrivateMethodInitSpec(_assertThisInitialized(_this50),_showNextCard),_classPrivateMethodInitSpec(_assertThisInitialized(_this50),_getExitClassForDirection),_classPrivateMethodInitSpec(_assertThisInitialized(_this50),_removeLastAnimationClass),_classPrivateMethodInitSpec(_assertThisInitialized(_this50),_applyAnimationClass),_classPrivateMethodInitSpec(_assertThisInitialized(_this50),_setCardState),_classPrivateMethodInitSpec(_assertThisInitialized(_this50),_addButtonToButtonBar),_classPrivateMethodInitSpec(_assertThisInitialized(_this50),_addMediaButtons),_classPrivateMethodInitSpec(_assertThisInitialized(_this50),_buildSlideShow),_classPrivateFieldInitSpec(_assertThisInitialized(_this50),_cards,{writable:!0,value:void 0}),_classPrivateFieldInitSpec(_assertThisInitialized(_this50),_visualCard,{writable:!0,value:void 0}),_classPrivateFieldInitSpec(_assertThisInitialized(_this50),_skipButton,{writable:!0,value:void 0}),_classPrivateFieldInitSpec(_assertThisInitialized(_this50),_playButton,{writable:!0,value:void 0}),_classPrivateFieldInitSpec(_assertThisInitialized(_this50),_pauseButton,{writable:!0,value:void 0}),_classPrivateFieldInitSpec(_assertThisInitialized(_this50),_readTimerId,{writable:!0,value:void 0}),_classPrivateFieldInitSpec(_assertThisInitialized(_this50),_cardState,{writable:!0,value:CardState.INACTIVE}),_classPrivateFieldInitSpec(_assertThisInitialized(_this50),_currentCardDetail,{writable:!0,value:void 0}),_classPrivateFieldInitSpec(_assertThisInitialized(_this50),_paused,{writable:!0,value:void 0}),_classPrivateFieldInitSpec(_assertThisInitialized(_this50),_lastAnimationClass,{writable:!0,value:void 0}),_classPrivateMethodGet(_assertThisInitialized(_this50),_buildSlideShow,_buildSlideShow2).call(_assertThisInitialized(_this50)),_this50.submitButton.hide(),_this50}return _createClass(SlideProblemPresenter,[{key:"presentOnStage",value:function(stageElement){var _this51=this;return _classPrivateMethodGet(this,_showMediaButtons,_showMediaButtons2).call(this,!0),setTimeout((function(){return _classPrivateMethodGet(_this51,_showNextCard,_showNextCard2).call(_this51)})),_get(_getPrototypeOf(SlideProblemPresenter.prototype),"presentOnStage",this).call(this,stageElement)}},{key:"handleClickEvent",value:function(event,eventId){switch(eventId){case MediaID.PAUSE:return void _classPrivateMethodGet(this,_pauseTheShow,_pauseTheShow2).call(this);case MediaID.PLAY:return clearTimeout(_classPrivateFieldGet(this,_readTimerId)),_classPrivateMethodGet(this,_showMediaButtons,_showMediaButtons2).call(this,!0),_classPrivateFieldGet(this,_cardState)===CardState.READING&&_classPrivateMethodGet(this,_removeCard,_removeCard2).call(this),void _classPrivateFieldSet(this,_paused,!1);case MediaID.SKIP:return void _classPrivateMethodGet(this,_skip,_skip2).call(this);case Presenter.HOME_ID:_classPrivateMethodGet(this,_pauseTheShow,_pauseTheShow2).call(this)}_get(_getPrototypeOf(SlideProblemPresenter.prototype),"handleClickEvent",this).call(this,event,eventId)}},{key:"next",value:function(eventId){return clearTimeout(_classPrivateFieldGet(this,_readTimerId)),_get(_getPrototypeOf(SlideProblemPresenter.prototype),"next",this).call(this,eventId)}},{key:"handleAnimationendEvent",value:function(eventIgnored,eventIdIgnored){switch(_classPrivateFieldGet(this,_cardState)){case CardState.ARRIVING:_classPrivateMethodGet(this,_readCard,_readCard2).call(this);break;case CardState.LEAVING:_classPrivateMethodGet(this,_showNextCard,_showNextCard2).call(this);break;default:console.error("Animation unexpectedly ended with card in state ".concat(_classPrivateFieldGet(this,_cardState)))}}},{key:"handleGestureEvent",value:function(event,eventIdIgnored){console.debug("Gesture direction ".concat(event.detail)),_classPrivateMethodGet(this,_skip,_skip2).call(this,event.detail)}}]),SlideProblemPresenter}(ProblemPresenter);function _buildSlideShow2(){var cardHtml=this.problem.intro.html||"";this.problem.question.html&&(toast(i18n(_templateObject136||(_templateObject136=_taggedTemplateLiteral(["16646c2ea6b771d167bbcd871072f930::"])))),cardHtml+=this.problem.question.html),_classPrivateFieldSet(this,_cards,new DisplayCards(cardHtml)),_classPrivateFieldSet(this,_visualCard,new ManagedElement("div","display-card")),this.managedChildren.push(new Gesture(_classPrivateFieldGet(this,_visualCard).element)),this.listenToEventOn("gesture",_classPrivateFieldGet(this,_visualCard)),this.listenToEventOn("animationend",_classPrivateFieldGet(this,_visualCard)),this.questionElement.removeChildren(),this.questionElement.appendChild(_classPrivateFieldGet(this,_visualCard)),this.expandPresentation(),_classPrivateMethodGet(this,_addMediaButtons,_addMediaButtons2).call(this),this.showSlideshowProgress()}function _addMediaButtons2(){_classPrivateFieldSet(this,_playButton,new ManagedElement("button",MediaClass.PLAY)),_classPrivateMethodGet(this,_addButtonToButtonBar,_addButtonToButtonBar2).call(this,_classPrivateFieldGet(this,_playButton),icons.play,MediaID.PLAY),_classPrivateFieldSet(this,_pauseButton,new ManagedElement("button",MediaClass.PAUSE)),_classPrivateMethodGet(this,_addButtonToButtonBar,_addButtonToButtonBar2).call(this,_classPrivateFieldGet(this,_pauseButton),icons.pause,MediaID.PAUSE),_classPrivateFieldSet(this,_skipButton,new ManagedElement("button",MediaClass.SKIP)),_classPrivateMethodGet(this,_addButtonToButtonBar,_addButtonToButtonBar2).call(this,_classPrivateFieldGet(this,_skipButton),icons.skip,MediaID.SKIP)}function _addButtonToButtonBar2(button,icon,eventId){icons.applyIconToElement(icon,button.element),this.listenToEventOn("click",button,eventId),this.addButtonToBar(button)}function _setCardState2(cardState,direction){switch(cardState){case CardState.ARRIVING:_classPrivateMethodGet(this,_applyAnimationClass,_applyAnimationClass2).call(this,Random.itemFrom(ENTRY_CLASS_NAMES));break;case CardState.LEAVING:_classPrivateMethodGet(this,_applyAnimationClass,_applyAnimationClass2).call(this,_classPrivateMethodGet(this,_getExitClassForDirection,_getExitClassForDirection2).call(this,direction))}_classPrivateFieldSet(this,_cardState,cardState)}function _applyAnimationClass2(className){_classPrivateMethodGet(this,_removeLastAnimationClass,_removeLastAnimationClass2).call(this),_classPrivateFieldSet(this,_lastAnimationClass,className),_classPrivateFieldGet(this,_visualCard).classList.add(className)}function _removeLastAnimationClass2(){_classPrivateFieldGet(this,_lastAnimationClass)&&_classPrivateFieldGet(this,_visualCard).classList.remove(_classPrivateFieldGet(this,_lastAnimationClass)),_classPrivateFieldSet(this,_lastAnimationClass,"")}function _getExitClassForDirection2(direction){var rootClass="card-offscreen";switch(direction){case Gesture.Direction.UP:return"".concat(rootClass,"-up");case Gesture.Direction.LEFT:return"".concat(rootClass,"-left");case Gesture.Direction.DOWN:return"".concat(rootClass,"-down");case Gesture.Direction.RIGHT:default:return"".concat(rootClass,"-right")}}function _showNextCard2(){if(console.log("Show the next card"),_classPrivateMethodGet(this,_endShowIfLastCard,_endShowIfLastCard2).call(this))this.handleClickEvent(new Event("click"),Presenter.NEXT_ID);else{var readingSpeed=persistentData.getFromStorage("readingSpeed",130);_classPrivateFieldGet(this,_cards).setWordsPerMinute(readingSpeed),_classPrivateFieldSet(this,_currentCardDetail,_classPrivateFieldGet(this,_cards).getNext()),this.slideshowProgress=_classPrivateFieldGet(this,_cards).progress,_classPrivateFieldGet(this,_visualCard).innerHTML=_classPrivateFieldGet(this,_currentCardDetail).html,this.addAttributions(),_classPrivateMethodGet(this,_autoPauseIfAppropriate,_autoPauseIfAppropriate2).call(this,_classPrivateFieldGet(this,_currentCardDetail).html),_classPrivateFieldGet(this,_visualCard).element.scrollTo(0,0),_classPrivateMethodGet(this,_setCardState,_setCardState2).call(this,CardState.ARRIVING),_classPrivateMethodGet(this,_endShowIfLastCard,_endShowIfLastCard2).call(this)}}function _autoPauseIfAppropriate2(cardHtml){_classPrivateFieldGet(this,_paused)||(/<a\s*[^>]*href=[^>]+\s*>.*?<\/a>/i.test(cardHtml)||/<iframe[^>]+><\/iframe>/.test(cardHtml))&&(_classPrivateMethodGet(this,_pauseTheShow,_pauseTheShow2).call(this),toast(i18n(_templateObject137||(_templateObject137=_taggedTemplateLiteral(["16c592cb26e97758cde37bda13b3bc4e::"])))))}function _readCard2(){var _this70=this;_classPrivateMethodGet(this,_setCardState,_setCardState2).call(this,CardState.READING);var readTimeMs=Math.max(SlideProblemPresenter.MIN_READ_TIME_MS,1e3*_classPrivateFieldGet(this,_currentCardDetail).readTimeSecs);_classPrivateFieldGet(this,_paused)||_classPrivateFieldSet(this,_readTimerId,setTimeout((function(){_classPrivateMethodGet(_this70,_removeCard,_removeCard2).call(_this70)}),readTimeMs))}function _removeCard2(direction){_classPrivateMethodGet(this,_setCardState,_setCardState2).call(this,CardState.LEAVING,direction)}function _endShowIfLastCard2(){return!_classPrivateFieldGet(this,_cards).hasMore}function _pauseTheShow2(){clearTimeout(_classPrivateFieldGet(this,_readTimerId)),_classPrivateMethodGet(this,_showMediaButtons,_showMediaButtons2).call(this,!1),_classPrivateFieldSet(this,_paused,!0)}function _skip2(direction){clearTimeout(_classPrivateFieldGet(this,_readTimerId)),_classPrivateFieldGet(this,_cardState)!==CardState.ARRIVING&&_classPrivateFieldGet(this,_cardState)!==CardState.READING||_classPrivateMethodGet(this,_removeCard,_removeCard2).call(this,direction)}function _showMediaButtons2(playing){playing?(_classPrivateFieldGet(this,_pauseButton).show(),_classPrivateFieldGet(this,_playButton).hide(),_classPrivateFieldGet(this,_skipButton).show(),_classPrivateFieldGet(this,_pauseButton).focus()):(_classPrivateFieldGet(this,_pauseButton).hide(),_classPrivateFieldGet(this,_playButton).show(),_classPrivateFieldGet(this,_skipButton).show(),_classPrivateFieldGet(this,_playButton).focus())}_defineProperty(SlideProblemPresenter,"MIN_READ_TIME_MS",3e3);var MAX_CONFETTI=20,CONFETTI_CLASSES=["square","heart","star"],MIN_FALL_TIME_MS=3e3,MAX_FALL_TIME_MS=6e3,MIN_ROTATION_DEG=-45,MAX_ROTATION_DEG=45;function shareByEmail(data){var url=function(options){var url="mailto:".concat(options.to,"?subject=").concat(options.subject,"&body=").concat(options.body);return encodeURI(url)}(data);window.open(url,"_blank")}function shareCertificateContent(content){var html=function(content){return"<!DOCTYPE html>\n  <html lang=\"en\">\n    <head>\n      <meta charset=\"UTF-8\" />\n      <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\" />\n      <title>Text2Lesson</title>\n      <style>\n        html {\n          font-family: Verdana, Geneva, Tahoma, sans-serif;\n          font-size: calc(15px + 0.390625vw);\n          margin: 0;\n          overflow-x: hidden;\n          padding: 0;\n        }\n        \n        .MarksPresenter .answer-summary {\n          overflow: hidden;\n          text-overflow: ellipsis;\n          white-space: nowrap;\n        }\n        \n        .MarksPresenter .answer-summary div,\n        .MarksPresenter .answer-summary p,\n        .MarksPresenter .answer-summary table,\n        .MarksPresenter .answer-summary tr,\n        .MarksPresenter .answer-summary td,\n        .MarksPresenter .answer-summary h1,\n        .MarksPresenter .answer-summary h2,\n        .MarksPresenter .answer-summary h3,\n        .MarksPresenter .answer-summary h4,\n        .MarksPresenter .answer-summary h5,\n        .MarksPresenter .answer-summary h6 {\n          display: inline;\n          padding: 0px;\n        }\n        \n        .MarksPresenter .removed-image::before,\n        .MarksPresenter .removed-iframe::before {\n          content: '🖼️';\n        }\n        \n        .MarksPresenter .answer-summary tr {\n          border: none;\n          margin-right: 0px;\n          vertical-align: baseline;\n        }\n        \n        .MarksPresenter .maths::before {\n          content: '{';\n        }\n        \n        .MarksPresenter .maths::after {\n          content: '}';\n        }\n        \n        .MarksPresenter .answer-summary .maths tr:first-child::after {\n          content: '\\00f7';\n        }\n         \n        .MarksPresenter .answer-summary.correct::before {\n          content: '\\2714 \\FE0F';\n        }\n        \n        .MarksPresenter .answer-summary.incorrect::before {\n          content: '\\274c';\n        }\n        \n        .MarksPresenter .answer-summary.skipped::before {\n          content: '\\274c';\n        }\n        .MarksPresenter {\n          margin: 0.3rem;\n          padding: 0.3rem;\n          border: double 2px;\n        }\n        \n        .MarksPresenter h1,\n        .MarksPresenter h2,\n        .MarksPresenter h3 {\n          margin-top: 0.3rem;\n          text-align: center;\n        }\n        \n        .MarksPresenter h1,\n        .MarksPresenter .result-summary {\n          text-align: center;\n        }\n        .MarksPresenter .result-summary::after {\n          font-size: 3em;\n        }\n        .MarksPresenter .result-summary.poor::after {\n          content: '\\1f62c';\n        }\n        .MarksPresenter .result-summary.bad::after {\n          content: '\\1f614';\n        }\n        .MarksPresenter .result-summary.good::after {\n          content: '\\1f948';\n        }\n        .MarksPresenter .result-summary.excellent::after {\n          content: '\\1f947';\n        }\n        \n        .MarksPresenter .certificate-date {\n          text-align: center;\n        }\n\n      </style>\n    </head>\n    <body>\n        <div id=\"content\" class='container'>\n          ".concat(content,'\n        </div>\n        <div id="footer">\n          Content generated by <a href ="').concat(Urls.DOCS_HOME,'">Text2Lesson</a>.\n        </div>\n    </body>\n  </html>\n  ')}(content);return shareHtmlFile({filename:"Text2Lesson_certificate.html",text:i18n(_templateObject88||(_templateObject88=_taggedTemplateLiteral(["819b068cc6049e219551939b8241d1bf::"]))),title:i18n(_templateObject89||(_templateObject89=_taggedTemplateLiteral(["b40c84bb21bd1dce64e0a06628f2405b::"]))),html:html}).then((function(shareResult){return shareResult||toast(shareResult.message),shareResult.success}))}function shareHtmlFile(data){var _navigator3,fileToShare=new File([data.html],data.filename,{type:"text/html"}),shareData={text:data.text,title:data.title,files:[fileToShare]};return null!==(_navigator3=navigator)&&void 0!==_navigator3&&_navigator3.canShare(shareData)?navigator.share(shareData).then((function(){return console.debug("Share completed okay."),{success:!0,errorMessage:""}})).catch((function(error){return console.error(error.message),{success:!1,errorMessage:error.message}})):(console.error("Cannot share:",shareData),Promise.resolve({success:!1,errorMessage:i18n(_templateObject91||(_templateObject91=_taggedTemplateLiteral(["0e6df631691794b9ba4dafed9f559b62::"])))}))}var MedalDetails={POOR:{upperLimit:25,cssClass:"poor",emojiCode:"😬"},BAD:{upperLimit:50,cssClass:"bad",emojiCode:"😔"},GOOD:{upperLimit:75,cssClass:"good",emojiCode:"🥈"},EXCELLENT:{upperLimit:100,cssClass:"excellent",emojiCode:"🥇"}},_marks=new WeakMap,_assignedMedal=new WeakMap,_completionDateText=new WeakMap,_scoreSummaryText=new WeakMap,_buildContent7=new WeakSet,_adjustButtonsForOrigin=new WeakSet,_addHeadings=new WeakSet,_addBookDetailsIfManaged=new WeakSet,_addRetryButton=new WeakSet,_addEditButtonIfLocal5=new WeakSet,_addAnswers=new WeakSet,_addResult=new WeakSet,_calcMedalClass=new WeakSet,_getClassForMarkState=new WeakSet,_addShareButtons=new WeakSet,_addEmailButton=new WeakSet,_addWebShareCertificateButton=new WeakSet,_addWebShareAutorunButton=new WeakSet,_getPlainTextResults=new WeakSet,_emailResults=new WeakSet,_webShareResults=new WeakSet,_webShareAutorun=new WeakSet,_stripImages=new WeakSet,MarksPresenter=function(_Presenter6){_inherits(MarksPresenter,_Presenter6);var _super32=_createSuper(MarksPresenter);function MarksPresenter(config){var _this52;return _classCallCheck(this,MarksPresenter),_classPrivateMethodInitSpec(_assertThisInitialized(_this52=_super32.call(this,config)),_stripImages),_classPrivateMethodInitSpec(_assertThisInitialized(_this52),_webShareAutorun),_classPrivateMethodInitSpec(_assertThisInitialized(_this52),_webShareResults),_classPrivateMethodInitSpec(_assertThisInitialized(_this52),_emailResults),_classPrivateMethodInitSpec(_assertThisInitialized(_this52),_getPlainTextResults),_classPrivateMethodInitSpec(_assertThisInitialized(_this52),_addWebShareAutorunButton),_classPrivateMethodInitSpec(_assertThisInitialized(_this52),_addWebShareCertificateButton),_classPrivateMethodInitSpec(_assertThisInitialized(_this52),_addEmailButton),_classPrivateMethodInitSpec(_assertThisInitialized(_this52),_addShareButtons),_classPrivateMethodInitSpec(_assertThisInitialized(_this52),_getClassForMarkState),_classPrivateMethodInitSpec(_assertThisInitialized(_this52),_calcMedalClass),_classPrivateMethodInitSpec(_assertThisInitialized(_this52),_addResult),_classPrivateMethodInitSpec(_assertThisInitialized(_this52),_addAnswers),_classPrivateMethodInitSpec(_assertThisInitialized(_this52),_addEditButtonIfLocal5),_classPrivateMethodInitSpec(_assertThisInitialized(_this52),_addRetryButton),_classPrivateMethodInitSpec(_assertThisInitialized(_this52),_addBookDetailsIfManaged),_classPrivateMethodInitSpec(_assertThisInitialized(_this52),_addHeadings),_classPrivateMethodInitSpec(_assertThisInitialized(_this52),_adjustButtonsForOrigin),_classPrivateMethodInitSpec(_assertThisInitialized(_this52),_buildContent7),_classPrivateFieldInitSpec(_assertThisInitialized(_this52),_marks,{writable:!0,value:void 0}),_classPrivateFieldInitSpec(_assertThisInitialized(_this52),_assignedMedal,{writable:!0,value:void 0}),_classPrivateFieldInitSpec(_assertThisInitialized(_this52),_completionDateText,{writable:!0,value:void 0}),_classPrivateFieldInitSpec(_assertThisInitialized(_this52),_scoreSummaryText,{writable:!0,value:void 0}),_classPrivateMethodGet(_assertThisInitialized(_this52),_buildContent7,_buildContent8).call(_assertThisInitialized(_this52)),_this52}return _createClass(MarksPresenter,[{key:"next",value:function(eventId){switch(eventId){case MarksPresenter.EMAIL_ID:return _classPrivateMethodGet(this,_emailResults,_emailResults2).call(this);case MarksPresenter.WEBSHARE_CERTIFICATE_ID:return _classPrivateMethodGet(this,_webShareResults,_webShareResults2).call(this);case MarksPresenter.WEBSHARE_AUTORUN_ID:return _classPrivateMethodGet(this,_webShareAutorun,_webShareAutorun2).call(this);case MarksPresenter.RETRY_LESSON_ID:return this.config.factory.getProblemAgain(this,this.config);case MarksPresenter.EDIT_LESSON_ID:return this.config.factory.getEditor(this,this.config);case Presenter.NEXT_ID:if(this.config.lessonInfo.origin===LessonOrigin.EMBEDDED)return void window.top.location.replace(embeddedLesson.rootUrl)}return _get(_getPrototypeOf(MarksPresenter.prototype),"next",this).call(this,eventId)}}]),MarksPresenter}(Presenter);function _buildContent8(){_classPrivateMethodGet(this,_addHeadings,_addHeadings2).call(this),_classPrivateMethodGet(this,_addAnswers,_addAnswers2).call(this),_classPrivateMethodGet(this,_addResult,_addResult2).call(this),_classPrivateMethodGet(this,_addEditButtonIfLocal5,_addEditButtonIfLocal6).call(this),_classPrivateMethodGet(this,_addRetryButton,_addRetryButton2).call(this),_classPrivateMethodGet(this,_addShareButtons,_addShareButtons2).call(this),_classPrivateMethodGet(this,_adjustButtonsForOrigin,_adjustButtonsForOrigin2).call(this)}function _adjustButtonsForOrigin2(){switch(this.config.lessonInfo.origin){case LessonOrigin.EMBEDDED:this.hideHomeButton(),this.applyIconToNextButton(icons.exit),this.showNextButton();break;case LessonOrigin.REMOTE:this.applyIconToNextButton(icons.selectLesson),this.showNextButton()}}function _addHeadings2(){var lessonTitle=this.config.lessonInfo.titles.lesson||this.config.lesson.metadata.getValue("TITLE",i18n(_templateObject138||(_templateObject138=_taggedTemplateLiteral(["80ba26f176878a8c09fed91eec1847ac::"]))));this.presentation.createAndAppendChild("h1",null,i18n(_templateObject139||(_templateObject139=_taggedTemplateLiteral(["8a7b5ed72835af8c2804d8f5047da3d3::"])))),this.presentation.createAndAppendChild("h2",null,lessonTitle),_classPrivateMethodGet(this,_addBookDetailsIfManaged,_addBookDetailsIfManaged2).call(this)}function _addBookDetailsIfManaged2(){if(this.config.lessonInfo.managed){var bookDetails="<p>from:</p>";lessonManager.usingLocalLibrary?bookDetails+="<span class='library-title'>".concat(this.config.lessonInfo.titles.library,"</span>"):bookDetails+="<span class='library-title'>".concat(this.config.lessonInfo.titles.library,"</span> \n        <span class='book-title'>").concat(this.config.lessonInfo.titles.book,"</span>\n        <span class='chapter-title'>").concat(this.config.lessonInfo.titles.chapter,"</span>"),this.presentation.createAndAppendChild("div",null,bookDetails)}}function _addRetryButton2(){if(!this.config.lesson.isEmpty){var repeatButton=new ManagedElement("button");icons.applyIconToElement(icons.repeatLesson,repeatButton),this.addButtonToBar(repeatButton),this.listenToEventOn("click",repeatButton,MarksPresenter.RETRY_LESSON_ID)}}function _addEditButtonIfLocal6(){if(this.config.lessonInfo.usingLocalLibrary){var editButton=new ManagedElement("button");icons.applyIconToElement(icons.edit,editButton),this.addButtonToBar(editButton),this.listenToEventOn("click",editButton,MarksPresenter.EDIT_LESSON_ID)}}function _addAnswers2(){var _this71=this,answers=new ManagedElement("div");this.config.lesson.marks.markedItems.forEach((function(markedItem){var item=new ManagedElement("div","answer-summary"),html=_classPrivateMethodGet(_this71,_stripImages,_stripImages2).call(_this71,markedItem.item.question.html);html=function(html){return html.replace(/<math[^>]*?>/g,(function(match){return match.replace(/display\s*=\s*"\w*"/,'display="inline"')}))}(html),item.innerHTML=html,item.classList.add(_classPrivateMethodGet(_this71,_getClassForMarkState,_getClassForMarkState2).call(_this71,markedItem.state)),answers.appendChild(item)})),this.presentation.appendChild(answers)}function _addResult2(){var marks=this.config.lesson.marks,totalQuestions=marks.correct+marks.incorrect+marks.skipped,percent=0==totalQuestions?100:Math.round(100*marks.correct/totalQuestions);_classPrivateFieldSet(this,_scoreSummaryText,i18n(_templateObject140||(_templateObject140=_taggedTemplateLiteral(["dba099f02fa6e674228bce51535a5cc4::","","",""])),percent,marks.correct,totalQuestions));var summaryItem=this.presentation.createAndAppendChild("p","result-summary",_classPrivateFieldGet(this,_scoreSummaryText)),formattedDate=this.config.lesson.lastUpdated.toUTCString();_classPrivateFieldSet(this,_completionDateText,i18n(_templateObject141||(_templateObject141=_taggedTemplateLiteral(["53e3d2e5830fd971a267c3eafc432a8e::",""])),formattedDate)),this.presentation.createAndAppendChild("p","certificate-date",_classPrivateFieldGet(this,_completionDateText)),summaryItem.classList.add(_classPrivateMethodGet(this,_calcMedalClass,_calcMedalClass2).call(this,percent)),percent>=MedalDetails.GOOD.upperLimit&&function(){for(var _loop=function(){var piece=document.createElement("div");piece.className="confetti";var pieceContent=document.createElement("div");pieceContent.style.transform="rotate(".concat(Random.between(MIN_ROTATION_DEG,MAX_ROTATION_DEG),"deg)"),piece.appendChild(pieceContent),piece.classList.add(Random.itemFrom(CONFETTI_CLASSES)),piece.style.animationDuration="".concat(Random.between(MIN_FALL_TIME_MS,MAX_FALL_TIME_MS),"ms"),document.body.appendChild(piece),piece.addEventListener("animationend",(function(){console.debug("remove confetti"),piece.remove()})),piece.addEventListener("animationcancel",(function(){console.debug("remove confetti"),piece.remove()}));var width=document.body.getBoundingClientRect().width,pieceWidth=piece.getBoundingClientRect().width;piece.style.left="".concat(Random.between(pieceWidth,width-pieceWidth),"px")},n=0;n<MAX_CONFETTI;n++)_loop()}()}function _calcMedalClass2(percent){for(var key in MedalDetails){var details=MedalDetails[key];if(percent<details.upperLimit)return _classPrivateFieldSet(this,_assignedMedal,details),details.cssClass}return _classPrivateFieldSet(this,_assignedMedal,MedalDetails.EXCELLENT),MedalDetails.EXCELLENT.cssClass}function _getClassForMarkState2(state){switch(state){case MarkState.CORRECT:return"correct";case MarkState.INCORRECT:return"incorrect";case MarkState.SKIPPED:return"skipped"}return"unknown-state"}function _addShareButtons2(){window.navigator.canShare?(_classPrivateMethodGet(this,_addWebShareCertificateButton,_addWebShareCertificateButton2).call(this),_classPrivateMethodGet(this,_addWebShareAutorunButton,_addWebShareAutorunButton2).call(this)):_classPrivateMethodGet(this,_addEmailButton,_addEmailButton2).call(this)}function _addEmailButton2(){var button=new ManagedElement("button");icons.applyIconToElement(icons.email,button),this.addButtonToBar(button),this.listenToEventOn("click",button,MarksPresenter.EMAIL_ID)}function _addWebShareCertificateButton2(){var button=new ManagedElement("button");icons.applyIconToElement(icons.webshareCertificate,button),this.addButtonToBar(button),this.listenToEventOn("click",button,MarksPresenter.WEBSHARE_CERTIFICATE_ID)}function _addWebShareAutorunButton2(){var button=new ManagedElement("button");icons.applyIconToElement(icons.webshareAutorun,button),this.addButtonToBar(button),this.listenToEventOn("click",button,MarksPresenter.WEBSHARE_AUTORUN_ID)}function _getPlainTextResults2(){var lines=[];return lines.push(i18n(_templateObject142||(_templateObject142=_taggedTemplateLiteral(["5360706c803a759e3a9f2ca54a651950::"])))),lines.push(i18n(_templateObject143||(_templateObject143=_taggedTemplateLiteral(["a72d7818259186043d2f433a9f561cf2::"])))),lines.push("  "+this.config.lessonInfo.titles.lesson),this.config.lessonInfo.managed&&(lines.push(i18n(_templateObject144||(_templateObject144=_taggedTemplateLiteral(["e1a6cba340f937b5c357f57a6a0d45d8::",""])),this.config.lessonInfo.titles.library)),lessonManager.usingLocalLibrary||(lines.push("  "+i18n(_templateObject145||(_templateObject145=_taggedTemplateLiteral(["2c0ada6268b7e2c54130e00745611f1c::",""])),this.config.lessonInfo.titles.book)),lines.push("  "+i18n(_templateObject146||(_templateObject146=_taggedTemplateLiteral(["6b529e195602103a6e254f133c41564b::",""])),this.config.lessonInfo.titles.chapter)))),lines.push("\n"),lines.push("____________________"),lines.push(_classPrivateFieldGet(this,_scoreSummaryText)+" ".concat(_classPrivateFieldGet(this,_assignedMedal).emojiCode)),lines.push(_classPrivateFieldGet(this,_completionDateText)),lines.push("____________________"),lines.push("\n"),lines.push(i18n(_templateObject147||(_templateObject147=_taggedTemplateLiteral(["Find out more about "," at ",""])),BuildInfo.getProductName(),Urls.DOCS_HOME)),lines.join("\n")}function _emailResults2(){shareByEmail({to:"",subject:i18n(_templateObject148||(_templateObject148=_taggedTemplateLiteral(["8f18d381d525fbb0ac77c0839ccdee27::",""])),BuildInfo.getProductName()),body:_classPrivateMethodGet(this,_getPlainTextResults,_getPlainTextResults2).call(this)})}function _webShareResults2(){shareCertificateContent(document.getElementById("content").innerHTML)}function _webShareAutorun2(){var title,lesson,html;title=this.config.lessonInfo.titles.lesson,lesson=this.config.lesson,html=new LessonExporter(title,lesson.rawSource).createAutorunLessonHtml(),shareHtmlFile({filename:makeSafeFilename("autorun_"+title,"html"),text:title,title:i18n(_templateObject90||(_templateObject90=_taggedTemplateLiteral(["e9a4dde8aa550e0d110fdfa9e8ed995d::"]))),html:html}).then((function(shareResult){return shareResult||toast(shareResult.message),shareResult.success}))}function _stripImages2(html){return html=(html=html.replace(/<img[^>]*?>(?:<\/img>)?/g,'<span class="removed-image"</span>')).replace(/<iframe[^>]*?><\/iframe>/g,'<span class="removed-iframe"</span>')}_defineProperty(MarksPresenter,"RETRY_LESSON_ID","RETRY_LESSON"),_defineProperty(MarksPresenter,"EMAIL_ID","EMAIL"),_defineProperty(MarksPresenter,"WEBSHARE_CERTIFICATE_ID","WEBSHARE_CERTIFICATE"),_defineProperty(MarksPresenter,"WEBSHARE_AUTORUN_ID","WEBSHARE_AUTORUN"),_defineProperty(MarksPresenter,"EDIT_LESSON_ID","EDIT_LESSON");var _buildContent9=new WeakSet,_addTitleBlock=new WeakSet,_addPrintButton3=new WeakSet,_addFontButton=new WeakSet,_addProblems=new WeakSet,_addProblem=new WeakSet,_addMultipleChoiceProblem=new WeakSet,_addFillInProblem=new WeakSet,_addOrderProblem=new WeakSet,_addSlideshowProblem=new WeakSet,_toggleFontSize=new WeakSet,PrintableLessonPresenter=function(_Presenter7){_inherits(PrintableLessonPresenter,_Presenter7);var _super33=_createSuper(PrintableLessonPresenter);function PrintableLessonPresenter(config){var _this53;return _classCallCheck(this,PrintableLessonPresenter),_classPrivateMethodInitSpec(_assertThisInitialized(_this53=_super33.call(this,config)),_toggleFontSize),_classPrivateMethodInitSpec(_assertThisInitialized(_this53),_addSlideshowProblem),_classPrivateMethodInitSpec(_assertThisInitialized(_this53),_addOrderProblem),_classPrivateMethodInitSpec(_assertThisInitialized(_this53),_addFillInProblem),_classPrivateMethodInitSpec(_assertThisInitialized(_this53),_addMultipleChoiceProblem),_classPrivateMethodInitSpec(_assertThisInitialized(_this53),_addProblem),_classPrivateMethodInitSpec(_assertThisInitialized(_this53),_addProblems),_classPrivateMethodInitSpec(_assertThisInitialized(_this53),_addFontButton),_classPrivateMethodInitSpec(_assertThisInitialized(_this53),_addPrintButton3),_classPrivateMethodInitSpec(_assertThisInitialized(_this53),_addTitleBlock),_classPrivateMethodInitSpec(_assertThisInitialized(_this53),_buildContent9),_classPrivateMethodGet(_assertThisInitialized(_this53),_buildContent9,_buildContent10).call(_assertThisInitialized(_this53)),_classPrivateMethodGet(_assertThisInitialized(_this53),_addPrintButton3,_addPrintButton4).call(_assertThisInitialized(_this53)),_classPrivateMethodGet(_assertThisInitialized(_this53),_addFontButton,_addFontButton2).call(_assertThisInitialized(_this53)),_this53.showBackButton(),_this53}return _createClass(PrintableLessonPresenter,[{key:"addAttributions",value:function(){_get(_getPrototypeOf(PrintableLessonPresenter.prototype),"addAttributions",this).call(this),this.addPostamble(i18n(_templateObject92||(_templateObject92=_taggedTemplateLiteral(["a70fd8f5681fff49ff36d2db5d3f63a0::",""])),(new Date).toLocaleDateString()))}},{key:"handleClickEvent",value:function(event,eventId){switch(eventId){case PrintableLessonPresenter.FONT_EVENT_ID:return void _classPrivateMethodGet(this,_toggleFontSize,_toggleFontSize2).call(this);case PrintableLessonPresenter.PRINT_EVENT_ID:return void window.print();default:_get(_getPrototypeOf(PrintableLessonPresenter.prototype),"handleClickEvent",this).call(this,event,eventId)}}}]),PrintableLessonPresenter}(Presenter);function _buildContent10(){_classPrivateMethodGet(this,_addTitleBlock,_addTitleBlock2).call(this),_classPrivateMethodGet(this,_addProblems,_addProblems2).call(this)}function _addTitleBlock2(){var titleBlock=new ManagedElement("div","lesson-summary");titleBlock.createAndAppendChild("p","library-title",this.config.lessonInfo.titles.library),lessonManager.usingLocalLibrary||(titleBlock.createAndAppendChild("p","book-title",this.config.lessonInfo.titles.book),titleBlock.createAndAppendChild("p","chapter-title",this.config.lessonInfo.titles.chapter)),titleBlock.createAndAppendChild("p","lesson-title",this.config.lessonInfo.titles.lesson),this.addPreamble(titleBlock)}function _addPrintButton4(){var printButton=new ManagedElement("button");icons.applyIconToElement(icons.print,printButton),this.addButtonToBar(printButton),this.listenToEventOn("click",printButton,PrintableLessonPresenter.PRINT_EVENT_ID)}function _addFontButton2(){var fontButton=new ManagedElement("button");icons.applyIconToElement(icons.fontSize,fontButton),this.addButtonToBar(fontButton),this.listenToEventOn("click",fontButton,PrintableLessonPresenter.FONT_EVENT_ID)}function _addProblems2(){var _this72=this,questionList=this.presentation.createAndAppendChild("ol","print-problems");this.config.lesson.problems.forEach((function(problem){_classPrivateMethodGet(_this72,_addProblem,_addProblem2).call(_this72,questionList,problem)}))}function _addProblem2(listContainer,problem){var listItem=listContainer.createAndAppendChild("li");switch(problem.questionType){case QuestionType.SIMPLE:case QuestionType.MULTI:_classPrivateMethodGet(this,_addMultipleChoiceProblem,_addMultipleChoiceProblem2).call(this,listItem,problem);break;case QuestionType.FILL:_classPrivateMethodGet(this,_addFillInProblem,_addFillInProblem2).call(this,listItem,problem);break;case QuestionType.ORDER:_classPrivateMethodGet(this,_addOrderProblem,_addOrderProblem2).call(this,listItem,problem);break;case QuestionType.SLIDE:_classPrivateMethodGet(this,_addSlideshowProblem,_addSlideshowProblem2).call(this,listItem,problem)}}function _addMultipleChoiceProblem2(listItem,problem){listItem.classList.add("multiple-choice-problem"),listItem.createAndAppendChild("p","print-intro",problem.intro.html),listItem.createAndAppendChild("p","print-question",problem.question.html);var _step9,answersContainer=listItem.createAndAppendChild("div","print-answers"),_iterator9=_createForOfIteratorHelper(shuffle([].concat(_toConsumableArray(problem.rightAnswers),_toConsumableArray(problem.wrongAnswers))));try{for(_iterator9.s();!(_step9=_iterator9.n()).done;){var answer=_step9.value;answersContainer.createAndAppendChild("div","print-option",answer.html)}}catch(err){_iterator9.e(err)}finally{_iterator9.f()}}function _addFillInProblem2(listItem,problem){listItem.classList.add("fill-in-blanks-problem"),listItem.createAndAppendChild("p","print-intro",problem.intro.html),listItem.createAndAppendChild("p","print-question",problem.question.html);var answersContainer=listItem.createAndAppendChild("p","print-word-options");answersContainer.createAndAppendChild("span",null,i18n(_templateObject149||(_templateObject149=_taggedTemplateLiteral(["486e338518ccf29db06728f35e5cbe7a::"]))));var redHerrings=problem.firstWordsOfWrongAnswers,missingWords=problem.question.missingWords;shuffle([].concat(_toConsumableArray(missingWords),_toConsumableArray(redHerrings))).forEach((function(answer,index){answersContainer.createAndAppendChild("span","print-option","".concat(0===index?"":", ").concat(answer))}))}function _addOrderProblem2(listItem,problem){listItem.classList.add("order-problem"),listItem.createAndAppendChild("p","print-intro",problem.intro.html),listItem.createAndAppendChild("p","print-question",problem.question.html),listItem.createAndAppendChild("p",null,i18n(_templateObject150||(_templateObject150=_taggedTemplateLiteral(["2c31a9b339ff3547cf370d814f7d20df::"]))));var answersContainer=listItem.createAndAppendChild("div","print-word-options");shuffle([].concat(_toConsumableArray(problem.firstWordsOfRightAnswers),_toConsumableArray(problem.firstWordsOfWrongAnswers))).forEach((function(answer){var option=answersContainer.createAndAppendChild("div","print-order-option");option.createAndAppendChild("span","number-box"," "),option.createAndAppendChild("span","print-option",answer)}))}function _addSlideshowProblem2(listItem,problem){listItem.classList.add("slideshow-problem"),listItem.createAndAppendChild("p","print-intro",problem.intro.html)}function _toggleFontSize2(){this.classList.toggle("use-large-font")}_defineProperty(PrintableLessonPresenter,"PRINT_EVENT_ID","PRINT_LESSON"),_defineProperty(PrintableLessonPresenter,"FONT_EVENT_ID","CHANGE_FONT");var NAVIGATION={HomePresenter:{previous:null,next:LibraryPresenter},LibraryPresenter:{previous:HomePresenter,next:BookPresenter},BookPresenter:{previous:LibraryPresenter,next:ChapterPresenter},ChapterPresenter:{previous:BookPresenter,next:LessonPresenter},LessonPresenter:{previous:ChapterPresenter,next:ProblemPresenter},LessonEditorPresenter:{previous:LessonPresenter,next:LessonPresenter},PrintableLessonPresenter:{previous:LessonPresenter,next:LessonPresenter},ProblemPresenter:{previous:null,next:ProblemPresenter},ChoiceProblemPresenter:{previous:null,next:ProblemPresenter},FillProblemPresenter:{previous:null,next:ProblemPresenter},OrderProblemPresenter:{previous:null,next:ProblemPresenter},SlideProblemPresenter:{previous:null,next:ProblemPresenter},MarksPresenter:{previous:null,next:ChapterPresenter}},_skipUnnecessaryListPresenters=new WeakSet,_moveToNextPresenterIfUnnecessary=new WeakSet,PresenterFactory=function(){function PresenterFactory(){_classCallCheck(this,PresenterFactory),_classPrivateMethodInitSpec(this,_moveToNextPresenterIfUnnecessary),_classPrivateMethodInitSpec(this,_skipUnnecessaryListPresenters)}return _createClass(PresenterFactory,[{key:"getSuitableProblemPresenter",value:function(config){switch(config.lesson.peekAtNextProblem().questionType){case QuestionType.ORDER:return new OrderProblemPresenter(config);case QuestionType.FILL:return new FillProblemPresenter(config);case QuestionType.MULTI:case QuestionType.SIMPLE:return new ChoiceProblemPresenter(config);case QuestionType.SLIDE:default:return new SlideProblemPresenter(config)}}},{key:"hasNext",value:function(caller){return!!NAVIGATION[caller.constructor.name].next}},{key:"hasPrevious",value:function(caller){return!!NAVIGATION[caller.constructor.name].previous}},{key:"getHome",value:function(config){return new HomePresenter(config)}},{key:"getEditor",value:function(caller,config){return caller instanceof LessonPresenter||caller instanceof ProblemPresenter||caller instanceof MarksPresenter?new LessonEditorPresenter(config):(console.error("Attempt to edit a presenter for which there is no editor. Going home."),new HomePresenter(config))}},{key:"getNext",value:function(caller,config){if(caller instanceof ProblemPresenter||caller instanceof LessonPresenter)return config.lesson.hasMoreProblems?this.getSuitableProblemPresenter(config):new MarksPresenter(config);var klass=_classPrivateMethodGet(this,_skipUnnecessaryListPresenters,_skipUnnecessaryListPresenters2).call(this,NAVIGATION[caller.constructor.name].next);return klass?new klass(config):null}},{key:"getPrevious",value:function(caller,config){var klass=NAVIGATION[caller.constructor.name].previous;return klass?new klass(config):null}},{key:"getProblemAgain",value:function(caller,config){return caller instanceof MarksPresenter?(config.lesson.restart(),config.lesson.hasMoreProblems?this.getSuitableProblemPresenter(config):new MarksPresenter(config)):(console.error("Attempt to retry problem from other than a MarksPresenter."),this.getHome(config))}},{key:"getLibraryPresenter",value:function(callerIgnored,config){return new(_classPrivateMethodGet(this,_skipUnnecessaryListPresenters,_skipUnnecessaryListPresenters2).call(this,LibraryPresenter))(config)}},{key:"getPrintable",value:function(caller,config){return caller instanceof LessonPresenter?new PrintableLessonPresenter(config):(console.error("Attempt to get a printable presenter from other than a LessonPresenter."),this.config.lesson=null,new HomePresenter(config))}}],[{key:"getInitial",value:function(){var config={factory:new PresenterFactory};return embeddedLesson.hasLesson?(config.lesson=embeddedLesson.lesson,config.lessonInfo=embeddedLesson.lessonInfo,config.lesson.hasMoreProblems?config.factory.getSuitableProblemPresenter(config):new MarksPresenter(config)):new HomePresenter(config)}}]),PresenterFactory}();function _skipUnnecessaryListPresenters2(presenterClass){for(;;){var nextClass=_classPrivateMethodGet(this,_moveToNextPresenterIfUnnecessary,_moveToNextPresenterIfUnnecessary2).call(this,presenterClass);if(nextClass===presenterClass)return presenterClass;presenterClass=nextClass}}function _moveToNextPresenterIfUnnecessary2(presenterClass){switch(presenterClass.name){case"LibraryPresenter":if(lessonManager.bookTitles.length<=1)return lessonManager.bookIndex=0,BookPresenter;break;case"BookPresenter":if(lessonManager.chapterTitles.length<=1)return lessonManager.chapterIndex=0,ChapterPresenter;break;case"ChapterPresenter":if(lessonManager.lessonTitles.length<=1)return lessonManager.lessonIndex=0,LessonPresenter}return presenterClass}var throttleTimer=null;function setVhCssVariable(){var vh=.01*window.innerHeight;document.documentElement.style.setProperty("--vh","".concat(vh,"px"))}function showFatalError(error){var html="<h1>Whoops!</h1>\n  <p>An error has occurred from which I can't recover on my own.</p>\n  <ul>\n  <li>Name: ".concat(error.name,"</li>\n  <li>Cause: ").concat(error.cause,"</li>\n  <li>Message: ").concat(error.message,"</li>\n  </ul>\n  <p>Try reloading the application.</p>\n  ");console.error(error),document.getElementById("content").innerHTML=html}function loadApplication(){console.info("Launching application."),persistentData.setStorageKeyPrefix("LR_".concat(BuildInfo.getBundleName().replace(".","_")));var librariesLocation=BuildInfo.isBuilt()?"assets/lessons/libraries.json":"assets/lessons/lessons.test.data/libraries.test.json";return getLanguages(embeddedLesson.translations).then((function(){return lessonManager.loadAllLibraries(librariesLocation)})).then((function(error){return error?function(error){var _error$message,paragraphs=[i18n(_templateObject105||(_templateObject105=_taggedTemplateLiteral(["f3f0b4f55fc291c94d6ccc7f4dc2c22f::"]))),i18n(_templateObject106||(_templateObject106=_taggedTemplateLiteral(["de24ccc27cfdfb2a644948575f2af415::"]))),i18n(_templateObject107||(_templateObject107=_taggedTemplateLiteral(["cc63df6959a88e968e5e937687cdae40::"]))),"<br><br>",i18n(_templateObject108||(_templateObject108=_taggedTemplateLiteral(["ff154bcad7ab72998d209789e2ad3cbe::"]))),"<br><br>",null!==(_error$message=error.message)&&void 0!==_error$message?_error$message:error];return ModalDialog.showError(paragraphs.join(" "))}(error):null})).then((function(){return loadSettingDefinitions({palette:{type:"separator",label:i18n(_templateObject56||(_templateObject56=_taggedTemplateLiteral(["54016c9d89a98aa8bf2e8a8e7ba6f352::"])))},hue:{type:"range",label:i18n(_templateObject57||(_templateObject57=_taggedTemplateLiteral(["d86cbd21656e6a16eeebdf3041f7d9b0::"]))),defaultValue:DEFAULT_HUE,min:0,max:360,onupdate:function(value){setPalette({hue:value=parseInt(value)})}},saturation:{type:"range",label:i18n(_templateObject58||(_templateObject58=_taggedTemplateLiteral(["0b0d1a40638f299b733e0c7c90344698::"]))),defaultValue:DEFAULT_SATURATION,min:0,max:100,onupdate:function(value){setPalette({saturation:value=parseInt(value)})}},spread:{type:"range",label:i18n(_templateObject59||(_templateObject59=_taggedTemplateLiteral(["c13970d8379e2f9daef71a2d63e2233d::"]))),defaultValue:DEFAULT_COLOR_SPREAD,min:0,max:180,onupdate:function(value){setPalette({spread:value=parseInt(value)})}},darkMode:{type:"checkbox",label:i18n(_templateObject60||(_templateObject60=_taggedTemplateLiteral(["3924c958175e666737225e86a68ac4b4::"]))),defaultValue:DEFAULT_DARK_MODE,onupdate:function(value){setPalette({dark:value})}},ui:{type:"separator",label:i18n(_templateObject61||(_templateObject61=_taggedTemplateLiteral(["382f24d48bc1efa5dd974e166ac8df58::"])))},fontSize:{type:"range",label:i18n(_templateObject62||(_templateObject62=_taggedTemplateLiteral(["c4943062b634c56348c67fdebba808eb::"]))),defaultValue:DEFAULT_FONT_SIZE,min:10,max:22,onupdate:function(value){setProperty("--font-base-size","".concat(value,"px"))}},hideButtonText:{type:"checkbox",label:i18n(_templateObject63||(_templateObject63=_taggedTemplateLiteral(["63d171a5c8e1018a70b682bc3eca413f::"]))),defaultValue:!1,onupdate:function(value){icons.hideText=value}},focusOnStage:{type:"checkbox",label:i18n(_templateObject64||(_templateObject64=_taggedTemplateLiteral(["374352215837c62611f5473cf56d6812::"]))),defaultValue:!1,onupdate:function(value){focusManager.focusOnStage=value}},readingSpeed:{type:"range",label:i18n(_templateObject65||(_templateObject65=_taggedTemplateLiteral(["23944ac1bff1399fe70064067e3e4804::"]))),defaultValue:DEFAULT_READING_SPEED,min:80,max:1e3},enthusiasm:{type:"range",label:i18n(_templateObject66||(_templateObject66=_taggedTemplateLiteral(["fe36ab47806d98a669104c75909baa79::"]))),defaultValue:Enthusiasm.LOW,min:Enthusiasm.OFF,max:Enthusiasm.HIGH,onupdate:function(value){return soundManager.enthusiasm=value}},showFirstUseMessage:{type:"checkbox",label:i18n(_templateObject67||(_templateObject67=_taggedTemplateLiteral(["5bb6f06649fe039d8738eab53560e644::"]))),defaultValue:!0},lessonInfo:{type:"separator",label:i18n(_templateObject68||(_templateObject68=_taggedTemplateLiteral(["16c6a433b76133c6204c165f24374006::"])))},library:{type:"select",label:i18n(_templateObject69||(_templateObject69=_taggedTemplateLiteral(["b0ef546d26b0e0a6ad6a89b8f81b9170::"]))),defaultValue:DEFAULT_LIBRARY_KEY,onupdate:function(value){lessonManager.remoteLibraryKey=value},options:function(){return lessonManager.remoteLibraryTitles},reloadIfChanged:!0}})})).then((function(){var language=i18n(_templateObject115||(_templateObject115=_taggedTemplateLiteral(["language::"])));return""!==language&&(console.info("Language ".concat(language)),document.documentElement.setAttribute("lang",language)),!0})).then((function(){return menuItems=getMainMenuItems(),header.setup(menuItems),void footer.setup();var menuItems})).then((function(){return lessonManager.loadAllLibraryContent()})).then((function(error){return error?function(error){var _error$message2,paragraphs=[i18n(_templateObject109||(_templateObject109=_taggedTemplateLiteral(["007acecc18c3ad1ae9936101830d97ea::"]))),i18n(_templateObject110||(_templateObject110=_taggedTemplateLiteral(["4a3592179f792ce3636583d79b3022df::"]))),i18n(_templateObject111||(_templateObject111=_taggedTemplateLiteral(["fec8d71691789e72ce6db83ca0802a0f::"]))),i18n(_templateObject112||(_templateObject112=_taggedTemplateLiteral(["de24ccc27cfdfb2a644948575f2af415::"]))),i18n(_templateObject113||(_templateObject113=_taggedTemplateLiteral(["cc63df6959a88e968e5e937687cdae40::"]))),"<br><br>",i18n(_templateObject114||(_templateObject114=_taggedTemplateLiteral(["ff154bcad7ab72998d209789e2ad3cbe::"]))),"<br><br>",null!==(_error$message2=error.message)&&void 0!==_error$message2?_error$message2:error];return ModalDialog.showError(paragraphs.join(" "))}(error):null})).then((function(){return toast('<span style="font-size:3rem;">&#x1F631;</span>This application is work in progress and not released yet. Things may change and things may break. Documentation may not be correct.')})).then((function(){return function(){if(persistentData.getFromStorage("showFirstUseMessage",!0)){var appName=BuildInfo.getProductName(),privacyLinkLabel=i18n(_templateObject93||(_templateObject93=_taggedTemplateLiteral(["c5f29bb36f9158d2e00f5d4dc213a0ff::"]))),privacyLink="[".concat(privacyLinkLabel,"](").concat(Urls.PRIVACY,")"),message=[i18n(_templateObject94||(_templateObject94=_taggedTemplateLiteral(["a7c4b7db96ceb235072a13b2f6d0a47c::",""])),appName),i18n(_templateObject95||(_templateObject95=_taggedTemplateLiteral(["f1c6d62749c0daf6f811d81d8e81a0ac::"]))),"",i18n(_templateObject96||(_templateObject96=_taggedTemplateLiteral(["09c78e9bf1c7828280e85b6422d6e712::",""])),appName),i18n(_templateObject97||(_templateObject97=_taggedTemplateLiteral(["645a1e1fef8324f7061e6cd82b966b02::"]))),i18n(_templateObject98||(_templateObject98=_taggedTemplateLiteral(["85320d2bf19b4540dfca0365564a452e::"]))),i18n(_templateObject99||(_templateObject99=_taggedTemplateLiteral(["9c56fddb40ff68400351826fd5d07d45::"]))),i18n(_templateObject100||(_templateObject100=_taggedTemplateLiteral(["d41d8cd98f00b204e9800998ecf8427e::"]))),i18n(_templateObject101||(_templateObject101=_taggedTemplateLiteral(["8b73f389cf0286a63a4adfb231300c05::"]))),i18n(_templateObject102||(_templateObject102=_taggedTemplateLiteral(["d41d8cd98f00b204e9800998ecf8427e::"]))),i18n(_templateObject103||(_templateObject103=_taggedTemplateLiteral(["f3d5c4e36b478dff85e2fec9c9be9a35::",""])),privacyLink)].join("\n");return ModalDialog.showInfo(parseMarkdown(message),i18n(_templateObject104||(_templateObject104=_taggedTemplateLiteral(["83218ac34c1834c26781fe4bde918ee4::"])))).then((function(){return persistentData.saveToStorage("showFirstUseMessage",!1)}))}return Promise.resolve()}()})).then((function(){var stage=document.getElementById("stage");return new StageManager(stage).startShow(PresenterFactory.getInitial())})).then((function(){console.warn("Did not expect to get here."),ModalDialog.showInfo(i18n(_templateObject116||(_templateObject116=_taggedTemplateLiteral(["c55bdbb47fee32f4ca56a977427374bf::"])))).then((function(){return window.location.reload()}))})).catch((function(error){showFatalError(error),ModalDialog.showFatal(error).then((function(){return window.location.reload()}))}))}window.addEventListener("resize",(function(){null===throttleTimer&&(throttleTimer=window.setTimeout((function(){throttleTimer=null,setVhCssVariable()}),200))})),setVhCssVariable(),window.addEventListener("load",(function(){try{return BuildInfo.isBuilt()&&registerServiceWorker(BuildInfo.getMode()),function(){var container=document.createElement("div");if(container.style.position="absolute",container.innerHTML="<".concat("math",' xmlns="http://www.w3.org/1998/Math/MathML"><mspace width="').concat(100,'px" height="').concat(20,'px"></mspace></').concat("math",">"),document.body.appendChild(container),container.offsetWidth<100||container.offsetHeight<20){console.debug("MathMl not supported so loading fallback CSS");var cssLink=document.createElement("link");cssLink.href="".concat("https://henspace.github.io/text2lesson/","assets/styles/mathml.css"),cssLink.rel="stylesheet",document.head.appendChild(cssLink)}else console.debug("MathMl supported by browser");container.remove()}(),window.addEventListener("beforeunload",(function(event){if(document.querySelector(".".concat(Presenter.DO_NOT_CLOSE_CLASS_NAME)))return event.preventDefault(),event.returnValue=""})),loadApplication()}catch(error){showFatalError(error)}}))}();