/**
 * text2lesson 1.0.76
 * RapidQandA: create quizzes and lessons from plain text files.
 * Copyright 2024 Steve Butler (henspace.com)
 * 
 * This program is free software: you can redistribute it and/or modify
 * it under the terms of the GNU General Public License as published by
 * the Free Software Foundation, either version 3 of the License, or
 * (at your option) any later version.
 * 
 * This program is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
 * GNU General Public License for more details.
 * 
 * You should have received a copy of the GNU General Public License
 * along with this program.  If not, see <https://www.gnu.org/licenses/>.
 * 
 */
"use strict";function _typeof(o){return _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(o){return typeof o}:function(o){return o&&"function"==typeof Symbol&&o.constructor===Symbol&&o!==Symbol.prototype?"symbol":typeof o},_typeof(o)}var _templateObject,_templateObject2,_templateObject3,_templateObject4,_templateObject5,_templateObject6,_templateObject7,_templateObject8,_templateObject9,_templateObject10,_templateObject11,_templateObject12,_templateObject13,_templateObject14,_templateObject15,_templateObject16,_templateObject17,_templateObject18,_templateObject19,_templateObject20,_templateObject21,_templateObject22,_templateObject23,_templateObject24,_templateObject25,_templateObject26,_templateObject27,_templateObject28,_templateObject29,_templateObject30,_templateObject31,_templateObject32,_templateObject33,_templateObject34,_templateObject35,_templateObject36,_templateObject37,_templateObject38,_templateObject39,_templateObject40,_templateObject41,_templateObject42,_templateObject43,_templateObject44,_templateObject45,_templateObject46,_templateObject47,_templateObject48,_templateObject49,_templateObject50,_templateObject51,_templateObject52,_templateObject53,_templateObject54,_templateObject55,_templateObject56,_templateObject57,_templateObject58,_templateObject59,_templateObject60,_templateObject61,_templateObject62,_templateObject63,_templateObject64,_templateObject65,_templateObject66,_templateObject67,_templateObject68,_templateObject69,_templateObject70,_templateObject71,_templateObject72,_templateObject73,_templateObject74,_templateObject75,_templateObject76,_templateObject77,_templateObject78,_templateObject79,_templateObject80,_templateObject81,_templateObject82,_templateObject83,_templateObject84,_templateObject85,_templateObject86,_templateObject87,_templateObject88,_templateObject89,_templateObject90,_templateObject91,_templateObject92,_templateObject93,_templateObject94,_templateObject95,_templateObject96,_templateObject97,_templateObject98,_templateObject99,_templateObject100,_templateObject101,_templateObject102,_templateObject103,_templateObject104,_templateObject105,_templateObject106,_templateObject107,_templateObject108,_templateObject109,_templateObject110,_templateObject111,_templateObject112,_templateObject113,_templateObject114,_templateObject115,_templateObject116,_templateObject117,_templateObject118,_templateObject119,_templateObject120,_templateObject121,_templateObject122,_templateObject123,_templateObject124,_templateObject125,_templateObject126,_templateObject127,_templateObject128,_templateObject129,_templateObject130,_templateObject131,_templateObject132,_templateObject133,_templateObject134,_templateObject135,_templateObject136,_templateObject137,_templateObject138,_templateObject139,_templateObject140,_templateObject141,_templateObject142,_templateObject143,_templateObject144,_templateObject145,_templateObject146,_templateObject147,_templateObject148,_templateObject149,_templateObject150,_templateObject151,_templateObject152,_templateObject153,_templateObject154,_templateObject155,_templateObject156,_templateObject157,_templateObject158,_templateObject159,_templateObject160,_templateObject161;function _get(){return _get="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(e,t,r){var p=_superPropBase(e,t);if(p){var n=Object.getOwnPropertyDescriptor(p,t);return n.get?n.get.call(arguments.length<3?e:r):n.value}},_get.apply(null,arguments)}function _superPropBase(t,o){for(;!{}.hasOwnProperty.call(t,o)&&null!==(t=_getPrototypeOf(t)););return t}function _classPrivateGetter(s,r,a){return a(_assertClassBrand(s,r))}function _regeneratorRuntime(){_regeneratorRuntime=function(){return e};var t,e={},r=Object.prototype,n=r.hasOwnProperty,o=Object.defineProperty||function(t,e,r){t[e]=r.value},i="function"==typeof Symbol?Symbol:{},a=i.iterator||"@@iterator",c=i.asyncIterator||"@@asyncIterator",u=i.toStringTag||"@@toStringTag";function define(t,e,r){return Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{define({},"")}catch(t){define=function(t,e,r){return t[e]=r}}function wrap(t,e,r,n){var i=e&&e.prototype instanceof Generator?e:Generator,a=Object.create(i.prototype),c=new Context(n||[]);return o(a,"_invoke",{value:makeInvokeMethod(t,r,c)}),a}function tryCatch(t,e,r){try{return{type:"normal",arg:t.call(e,r)}}catch(t){return{type:"throw",arg:t}}}e.wrap=wrap;var h="suspendedStart",l="suspendedYield",f="executing",s="completed",y={};function Generator(){}function GeneratorFunction(){}function GeneratorFunctionPrototype(){}var p={};define(p,a,(function(){return this}));var d=Object.getPrototypeOf,v=d&&d(d(values([])));v&&v!==r&&n.call(v,a)&&(p=v);var g=GeneratorFunctionPrototype.prototype=Generator.prototype=Object.create(p);function defineIteratorMethods(t){["next","throw","return"].forEach((function(e){define(t,e,(function(t){return this._invoke(e,t)}))}))}function AsyncIterator(t,e){function invoke(r,o,i,a){var c=tryCatch(t[r],t,o);if("throw"!==c.type){var u=c.arg,h=u.value;return h&&"object"==_typeof(h)&&n.call(h,"__await")?e.resolve(h.__await).then((function(t){invoke("next",t,i,a)}),(function(t){invoke("throw",t,i,a)})):e.resolve(h).then((function(t){u.value=t,i(u)}),(function(t){return invoke("throw",t,i,a)}))}a(c.arg)}var r;o(this,"_invoke",{value:function(t,n){function callInvokeWithMethodAndArg(){return new e((function(e,r){invoke(t,n,e,r)}))}return r=r?r.then(callInvokeWithMethodAndArg,callInvokeWithMethodAndArg):callInvokeWithMethodAndArg()}})}function makeInvokeMethod(e,r,n){var o=h;return function(i,a){if(o===f)throw Error("Generator is already running");if(o===s){if("throw"===i)throw a;return{value:t,done:!0}}for(n.method=i,n.arg=a;;){var c=n.delegate;if(c){var u=maybeInvokeDelegate(c,n);if(u){if(u===y)continue;return u}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(o===h)throw o=s,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);o=f;var p=tryCatch(e,r,n);if("normal"===p.type){if(o=n.done?s:l,p.arg===y)continue;return{value:p.arg,done:n.done}}"throw"===p.type&&(o=s,n.method="throw",n.arg=p.arg)}}}function maybeInvokeDelegate(e,r){var n=r.method,o=e.iterator[n];if(o===t)return r.delegate=null,"throw"===n&&e.iterator.return&&(r.method="return",r.arg=t,maybeInvokeDelegate(e,r),"throw"===r.method)||"return"!==n&&(r.method="throw",r.arg=new TypeError("The iterator does not provide a '"+n+"' method")),y;var i=tryCatch(o,e.iterator,r.arg);if("throw"===i.type)return r.method="throw",r.arg=i.arg,r.delegate=null,y;var a=i.arg;return a?a.done?(r[e.resultName]=a.value,r.next=e.nextLoc,"return"!==r.method&&(r.method="next",r.arg=t),r.delegate=null,y):a:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,y)}function pushTryEntry(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function resetTryEntry(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function Context(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(pushTryEntry,this),this.reset(!0)}function values(e){if(e||""===e){var r=e[a];if(r)return r.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var o=-1,i=function next(){for(;++o<e.length;)if(n.call(e,o))return next.value=e[o],next.done=!1,next;return next.value=t,next.done=!0,next};return i.next=i}}throw new TypeError(_typeof(e)+" is not iterable")}return GeneratorFunction.prototype=GeneratorFunctionPrototype,o(g,"constructor",{value:GeneratorFunctionPrototype,configurable:!0}),o(GeneratorFunctionPrototype,"constructor",{value:GeneratorFunction,configurable:!0}),GeneratorFunction.displayName=define(GeneratorFunctionPrototype,u,"GeneratorFunction"),e.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===GeneratorFunction||"GeneratorFunction"===(e.displayName||e.name))},e.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,GeneratorFunctionPrototype):(t.__proto__=GeneratorFunctionPrototype,define(t,u,"GeneratorFunction")),t.prototype=Object.create(g),t},e.awrap=function(t){return{__await:t}},defineIteratorMethods(AsyncIterator.prototype),define(AsyncIterator.prototype,c,(function(){return this})),e.AsyncIterator=AsyncIterator,e.async=function(t,r,n,o,i){void 0===i&&(i=Promise);var a=new AsyncIterator(wrap(t,r,n,o),i);return e.isGeneratorFunction(r)?a:a.next().then((function(t){return t.done?t.value:a.next()}))},defineIteratorMethods(g),define(g,u,"Generator"),define(g,a,(function(){return this})),define(g,"toString",(function(){return"[object Generator]"})),e.keys=function(t){var e=Object(t),r=[];for(var n in e)r.push(n);return r.reverse(),function next(){for(;r.length;){var t=r.pop();if(t in e)return next.value=t,next.done=!1,next}return next.done=!0,next}},e.values=values,Context.prototype={constructor:Context,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=t,this.done=!1,this.delegate=null,this.method="next",this.arg=t,this.tryEntries.forEach(resetTryEntry),!e)for(var r in this)"t"===r.charAt(0)&&n.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=t)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var r=this;function handle(n,o){return a.type="throw",a.arg=e,r.next=n,o&&(r.method="next",r.arg=t),!!o}for(var o=this.tryEntries.length-1;o>=0;--o){var i=this.tryEntries[o],a=i.completion;if("root"===i.tryLoc)return handle("end");if(i.tryLoc<=this.prev){var c=n.call(i,"catchLoc"),u=n.call(i,"finallyLoc");if(c&&u){if(this.prev<i.catchLoc)return handle(i.catchLoc,!0);if(this.prev<i.finallyLoc)return handle(i.finallyLoc)}else if(c){if(this.prev<i.catchLoc)return handle(i.catchLoc,!0)}else{if(!u)throw Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return handle(i.finallyLoc)}}}},abrupt:function(t,e){for(var r=this.tryEntries.length-1;r>=0;--r){var o=this.tryEntries[r];if(o.tryLoc<=this.prev&&n.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var i=o;break}}i&&("break"===t||"continue"===t)&&i.tryLoc<=e&&e<=i.finallyLoc&&(i=null);var a=i?i.completion:{};return a.type=t,a.arg=e,i?(this.method="next",this.next=i.finallyLoc,y):this.complete(a)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),y},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.finallyLoc===t)return this.complete(r.completion,r.afterLoc),resetTryEntry(r),y}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.tryLoc===t){var n=r.completion;if("throw"===n.type){var o=n.arg;resetTryEntry(r)}return o}}throw Error("illegal catch attempt")},delegateYield:function(e,r,n){return this.delegate={iterator:values(e),resultName:r,nextLoc:n},"next"===this.method&&(this.arg=t),y}},e}function asyncGeneratorStep(n,t,e,r,o,a,c){try{var i=n[a](c),u=i.value}catch(n){return void e(n)}i.done?t(u):Promise.resolve(u).then(r,o)}function _asyncToGenerator(n){return function(){var t=this,e=arguments;return new Promise((function(r,o){var a=n.apply(t,e);function _next(n){asyncGeneratorStep(a,r,o,_next,_throw,"next",n)}function _throw(n){asyncGeneratorStep(a,r,o,_next,_throw,"throw",n)}_next(void 0)}))}}function _wrapNativeSuper(t){var r="function"==typeof Map?new Map:void 0;return _wrapNativeSuper=function(t){if(null===t||!_isNativeFunction(t))return t;if("function"!=typeof t)throw new TypeError("Super expression must either be null or a function");if(void 0!==r){if(r.has(t))return r.get(t);r.set(t,Wrapper)}function Wrapper(){return _construct(t,arguments,_getPrototypeOf(this).constructor)}return Wrapper.prototype=Object.create(t.prototype,{constructor:{value:Wrapper,enumerable:!1,writable:!0,configurable:!0}}),_setPrototypeOf(Wrapper,t)},_wrapNativeSuper(t)}function _construct(t,e,r){if(_isNativeReflectConstruct())return Reflect.construct.apply(null,arguments);var o=[null];o.push.apply(o,e);var p=new(t.bind.apply(t,o));return r&&_setPrototypeOf(p,r.prototype),p}function _isNativeFunction(t){try{return-1!==Function.toString.call(t).indexOf("[native code]")}catch(n){return"function"==typeof t}}function _toConsumableArray(r){return _arrayWithoutHoles(r)||_iterableToArray(r)||_unsupportedIterableToArray(r)||_nonIterableSpread()}function _nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _iterableToArray(r){if("undefined"!=typeof Symbol&&null!=r[Symbol.iterator]||null!=r["@@iterator"])return Array.from(r)}function _arrayWithoutHoles(r){if(Array.isArray(r))return _arrayLikeToArray(r)}function _callSuper(t,o,e){return o=_getPrototypeOf(o),_possibleConstructorReturn(t,_isNativeReflectConstruct()?Reflect.construct(o,e||[],_getPrototypeOf(t).constructor):o.apply(t,e))}function _possibleConstructorReturn(t,e){if(e&&("object"==_typeof(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return _assertThisInitialized(t)}function _assertThisInitialized(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function _isNativeReflectConstruct(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(t){}return(_isNativeReflectConstruct=function(){return!!t})()}function _getPrototypeOf(t){return _getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},_getPrototypeOf(t)}function _inherits(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&_setPrototypeOf(t,e)}function _setPrototypeOf(t,e){return _setPrototypeOf=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},_setPrototypeOf(t,e)}function _taggedTemplateLiteral(e,t){return t||(t=e.slice(0)),Object.freeze(Object.defineProperties(e,{raw:{value:Object.freeze(t)}}))}function ownKeys(e,r){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);r&&(o=o.filter((function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable}))),t.push.apply(t,o)}return t}function _objectSpread(e){for(var r=1;r<arguments.length;r++){var t=null!=arguments[r]?arguments[r]:{};r%2?ownKeys(Object(t),!0).forEach((function(r){_defineProperty(e,r,t[r])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):ownKeys(Object(t)).forEach((function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r))}))}return e}function _defineProperty(e,r,t){return(r=_toPropertyKey(r))in e?Object.defineProperty(e,r,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[r]=t,e}function _classPrivateFieldSet(s,a,r){return s.set(_assertClassBrand(s,a),r),r}function _classCallCheck(a,n){if(!(a instanceof n))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,r){for(var t=0;t<r.length;t++){var o=r[t];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,_toPropertyKey(o.key),o)}}function _createClass(e,r,t){return r&&_defineProperties(e.prototype,r),t&&_defineProperties(e,t),Object.defineProperty(e,"prototype",{writable:!1}),e}function _toPropertyKey(t){var i=_toPrimitive(t,"string");return"symbol"==_typeof(i)?i:i+""}function _toPrimitive(t,r){if("object"!=_typeof(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var i=e.call(t,r||"default");if("object"!=_typeof(i))return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===r?String:Number)(t)}function _classPrivateMethodInitSpec(e,a){_checkPrivateRedeclaration(e,a),a.add(e)}function _classPrivateFieldInitSpec(e,t,a){_checkPrivateRedeclaration(e,t),t.set(e,a)}function _checkPrivateRedeclaration(e,t){if(t.has(e))throw new TypeError("Cannot initialize the same private elements twice on an object")}function _classPrivateFieldGet(s,a){return s.get(_assertClassBrand(s,a))}function _assertClassBrand(e,t,n){if("function"==typeof e?e===t:e.has(t))return arguments.length<3?t:n;throw new TypeError("Private element is not present on this object")}function _createForOfIteratorHelper(r,e){var t="undefined"!=typeof Symbol&&r[Symbol.iterator]||r["@@iterator"];if(!t){if(Array.isArray(r)||(t=_unsupportedIterableToArray(r))||e&&r&&"number"==typeof r.length){t&&(r=t);var _n=0,F=function(){};return{s:F,n:function(){return _n>=r.length?{done:!0}:{done:!1,value:r[_n++]}},e:function(r){throw r},f:F}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,a=!0,u=!1;return{s:function(){t=t.call(r)},n:function(){var r=t.next();return a=r.done,r},e:function(r){u=!0,o=r},f:function(){try{a||null==t.return||t.return()}finally{if(u)throw o}}}}function _unsupportedIterableToArray(r,a){if(r){if("string"==typeof r)return _arrayLikeToArray(r,a);var t={}.toString.call(r).slice(8,-1);return"Object"===t&&r.constructor&&(t=r.constructor.name),"Map"===t||"Set"===t?Array.from(r):"Arguments"===t||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t)?_arrayLikeToArray(r,a):void 0}}function _arrayLikeToArray(r,a){(null==a||a>r.length)&&(a=r.length);for(var e=0,n=Array(a);e<a;e++)n[e]=r[e];return n}!function(_LocalLibrary,_ModalDialog,_Presenter,_HomePresenter,_LessonPresenter,_LessonEditorPresenter,_ProblemPresenter,_SlideProblemPresenter,_MarksPresenter,_PrintableLessonPresenter){function isLeadingSurrogate(codePoint){return codePoint>=55296&&codePoint<=56319}function isTrailingSurrogate(codePoint){return codePoint>=56320&&codePoint<=57343}String.prototype.replaceAll||(String.prototype.replaceAll=function(pattern,replacement){if(pattern instanceof RegExp){if(pattern.flags.indexOf("g")<0)throw new TypeError("String.prototype.replaceAll called with a non-global RegExp argument");return this.replace(pattern,replacement)}return this.replace(new RegExp(pattern,"g"),replacement)});String.prototype.toWellFormed||(String.prototype.toWellFormed=function(){if(!this)return this;var _step,result="",_iterator=_createForOfIteratorHelper(this);try{for(_iterator.s();!(_step=_iterator.n()).done;){var chr=_step.value,codePoint=chr.codePointAt(0);isLeadingSurrogate(codePoint)||isTrailingSurrogate(codePoint)?result+="�":result+=chr}}catch(err){_iterator.e(err)}finally{_iterator.f()}return result});var BuildInfo={isBuilt:function(){return BuildInfo.getMode().indexOf("$")<0},getBuildDate:function(){return"2024-07-18 09:13:19Z"},getBundleName:function(){return"text2lesson.js"},getProductName:function(){return"RapidQandA"},getMode:function(){return"production"},getVersion:function(){return"1.0.76 "}};function extractWikiMediaLicence(attribution){var match=/^([\s\S]+?),\s*([^&,<]+)\s*(?:(?:<|&lt;)([\s\S]+)(?:>|&gt;))?,\s*via Wikimedia Commons$/g.exec(attribution);return match?{attribution:match[1],shortName:match[2],url:match[3]}:{attribution:attribution,shortName:"",url:""}}function formMarkdownUrl(data){var _data$alignment,_data$authors,_data$licenceName,_data$licenceUrl,_data$notes,prefix="<"===data.alignment?"!<":"".concat(null!==(_data$alignment=data.alignment)&&void 0!==_data$alignment?_data$alignment:"","!");return function(data){return null==data?void 0:data.replace(/\s/g," ")}("".concat(prefix,"[").concat(data.altText,"](").concat(data.imageUrl,' "').concat(data.altText,": ").concat(data.attribution,"|").concat(data.imageSourceUrl,"|").concat(null!==(_data$authors=data.authors)&&void 0!==_data$authors?_data$authors:"","|").concat(null!==(_data$licenceName=data.licenceName)&&void 0!==_data$licenceName?_data$licenceName:"","|").concat(null!==(_data$licenceUrl=data.licenceUrl)&&void 0!==_data$licenceUrl?_data$licenceUrl:"","|").concat(null!==(_data$notes=data.notes)&&void 0!==_data$notes?_data$notes:"",'")'))}var attributionPatterns={WikimediaHtml:{re:/([<])?<a\s+title="([^"]+Wikimedia Commons)"\s+href="([^"]+)"><img\s+(?:width="(\d+)")?\s?alt="([^"]+)"\s+src="([^"]+)">\s*<\/a>/g,rep:function(match,alignment,attribution,imageSourceUrl,width,altText,imageUrl){var _licence$attribution,_licence$shortName,licence=extractWikiMediaLicence(attribution);return formMarkdownUrl({alignment:alignment,altText:null==altText?void 0:altText.trim(),imageUrl:imageUrl,imageSourceUrl:imageSourceUrl,attribution:null===(_licence$attribution=licence.attribution)||void 0===_licence$attribution?void 0:_licence$attribution.trim(),authors:"",licenceName:null===(_licence$shortName=licence.shortName)||void 0===_licence$shortName?void 0:_licence$shortName.trim(),licenceUrl:licence.url,notes:"via Wikimedia Commons"})}},WikimediaBbcode:{re:/\{bbcode\}\s*([<])?\[url=([^\]]+?)\]\s*\[img\]([^[]+?)\[\/img\]\s*\[\/url\]\s*\[url=([^\]]+?)\]([^[]+?)\[\/url\]\s*([\s\S]*?)\{bbcode\}/g,rep:function(match,alignment,imageSourceUrl,imageUrl,imageSourceUrlRepeated,altText,attribution){var _licence$attribution2,_licence$shortName2,licence=extractWikiMediaLicence(attribution);return formMarkdownUrl({alignment:alignment,altText:null==altText?void 0:altText.trim(),imageUrl:imageUrl,imageSourceUrl:imageSourceUrl,attribution:null===(_licence$attribution2=licence.attribution)||void 0===_licence$attribution2?void 0:_licence$attribution2.trim(),authors:"",licenceName:null===(_licence$shortName2=licence.shortName)||void 0===_licence$shortName2?void 0:_licence$shortName2.trim(),licenceUrl:licence.url,notes:"via Wikimedia Commons"})}}};var DOCS_ROOT_URL="https://henspace.github.io/text2lesson-docs/";function parseMathMl(data,warden){return data.replace(/<math[^>]*?>[\s\S]*<\/math>/g,(function(match){return function(html,warden){return html=(html=html.replace(/href\s*="[^"]*"/g,"")).replace(/<(?!semantics|annotation|[m/])/g,"&lt;"),warden.protect(html)}(match,warden)}))}function safeEncodeURIComponent(uri){try{return encodeURIComponent(uri)}catch(error){return console.error(error),encodeURIComponent(uri.toWellFormed())}}function stringToBase64(str){return window.btoa(safeEncodeURIComponent(str))}function base64ToString(base64){return decodeURIComponent(window.atob(base64))}var _wards=new WeakMap,_ParsingWarden_brand=new WeakSet,ParsingWarden=function(){return _createClass((function ParsingWarden(){_classCallCheck(this,ParsingWarden),_classPrivateMethodInitSpec(this,_ParsingWarden_brand),_classPrivateFieldInitSpec(this,_wards,new Map)}),[{key:"clear",value:function(){_classPrivateFieldGet(_wards,this).clear()}},{key:"protect",value:function(data){if(!data)return data;var key="???".concat(_classPrivateFieldGet(_wards,this).size).concat(_assertClassBrand(_ParsingWarden_brand,this,_createKeyCode).call(this,data),"???");return _classPrivateFieldGet(_wards,this).set(key,data),key}},{key:"retrieve",value:function(key){var value=_classPrivateFieldGet(_wards,this).get(key);return _classPrivateFieldGet(_wards,this).delete(key),value||(console.error("Could not find ".concat(key," in protected data.")),key)}},{key:"reinstate",value:function(data){var _this=this;return data.replace(/[?]{3}\d+[a-zA-Z0-9+/]+:{0,2}[?]{3}/g,(function(match){return _this.retrieve(match)}))}}])}();function _createKeyCode(data){return stringToBase64(data).replace(/=/g,":")}var asciimath={};!function(){var decimalsign=".",isIE="Microsoft"==navigator.appName.slice(0,9);var AMmathml="http://www.w3.org/1998/Math/MathML";function createMmlNode(t,frag){var node;return node=isIE?document.createElement("m:"+t):document.createElementNS(AMmathml,t),frag&&node.appendChild(frag),node}var AMcal=["𝒜","ℬ","𝒞","𝒟","ℰ","ℱ","𝒢","ℋ","ℐ","𝒥","𝒦","ℒ","ℳ","𝒩","𝒪","𝒫","𝒬","ℛ","𝒮","𝒯","𝒰","𝒱","𝒲","𝒳","𝒴","𝒵","𝒶","𝒷","𝒸","𝒹","ℯ","𝒻","ℊ","𝒽","𝒾","𝒿","𝓀","𝓁","𝓂","𝓃","ℴ","𝓅","𝓆","𝓇","𝓈","𝓉","𝓊","𝓋","𝓌","𝓍","𝓎","𝓏"],AMfrk=["𝔄","𝔅","ℭ","𝔇","𝔈","𝔉","𝔊","ℌ","ℑ","𝔍","𝔎","𝔏","𝔐","𝔑","𝔒","𝔓","𝔔","ℜ","𝔖","𝔗","𝔘","𝔙","𝔚","𝔛","𝔜","ℨ","𝔞","𝔟","𝔠","𝔡","𝔢","𝔣","𝔤","𝔥","𝔦","𝔧","𝔨","𝔩","𝔪","𝔫","𝔬","𝔭","𝔮","𝔯","𝔰","𝔱","𝔲","𝔳","𝔴","𝔵","𝔶","𝔷"],AMbbb=["𝔸","𝔹","ℂ","𝔻","𝔼","𝔽","𝔾","ℍ","𝕀","𝕁","𝕂","𝕃","𝕄","ℕ","𝕆","ℙ","ℚ","ℝ","𝕊","𝕋","𝕌","𝕍","𝕎","𝕏","𝕐","ℤ","𝕒","𝕓","𝕔","𝕕","𝕖","𝕗","𝕘","𝕙","𝕚","𝕛","𝕜","𝕝","𝕞","𝕟","𝕠","𝕡","𝕢","𝕣","𝕤","𝕥","𝕦","𝕧","𝕨","𝕩","𝕪","𝕫"],CONST=0,UNARY=1,BINARY=2,INFIX=3,LEFTBRACKET=4,RIGHTBRACKET=5,SPACE=6,UNDEROVER=7,DEFINITION=8,LEFTRIGHT=9,TEXT=10,UNARYUNDEROVER=15,AMquote={input:'"',tag:"mtext",output:"mbox",tex:null,ttype:TEXT},AMsymbols=[{input:"alpha",tag:"mi",output:"α",tex:null,ttype:CONST},{input:"beta",tag:"mi",output:"β",tex:null,ttype:CONST},{input:"chi",tag:"mi",output:"χ",tex:null,ttype:CONST},{input:"delta",tag:"mi",output:"δ",tex:null,ttype:CONST},{input:"Delta",tag:"mo",output:"Δ",tex:null,ttype:CONST},{input:"epsi",tag:"mi",output:"ε",tex:"epsilon",ttype:CONST},{input:"varepsilon",tag:"mi",output:"ɛ",tex:null,ttype:CONST},{input:"eta",tag:"mi",output:"η",tex:null,ttype:CONST},{input:"gamma",tag:"mi",output:"γ",tex:null,ttype:CONST},{input:"Gamma",tag:"mo",output:"Γ",tex:null,ttype:CONST},{input:"iota",tag:"mi",output:"ι",tex:null,ttype:CONST},{input:"kappa",tag:"mi",output:"κ",tex:null,ttype:CONST},{input:"lambda",tag:"mi",output:"λ",tex:null,ttype:CONST},{input:"Lambda",tag:"mo",output:"Λ",tex:null,ttype:CONST},{input:"lamda",tag:"mi",output:"λ",tex:null,ttype:CONST},{input:"Lamda",tag:"mo",output:"Λ",tex:null,ttype:CONST},{input:"mu",tag:"mi",output:"μ",tex:null,ttype:CONST},{input:"nu",tag:"mi",output:"ν",tex:null,ttype:CONST},{input:"omega",tag:"mi",output:"ω",tex:null,ttype:CONST},{input:"Omega",tag:"mo",output:"Ω",tex:null,ttype:CONST},{input:"phi",tag:"mi",output:"ϕ",tex:null,ttype:CONST},{input:"varphi",tag:"mi",output:"φ",tex:null,ttype:CONST},{input:"Phi",tag:"mo",output:"Φ",tex:null,ttype:CONST},{input:"pi",tag:"mi",output:"π",tex:null,ttype:CONST},{input:"Pi",tag:"mo",output:"Π",tex:null,ttype:CONST},{input:"psi",tag:"mi",output:"ψ",tex:null,ttype:CONST},{input:"Psi",tag:"mi",output:"Ψ",tex:null,ttype:CONST},{input:"rho",tag:"mi",output:"ρ",tex:null,ttype:CONST},{input:"sigma",tag:"mi",output:"σ",tex:null,ttype:CONST},{input:"Sigma",tag:"mo",output:"Σ",tex:null,ttype:CONST},{input:"tau",tag:"mi",output:"τ",tex:null,ttype:CONST},{input:"theta",tag:"mi",output:"θ",tex:null,ttype:CONST},{input:"vartheta",tag:"mi",output:"ϑ",tex:null,ttype:CONST},{input:"Theta",tag:"mo",output:"Θ",tex:null,ttype:CONST},{input:"upsilon",tag:"mi",output:"υ",tex:null,ttype:CONST},{input:"xi",tag:"mi",output:"ξ",tex:null,ttype:CONST},{input:"Xi",tag:"mo",output:"Ξ",tex:null,ttype:CONST},{input:"zeta",tag:"mi",output:"ζ",tex:null,ttype:CONST},{input:"*",tag:"mo",output:"⋅",tex:"cdot",ttype:CONST},{input:"**",tag:"mo",output:"∗",tex:"ast",ttype:CONST},{input:"***",tag:"mo",output:"⋆",tex:"star",ttype:CONST},{input:"//",tag:"mo",output:"/",tex:null,ttype:CONST},{input:"\\\\",tag:"mo",output:"\\",tex:"backslash",ttype:CONST},{input:"setminus",tag:"mo",output:"\\",tex:null,ttype:CONST},{input:"xx",tag:"mo",output:"×",tex:"times",ttype:CONST},{input:"|><",tag:"mo",output:"⋉",tex:"ltimes",ttype:CONST},{input:"><|",tag:"mo",output:"⋊",tex:"rtimes",ttype:CONST},{input:"|><|",tag:"mo",output:"⋈",tex:"bowtie",ttype:CONST},{input:"-:",tag:"mo",output:"÷",tex:"div",ttype:CONST},{input:"divide",tag:"mo",output:"-:",tex:null,ttype:DEFINITION},{input:"@",tag:"mo",output:"∘",tex:"circ",ttype:CONST},{input:"o+",tag:"mo",output:"⊕",tex:"oplus",ttype:CONST},{input:"ox",tag:"mo",output:"⊗",tex:"otimes",ttype:CONST},{input:"o.",tag:"mo",output:"⊙",tex:"odot",ttype:CONST},{input:"sum",tag:"mo",output:"∑",tex:null,ttype:UNDEROVER},{input:"prod",tag:"mo",output:"∏",tex:null,ttype:UNDEROVER},{input:"^^",tag:"mo",output:"∧",tex:"wedge",ttype:CONST},{input:"^^^",tag:"mo",output:"⋀",tex:"bigwedge",ttype:UNDEROVER},{input:"vv",tag:"mo",output:"∨",tex:"vee",ttype:CONST},{input:"vvv",tag:"mo",output:"⋁",tex:"bigvee",ttype:UNDEROVER},{input:"nn",tag:"mo",output:"∩",tex:"cap",ttype:CONST},{input:"nnn",tag:"mo",output:"⋂",tex:"bigcap",ttype:UNDEROVER},{input:"uu",tag:"mo",output:"∪",tex:"cup",ttype:CONST},{input:"uuu",tag:"mo",output:"⋃",tex:"bigcup",ttype:UNDEROVER},{input:"!=",tag:"mo",output:"≠",tex:"ne",ttype:CONST},{input:":=",tag:"mo",output:":=",tex:null,ttype:CONST},{input:"lt",tag:"mo",output:"<",tex:null,ttype:CONST},{input:"<=",tag:"mo",output:"≤",tex:"le",ttype:CONST},{input:"lt=",tag:"mo",output:"≤",tex:"leq",ttype:CONST},{input:"gt",tag:"mo",output:">",tex:null,ttype:CONST},{input:"mlt",tag:"mo",output:"≪",tex:"ll",ttype:CONST},{input:">=",tag:"mo",output:"≥",tex:"ge",ttype:CONST},{input:"gt=",tag:"mo",output:"≥",tex:"geq",ttype:CONST},{input:"mgt",tag:"mo",output:"≫",tex:"gg",ttype:CONST},{input:"-<",tag:"mo",output:"≺",tex:"prec",ttype:CONST},{input:"-lt",tag:"mo",output:"≺",tex:null,ttype:CONST},{input:">-",tag:"mo",output:"≻",tex:"succ",ttype:CONST},{input:"-<=",tag:"mo",output:"⪯",tex:"preceq",ttype:CONST},{input:">-=",tag:"mo",output:"⪰",tex:"succeq",ttype:CONST},{input:"in",tag:"mo",output:"∈",tex:null,ttype:CONST},{input:"!in",tag:"mo",output:"∉",tex:"notin",ttype:CONST},{input:"sub",tag:"mo",output:"⊂",tex:"subset",ttype:CONST},{input:"sup",tag:"mo",output:"⊃",tex:"supset",ttype:CONST},{input:"sube",tag:"mo",output:"⊆",tex:"subseteq",ttype:CONST},{input:"supe",tag:"mo",output:"⊇",tex:"supseteq",ttype:CONST},{input:"-=",tag:"mo",output:"≡",tex:"equiv",ttype:CONST},{input:"~=",tag:"mo",output:"≅",tex:"cong",ttype:CONST},{input:"~~",tag:"mo",output:"≈",tex:"approx",ttype:CONST},{input:"~",tag:"mo",output:"∼",tex:"sim",ttype:CONST},{input:"prop",tag:"mo",output:"∝",tex:"propto",ttype:CONST},{input:"and",tag:"mtext",output:"and",tex:null,ttype:SPACE},{input:"or",tag:"mtext",output:"or",tex:null,ttype:SPACE},{input:"not",tag:"mo",output:"¬",tex:"neg",ttype:CONST},{input:"=>",tag:"mo",output:"⇒",tex:"implies",ttype:CONST},{input:"if",tag:"mo",output:"if",tex:null,ttype:SPACE},{input:"<=>",tag:"mo",output:"⇔",tex:"iff",ttype:CONST},{input:"AA",tag:"mo",output:"∀",tex:"forall",ttype:CONST},{input:"EE",tag:"mo",output:"∃",tex:"exists",ttype:CONST},{input:"_|_",tag:"mo",output:"⊥",tex:"bot",ttype:CONST},{input:"TT",tag:"mo",output:"⊤",tex:"top",ttype:CONST},{input:"|--",tag:"mo",output:"⊢",tex:"vdash",ttype:CONST},{input:"|==",tag:"mo",output:"⊨",tex:"models",ttype:CONST},{input:"(",tag:"mo",output:"(",tex:"left(",ttype:LEFTBRACKET},{input:")",tag:"mo",output:")",tex:"right)",ttype:RIGHTBRACKET},{input:"[",tag:"mo",output:"[",tex:"left[",ttype:LEFTBRACKET},{input:"]",tag:"mo",output:"]",tex:"right]",ttype:RIGHTBRACKET},{input:"{",tag:"mo",output:"{",tex:null,ttype:LEFTBRACKET},{input:"}",tag:"mo",output:"}",tex:null,ttype:RIGHTBRACKET},{input:"|",tag:"mo",output:"|",tex:null,ttype:LEFTRIGHT},{input:":|:",tag:"mo",output:"|",tex:null,ttype:CONST},{input:"|:",tag:"mo",output:"|",tex:null,ttype:LEFTBRACKET},{input:":|",tag:"mo",output:"|",tex:null,ttype:RIGHTBRACKET},{input:"(:",tag:"mo",output:"〈",tex:"langle",ttype:LEFTBRACKET},{input:":)",tag:"mo",output:"〉",tex:"rangle",ttype:RIGHTBRACKET},{input:"<<",tag:"mo",output:"〈",tex:null,ttype:LEFTBRACKET},{input:">>",tag:"mo",output:"〉",tex:null,ttype:RIGHTBRACKET},{input:"{:",tag:"mo",output:"{:",tex:null,ttype:LEFTBRACKET,invisible:!0},{input:":}",tag:"mo",output:":}",tex:null,ttype:RIGHTBRACKET,invisible:!0},{input:"int",tag:"mo",output:"∫",tex:null,ttype:CONST},{input:"dx",tag:"mi",output:"{:d x:}",tex:null,ttype:DEFINITION},{input:"dy",tag:"mi",output:"{:d y:}",tex:null,ttype:DEFINITION},{input:"dz",tag:"mi",output:"{:d z:}",tex:null,ttype:DEFINITION},{input:"dt",tag:"mi",output:"{:d t:}",tex:null,ttype:DEFINITION},{input:"oint",tag:"mo",output:"∮",tex:null,ttype:CONST},{input:"del",tag:"mo",output:"∂",tex:"partial",ttype:CONST},{input:"grad",tag:"mo",output:"∇",tex:"nabla",ttype:CONST},{input:"+-",tag:"mo",output:"±",tex:"pm",ttype:CONST},{input:"-+",tag:"mo",output:"∓",tex:"mp",ttype:CONST},{input:"O/",tag:"mo",output:"∅",tex:"emptyset",ttype:CONST},{input:"oo",tag:"mo",output:"∞",tex:"infty",ttype:CONST},{input:"aleph",tag:"mo",output:"ℵ",tex:null,ttype:CONST},{input:"...",tag:"mo",output:"...",tex:"ldots",ttype:CONST},{input:":.",tag:"mo",output:"∴",tex:"therefore",ttype:CONST},{input:":'",tag:"mo",output:"∵",tex:"because",ttype:CONST},{input:"/_",tag:"mo",output:"∠",tex:"angle",ttype:CONST},{input:"/_\\",tag:"mo",output:"△",tex:"triangle",ttype:CONST},{input:"'",tag:"mo",output:"′",tex:"prime",ttype:CONST},{input:"tilde",tag:"mover",output:"~",tex:null,ttype:UNARY,acc:!0},{input:"\\ ",tag:"mo",output:" ",tex:null,ttype:CONST},{input:"frown",tag:"mo",output:"⌢",tex:null,ttype:CONST},{input:"quad",tag:"mo",output:"  ",tex:null,ttype:CONST},{input:"qquad",tag:"mo",output:"    ",tex:null,ttype:CONST},{input:"cdots",tag:"mo",output:"⋯",tex:null,ttype:CONST},{input:"vdots",tag:"mo",output:"⋮",tex:null,ttype:CONST},{input:"ddots",tag:"mo",output:"⋱",tex:null,ttype:CONST},{input:"diamond",tag:"mo",output:"⋄",tex:null,ttype:CONST},{input:"square",tag:"mo",output:"□",tex:null,ttype:CONST},{input:"|__",tag:"mo",output:"⌊",tex:"lfloor",ttype:CONST},{input:"__|",tag:"mo",output:"⌋",tex:"rfloor",ttype:CONST},{input:"|~",tag:"mo",output:"⌈",tex:"lceiling",ttype:CONST},{input:"~|",tag:"mo",output:"⌉",tex:"rceiling",ttype:CONST},{input:"CC",tag:"mo",output:"ℂ",tex:null,ttype:CONST},{input:"NN",tag:"mo",output:"ℕ",tex:null,ttype:CONST},{input:"QQ",tag:"mo",output:"ℚ",tex:null,ttype:CONST},{input:"RR",tag:"mo",output:"ℝ",tex:null,ttype:CONST},{input:"ZZ",tag:"mo",output:"ℤ",tex:null,ttype:CONST},{input:"f",tag:"mi",output:"f",tex:null,ttype:UNARY,func:!0},{input:"g",tag:"mi",output:"g",tex:null,ttype:UNARY,func:!0},{input:"lim",tag:"mo",output:"lim",tex:null,ttype:UNDEROVER},{input:"Lim",tag:"mo",output:"Lim",tex:null,ttype:UNDEROVER},{input:"sin",tag:"mo",output:"sin",tex:null,ttype:UNARY,func:!0},{input:"cos",tag:"mo",output:"cos",tex:null,ttype:UNARY,func:!0},{input:"tan",tag:"mo",output:"tan",tex:null,ttype:UNARY,func:!0},{input:"sinh",tag:"mo",output:"sinh",tex:null,ttype:UNARY,func:!0},{input:"cosh",tag:"mo",output:"cosh",tex:null,ttype:UNARY,func:!0},{input:"tanh",tag:"mo",output:"tanh",tex:null,ttype:UNARY,func:!0},{input:"cot",tag:"mo",output:"cot",tex:null,ttype:UNARY,func:!0},{input:"sec",tag:"mo",output:"sec",tex:null,ttype:UNARY,func:!0},{input:"csc",tag:"mo",output:"csc",tex:null,ttype:UNARY,func:!0},{input:"arcsin",tag:"mo",output:"arcsin",tex:null,ttype:UNARY,func:!0},{input:"arccos",tag:"mo",output:"arccos",tex:null,ttype:UNARY,func:!0},{input:"arctan",tag:"mo",output:"arctan",tex:null,ttype:UNARY,func:!0},{input:"coth",tag:"mo",output:"coth",tex:null,ttype:UNARY,func:!0},{input:"sech",tag:"mo",output:"sech",tex:null,ttype:UNARY,func:!0},{input:"csch",tag:"mo",output:"csch",tex:null,ttype:UNARY,func:!0},{input:"exp",tag:"mo",output:"exp",tex:null,ttype:UNARY,func:!0},{input:"abs",tag:"mo",output:"abs",tex:null,ttype:UNARY,rewriteleftright:["|","|"]},{input:"norm",tag:"mo",output:"norm",tex:null,ttype:UNARY,rewriteleftright:["∥","∥"]},{input:"floor",tag:"mo",output:"floor",tex:null,ttype:UNARY,rewriteleftright:["⌊","⌋"]},{input:"ceil",tag:"mo",output:"ceil",tex:null,ttype:UNARY,rewriteleftright:["⌈","⌉"]},{input:"log",tag:"mo",output:"log",tex:null,ttype:UNARY,func:!0},{input:"ln",tag:"mo",output:"ln",tex:null,ttype:UNARY,func:!0},{input:"det",tag:"mo",output:"det",tex:null,ttype:UNARY,func:!0},{input:"dim",tag:"mo",output:"dim",tex:null,ttype:CONST},{input:"mod",tag:"mo",output:"mod",tex:null,ttype:CONST},{input:"gcd",tag:"mo",output:"gcd",tex:null,ttype:UNARY,func:!0},{input:"lcm",tag:"mo",output:"lcm",tex:null,ttype:UNARY,func:!0},{input:"lub",tag:"mo",output:"lub",tex:null,ttype:CONST},{input:"glb",tag:"mo",output:"glb",tex:null,ttype:CONST},{input:"min",tag:"mo",output:"min",tex:null,ttype:UNDEROVER},{input:"max",tag:"mo",output:"max",tex:null,ttype:UNDEROVER},{input:"Sin",tag:"mo",output:"Sin",tex:null,ttype:UNARY,func:!0},{input:"Cos",tag:"mo",output:"Cos",tex:null,ttype:UNARY,func:!0},{input:"Tan",tag:"mo",output:"Tan",tex:null,ttype:UNARY,func:!0},{input:"Arcsin",tag:"mo",output:"Arcsin",tex:null,ttype:UNARY,func:!0},{input:"Arccos",tag:"mo",output:"Arccos",tex:null,ttype:UNARY,func:!0},{input:"Arctan",tag:"mo",output:"Arctan",tex:null,ttype:UNARY,func:!0},{input:"Sinh",tag:"mo",output:"Sinh",tex:null,ttype:UNARY,func:!0},{input:"Cosh",tag:"mo",output:"Cosh",tex:null,ttype:UNARY,func:!0},{input:"Tanh",tag:"mo",output:"Tanh",tex:null,ttype:UNARY,func:!0},{input:"Cot",tag:"mo",output:"Cot",tex:null,ttype:UNARY,func:!0},{input:"Sec",tag:"mo",output:"Sec",tex:null,ttype:UNARY,func:!0},{input:"Csc",tag:"mo",output:"Csc",tex:null,ttype:UNARY,func:!0},{input:"Log",tag:"mo",output:"Log",tex:null,ttype:UNARY,func:!0},{input:"Ln",tag:"mo",output:"Ln",tex:null,ttype:UNARY,func:!0},{input:"Abs",tag:"mo",output:"abs",tex:null,ttype:UNARY,notexcopy:!0,rewriteleftright:["|","|"]},{input:"uarr",tag:"mo",output:"↑",tex:"uparrow",ttype:CONST},{input:"darr",tag:"mo",output:"↓",tex:"downarrow",ttype:CONST},{input:"rarr",tag:"mo",output:"→",tex:"rightarrow",ttype:CONST},{input:"->",tag:"mo",output:"→",tex:"to",ttype:CONST},{input:">->",tag:"mo",output:"↣",tex:"rightarrowtail",ttype:CONST},{input:"->>",tag:"mo",output:"↠",tex:"twoheadrightarrow",ttype:CONST},{input:">->>",tag:"mo",output:"⤖",tex:"twoheadrightarrowtail",ttype:CONST},{input:"|->",tag:"mo",output:"↦",tex:"mapsto",ttype:CONST},{input:"larr",tag:"mo",output:"←",tex:"leftarrow",ttype:CONST},{input:"harr",tag:"mo",output:"↔",tex:"leftrightarrow",ttype:CONST},{input:"rArr",tag:"mo",output:"⇒",tex:"Rightarrow",ttype:CONST},{input:"lArr",tag:"mo",output:"⇐",tex:"Leftarrow",ttype:CONST},{input:"hArr",tag:"mo",output:"⇔",tex:"Leftrightarrow",ttype:CONST},{input:"sqrt",tag:"msqrt",output:"sqrt",tex:null,ttype:UNARY},{input:"root",tag:"mroot",output:"root",tex:null,ttype:BINARY},{input:"frac",tag:"mfrac",output:"/",tex:null,ttype:BINARY},{input:"/",tag:"mfrac",output:"/",tex:null,ttype:INFIX},{input:"stackrel",tag:"mover",output:"stackrel",tex:null,ttype:BINARY},{input:"overset",tag:"mover",output:"stackrel",tex:null,ttype:BINARY},{input:"underset",tag:"munder",output:"stackrel",tex:null,ttype:BINARY},{input:"_",tag:"msub",output:"_",tex:null,ttype:INFIX},{input:"^",tag:"msup",output:"^",tex:null,ttype:INFIX},{input:"hat",tag:"mover",output:"^",tex:null,ttype:UNARY,acc:!0},{input:"bar",tag:"mover",output:"¯",tex:"overline",ttype:UNARY,acc:!0},{input:"vec",tag:"mover",output:"→",tex:null,ttype:UNARY,acc:!0},{input:"dot",tag:"mover",output:".",tex:null,ttype:UNARY,acc:!0},{input:"ddot",tag:"mover",output:"..",tex:null,ttype:UNARY,acc:!0},{input:"overarc",tag:"mover",output:"⏜",tex:"overparen",ttype:UNARY,acc:!0},{input:"ul",tag:"munder",output:"̲",tex:"underline",ttype:UNARY,acc:!0},{input:"ubrace",tag:"munder",output:"⏟",tex:"underbrace",ttype:UNARYUNDEROVER,acc:!0},{input:"obrace",tag:"mover",output:"⏞",tex:"overbrace",ttype:UNARYUNDEROVER,acc:!0},{input:"text",tag:"mtext",output:"text",tex:null,ttype:TEXT},{input:"mbox",tag:"mtext",output:"mbox",tex:null,ttype:TEXT},{input:"color",tag:"mstyle",ttype:BINARY},{input:"id",tag:"mrow",ttype:BINARY},{input:"class",tag:"mrow",ttype:BINARY},{input:"cancel",tag:"menclose",output:"cancel",tex:null,ttype:UNARY},AMquote,{input:"bb",tag:"mstyle",atname:"mathvariant",atval:"bold",output:"bb",tex:null,ttype:UNARY},{input:"mathbf",tag:"mstyle",atname:"mathvariant",atval:"bold",output:"mathbf",tex:null,ttype:UNARY},{input:"sf",tag:"mstyle",atname:"mathvariant",atval:"sans-serif",output:"sf",tex:null,ttype:UNARY},{input:"mathsf",tag:"mstyle",atname:"mathvariant",atval:"sans-serif",output:"mathsf",tex:null,ttype:UNARY},{input:"bbb",tag:"mstyle",atname:"mathvariant",atval:"double-struck",output:"bbb",tex:null,ttype:UNARY,codes:AMbbb},{input:"mathbb",tag:"mstyle",atname:"mathvariant",atval:"double-struck",output:"mathbb",tex:null,ttype:UNARY,codes:AMbbb},{input:"cc",tag:"mstyle",atname:"mathvariant",atval:"script",output:"cc",tex:null,ttype:UNARY,codes:AMcal},{input:"mathcal",tag:"mstyle",atname:"mathvariant",atval:"script",output:"mathcal",tex:null,ttype:UNARY,codes:AMcal},{input:"tt",tag:"mstyle",atname:"mathvariant",atval:"monospace",output:"tt",tex:null,ttype:UNARY},{input:"mathtt",tag:"mstyle",atname:"mathvariant",atval:"monospace",output:"mathtt",tex:null,ttype:UNARY},{input:"fr",tag:"mstyle",atname:"mathvariant",atval:"fraktur",output:"fr",tex:null,ttype:UNARY,codes:AMfrk},{input:"mathfrak",tag:"mstyle",atname:"mathvariant",atval:"fraktur",output:"mathfrak",tex:null,ttype:UNARY,codes:AMfrk}];function compareNames(s1,s2){return s1.input>s2.input?1:-1}var AMnestingDepth,AMpreviousSymbol,AMcurrentSymbol,AMnames=[];function AMremoveCharsAndBlanks(str,n){var st;st="\\"==str.charAt(n)&&"\\"!=str.charAt(n+1)&&" "!=str.charAt(n+1)?str.slice(n+1):str.slice(n);for(var i=0;i<st.length&&st.charCodeAt(i)<=32;i+=1);return st.slice(i)}function position(arr,str,n){if(0==n){var h,m;for(n=-1,h=arr.length;n+1<h;)arr[m=n+h>>1]<str?n=m:h=m;return h}for(var i=n;i<arr.length&&arr[i]<str;i++);return i}function AMgetSymbol(str){for(var mk,st,tagst,k=0,match="",more=!0,i=1;i<=str.length&&more;i++)st=str.slice(0,i),(k=position(AMnames,st,k))<AMnames.length&&str.slice(0,AMnames[k].length)==AMnames[k]&&(mk=k,i=(match=AMnames[k]).length),more=k<AMnames.length&&str.slice(0,AMnames[k].length)>=AMnames[k];if(AMpreviousSymbol=AMcurrentSymbol,""!=match)return AMcurrentSymbol=AMsymbols[mk].ttype,AMsymbols[mk];AMcurrentSymbol=CONST,k=1,st=str.slice(0,1);for(var integ=!0;"0"<=st&&st<="9"&&k<=str.length;)st=str.slice(k,k+1),k++;if(st==decimalsign&&"0"<=(st=str.slice(k,k+1))&&st<="9")for(integ=!1,k++;"0"<=st&&st<="9"&&k<=str.length;)st=str.slice(k,k+1),k++;return integ&&k>1||k>2?(st=str.slice(0,k-1),tagst="mn"):(k=2,tagst=("A">(st=str.slice(0,1))||st>"Z")&&("a">st||st>"z")?"mo":"mi"),"-"==st&&" "!==str.charAt(1)&&AMpreviousSymbol==INFIX?(AMcurrentSymbol=INFIX,{input:st,tag:tagst,output:st,ttype:UNARY,func:!0}):{input:st,tag:tagst,output:st,ttype:CONST}}function AMremoveBrackets(node){var st;if(node.hasChildNodes()){if(node.firstChild.hasChildNodes()&&("mrow"==node.nodeName||"M:MROW"==node.nodeName)){if(node.firstChild.nextSibling&&"mtable"==node.firstChild.nextSibling.nodeName)return;"("!=(st=node.firstChild.firstChild.nodeValue)&&"["!=st&&"{"!=st||node.removeChild(node.firstChild)}!node.lastChild.hasChildNodes()||"mrow"!=node.nodeName&&"M:MROW"!=node.nodeName||")"!=(st=node.lastChild.firstChild.nodeValue)&&"]"!=st&&"}"!=st||node.removeChild(node.lastChild)}}function AMparseSexpr(str){var symbol,node,result,i,st,newFrag=document.createDocumentFragment();if(null==(symbol=AMgetSymbol(str=AMremoveCharsAndBlanks(str,0)))||symbol.ttype==RIGHTBRACKET&&AMnestingDepth>0)return[null,str];switch(symbol.ttype==DEFINITION&&(symbol=AMgetSymbol(str=symbol.output+AMremoveCharsAndBlanks(str,symbol.input.length))),symbol.ttype){case UNDEROVER:case CONST:return str=AMremoveCharsAndBlanks(str,symbol.input.length),[createMmlNode(symbol.tag,document.createTextNode(symbol.output)),str];case LEFTBRACKET:return AMnestingDepth++,result=AMparseExpr(str=AMremoveCharsAndBlanks(str,symbol.input.length),!0),AMnestingDepth--,"boolean"==typeof symbol.invisible&&symbol.invisible?node=createMmlNode("mrow",result[0]):(node=createMmlNode("mo",document.createTextNode(symbol.output)),(node=createMmlNode("mrow",node)).appendChild(result[0])),[node,result[1]];case TEXT:return symbol!=AMquote&&(str=AMremoveCharsAndBlanks(str,symbol.input.length)),-1==(i="{"==str.charAt(0)?str.indexOf("}"):"("==str.charAt(0)?str.indexOf(")"):"["==str.charAt(0)?str.indexOf("]"):symbol==AMquote?str.slice(1).indexOf('"')+1:0)&&(i=str.length)," "==(st=str.slice(1,i)).charAt(0)&&((node=createMmlNode("mspace")).setAttribute("width","1ex"),newFrag.appendChild(node)),newFrag.appendChild(createMmlNode(symbol.tag,document.createTextNode(st)))," "==st.charAt(st.length-1)&&((node=createMmlNode("mspace")).setAttribute("width","1ex"),newFrag.appendChild(node)),str=AMremoveCharsAndBlanks(str,i+1),[createMmlNode("mrow",newFrag),str];case UNARYUNDEROVER:case UNARY:if(null==(result=AMparseSexpr(str=AMremoveCharsAndBlanks(str,symbol.input.length)))[0]){if("mi"==symbol.tag||"mo"==symbol.tag)return[createMmlNode(symbol.tag,document.createTextNode(symbol.output)),str];result[0]=createMmlNode("mi","")}if("boolean"==typeof symbol.func&&symbol.func)return"^"==(st=str.charAt(0))||"_"==st||"/"==st||"|"==st||","==st||1==symbol.input.length&&symbol.input.match(/\w/)&&"("!=st?[createMmlNode(symbol.tag,document.createTextNode(symbol.output)),str]:((node=createMmlNode("mrow",createMmlNode(symbol.tag,document.createTextNode(symbol.output)))).appendChild(result[0]),[node,result[1]]);if(AMremoveBrackets(result[0]),"sqrt"==symbol.input)return[createMmlNode(symbol.tag,result[0]),result[1]];if(void 0!==symbol.rewriteleftright)return(node=createMmlNode("mrow",createMmlNode("mo",document.createTextNode(symbol.rewriteleftright[0])))).appendChild(result[0]),node.appendChild(createMmlNode("mo",document.createTextNode(symbol.rewriteleftright[1]))),[node,result[1]];if("cancel"==symbol.input)return(node=createMmlNode(symbol.tag,result[0])).setAttribute("notation","updiagonalstrike"),[node,result[1]];if("boolean"==typeof symbol.acc&&symbol.acc){node=createMmlNode(symbol.tag,result[0]);var accnode=createMmlNode("mo",document.createTextNode(symbol.output));return"vec"==symbol.input&&("mrow"==result[0].nodeName&&1==result[0].childNodes.length&&null!==result[0].firstChild.firstChild.nodeValue&&1==result[0].firstChild.firstChild.nodeValue.length||result[0].firstChild&&null!==result[0].firstChild.nodeValue&&1==result[0].firstChild.nodeValue.length)&&accnode.setAttribute("stretchy",!1),node.appendChild(accnode),[node,result[1]]}if(!isIE&&void 0!==symbol.codes)for(i=0;i<result[0].childNodes.length;i++)if("mi"==result[0].childNodes[i].nodeName||"mi"==result[0].nodeName){st="mi"==result[0].nodeName?result[0].firstChild.nodeValue:result[0].childNodes[i].firstChild.nodeValue;for(var newst=[],j=0;j<st.length;j++)st.charCodeAt(j)>64&&st.charCodeAt(j)<91?newst+=symbol.codes[st.charCodeAt(j)-65]:st.charCodeAt(j)>96&&st.charCodeAt(j)<123?newst+=symbol.codes[st.charCodeAt(j)-71]:newst+=st.charAt(j);"mi"==result[0].nodeName?result[0]=createMmlNode("mo").appendChild(document.createTextNode(newst)):result[0].replaceChild(createMmlNode("mo").appendChild(document.createTextNode(newst)),result[0].childNodes[i])}return(node=createMmlNode(symbol.tag,result[0])).setAttribute(symbol.atname,symbol.atval),[node,result[1]];case BINARY:if(null==(result=AMparseSexpr(str=AMremoveCharsAndBlanks(str,symbol.input.length)))[0])return[createMmlNode("mo",document.createTextNode(symbol.input)),str];AMremoveBrackets(result[0]);var result2=AMparseSexpr(result[1]);return null==result2[0]?[createMmlNode("mo",document.createTextNode(symbol.input)),str]:(AMremoveBrackets(result2[0]),["color","class","id"].indexOf(symbol.input)>=0?("{"==str.charAt(0)?i=str.indexOf("}"):"("==str.charAt(0)?i=str.indexOf(")"):"["==str.charAt(0)&&(i=str.indexOf("]")),st=str.slice(1,i),node=createMmlNode(symbol.tag,result2[0]),"color"===symbol.input?node.setAttribute("mathcolor",st):"class"===symbol.input?node.setAttribute("class",st):"id"===symbol.input&&node.setAttribute("id",st),[node,result2[1]]):("root"!=symbol.input&&"stackrel"!=symbol.output||newFrag.appendChild(result2[0]),newFrag.appendChild(result[0]),"frac"==symbol.input&&newFrag.appendChild(result2[0]),[createMmlNode(symbol.tag,newFrag),result2[1]]));case INFIX:return str=AMremoveCharsAndBlanks(str,symbol.input.length),[createMmlNode("mo",document.createTextNode(symbol.output)),str];case SPACE:return str=AMremoveCharsAndBlanks(str,symbol.input.length),(node=createMmlNode("mspace")).setAttribute("width","1ex"),newFrag.appendChild(node),newFrag.appendChild(createMmlNode(symbol.tag,document.createTextNode(symbol.output))),(node=createMmlNode("mspace")).setAttribute("width","1ex"),newFrag.appendChild(node),[createMmlNode("mrow",newFrag),str];case LEFTRIGHT:return AMnestingDepth++,result=AMparseExpr(str=AMremoveCharsAndBlanks(str,symbol.input.length),!1),AMnestingDepth--,st="",null!=result[0].lastChild&&(st=result[0].lastChild.firstChild.nodeValue),"|"==st&&","!==str.charAt(0)?(node=createMmlNode("mo",document.createTextNode(symbol.output)),(node=createMmlNode("mrow",node)).appendChild(result[0]),[node,result[1]]):(node=createMmlNode("mo",document.createTextNode("∣")),[node=createMmlNode("mrow",node),str]);default:return str=AMremoveCharsAndBlanks(str,symbol.input.length),[createMmlNode(symbol.tag,document.createTextNode(symbol.output)),str]}}function AMparseIexpr(str){var symbol,sym1,sym2,node,result,underover;if(sym1=AMgetSymbol(str=AMremoveCharsAndBlanks(str,0)),node=(result=AMparseSexpr(str))[0],(symbol=AMgetSymbol(str=result[1])).ttype==INFIX&&"/"!=symbol.input){if(null==(result=AMparseSexpr(str=AMremoveCharsAndBlanks(str,symbol.input.length)))[0]?result[0]=createMmlNode("mo",document.createTextNode("□")):AMremoveBrackets(result[0]),str=result[1],underover=sym1.ttype==UNDEROVER||sym1.ttype==UNARYUNDEROVER,"_"==symbol.input)if("^"==(sym2=AMgetSymbol(str)).input){var res2=AMparseSexpr(str=AMremoveCharsAndBlanks(str,sym2.input.length));AMremoveBrackets(res2[0]),str=res2[1],(node=createMmlNode(underover?"munderover":"msubsup",node)).appendChild(result[0]),node.appendChild(res2[0]),node=createMmlNode("mrow",node)}else(node=createMmlNode(underover?"munder":"msub",node)).appendChild(result[0]);else"^"==symbol.input&&underover?(node=createMmlNode("mover",node)).appendChild(result[0]):(node=createMmlNode(symbol.tag,node)).appendChild(result[0]);void 0!==sym1.func&&sym1.func&&(sym2=AMgetSymbol(str)).ttype!=INFIX&&sym2.ttype!=RIGHTBRACKET&&(sym1.input.length>1||sym2.ttype==LEFTBRACKET)&&(result=AMparseIexpr(str),(node=createMmlNode("mrow",node)).appendChild(result[0]),str=result[1])}return[node,str]}function AMparseExpr(str,rightbracket){var symbol,node,result,i,newFrag=document.createDocumentFragment();do{node=(result=AMparseIexpr(str=AMremoveCharsAndBlanks(str,0)))[0],(symbol=AMgetSymbol(str=result[1])).ttype==INFIX&&"/"==symbol.input?(null==(result=AMparseIexpr(str=AMremoveCharsAndBlanks(str,symbol.input.length)))[0]?result[0]=createMmlNode("mo",document.createTextNode("□")):AMremoveBrackets(result[0]),str=result[1],AMremoveBrackets(node),(node=createMmlNode(symbol.tag,node)).appendChild(result[0]),newFrag.appendChild(node),symbol=AMgetSymbol(str)):null!=node&&newFrag.appendChild(node)}while((symbol.ttype!=RIGHTBRACKET&&(symbol.ttype!=LEFTRIGHT||rightbracket)||0==AMnestingDepth)&&null!=symbol&&""!=symbol.output);if(symbol.ttype==RIGHTBRACKET||symbol.ttype==LEFTRIGHT){var len=newFrag.childNodes.length;if(len>0&&"mrow"==newFrag.childNodes[len-1].nodeName&&newFrag.childNodes[len-1].lastChild&&newFrag.childNodes[len-1].lastChild.firstChild){var right=newFrag.childNodes[len-1].lastChild.firstChild.nodeValue;if(")"==right||"]"==right){var left=newFrag.childNodes[len-1].firstChild.firstChild.nodeValue;if("("==left&&")"==right&&"}"!=symbol.output||"["==left&&"]"==right){var pos=[],matrix=!0,m=newFrag.childNodes.length;for(i=0;matrix&&i<m;i+=2){if(pos[i]=[],node=newFrag.childNodes[i],matrix&&(matrix="mrow"==node.nodeName&&(i==m-1||"mo"==node.nextSibling.nodeName&&","==node.nextSibling.firstChild.nodeValue)&&node.firstChild.firstChild&&node.firstChild.firstChild.nodeValue==left&&node.lastChild.firstChild&&node.lastChild.firstChild.nodeValue==right),matrix)for(var j=0;j<node.childNodes.length;j++)","==node.childNodes[j].firstChild.nodeValue&&(pos[i][pos[i].length]=j);matrix&&i>1&&(matrix=pos[i].length==pos[i-2].length)}var columnlines=[];if(matrix=matrix&&(pos.length>1||pos[0].length>0)){var row,frag,n,k,table=document.createDocumentFragment();for(i=0;i<m;i+=2){for(row=document.createDocumentFragment(),frag=document.createDocumentFragment(),n=(node=newFrag.firstChild).childNodes.length,k=0,node.removeChild(node.firstChild),j=1;j<n-1;j++)void 0!==pos[i][k]&&j==pos[i][k]?(node.removeChild(node.firstChild),"mrow"==node.firstChild.nodeName&&1==node.firstChild.childNodes.length&&"∣"==node.firstChild.firstChild.firstChild.nodeValue?(0==i&&columnlines.push("solid"),node.removeChild(node.firstChild),node.removeChild(node.firstChild),j+=2,k++):0==i&&columnlines.push("none"),row.appendChild(createMmlNode("mtd",frag)),k++):frag.appendChild(node.firstChild);row.appendChild(createMmlNode("mtd",frag)),0==i&&columnlines.push("none"),newFrag.childNodes.length>2&&(newFrag.removeChild(newFrag.firstChild),newFrag.removeChild(newFrag.firstChild)),table.appendChild(createMmlNode("mtr",row))}(node=createMmlNode("mtable",table)).setAttribute("columnlines",columnlines.join(" ")),"boolean"==typeof symbol.invisible&&symbol.invisible&&node.setAttribute("columnalign","left"),newFrag.replaceChild(node,newFrag.firstChild)}}}}str=AMremoveCharsAndBlanks(str,symbol.input.length),"boolean"==typeof symbol.invisible&&symbol.invisible||(node=createMmlNode("mo",document.createTextNode(symbol.output)),newFrag.appendChild(node))}return[newFrag,str]}asciimath.parseMath=function(str,inline){var node;return AMnestingDepth=0,(node=createMmlNode("mstyle",AMparseExpr((str=(str=(str=str.replace(/&nbsp;/g,"")).replace(/&gt;/g,">")).replace(/&lt;/g,"<")).replace(/^\s+/g,""),!1)[0])).setAttribute("fontsize","1em"),node.setAttribute("mathsize","1em"),node.setAttribute("displaystyle","true"),(node=createMmlNode("math",node)).setAttribute("display",inline?"inline":"block"),node.setAttribute("title",str.replace(/\s+/g," ")),node},function(){var i,symlen=AMsymbols.length;for(i=0;i<symlen;i++)AMsymbols[i].tex&&AMsymbols.push({input:AMsymbols[i].tex,tag:AMsymbols[i].tag,output:AMsymbols[i].output,ttype:AMsymbols[i].ttype,acc:AMsymbols[i].acc||!1});!function(){var i;for(AMsymbols.sort(compareNames),i=0;i<AMsymbols.length;i++)AMnames[i]=AMsymbols[i].input}()}()}();var parsingWarden=new ParsingWarden;function parseAsciiMathEquation(equation,inline){var html=asciimath.parseMath(equation,inline).outerHTML;return html=(html=html.replace(/<(\/)script/g,"<&1noscript")).toWellFormed(),parsingWarden.protect(html)}function getPrintableLink(href,parentheses){return'<span class="printable-link for-print-only">'.concat(parentheses?"(":"").concat(href).concat(parentheses?")":"","</span>")}var blockReps=[{re:/(?:(.+)\n=+\n)/g,rep:"\n\n<h1>$1</h1>\n\n"},{re:/(?:(.+)\n-+\n)/g,rep:"\n\n<h2>$1</h2>\n\n"},{re:/^(#+)(?: *)(.+?)(?:#*)[ \t]*$/gm,rep:function(matched,hashes,txt){var level=Math.min(hashes.length,6);return"\n\n<h".concat(level,">").concat(txt.trim(),"</h").concat(level,">\n")}},reAllLinesStartWith(">[ \t]*",{blockPrefix:"<blockquote>",blockSuffix:"</blockquote>"}),reAllLinesStartWith("(?: {4}|\t)",{blockPrefix:"<pre><code>",blockSuffix:"</code></pre>",trimContents:!0,useWarden:!0}),{re:/^(?:[*_-] *){3,}\s*$/gm,rep:"\n\n<hr>\n\n"},reAllLinesStartWith(" {0,3}[*+-][ \t]+",{blockPrefix:"<ul>",blockSuffix:"</ul>",linePrefix:"<li>",lineSuffix:"</li>"}),reAllLinesStartWith(" {0,3}\\d+\\.[ \t]+",{blockPrefix:"<ol>",blockSuffix:"</ol>",linePrefix:"<li>",lineSuffix:"</li>"}),{re:/^\s*a?maths?:\s*(.+?)\s*$/gm,rep:function(match,equation){return parseAsciiMathEquation(equation,!1)}}],paragraphReps=[{re:/(?:(?:^|\n{2,})(?!<\w+>))((?:.(?:\n(?!\n))?)+)/g,rep:"\n\n<p>$1</p>\n\n"},{re:/\n{2,}/g,rep:"\n\n"}],spanReps=[{re:/{a?maths?}(.+?){a?maths?}/gm,rep:function(match,equation){return parseAsciiMathEquation(equation,!0)}},{re:/!(&lt;)?\[(.*?)\]\((https?:\/\/[-\w@:%.+~#=/]+?)(?: +"(.*?)")?\)/gm,rep:function(match,floatLeft,altText,src,title){var additionalClass=floatLeft?"floatable":"",html='<img alt="'.concat(null!=altText?altText:"",'" class="').concat(additionalClass,'" src="').concat(src,'" title="').concat(null!=title?title:"",'"/>');return parsingWarden.protect(html)}},{re:/\[(.*?)\]\((https?:\/\/[-\w@:%.+~#=/]+?)(?: +"(.*?)")?\)/gm,rep:function(match,label,href,title){var _label;label=function(href,label){var iconHtml="";return/^https:\/\/vimeo.com\//.test(href)?iconHtml='<i class="fa-brands fa-vimeo"></i>':/^https:\/\/(www\.)?youtube.com\//.test(href)&&(iconHtml='<i class="fa-brands fa-youtube"></i>'),iconHtml&&(iconHtml="<span class='link-icon'>".concat(iconHtml,"</span>")),"".concat(label).concat(iconHtml)}(href,label);var html='<a target="_blank" href="'.concat(href,'" title="').concat(null!=title?title:"",'">').concat(null!==(_label=label)&&void 0!==_label?_label:"","</a>").concat(getPrintableLink(href,!0));return parsingWarden.protect(html)}},{re:/(?:&lt;|<)(https?:\/\/[-\w@:%.+~#=/]+?)>/gm,rep:function(match,href){var html='<a target="_blank" href="'.concat(href,'">').concat(href,"</a>").concat(getPrintableLink(href,!0));return parsingWarden.protect(html)}},{re:/(?:&lt;|<)([\w.-]+@(?:[\w-]+\.)+[\w-]+)/gm,rep:function(match,address){var encoded=function(data){var _step2,result="",_iterator2=_createForOfIteratorHelper(data);try{for(_iterator2.s();!(_step2=_iterator2.n()).done;){result+=encodeCharToEntity(_step2.value)}}catch(err){_iterator2.e(err)}finally{_iterator2.f()}return result}(address),html='<a href="'.concat(encoded,'">').concat(encoded,"</a>");return parsingWarden.protect(html)}},{re:/(?:`{2,}(.*?)`{2,}|`(.*?)`)/gm,rep:function(match,codeA,codeB){var html="<code>".concat(null!=codeA?codeA:codeB,"</code>");return parsingWarden.protect(html)}},{re:/\*\*([^\s])\*\*/gm,rep:"<strong>$1</strong>"},{re:/__([^\s])__/gm,rep:"<strong>$1</strong>"},{re:/\*([^\s])\*/gm,rep:"<em>$1</em>"},{re:/_([^\s])_/gm,rep:"<em>$1</em>"},{re:/\*\*([^\s])(.*?)([^\s])\*\*/gm,rep:"<strong>$1$2$3</strong>"},{re:/__([^\s])(.*?)([^\s])__/gm,rep:"<strong>$1$2$3</strong>"},{re:/\*([^\s])(.*?)([^\s])\*/gm,rep:"<em>$1$2$3</em>"},{re:/_([^\s])(.*?)([^\s])_/gm,rep:"<em>$1$2$3</em>"}],markdownEscReps=[{re:/\\([\\`*_{}[\]()#+.!-])/g,rep:function(match,chr){return encodeCharToEntity(chr)}}],securityReps=[{re:"\0",rep:"�"}],htmlEscIgnoringBrReps=[{re:/&(?![\w#]+?;)/gm,rep:"&amp;"},{re:/<(?!\/?(?:br|sub|sup)>)/gim,rep:"&lt;"}],htmlEscAllReps=[{re:/&(?![\w#]+?;)/gm,rep:"&amp;"},{re:/</gim,rep:"&lt;"}],htmlCleanUpReps=[{re:/^\s*$/gm,rep:""},{re:/<(?:p|div)>\s*?<\/(?:p|div)>/gim,rep:""}];function processReplacements(data,replacements){return data?(replacements.forEach((function(sub){data=data.replaceAll(sub.re,sub.rep)})),data):data}function reAllLinesStartWith(reStart,options){var _options$linePrefix,_options$lineSuffix,reBlockSearchRe=new RegExp("(?:^|\\n)".concat(reStart,"(?:.|\\n)*?(?:(\\n(?!").concat(reStart,"))|$)"),"g"),lineReplacementRe=new RegExp("^".concat(reStart,"([ \\t]*.*)$"),"gm"),lineReplacement="".concat(null!==(_options$linePrefix=null==options?void 0:options.linePrefix)&&void 0!==_options$linePrefix?_options$linePrefix:"","$1").concat(null!==(_options$lineSuffix=null==options?void 0:options.lineSuffix)&&void 0!==_options$lineSuffix?_options$lineSuffix:"");return{re:reBlockSearchRe,rep:function(match){var _options$blockPrefix,_options$blockSuffix,blockContents=match.replaceAll(lineReplacementRe,lineReplacement);return options.trimContents&&(blockContents=blockContents.replace(/^[\n\r]*/,"").trimEnd()),options.useWarden&&(blockContents=parsingWarden.protect(blockContents)),"\n\n".concat(null!==(_options$blockPrefix=null==options?void 0:options.blockPrefix)&&void 0!==_options$blockPrefix?_options$blockPrefix:"").concat(blockContents).concat(null!==(_options$blockSuffix=null==options?void 0:options.blockSuffix)&&void 0!==_options$blockSuffix?_options$blockSuffix:"","\n\n")}}}function encodeCharToEntity(chr){return"&#".concat(chr.charCodeAt(0).toString(),";")}function parseMarkdown(data,options){parsingWarden.clear();var result=data.replaceAll(/\r/g,"");return result=function(data){for(var key in attributionPatterns){var pattern=attributionPatterns[key];data=data.replace(pattern.re,pattern.rep)}return data}(result),result=processReplacements(result,securityReps),null!=options&&options.pre&&(result=processReplacements(result,options.pre)),result=processReplacements(result=parseMathMl(result,parsingWarden),htmlEscIgnoringBrReps),result=processReplacements(result,markdownEscReps),result=processReplacements(result,blockReps),result=processReplacements(result,paragraphReps),result=processReplacements(result,spanReps),result=processReplacements(result,htmlCleanUpReps),null!=options&&options.post&&(result=processReplacements(result,options.post)),parsingWarden.reinstate(result)}function parseMarkdownSpanOnly(data){parsingWarden.clear();var result=data.replaceAll(/\r/g,"");return result=processReplacements(result,securityReps),result=processReplacements(result=parseMathMl(result,parsingWarden),htmlEscIgnoringBrReps),result=processReplacements(result,markdownEscReps),result=processReplacements(result,spanReps),result=processReplacements(result,htmlCleanUpReps),parsingWarden.reinstate(result)}function escapeHtml(data){return data=processReplacements(data,securityReps),processReplacements(data,htmlEscAllReps)}function getPlainTextFromHtml(html){var plain=html.replace(/<[^>]*>/g,"").replace(/\s+/g," ");return plain.replaceAll(/&#([0-9]{1,4});/g,(function(match,value){return String.fromCharCode(parseInt(value))+"­"})).replace(/&lt;/gi,"<").replace(/&gt;/gi,">").replace(/&nbsp;/gi," ").replace(/&amp;/gi,"&").replace(/</gi,"<­").replace(/&/gi,"&­")}var activeTranslations=null,fallbackTranslations=null;function setActiveTranslations(translations){!function(translations){for(var key in translations)translations[key]=escapeHtml(translations[key])}(translations),activeTranslations&&(fallbackTranslations=activeTranslations),activeTranslations=translations}function i18n(strings){var keyMatch=strings[0].match(/(\w+?)::(.*)/),keyword="",result=[];keyMatch?(keyword=keyMatch[1],result.push(keyMatch[2])):result.push(strings[0]);var output,template=activeTranslations?activeTranslations[keyword]:null;template||(template=fallbackTranslations?fallbackTranslations[keyword]:null);for(var _len=arguments.length,values=new Array(_len>1?_len-1:0),_key=1;_key<_len;_key++)values[_key-1]=arguments[_key];return template?output=function(template,values){var defaultIndex=0;return template.replace(/\${(.*?)}/g,(function(match,index){return index=parseInt(index),isNaN(index)&&(index=defaultIndex++),index<values.length?values[index]:(console.error("Cannot find {".concat(index,'} for "').concat(template,'"')),"${?}")}))}(template,values):(values.forEach((function(value,i){result.push(value),result.push(strings[i+1])})),output=result.join("")),output}function extractLanguageSubTags(languageTag){var language="",extlang="",script="",region="",matches=(languageTag=languageTag.toLowerCase()).match(/^([a-z]{2,3})(-[a-z]{3}(?:-[a-z]{3}){0,2})?(-[a-z]{4})?(-(?:[a-z]{2}|[0-9]{3}))?([-].{5,})?$/);return matches&&(language=matches[1],extlang=matches[2]?matches[2].substring(1):"",script=matches[3]?matches[3].substring(1):"",region=matches[4]?matches[4].substring(1):""),{language:language,extlang:extlang,script:script,region:region}}function RGB(red,green,blue){this.red=red,this.green=green,this.blue=blue}function HSL(hue,saturation,luminance){this.hue=hue,this.saturation=saturation,this.luminance=luminance}function relativeLuminance(rgbColor){var RsRGB=rgbColor.red/255,GsRGB=rgbColor.green/255,BsRGB=rgbColor.blue/255;return 100*(.2126*(RsRGB<=.03928?RsRGB/12.92:Math.pow((RsRGB+.055)/1.055,2.4))+.7152*(GsRGB<=.03928?GsRGB/12.92:Math.pow((GsRGB+.055)/1.055,2.4))+.0722*(BsRGB<=.03928?BsRGB/12.92:Math.pow((BsRGB+.055)/1.055,2.4)))}function isDark(rgbColor){return relativeLuminance(rgbColor)<50}function rgbToHsl(rgbValue){var RsRGB=rgbValue.red/255,GsRGB=rgbValue.green/255,BsRGB=rgbValue.blue/255,minChannelValue=Math.min(RsRGB,GsRGB,BsRGB),maxChannelValue=Math.max(RsRGB,GsRGB,BsRGB),channelRange=maxChannelValue-minChannelValue,luminance=(minChannelValue+maxChannelValue)/2;if(Math.abs(channelRange)<.001)return{hue:0,saturation:0,luminance:Math.round(100*luminance)};var saturation=0;saturation=luminance<=.5?channelRange/(minChannelValue+maxChannelValue):channelRange/(2-maxChannelValue-minChannelValue);var hue=0;return 0!==channelRange&&(hue=Math.abs(maxChannelValue-RsRGB)<.001?(GsRGB-BsRGB)/channelRange:Math.abs(maxChannelValue-GsRGB)<.001?2+(BsRGB-RsRGB)/channelRange:4+(RsRGB-GsRGB)/channelRange),(hue*=60)<0&&(hue+=360),{hue:Math.round(hue),saturation:Math.round(100*saturation),luminance:Math.round(100*luminance)}}function hslToRgb(hslValue){var S=hslValue.saturation/100,L=hslValue.luminance/100,C=(1-Math.abs(2*L-1))*S,Htick=hslValue.hue/60,X=C*(1-Math.abs(Htick%2-1)),RGBtick={};RGBtick=0<=Htick&&Htick<1?{red:C,green:X,blue:0}:Htick<2?{red:X,green:C,blue:0}:Htick<3?{red:0,green:C,blue:X}:Htick<4?{red:0,green:X,blue:C}:Htick<5?{red:X,green:0,blue:C}:{red:C,green:0,blue:X};var m=L-C/2;return new RGB(Math.round(255*(RGBtick.red+m)),Math.round(255*(RGBtick.green+m)),Math.round(255*(RGBtick.blue+m)))}function getDarker(rgbColor,delta){var hslColor=rgbToHsl(rgbColor);return hslColor.luminance-=delta,hslColor.luminance=Math.max(hslColor.luminance,0),hslToRgb(hslColor)}function getLighter(rgbColor,delta){var hslColor=rgbToHsl(rgbColor);return hslColor.luminance+=delta,hslColor.luminance=Math.min(hslColor.luminance,100),hslToRgb(hslColor)}function shiftHue(rgbValue,degrees){var hsl=rgbToHsl(rgbValue);return hsl.hue,hsl.hue+=degrees,hsl.hue%=360,hsl.hue<0&&(hsl.hue+=360),hslToRgb(hsl)}var root=document.querySelector(":root");function setProperty(propertyName,propertyValue){root.style.setProperty(propertyName,propertyValue)}function PaletteEntry(base,contrast,highlight){this.base=base,this.contrast=contrast,this.highlight=highlight}function Palette(config){this.primary=config.primary,this.secondary=config.secondary,this.tertiary=config.tertiary,this.background=config.background,this.window=config.window,this.error=config.error}function getPaletteEntry(rgbColor){var highlight;highlight=isDark(rgbColor)?getLighter(rgbColor,10):getDarker(rgbColor,10);var contrastColor=function(rgbColor){return isDark(rgbColor)?{red:255,green:255,blue:255}:{red:0,green:0,blue:0}}(rgbColor);return new PaletteEntry(rgbColor=function(rgbColor,rgbColorReference,minContrast){for(var rgbColorB,contrast,refIsDark=isDark(rgbColorReference),loopLimit=Math.floor(20);loopLimit--&&(rgbColorB=rgbColorReference,contrast=void 0,((contrast=(relativeLuminance(rgbColor)/100+.05)/(relativeLuminance(rgbColorB)/100+.05))<1?1/contrast:contrast)<minContrast);)rgbColor=refIsDark?getLighter(rgbColor,5):getDarker(rgbColor,5);return rgbColor}(rgbColor,contrastColor,7.5),contrastColor,highlight)}function setCssFromPaletteEntry(key,paletteEntry){for(var subkey in paletteEntry)relativeLuminance(paletteEntry.base),relativeLuminance(paletteEntry.contrast),setProperty("--".concat(key,"-").concat(subkey),(rgbColor=paletteEntry[subkey],"rgb(".concat(rgbColor.red,", ").concat(rgbColor.green,", ").concat(rgbColor.blue,")")));var rgbColor}function fetchJson(url){return fetchFile(url,"json")}function fetchFile(url,responseType){return console.debug("Fetch ".concat(url)),fetch(url).then((function(response){return response.ok?"json"===responseType.toLocaleLowerCase()?response.json():response.text():Promise.reject(new Error("".concat(response.status,": ").concat(response.statusText,"; ").concat(url)))}))}var _info=new WeakMap,_content=new WeakMap,CachedLesson=function(){function CachedLesson(info,content){_classCallCheck(this,CachedLesson),_classPrivateFieldInitSpec(this,_info,void 0),_classPrivateFieldInitSpec(this,_content,void 0),_classPrivateFieldSet(_info,this,info),_classPrivateFieldSet(_content,this,content)}return _createClass(CachedLesson,[{key:"content",get:function(){return _classPrivateFieldGet(_content,this)},set:function(content){_classPrivateFieldSet(_content,this,content)}},{key:"info",get:function(){return _classPrivateFieldGet(_info,this)}}],[{key:"clone",value:function(other){var cloned=new CachedLesson(null);return _classPrivateFieldSet(_info,cloned,_objectSpread({},other.info)),_classPrivateFieldSet(_content,cloned,other.content),cloned}}])}(),_element=new WeakMap,_listeningTargets=new WeakMap,_managedChildren=new WeakMap,_elementRemovable=new WeakMap,ManagedElement=function(){function ManagedElement(tagOrElement,className){_classCallCheck(this,ManagedElement),_classPrivateFieldInitSpec(this,_element,void 0),_classPrivateFieldInitSpec(this,_listeningTargets,void 0),_classPrivateFieldInitSpec(this,_managedChildren,void 0),_classPrivateFieldInitSpec(this,_elementRemovable,void 0),tagOrElement instanceof Element?(_classPrivateFieldSet(_element,this,tagOrElement),_classPrivateFieldSet(_elementRemovable,this,!1)):(_classPrivateFieldSet(_element,this,document.createElement(tagOrElement)),_classPrivateFieldSet(_elementRemovable,this,!0)),className&&(_classPrivateFieldGet(_element,this).className=className),_classPrivateFieldSet(_listeningTargets,this,[]),_classPrivateFieldSet(_managedChildren,this,[])}return _createClass(ManagedElement,[{key:"element",get:function(){return _classPrivateFieldGet(_element,this)}},{key:"$",get:function(){return _classPrivateFieldGet(_element,this)}},{key:"disabled",get:function(){return _classPrivateFieldGet(_element,this).disabled},set:function(value){_classPrivateFieldGet(_element,this).disabled=value}},{key:"id",get:function(){return _classPrivateFieldGet(_element,this).id},set:function(value){_classPrivateFieldGet(_element,this).id=value}},{key:"managedChildren",get:function(){return _classPrivateFieldGet(_managedChildren,this)}},{key:"classList",get:function(){return _classPrivateFieldGet(_element,this).classList}},{key:"className",get:function(){return _classPrivateFieldGet(_element,this).className},set:function(value){_classPrivateFieldGet(_element,this).className=value}},{key:"checked",get:function(){return _classPrivateFieldGet(_element,this).checked},set:function(state){_classPrivateFieldGet(_element,this).checked=state}},{key:"children",get:function(){return _classPrivateFieldGet(_element,this).children}},{key:"innerHTML",get:function(){return _classPrivateFieldGet(_element,this).innerHTML},set:function(data){_classPrivateFieldGet(_element,this).innerHTML=data}},{key:"lastElementChild",get:function(){return _classPrivateFieldGet(_element,this).lastElementChild}},{key:"offsetHeight",get:function(){return _classPrivateFieldGet(_element,this).offsetHeight}},{key:"offsetWidth",get:function(){return _classPrivateFieldGet(_element,this).offsetWidth}},{key:"parentElement",get:function(){return _classPrivateFieldGet(_element,this).parentElement}},{key:"style",get:function(){return _classPrivateFieldGet(_element,this).style}},{key:"tagName",get:function(){return _classPrivateFieldGet(_element,this).tagName}},{key:"textContent",get:function(){return _classPrivateFieldGet(_element,this).textContent},set:function(data){_classPrivateFieldGet(_element,this).textContent=data}},{key:"value",get:function(){return _classPrivateFieldGet(_element,this).value},set:function(data){_classPrivateFieldGet(_element,this).value=data}},{key:"appendChild",value:function(managedElement){return _classPrivateFieldGet(_element,this).appendChild(managedElement.element),_classPrivateFieldGet(_managedChildren,this).push(managedElement),managedElement}},{key:"appendChildTo",value:function(managedElement,parent){var _managedElement$eleme;parent.appendChild(null!==(_managedElement$eleme=managedElement.element)&&void 0!==_managedElement$eleme?_managedElement$eleme:managedElement),_classPrivateFieldGet(_managedChildren,this).push(managedElement)}},{key:"appendTo",value:function(parent){parent.appendChild(_classPrivateFieldGet(_element,this))}},{key:"createAndAppendChild",value:function(tagName,cssClass,html){var managedElement=new ManagedElement(tagName);return cssClass&&managedElement.classList.add(cssClass),html&&(managedElement.innerHTML=html),this.appendChild(managedElement),managedElement}},{key:"dispatchEvent",value:function(event){return _classPrivateFieldGet(_element,this).dispatchEvent(event)}},{key:"fadeOut",value:function(){_classPrivateFieldGet(_element,this).classList.remove("fade-in"),_classPrivateFieldGet(_element,this).classList.add("fade-out")}},{key:"fadeIn",value:function(){_classPrivateFieldGet(_element,this).classList.remove("fade-out"),_classPrivateFieldGet(_element,this).classList.add("fade-in")}},{key:"focus",value:function(){_classPrivateFieldGet(_element,this).focus()}},{key:"getBoundingClientRect",value:function(){return _classPrivateFieldGet(_element,this).getBoundingClientRect()}},{key:"handleEvent",value:function(event){var _this$handlerName;console.debug("Event ".concat(event.type," fired on <").concat(event.currentTarget.tagName,">: class ").concat(event.target.className,"."));var handlerName="handle"+event.type.charAt(0).toUpperCase()+event.type.substring(1)+"Event",eventId=event.currentTarget.getAttribute("data-event-id");null===(_this$handlerName=this[handlerName])||void 0===_this$handlerName||_this$handlerName.call(this,event,eventId)}},{key:"hide",value:function(){_classPrivateFieldGet(_element,this).style.display="none"}},{key:"insertChildAtTop",value:function(managedElement){var _managedElement$eleme2;return _classPrivateFieldGet(_element,this).insertBefore(null!==(_managedElement$eleme2=managedElement.element)&&void 0!==_managedElement$eleme2?_managedElement$eleme2:managedElement,_classPrivateFieldGet(_element,this).firstChild),_classPrivateFieldGet(_managedChildren,this).push(managedElement),managedElement}},{key:"listenToOwnEvent",value:function(eventType,eventIdOrHandler,options){this.listenToEventOn(eventType,this,eventIdOrHandler,options)}},{key:"listenToEventOn",value:function(eventType,target,eventIdOrHandler,options){if(!(target instanceof ManagedElement))throw new Error("Expect ManagedElement");_classPrivateFieldGet(_listeningTargets,this).push({managedElement:target,eventType:eventType,options:options}),eventIdOrHandler instanceof Function?target.$.addEventListener(eventType,eventIdOrHandler,options):(null!=eventIdOrHandler&&target.setAttribute("data-event-id",eventIdOrHandler),target.$.addEventListener(eventType,this,options))}},{key:"querySelector",value:function(selectors){return _classPrivateFieldGet(_element,this).querySelector(selectors)}},{key:"querySelectorAll",value:function(selectors){return _classPrivateFieldGet(_element,this).querySelectorAll(selectors)}},{key:"remove",value:function(){this.removeListeners(),this.removeChildren(),_classPrivateFieldGet(_elementRemovable,this)&&_classPrivateFieldGet(_element,this).remove()}},{key:"removeChildren",value:function(){for(_classPrivateFieldGet(_managedChildren,this).forEach((function(child){child.remove()})),_classPrivateFieldSet(_managedChildren,this,[]);_classPrivateFieldGet(_element,this).firstChild;)_classPrivateFieldGet(_element,this).removeChild(_classPrivateFieldGet(_element,this).lastChild)}},{key:"removeListeners",value:function(){var _this2=this;_classPrivateFieldGet(_listeningTargets,this).forEach((function(target){target.managedElement.element.removeEventListener(target.eventType,_this2,target.options)})),_classPrivateFieldGet(_managedChildren,this).forEach((function(child){child.removeListeners()})),_classPrivateFieldSet(_listeningTargets,this,[])}},{key:"setSafeAttribute",value:function(name,value){_classPrivateFieldGet(_element,this).setAttribute(name,ManagedElement.encodeString(value))}},{key:"setAttribute",value:function(name,value){return _classPrivateFieldGet(_element,this).setAttribute(name,value)}},{key:"show",value:function(){_classPrivateFieldGet(_element,this).style.display="unset"}},{key:"getSafeAttribute",value:function(name){return ManagedElement.decodeString(_classPrivateFieldGet(_element,this).getAttribute(name))}},{key:"setAttributes",value:function(attributes){for(var key in attributes){var value=attributes[key];null!=value&&null!=value&&""!==value&&_classPrivateFieldGet(_element,this).setAttribute(key,value)}}}],[{key:"getElement",value:function(item){return item instanceof ManagedElement?item.element:item}},{key:"$",value:function(item){return item instanceof ManagedElement?item.element:item}},{key:"decodeString",value:function(value){return base64ToString(value)}},{key:"encodeString",value:function(value){return stringToBase64(value)}},{key:"getSafeAttribute",value:function(element,name){return ManagedElement.decodeString(element.getAttribute(name))}}])}(),HTML_SEMANTIC_ROLES={A:"link",BUTTON:"button"},_cache=new WeakMap,_hideText=new WeakMap,_IconGenerator_brand=new WeakSet,IconGenerator=function(){return _createClass((function IconGenerator(){_classCallCheck(this,IconGenerator),_classPrivateMethodInitSpec(this,_IconGenerator_brand),_classPrivateFieldInitSpec(this,_cache,new Map),_classPrivateFieldInitSpec(this,_hideText,void 0)}),[{key:"hideText",get:function(){return _classPrivateFieldGet(_hideText,this)},set:function(value){_classPrivateFieldSet(_hideText,this,value)}},{key:"addLesson",get:function(){return{content:_assertClassBrand(_IconGenerator_brand,this,_getIconHtml).call(this,"--icon-add-lesson-html"),accessibleName:i18n(_templateObject||(_templateObject=_taggedTemplateLiteral(["d6e44bc735e33192ee2ddce4af2f2be6::"])))}}},{key:"back",get:function(){return{content:_assertClassBrand(_IconGenerator_brand,this,_getIconHtml).call(this,"--icon-back-nav-html"),accessibleName:i18n(_templateObject2||(_templateObject2=_taggedTemplateLiteral(["0557fa923dcee4d0f86b1409f5c2167f::"])))}}},{key:"cancel",get:function(){return{content:_assertClassBrand(_IconGenerator_brand,this,_getIconHtml).call(this,"--icon-cancel-html"),accessibleName:i18n(_templateObject3||(_templateObject3=_taggedTemplateLiteral(["ea4788705e6873b424c65e91c2846b19::"])))}}},{key:"closeEditor",get:function(){return{content:_assertClassBrand(_IconGenerator_brand,this,_getIconHtml).call(this,"--icon-close-editor-html"),accessibleName:i18n(_templateObject4||(_templateObject4=_taggedTemplateLiteral(["218ed7e6bf7ff30555652c87feff7cd7::"])))}}},{key:"closeMenu",get:function(){return{content:_assertClassBrand(_IconGenerator_brand,this,_getIconHtml).call(this,"--icon-close-menu-html"),accessibleName:i18n(_templateObject5||(_templateObject5=_taggedTemplateLiteral(["68f18f6b55f955ad05e4a174341bf3f1::"])))}}},{key:"delete",get:function(){return{content:_assertClassBrand(_IconGenerator_brand,this,_getIconHtml).call(this,"--icon-delete-html"),accessibleName:i18n(_templateObject6||(_templateObject6=_taggedTemplateLiteral(["f2a6c498fb90ee345d997f888fce3b18::"])))}}},{key:"edit",get:function(){return{content:_assertClassBrand(_IconGenerator_brand,this,_getIconHtml).call(this,"--icon-edit-html"),accessibleName:i18n(_templateObject7||(_templateObject7=_taggedTemplateLiteral(["7dce122004969d56ae2e0245cb754d35::"])))}}},{key:"email",get:function(){return{content:_assertClassBrand(_IconGenerator_brand,this,_getIconHtml).call(this,"--icon-email-html"),accessibleName:i18n(_templateObject8||(_templateObject8=_taggedTemplateLiteral(["ce8ae9da5b7cd6c3df2929543a9af92d::"])))}}},{key:"error",get:function(){return{content:_assertClassBrand(_IconGenerator_brand,this,_getIconHtml).call(this,"--icon-error-html"),accessibleName:i18n(_templateObject9||(_templateObject9=_taggedTemplateLiteral(["64d2cc43035360eddf790efbef5ddb30::"])))}}},{key:"exit",get:function(){return{content:_assertClassBrand(_IconGenerator_brand,this,_getIconHtml).call(this,"--icon-exit-html"),accessibleName:i18n(_templateObject10||(_templateObject10=_taggedTemplateLiteral(["cfce38c3725a96fb69d437d1f6af351c::"])))}}},{key:"export",get:function(){return{content:_assertClassBrand(_IconGenerator_brand,this,_getIconHtml).call(this,"--icon-export-html"),accessibleName:i18n(_templateObject11||(_templateObject11=_taggedTemplateLiteral(["3a7ff7e7931df81408c4e1465364c699::"])))}}},{key:"exportAutoRun",get:function(){return{content:_assertClassBrand(_IconGenerator_brand,this,_getIconHtml).call(this,"--icon-export-autorun-html"),accessibleName:i18n(_templateObject12||(_templateObject12=_taggedTemplateLiteral(["65b03512ff197b6b8899ba755db630f9::"])))}}},{key:"fatal",get:function(){return{content:_assertClassBrand(_IconGenerator_brand,this,_getIconHtml).call(this,"--icon-fatal-html"),accessibleName:i18n(_templateObject13||(_templateObject13=_taggedTemplateLiteral(["64d2cc43035360eddf790efbef5ddb30::"])))}}},{key:"flag",get:function(){return{content:_assertClassBrand(_IconGenerator_brand,this,_getIconHtml).call(this,"--icon-flagged-html"),accessibleName:i18n(_templateObject14||(_templateObject14=_taggedTemplateLiteral(["c5836008c1649301e29351a55db8f65c::"])))}}},{key:"image",get:function(){return{content:_assertClassBrand(_IconGenerator_brand,this,_getIconHtml).call(this,"--icon-image-html"),accessibleName:i18n(_templateObject15||(_templateObject15=_taggedTemplateLiteral(["be53a0541a6d36f6ecb879fa2c584b08::"])))}}},{key:"imageInfo",get:function(){return{content:_assertClassBrand(_IconGenerator_brand,this,_getIconHtml).call(this,"--icon-image-info-html"),accessibleName:i18n(_templateObject16||(_templateObject16=_taggedTemplateLiteral(["d5aed5edc660d95bd24c074fb36974ec::"])))}}},{key:"hourglass",get:function(){return{content:_assertClassBrand(_IconGenerator_brand,this,_getIconHtml).call(this,"--icon-hourglass-html"),accessibleName:i18n(_templateObject17||(_templateObject17=_taggedTemplateLiteral(["07f484e89e3e82f48cb7cbebd115cbce::"])))}}},{key:"openFolder",get:function(){return{content:_assertClassBrand(_IconGenerator_brand,this,_getIconHtml).call(this,"--icon-open-folder-html"),accessibleName:i18n(_templateObject18||(_templateObject18=_taggedTemplateLiteral(["a6e75eb31dc77e8d077fb6f92909e191::"])))}}},{key:"fontSize",get:function(){return{content:_assertClassBrand(_IconGenerator_brand,this,_getIconHtml).call(this,"--icon-font-size-html"),accessibleName:i18n(_templateObject19||(_templateObject19=_taggedTemplateLiteral(["c4943062b634c56348c67fdebba808eb::"])))}}},{key:"forward",get:function(){return{content:_assertClassBrand(_IconGenerator_brand,this,_getIconHtml).call(this,"--icon-forward-nav-html"),accessibleName:i18n(_templateObject20||(_templateObject20=_taggedTemplateLiteral(["67d2f6740a8eaebf4d5c6f79be8da481::"])))}}},{key:"help",get:function(){return{content:_assertClassBrand(_IconGenerator_brand,this,_getIconHtml).call(this,"--icon-help-html"),accessibleName:i18n(_templateObject21||(_templateObject21=_taggedTemplateLiteral(["6a26f548831e6a8c26bfbbd9f6ec61e0::"])))}}},{key:"home",get:function(){return{content:_assertClassBrand(_IconGenerator_brand,this,_getIconHtml).call(this,"--icon-home-html"),accessibleName:i18n(_templateObject22||(_templateObject22=_taggedTemplateLiteral(["8cf04a9734132302f96da8e113e80ce5::"])))}}},{key:"import",get:function(){return{content:_assertClassBrand(_IconGenerator_brand,this,_getIconHtml).call(this,"--icon-import-html"),accessibleName:i18n(_templateObject23||(_templateObject23=_taggedTemplateLiteral(["28dd16bcceda4431550c96dfc257dd22::"])))}}},{key:"info",get:function(){return{content:_assertClassBrand(_IconGenerator_brand,this,_getIconHtml).call(this,"--icon-info-html"),accessibleName:i18n(_templateObject24||(_templateObject24=_taggedTemplateLiteral(["c5836008c1649301e29351a55db8f65c::"])))}}},{key:"selectLesson",get:function(){return{content:_assertClassBrand(_IconGenerator_brand,this,_getIconHtml).call(this,"--icon-lesson-html"),accessibleName:i18n(_templateObject25||(_templateObject25=_taggedTemplateLiteral(["666258634f2ea689eac1e01b184a3cea::"])))}}},{key:"library",get:function(){return{content:_assertClassBrand(_IconGenerator_brand,this,_getIconHtml).call(this,"--icon-library-html"),accessibleName:i18n(_templateObject26||(_templateObject26=_taggedTemplateLiteral(["d6e5c296474cad126efdfa515a47f1f8::"])))}}},{key:"load",get:function(){return{content:_assertClassBrand(_IconGenerator_brand,this,_getIconHtml).call(this,"--icon-load-html"),accessibleName:i18n(_templateObject27||(_templateObject27=_taggedTemplateLiteral(["74540c79e377bea903e1023a46df5574::"])))}}},{key:"nextProblem",get:function(){return{content:_assertClassBrand(_IconGenerator_brand,this,_getIconHtml).call(this,"--icon-next-problem-html"),accessibleName:i18n(_templateObject28||(_templateObject28=_taggedTemplateLiteral(["a0bfb8e59e6c13fc8d990781f77694fe::"])))}}},{key:"no",get:function(){return{content:_assertClassBrand(_IconGenerator_brand,this,_getIconHtml).call(this,"--icon-no-html"),accessibleName:i18n(_templateObject29||(_templateObject29=_taggedTemplateLiteral(["bafd7322c6e97d25b6299b5d6fe8920b::"])))}}},{key:"ok",get:function(){return{content:_assertClassBrand(_IconGenerator_brand,this,_getIconHtml).call(this,"--icon-ok-html"),accessibleName:i18n(_templateObject30||(_templateObject30=_taggedTemplateLiteral(["e0aa021e21dddbd6d8cecec71e9cf564::"])))}}},{key:"pause",get:function(){return{content:_assertClassBrand(_IconGenerator_brand,this,_getIconHtml).call(this,"--icon-pause-html"),accessibleName:i18n(_templateObject31||(_templateObject31=_taggedTemplateLiteral(["105b296a83f9c105355403f3332af50f::"])))}}},{key:"play",get:function(){return{content:_assertClassBrand(_IconGenerator_brand,this,_getIconHtml).call(this,"--icon-play-html"),accessibleName:i18n(_templateObject32||(_templateObject32=_taggedTemplateLiteral(["de3c731be5633838089a07179d301d7b::"])))}}},{key:"playLesson",get:function(){return{content:_assertClassBrand(_IconGenerator_brand,this,_getIconHtml).call(this,"--icon-play-html"),accessibleName:i18n(_templateObject33||(_templateObject33=_taggedTemplateLiteral(["afd061e2316f7ab6f934ef5b43f994b6::"])))}}},{key:"print",get:function(){return{content:_assertClassBrand(_IconGenerator_brand,this,_getIconHtml).call(this,"--icon-print-html"),accessibleName:i18n(_templateObject34||(_templateObject34=_taggedTemplateLiteral(["13dba24862cf9128167a59100e154c8d::"])))}}},{key:"printPreview",get:function(){return{content:_assertClassBrand(_IconGenerator_brand,this,_getIconHtml).call(this,"--icon-print-preview-html"),accessibleName:i18n(_templateObject35||(_templateObject35=_taggedTemplateLiteral(["d729a3a8d63daef5c5fb1739207f2377::"])))}}},{key:"privacy",get:function(){return{content:_assertClassBrand(_IconGenerator_brand,this,_getIconHtml).call(this,"--icon-privacy-html"),accessibleName:i18n(_templateObject36||(_templateObject36=_taggedTemplateLiteral(["c5f29bb36f9158d2e00f5d4dc213a0ff::"])))}}},{key:"question",get:function(){return{content:_assertClassBrand(_IconGenerator_brand,this,_getIconHtml).call(this,"--icon-question-html"),accessibleName:i18n(_templateObject37||(_templateObject37=_taggedTemplateLiteral(["c5836008c1649301e29351a55db8f65c::"])))}}},{key:"repeatLesson",get:function(){return{content:_assertClassBrand(_IconGenerator_brand,this,_getIconHtml).call(this,"--icon-repeat-lesson-html"),accessibleName:i18n(_templateObject38||(_templateObject38=_taggedTemplateLiteral(["87a0a633db4ae5246df7ebf3e417a805::"])))}}},{key:"resetToFactory",get:function(){return{content:_assertClassBrand(_IconGenerator_brand,this,_getIconHtml).call(this,"--icon-reset-to-factory-html"),accessibleName:i18n(_templateObject39||(_templateObject39=_taggedTemplateLiteral(["5dcd7aaf263cdf5f7d1de6aa2264e29f::"])))}}},{key:"save",get:function(){return{content:_assertClassBrand(_IconGenerator_brand,this,_getIconHtml).call(this,"--icon-save-html"),accessibleName:i18n(_templateObject40||(_templateObject40=_taggedTemplateLiteral(["c9cc8cce247e49bae79f15173ce97354::"])))}}},{key:"settings",get:function(){return{content:_assertClassBrand(_IconGenerator_brand,this,_getIconHtml).call(this,"--icon-settings-html"),accessibleName:i18n(_templateObject41||(_templateObject41=_taggedTemplateLiteral(["f4f70727dc34561dfde1a3c529b6205c::"])))}}},{key:"skip",get:function(){return{content:_assertClassBrand(_IconGenerator_brand,this,_getIconHtml).call(this,"--icon-skip-html"),accessibleName:i18n(_templateObject42||(_templateObject42=_taggedTemplateLiteral(["72ef2b9b6965d078e3c7f95487a82d1c::"])))}}},{key:"submitAnswer",get:function(){return{content:_assertClassBrand(_IconGenerator_brand,this,_getIconHtml).call(this,"--icon-submit-answer-html"),accessibleName:i18n(_templateObject43||(_templateObject43=_taggedTemplateLiteral(["4e095ee5de137300bfa0042a6b442b0e::"])))}}},{key:"openMenu",get:function(){return{content:_assertClassBrand(_IconGenerator_brand,this,_getIconHtml).call(this,"--icon-open-menu-html"),accessibleName:i18n(_templateObject44||(_templateObject44=_taggedTemplateLiteral(["64d2cc43035360eddf790efbef5ddb30::"])))}}},{key:"vimeo",get:function(){return{content:_assertClassBrand(_IconGenerator_brand,this,_getIconHtml).call(this,"--icon-vimeo-html"),accessibleName:i18n(_templateObject45||(_templateObject45=_taggedTemplateLiteral(["74a8353a68978f6d4c3076113c032973::"])))}}},{key:"warning",get:function(){return{content:_assertClassBrand(_IconGenerator_brand,this,_getIconHtml).call(this,"--icon-warning-html"),accessibleName:i18n(_templateObject46||(_templateObject46=_taggedTemplateLiteral(["64d2cc43035360eddf790efbef5ddb30::"])))}}},{key:"webshare",get:function(){return{content:_assertClassBrand(_IconGenerator_brand,this,_getIconHtml).call(this,"--icon-webshare-html"),accessibleName:i18n(_templateObject47||(_templateObject47=_taggedTemplateLiteral(["5a95a425f74314a96f13a2f136992178::"])))}}},{key:"webshareCertificate",get:function(){return{content:_assertClassBrand(_IconGenerator_brand,this,_getIconHtml).call(this,"--icon-webshare-certificate-html"),accessibleName:i18n(_templateObject48||(_templateObject48=_taggedTemplateLiteral(["a62912ed921dd0ca71b134c7dfd5a094::"])))}}},{key:"webshareAutorun",get:function(){return{content:_assertClassBrand(_IconGenerator_brand,this,_getIconHtml).call(this,"--icon-webshare-autorun-html"),accessibleName:i18n(_templateObject49||(_templateObject49=_taggedTemplateLiteral(["e3645e6e8f00b30125af6cd6838a9921::"])))}}},{key:"yes",get:function(){return{content:_assertClassBrand(_IconGenerator_brand,this,_getIconHtml).call(this,"--icon-yes-html"),accessibleName:i18n(_templateObject50||(_templateObject50=_taggedTemplateLiteral(["93cba07454f06a4a960172bbd6e2a435::"])))}}},{key:"youtube",get:function(){return{content:_assertClassBrand(_IconGenerator_brand,this,_getIconHtml).call(this,"--icon-youtube-html"),accessibleName:i18n(_templateObject51||(_templateObject51=_taggedTemplateLiteral(["789a34726ee00e1c6c8f259509ad832f::"])))}}},{key:"semanticsAddressRole",value:function(element,role){return!role||HTML_SEMANTIC_ROLES[element.tagName][element.tagName]==role}},{key:"applyIconToElement",value:function(icon,item){var _options$hideText,_options$overrideText,_options$role,options=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},hideText=null!==(_options$hideText=options.hideText)&&void 0!==_options$hideText?_options$hideText:_classPrivateFieldGet(_hideText,this),label=null!==(_options$overrideText=options.overrideText)&&void 0!==_options$overrideText?_options$overrideText:icon.accessibleName,element=ManagedElement.getElement(item),role=null===(_options$role=options.role)||void 0===_options$role?void 0:_options$role.toLowerCase();element.innerHTML=icon.content,icon.accessibleName&&!hideText?element.innerHTML+="&nbsp;".concat(label):element.title=label,this.semanticsAddressRole(element,role)?options.hideText&&element.setAttribute("aria-label",label):(element.setAttribute("role",role),element.setAttribute("aria-label",label))}}])}();function _getIconHtml(key){var _classPrivateFieldGet12;if(!_classPrivateFieldGet(_cache,this).has(key)){var cssValue=getComputedStyle(document.documentElement).getPropertyValue(key);cssValue=cssValue.trim(),_classPrivateFieldGet(_cache,this).set(key,cssValue.substring(1,cssValue.length-1).replace(/\\"/g,'"'))}return null!==(_classPrivateFieldGet12=_classPrivateFieldGet(_cache,this).get(key))&&void 0!==_classPrivateFieldGet12?_classPrivateFieldGet12:"!?"}var icons=new IconGenerator,_focusOnStage=new WeakMap,FocusManager=function(){return _createClass((function FocusManager(){var _this3=this;_classCallCheck(this,FocusManager),_classPrivateFieldInitSpec(this,_focusOnStage,!1),window.addEventListener("focus",(function(event){console.debug("Window has focus. Restore focus to active element. Active element ".concat(document.activeElement.tagName," ").concat(document.activeElement.className),document.activeElement,event.relatedTarget),document.activeElement!==document.body?(console.debug("Set focus to active element"),document.activeElement.focus()):_this3.findBestFocus()}))}),[{key:"focusOnStage",set:function(value){_classPrivateFieldSet(_focusOnStage,this,value)}},{key:"focusWithin",value:function(){var _containingElement$el,_step3,containingElement=arguments.length>0&&void 0!==arguments[0]?arguments[0]:document.body,element=null!==(_containingElement$el=containingElement.element)&&void 0!==_containingElement$el?_containingElement$el:containingElement,_iterator3=_createForOfIteratorHelper(element.querySelectorAll("button,select,input,.selectable").values());try{for(_iterator3.s();!(_step3=_iterator3.n()).done;){var candidate=_step3.value;if("none"!==candidate.style.display&&"hidden"!==candidate.style.visibility)return candidate.focus(),!0}}catch(err){_iterator3.e(err)}finally{_iterator3.f()}return console.debug("Couldn't find anything to focus on within ".concat(null==element?void 0:element.tagName,":").concat(null==element?void 0:element.className)),!1}},{key:"focusWithinElements",value:function(elements){var _step4,_iterator4=_createForOfIteratorHelper(elements);try{for(_iterator4.s();!(_step4=_iterator4.n()).done;){var element=_step4.value;if(this.focusWithin(element))return!0}}catch(err){_iterator4.e(err)}finally{_iterator4.f()}return!1}},{key:"findBestFocus",value:function(){var element=document.querySelector(".selectable.always-on-top");if(element)element.focus();else if(element=document.querySelector(".modal"))this.focusWithin(element);else{var candidates=[];_classPrivateFieldGet(_focusOnStage,this)&&candidates.push(document.getElementById("stage")),candidates.push(document.getElementById("footer")),this.focusWithinElements(candidates)}}},{key:"setFocus",value:function(element){return element.focus(),document.activeElement===element}}])}(),focusManager=new FocusManager,_Toast_brand=new WeakSet,Toast=function(_ManagedElement2){function Toast(message,rawHtml){var _this4;_classCallCheck(this,Toast),_classPrivateMethodInitSpec(_this4=_callSuper(this,Toast,["div","utils-toast"]),_Toast_brand),_this4.classList.add("selectable","always-on-top"),_this4.setAttributes({"aria-role":"alert",tabindex:"0"});var content=new ManagedElement("div","container"),icon=new ManagedElement("div");return icons.applyIconToElement(icons.closeMenu,icon.element,{hideText:!0}),_this4.appendChild(content),_this4.appendChild(icon),rawHtml?content.innerHTML=message:content.textContent=message,_this4.listenToOwnEvent("click",""),_this4.listenToOwnEvent("keydown",""),_this4}return _inherits(Toast,_ManagedElement2),_createClass(Toast,[{key:"handleClickEvent",value:function(eventIgnored){_assertClassBrand(_Toast_brand,this,_dismiss).call(this)}},{key:"handleKeydownEvent",value:function(event){console.debug("Key ".concat(event.key)),"Escape"!==event.key&&" "!==event.key&&"Enter"!==event.key||_assertClassBrand(_Toast_brand,this,_dismiss).call(this)}}])}(ManagedElement);function _dismiss(){this.style.opacity=0,this.remove(),focusManager.findBestFocus()}function toast(message){var toast=new Toast(message,!0);document.body.appendChild(toast.element),setTimeout((function(){toast.style.top="calc(var(--vh, 1vh) * 50)",toast.focus()}))}var _storage=new WeakMap,_keyPrefix=new WeakMap,persistentData=new(function(){return _createClass((function DataStoreManager(storage){_classCallCheck(this,DataStoreManager),_classPrivateFieldInitSpec(this,_storage,void 0),_classPrivateFieldInitSpec(this,_keyPrefix,"app"),_classPrivateFieldSet(_storage,this,storage)}),[{key:"createStorageKey",value:function(key){return"".concat(_classPrivateFieldGet(_keyPrefix,this)).concat(key)}},{key:"getFromStorage",value:function(key,defaultValue){key=this.createStorageKey(key);var value=_classPrivateFieldGet(_storage,this).getItem(key);if(value)try{var parsedValue=JSON.parse(value);return null==parsedValue?defaultValue:parsedValue}catch(error){console.error(error)}return defaultValue}},{key:"saveToStorage",value:function(key,value){key=this.createStorageKey(key);try{_classPrivateFieldGet(_storage,this).setItem(key,JSON.stringify(value))}catch(error){toast(i18n(_templateObject52||(_templateObject52=_taggedTemplateLiteral(["e6b3e01861eefd23bb3caa9acd6d0c42::",""])),error.message))}}},{key:"removeFromStorage",value:function(key){key=this.createStorageKey(key),_classPrivateFieldGet(_storage,this).removeItem(key)}},{key:"setStorageKeyPrefix",value:function(prefix){_classPrivateFieldSet(_keyPrefix,this,prefix)}}])}())(localStorage),_key2=new WeakMap,_title=new WeakMap,_contentLoader=new WeakMap,_LocalLibrary_brand=new WeakSet,LocalLibrary=function(){function LocalLibrary(){var _this5=this;_classCallCheck(this,LocalLibrary),_classPrivateMethodInitSpec(this,_LocalLibrary_brand),_classPrivateFieldInitSpec(this,_key2,void 0),_classPrivateFieldInitSpec(this,_title,void 0),_classPrivateFieldInitSpec(this,_contentLoader,void 0),_classPrivateFieldSet(_key2,this,LocalLibrary.LOCAL_LIBRARY_KEY),_classPrivateFieldSet(_title,this,i18n(_templateObject53||(_templateObject53=_taggedTemplateLiteral(["72393b3cb338d9556ecd072e26907479::"])))),_classPrivateFieldSet(_contentLoader,this,(function(){return _assertClassBrand(_LocalLibrary_brand,_this5,_getLibraryContent).call(_this5)}))}return _createClass(LocalLibrary,[{key:"okayToDeleteSlot",get:function(){return _assertClassBrand(_LocalLibrary_brand,this,_getLessonKeys).call(this).length>LocalLibrary.NUMBER_OF_INITIAL_LESSONS}},{key:"key",get:function(){return _classPrivateFieldGet(_key2,this)}},{key:"info",get:function(){return{title:_classPrivateFieldGet(_title,this),contentLoader:_classPrivateFieldGet(_contentLoader,this)}}},{key:"saveLocalLessonAtIndex",value:function(index,localLesson){var keys=_assertClassBrand(_LocalLibrary_brand,this,_getLessonKeys).call(this);if(index<0||index>=keys.length)console.error("Attempt to store to index ".concat(index," ignored."));else{var key=keys[index];persistentData.saveToStorage(_assertClassBrand(_LocalLibrary_brand,this,_getStorageKeyForLessonKey).call(this,key),localLesson)}}},{key:"addNewLessonSlot",value:function(){var key=_assertClassBrand(_LocalLibrary_brand,this,_getFreeKey).call(this),keys=_assertClassBrand(_LocalLibrary_brand,this,_getLessonKeys).call(this);keys.push(key),_assertClassBrand(_LocalLibrary_brand,this,_saveLessonKeys).call(this,keys)}},{key:"deleteLessonAtIndex",value:function(index){var keys=_assertClassBrand(_LocalLibrary_brand,this,_getLessonKeys).call(this);if(this.okayToDeleteSlot){var key=keys[index];null!=key&&(console.debug("Removing lesson storage index: ".concat(index,"; key:").concat(key)),persistentData.removeFromStorage(_assertClassBrand(_LocalLibrary_brand,this,_getStorageKeyForLessonKey).call(this,key)),keys.splice(index,1),_assertClassBrand(_LocalLibrary_brand,this,_saveLessonKeys).call(this,keys))}else console.error("Attempt made to reduce number of local lessons to below ".concat(LocalLibrary.NUMBER_OF_INITIAL_LESSONS,". Ignored."))}}])}();function _getDefaultLessonKeys(){for(var indexes=[],index=0;index<_LocalLibrary.NUMBER_OF_INITIAL_LESSONS;index++)indexes.push(index);return indexes}function _getLessonKeys(){return persistentData.getFromStorage(_LocalLibrary.LOCAL_LIBRARY_INDEX_KEY,_assertClassBrand(_LocalLibrary_brand,this,_getDefaultLessonKeys).call(this))}function _saveLessonKeys(keys){persistentData.saveToStorage(_LocalLibrary.LOCAL_LIBRARY_INDEX_KEY,keys)}function _getLibraryContent(){var _this55=this,book={title:i18n(_templateObject125||(_templateObject125=_taggedTemplateLiteral(["c025e43a825a053fc668cef35cfa9ef5::"]))),location:"",chapters:[{title:i18n(_templateObject126||(_templateObject126=_taggedTemplateLiteral(["8fe1f2e455ff223c81a6441733982773::"]))),lessons:[]}]};return _assertClassBrand(_LocalLibrary_brand,this,_getLessonKeys).call(this).forEach((function(key){var localLesson=_assertClassBrand(_LocalLibrary_brand,_this55,_loadLocalLesson).call(_this55,key);book.chapters[0].lessons.push({title:localLesson.title,contentLoader:function(){return localLesson.content}})})),[book]}function _getStorageKeyForLessonKey(key){return"".concat(_LocalLibrary.LOCAL_LESSON_KEY_PREFIX).concat(key)}function _loadLocalLesson(key){var defaultLesson={title:i18n(_templateObject127||(_templateObject127=_taggedTemplateLiteral(["b1e0c142cc722f03dfad078c22369435::"]))),content:""};return persistentData.getFromStorage(_assertClassBrand(_LocalLibrary_brand,this,_getStorageKeyForLessonKey).call(this,key),defaultLesson)}function _getFreeKey(){var indexes=_assertClassBrand(_LocalLibrary_brand,this,_getLessonKeys).call(this);indexes.sort((function(a,b){return a-b}));for(var n=0;n<indexes.length-1;n++)if(indexes[n+1]-indexes[n]>1)return indexes[n]+1;return indexes[indexes.length-1]+1}_LocalLibrary=LocalLibrary,_defineProperty(LocalLibrary,"LOCAL_LIBRARY_KEY","LOCAL_LIBRARY"),_defineProperty(LocalLibrary,"LOCAL_LIBRARY_INDEX_KEY","LOCAL_LIBRARY_INDEX"),_defineProperty(LocalLibrary,"LOCAL_LESSON_KEY_PREFIX","LocalLesson_"),_defineProperty(LocalLibrary,"NUMBER_OF_INITIAL_LESSONS",4);var PREDEFINED_EMOJIS={GRINNING:"&#x1F600;",")":"@GRINNING","-)":"@GRINNING",SMILEY:"@GRINNING",SMILING:"@GRINNING",HAPPY:"@GRINNING",WORRIED:"&#x1F61F;",SAD:"@WORRIED",LAUGHING:"&#x1F602;",LAUGH:"@LAUGHING",CRYING:"&#x1F622;",TEAR:"@CRYING",FROWNING:"&#x1F641;","(":"@FROWNING","-(":"@FROWNING",NEUTRAL:"&#x1F610;",ANGRY:"&#x1F620;",GRUMPY:"@ANGRY",WINK:"&#x1F609;",WINKY:"@WINK",WINKING:"@WINK",WARNING:"&#x26A0;&#xFE0F;",ALERT:"@WARNING",ERROR:"@WARNING","WHITE-QUESTION-MARK":"&#x2754;"};function getErrorAttributeHtml(message){return'data-error="'.concat(stringToBase64(message),'"')}var SAFE_CLASSES=["big","bigger","biggest","massive","giant","column"];function getOrientationClass(requestedClass){return/^col(?:$|umn$)/i.test(requestedClass)?"align-column":/^(?:row|line)$/i.test(requestedClass)?"align-row":/^(?:left)$/i.test(requestedClass)?"align-left":""}function makeClassSafe(requestedClass){if(!requestedClass)return"";var index=SAFE_CLASSES.indexOf(requestedClass.toLowerCase());return index<0?"":SAFE_CLASSES[index]}var _missingWords=new WeakMap,_replacements=new WeakMap,TrackedReplacements=function(){return _createClass((function TrackedReplacements(metadata){_classCallCheck(this,TrackedReplacements),_classPrivateFieldInitSpec(this,_missingWords,void 0),_classPrivateFieldInitSpec(this,_replacements,void 0),_classPrivateFieldSet(_missingWords,this,[]);var tracker=this;_classPrivateFieldSet(_replacements,this,[{re:/\\>/g,rep:"&gt;"},{re:/ 123(?:>([a-zA_Z]*))?(\s|<\/p>)*$/gm,rep:function(match,orientation){var classes="missing-word ".concat(getOrientationClass(orientation)).trim();return _classPrivateFieldGet(_missingWords,tracker).push(null),' <span class="'.concat(classes,'" data-missing-word="').concat(ManagedElement.encodeString("..."),'"></span>')}},getItemReplacement("[.]{3}",(function(match,startChr,word,orientation){if(!word)return match;var classes="missing-word ".concat(getOrientationClass(orientation)).trim();return _classPrivateFieldGet(_missingWords,tracker).push(word),"".concat(startChr,'<span class="').concat(classes,'" data-missing-word="').concat(ManagedElement.encodeString(word),'"></span>')})),getItemReplacement("emoji:",(function(match,startChr,word,emojiClass){var requiredClasses="emoji";return(emojiClass=makeClassSafe(emojiClass))&&(requiredClasses="".concat(requiredClasses," ").concat(emojiClass)),"".concat(startChr,'<span class="').concat(requiredClasses,'">').concat(function(originalDefinition){if(!originalDefinition)return" ";var definition=originalDefinition.toUpperCase();if(definition.startsWith("U+"))return definition.replaceAll(/U\+([A-F0-9]+)/g,"&#x$1;");var _code,code=PREDEFINED_EMOJIS[definition];return null!==(_code=code)&&void 0!==_code&&_code.startsWith("@")&&(code=PREDEFINED_EMOJIS[code.substring(1)]),code||originalDefinition}(word),"</span>")})),getItemReplacement("meta:",(function(match,startChr,word){var metavalue=null==metadata?void 0:metadata.getValue(word);if(!metavalue){var errorAttribute=getErrorAttributeHtml(i18n(_templateObject54||(_templateObject54=_taggedTemplateLiteral(["20f59a970faebddc0d41220837f3b4ad::",""])),word));return"".concat(startChr,"<span ").concat(errorAttribute,">").concat(word,"</span>")}return"".concat(startChr).concat(metavalue)})),getItemReplacement("icon:",(function(match,startChr,iconName,iconClass){return iconClass=makeClassSafe(iconClass),"".concat(startChr).concat(function(iconName){var _iconName,additionalClass=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",matches=(iconName=null===(_iconName=iconName)||void 0===_iconName?void 0:_iconName.toLowerCase()).match(/^(?:fa-)?([a-z-]{2,})$/),iconClass=matches?matches[1]:"notdef";return additionalClass=/^[a-zA-Z_-]{2,}$/.test(additionalClass)?" ".concat(additionalClass):"",'<i class="'.concat("fa-solid"," fa-").concat(iconClass).concat(additionalClass,'"></i>')}(iconName,iconClass),"</span>")})),getItemReplacement("text:",(function(match,startChr,text,textClass){return textClass=makeClassSafe(textClass),"".concat(startChr).concat(function(text,className){return'<span class="'.concat(className,'">').concat(text,"</span>")}(text,textClass),"</span>")})),getClassSpanReplacement("big"),getClassSpanReplacement("bigger"),getClassSpanReplacement("biggest"),getClassSpanReplacement("massive"),getClassSpanReplacement("giant")])}),[{key:"missingWords",get:function(){return _toConsumableArray(_classPrivateFieldGet(_missingWords,this))}},{key:"replacements",get:function(){return _classPrivateFieldGet(_replacements,this)}}])}(),_html=new WeakMap,_missingWords2=new WeakMap,_metadata=new WeakMap,TextItem=function(){function TextItem(metadata){if(_classCallCheck(this,TextItem),_classPrivateFieldInitSpec(this,_html,""),_classPrivateFieldInitSpec(this,_missingWords2,[]),_classPrivateFieldInitSpec(this,_metadata,void 0),!_isConstructing._)throw new Error("Private constructor. Use createTextItem");_classPrivateFieldSet(_metadata,this,metadata)}return _createClass(TextItem,[{key:"html",get:function(){return _classPrivateFieldGet(_html,this)}},{key:"plainText",get:function(){return getPlainTextFromHtml(_classPrivateFieldGet(_html,this).replace(/<(?:[^>]*missing-word[^>]*)>/g,"..."))}},{key:"missingWords",get:function(){return _classPrivateFieldGet(_missingWords2,this)}},{key:"firstWord",get:function(){var _classPrivateFieldGet2,match=null===(_classPrivateFieldGet2=_classPrivateFieldGet(_html,this))||void 0===_classPrivateFieldGet2?void 0:_classPrivateFieldGet2.match(/^(?:\s*(?:<\/?[^\r\n\f\t]*?>)*\s*)*([^\s<]*)/);return match?match[1]:""}}],[{key:"createFromSource",value:function(source,metadata){_isConstructing._=!0;var textItem=new TextItem;if(_isConstructing._=!1,source){var tracker=new TrackedReplacements(metadata);_classPrivateFieldSet(_html,textItem,parseMarkdown(source,{post:tracker.replacements})),_classPrivateFieldSet(_missingWords2,textItem,tracker.missingWords)}return textItem}}])}(),_isConstructing={_:!1};function getItemReplacement(prefix,replace){return{re:new RegExp("".concat("(^|[ >])").concat(prefix).concat("((?:&#?[a-zA-Z0-9]+?;|[^\\s<>])+?)?").concat("(?:>([a-zA_Z]*))?").concat("(?=[\\s,;:.?!]|$|</.+?>)"),"gmi"),rep:replace}}function getClassSpanReplacement(className){return{re:new RegExp("{".concat(className,"}(.*?){").concat(className,"}"),"g"),rep:'<span class="'.concat(className,'">$1</span>')}}var _map=new WeakMap,Metadata=function(){function Metadata(){if(_classCallCheck(this,Metadata),_classPrivateFieldInitSpec(this,_map,new Map),!_isConstructing2._)throw new Error("Private constructor. Use createMetaData")}return _createClass(Metadata,[{key:"getValue",value:function(key,defaultValue){var value=_classPrivateFieldGet(_map,this).get(key.toUpperCase());return null!=value?value:defaultValue}}],[{key:"createFromSource",value:function(source){_isConstructing2._=!0;var metadata=new Metadata;return _isConstructing2._=!1,source.split("\n").forEach((function(element){var match=element.match(/^\s*(\w+)\s*[:;.]-?\s*(.*?)\s*$/);match&&_classPrivateFieldGet(_map,metadata).set(match[1].toUpperCase(),escapeHtml(match[2]))})),metadata}}])}(),_isConstructing2={_:!1},QuestionType={SIMPLE:"simple",MULTI:"multi",FILL:"fill",ORDER:"order",SLIDE:"slide"},_intro=new WeakMap,_question=new WeakMap,_explanation=new WeakMap,_rightAnswers=new WeakMap,_wrongAnswers=new WeakMap,_questionType=new WeakMap,_Problem_brand=new WeakSet,Problem=function(){return _createClass((function Problem(){_classCallCheck(this,Problem),_classPrivateMethodInitSpec(this,_Problem_brand),_classPrivateFieldInitSpec(this,_intro,void 0),_classPrivateFieldInitSpec(this,_question,void 0),_classPrivateFieldInitSpec(this,_explanation,void 0),_classPrivateFieldInitSpec(this,_rightAnswers,void 0),_classPrivateFieldInitSpec(this,_wrongAnswers,void 0),_classPrivateFieldInitSpec(this,_questionType,QuestionType.SLIDE)}),[{key:"intro",get:function(){return _classPrivateFieldGet(_intro,this)},set:function(value){_classPrivateFieldSet(_intro,this,value)}},{key:"question",get:function(){return _classPrivateFieldGet(_question,this)},set:function(value){_classPrivateFieldSet(_question,this,value),_assertClassBrand(_Problem_brand,this,_deriveQuestionType).call(this)}},{key:"explanation",get:function(){return _classPrivateFieldGet(_explanation,this)},set:function(value){_classPrivateFieldSet(_explanation,this,value)}},{key:"rightAnswers",get:function(){return _classPrivateFieldGet(_rightAnswers,this)},set:function(value){_classPrivateFieldSet(_rightAnswers,this,value),_assertClassBrand(_Problem_brand,this,_deriveQuestionType).call(this)}},{key:"wrongAnswers",get:function(){return _classPrivateFieldGet(_wrongAnswers,this)},set:function(value){_classPrivateFieldSet(_wrongAnswers,this,value),_assertClassBrand(_Problem_brand,this,_deriveQuestionType).call(this)}},{key:"firstWordsOfWrongAnswers",get:function(){return _assertClassBrand(_Problem_brand,this,_extractFirstWords).call(this,this.wrongAnswers)}},{key:"firstWordsOfRightAnswers",get:function(){return _assertClassBrand(_Problem_brand,this,_extractFirstWords).call(this,this.rightAnswers)}},{key:"questionType",get:function(){return _classPrivateFieldGet(_questionType,this)}}])}();function _extractFirstWords(data){var words=[];return data.forEach((function(textItem){words.push(textItem.firstWord)})),words}function _deriveQuestionType(){var _classPrivateFieldGet13;if(null===(_classPrivateFieldGet13=_classPrivateFieldGet(_question,this))||void 0===_classPrivateFieldGet13||!_classPrivateFieldGet13.html)return QuestionType.SLIDE;_assertClassBrand(_Problem_brand,this,_isOrderQuestion).call(this)?_classPrivateFieldSet(_questionType,this,QuestionType.ORDER):_assertClassBrand(_Problem_brand,this,_isFillQuestion).call(this)?_classPrivateFieldSet(_questionType,this,QuestionType.FILL):_assertClassBrand(_Problem_brand,this,_isMultiQuestion).call(this)?_classPrivateFieldSet(_questionType,this,QuestionType.MULTI):_assertClassBrand(_Problem_brand,this,_isSimpleQuestion).call(this)?_classPrivateFieldSet(_questionType,this,QuestionType.SIMPLE):_classPrivateFieldSet(_questionType,this,QuestionType.SLIDE)}function _isSimpleQuestion(){return!!_classPrivateFieldGet(_rightAnswers,this)&&1===_classPrivateFieldGet(_rightAnswers,this).length}function _isMultiQuestion(){return!!_classPrivateFieldGet(_rightAnswers,this)&&_classPrivateFieldGet(_rightAnswers,this).length>1}function _isFillQuestion(){if(0===_classPrivateFieldGet(_question,this).missingWords.length)return!1;var _step6,_iterator6=_createForOfIteratorHelper(_classPrivateFieldGet(_question,this).missingWords);try{for(_iterator6.s();!(_step6=_iterator6.n()).done;){if(!_step6.value)return!1}}catch(err){_iterator6.e(err)}finally{_iterator6.f()}return!0}function _isOrderQuestion(){return/<span +class *= *"missing-word(?: [a-zA-Z-]*?)*?".*?><\/span>(?:\s*<\/p>\s*)*$/.test(_classPrivateFieldGet(_question,this).html)&&1===_classPrivateFieldGet(_question,this).missingWords.length&&!_classPrivateFieldGet(_question,this).missingWords[0]}var MarkState={UNDEFINED:-1,CORRECT:0,INCORRECT:1,SKIPPED:2},_markedItems=new WeakMap,_lastUpdated=new WeakMap,ItemMarker=function(){return _createClass((function ItemMarker(){_classCallCheck(this,ItemMarker),_classPrivateFieldInitSpec(this,_markedItems,void 0),_classPrivateFieldInitSpec(this,_lastUpdated,void 0),this.reset()}),[{key:"reset",value:function(){_classPrivateFieldSet(_lastUpdated,this,new Date),_classPrivateFieldSet(_markedItems,this,[])}},{key:"lastUpdated",get:function(){return _classPrivateFieldGet(_lastUpdated,this)}},{key:"marks",get:function(){var marks={correct:0,incorrect:0,skipped:0,markedItems:_classPrivateFieldGet(_markedItems,this)};return _classPrivateFieldGet(_markedItems,this).forEach((function(markedItem){switch(markedItem.state){case MarkState.CORRECT:marks.correct++;break;case MarkState.INCORRECT:marks.incorrect++;break;case MarkState.SKIPPED:marks.skipped++}})),marks}},{key:"markItem",value:function(item,state){_classPrivateFieldGet(_markedItems,this).push({item:item,state:state}),_classPrivateFieldSet(_lastUpdated,this,new Date)}}])}(),_rawSource=new WeakMap,_metadata2=new WeakMap,_problems=new WeakMap,_problemIndex=new WeakMap,_marker=new WeakMap,Lesson=function(){return _createClass((function Lesson(rawSource){_classCallCheck(this,Lesson),_classPrivateFieldInitSpec(this,_rawSource,void 0),_classPrivateFieldInitSpec(this,_metadata2,void 0),_classPrivateFieldInitSpec(this,_problems,[]),_classPrivateFieldInitSpec(this,_problemIndex,0),_classPrivateFieldInitSpec(this,_marker,new ItemMarker),_classPrivateFieldSet(_rawSource,this,rawSource),_classPrivateFieldGet(_marker,this).reset()}),[{key:"rawSource",get:function(){return _classPrivateFieldGet(_rawSource,this)}},{key:"metadata",get:function(){return _classPrivateFieldGet(_metadata2,this)},set:function(value){_classPrivateFieldSet(_metadata2,this,value)}},{key:"problems",get:function(){return _classPrivateFieldGet(_problems,this)}},{key:"marks",get:function(){return _classPrivateFieldGet(_marker,this).marks}},{key:"lastUpdated",get:function(){return _classPrivateFieldGet(_marker,this).lastUpdated}},{key:"progress",get:function(){return 0===_classPrivateFieldGet(_problems,this).length?1:_classPrivateFieldGet(_problemIndex,this)/_classPrivateFieldGet(_problems,this).length}},{key:"addProblem",value:function(problem){_classPrivateFieldGet(_problems,this).push(problem)}},{key:"restart",value:function(){_classPrivateFieldGet(_marker,this).reset(),_classPrivateFieldSet(_problemIndex,this,0)}},{key:"hasMoreProblems",get:function(){return _classPrivateFieldGet(_problemIndex,this)<_classPrivateFieldGet(_problems,this).length}},{key:"isEmpty",get:function(){return 0===_classPrivateFieldGet(_problems,this).length||!(null!==(_classPrivateFieldGet3=_classPrivateFieldGet(_problems,this)[0].intro)&&void 0!==_classPrivateFieldGet3&&_classPrivateFieldGet3.html||null!==(_classPrivateFieldGet4=_classPrivateFieldGet(_problems,this)[0].question)&&void 0!==_classPrivateFieldGet4&&_classPrivateFieldGet4.html);var _classPrivateFieldGet3,_classPrivateFieldGet4}},{key:"getNextProblem",value:function(){var _this$problemIndex,_this$problemIndex2;return _classPrivateFieldGet(_problemIndex,this)<_classPrivateFieldGet(_problems,this).length?_classPrivateFieldGet(_problems,this)[(_classPrivateFieldSet(_problemIndex,this,(_this$problemIndex=_classPrivateFieldGet(_problemIndex,this),_this$problemIndex2=_this$problemIndex++,_this$problemIndex)),_this$problemIndex2)]:null}},{key:"peekAtNextProblem",value:function(){return _classPrivateFieldGet(_problemIndex,this)<_classPrivateFieldGet(_problems,this).length?_classPrivateFieldGet(_problems,this)[_classPrivateFieldGet(_problemIndex,this)]:null}},{key:"markProblem",value:function(problem,state){_classPrivateFieldGet(_marker,this).markItem(problem,state)}}])}(),_introSource=new WeakMap,_questionSource=new WeakMap,_rightAnswerSources=new WeakMap,_wrongAnswerSources=new WeakMap,_explanationSource=new WeakMap,ProblemSource=function(){return _createClass((function ProblemSource(){_classCallCheck(this,ProblemSource),_classPrivateFieldInitSpec(this,_introSource,void 0),_classPrivateFieldInitSpec(this,_questionSource,void 0),_classPrivateFieldInitSpec(this,_rightAnswerSources,void 0),_classPrivateFieldInitSpec(this,_wrongAnswerSources,void 0),_classPrivateFieldInitSpec(this,_explanationSource,void 0),_classPrivateFieldSet(_introSource,this,""),_classPrivateFieldSet(_questionSource,this,""),_classPrivateFieldSet(_rightAnswerSources,this,[]),_classPrivateFieldSet(_wrongAnswerSources,this,[]),_classPrivateFieldSet(_explanationSource,this,"")}),[{key:"introSource",get:function(){return _classPrivateFieldGet(_introSource,this)},set:function(data){_classPrivateFieldSet(_introSource,this,data)}},{key:"questionSource",get:function(){return _classPrivateFieldGet(_questionSource,this)},set:function(data){_classPrivateFieldSet(_questionSource,this,data)}},{key:"explanationSource",get:function(){return _classPrivateFieldGet(_explanationSource,this)},set:function(data){_classPrivateFieldSet(_explanationSource,this,data)}},{key:"rightAnswerSources",get:function(){return _classPrivateFieldGet(_rightAnswerSources,this)}},{key:"wrongAnswerSources",get:function(){return _classPrivateFieldGet(_wrongAnswerSources,this)}},{key:"addRightAnswerSource",value:function(data){_classPrivateFieldGet(_rightAnswerSources,this).push(data)}},{key:"addWrongAnswerSource",value:function(data){_classPrivateFieldGet(_wrongAnswerSources,this).push(data)}}])}(),ProblemItemKey_INTRO="i",ProblemItemKey_QUESTION="?",ProblemItemKey_RIGHT_ANSWER="=",ProblemItemKey_WRONG_ANSWER="x",ProblemItemKey_EXPLANATION="&",ProblemItemKey_QUESTION_BREAK="_",_metaSource=new WeakMap,_problemSources=new WeakMap,_rawSource2=new WeakMap,LessonSource=function(){function LessonSource(source){if(_classCallCheck(this,LessonSource),_classPrivateFieldInitSpec(this,_metaSource,void 0),_classPrivateFieldInitSpec(this,_problemSources,void 0),_classPrivateFieldInitSpec(this,_rawSource2,void 0),!_isConstructing3._)throw new Error("Private constructor. Use createFromSource");_classPrivateFieldSet(_problemSources,this,[]),_classPrivateFieldSet(_rawSource2,this,source)}return _createClass(LessonSource,[{key:"metaSource",get:function(){return _classPrivateFieldGet(_metaSource,this)},set:function(value){_classPrivateFieldSet(_metaSource,this,value)}},{key:"problemSources",get:function(){return _classPrivateFieldGet(_problemSources,this)}},{key:"isNewProblem",value:function(lastKey,newKey,currentProblem){if(lastKey===ProblemItemKey_QUESTION_BREAK)return!0;switch(newKey){case ProblemItemKey_INTRO:return!(!currentProblem.introSource&&!currentProblem.questionSource);case ProblemItemKey_QUESTION:return!!currentProblem.questionSource}return!1}},{key:"addDataToProblemSource",value:function(problem,itemType,data){switch(itemType){case ProblemItemKey_INTRO:problem.introSource=data;break;case ProblemItemKey_QUESTION:problem.questionSource=data;break;case ProblemItemKey_RIGHT_ANSWER:problem.addRightAnswerSource(data);break;case ProblemItemKey_WRONG_ANSWER:problem.addWrongAnswerSource(data);break;case ProblemItemKey_EXPLANATION:problem.explanationSource=data;break;case ProblemItemKey_QUESTION_BREAK:break;default:this.metaSource=data}}},{key:"createProblemSource",value:function(){var block=new ProblemSource;return this.problemSources.push(block),block}},{key:"getLineDetails",value:function(line){var _match$,match=line.match(/^[-#_* ]{0,3}(?:\(*([i?=xX&_\xD7])\1*[_) ]+)(.*)$/);if(!match)return{key:void 0,content:line};var key=match[1].toLowerCase();return"×"===key&&(key="x"),{key:key,content:null!==(_match$=match[2])&&void 0!==_match$?_match$:""}}},{key:"convertToLesson",value:function(){var lesson=new Lesson(_classPrivateFieldGet(_rawSource2,this));return lesson.metadata=Metadata.createFromSource(this.metaSource),this.problemSources.forEach((function(problemSource){var problem=new Problem;problem.intro=TextItem.createFromSource(problemSource.introSource,lesson.metadata),problem.question=TextItem.createFromSource(problemSource.questionSource,lesson.metadata),problem.explanation=TextItem.createFromSource(problemSource.explanationSource,lesson.metadata),problem.rightAnswers=problemSource.rightAnswerSources.map((function(source){return TextItem.createFromSource(source,lesson.metadata)})),problem.wrongAnswers=problemSource.wrongAnswerSources.map((function(source){return TextItem.createFromSource(source,lesson.metadata)})),lesson.addProblem(problem)})),lesson}}],[{key:"createFromSource",value:function(source){_isConstructing3._=!0;var lessonSource=new LessonSource(source);_isConstructing3._=!1;var lines=source.split(/\r\n|\n/),currentItemKey=null,problemSource=lessonSource.createProblemSource(),data="";return lines.forEach((function(line){var details=lessonSource.getLineDetails(line);details.key?(lessonSource.addDataToProblemSource(problemSource,currentItemKey,data),data=details.content?"".concat(details.content,"\n"):"",lessonSource.isNewProblem(currentItemKey,details.key,problemSource)&&(problemSource=lessonSource.createProblemSource()),currentItemKey=details.key):data+="".concat(details.content,"\n")})),data&&lessonSource.addDataToProblemSource(problemSource,currentItemKey,data),lessonSource}}])}(),_isConstructing3={_:!1},_data=new WeakMap,_title2=new WeakMap,_lesson=new WeakMap,_origin=new WeakMap,_UnmanagedLesson_brand=new WeakSet,UnmanagedLesson=function(){return _createClass((function UnmanagedLesson(title,_data2,_origin2){_classCallCheck(this,UnmanagedLesson),_classPrivateMethodInitSpec(this,_UnmanagedLesson_brand),_classPrivateFieldInitSpec(this,_data,void 0),_classPrivateFieldInitSpec(this,_title2,void 0),_classPrivateFieldInitSpec(this,_lesson,void 0),_classPrivateFieldInitSpec(this,_origin,void 0),_classPrivateFieldSet(_title2,this,title),_data2&&_classPrivateFieldSet(_lesson,this,_assertClassBrand(_UnmanagedLesson_brand,this,_convertDataToLesson).call(this,_data2)),_classPrivateFieldSet(_origin,this,_origin2)}),[{key:"hasLesson",get:function(){return!!_classPrivateFieldGet(_lesson,this)}},{key:"lesson",get:function(){return _classPrivateFieldGet(_lesson,this)}},{key:"lessonInfo",get:function(){return _assertClassBrand(_UnmanagedLesson_brand,this,_getUnmanagedLessonInfo).call(this,escapeHtml(_classPrivateFieldGet(_title2,this)),_classPrivateFieldGet(_origin,this))}}])}();function _convertDataToLesson(data){return LessonSource.createFromSource(data).convertToLesson()}function _getUnmanagedLessonInfo(lessonTitle,origin){return{origin:origin,usingLocalLibrary:!1,libraryKey:void 0,file:void 0,url:void 0,indexes:{book:0,chapter:0,lesson:0},titles:{library:"",book:"",chapter:"",lesson:lessonTitle}}}var LessonOrigin={REMOTE:"remote",LOCAL:"local",EMBEDDED:"embedded",FILE_SYSTEM:"file_system"};function _getEmbeddedItem(name,data){if(data)try{return base64ToString(data)}catch(error){console.error("Could not decoded embedded variable ".concat(name,". Data: ").concat(data," "))}return null}var embeddedLesson=new(function(_UnmanagedLesson2){function EmbeddedLesson(){var _window$text2LessonEm,_window$text2LessonEm2;return _classCallCheck(this,EmbeddedLesson),_callSuper(this,EmbeddedLesson,[_getEmbeddedItem.call(EmbeddedLesson,"Embedded title",null===(_window$text2LessonEm=window.text2LessonEmbeddedData)||void 0===_window$text2LessonEm?void 0:_window$text2LessonEm.title),_getEmbeddedItem.call(EmbeddedLesson,"Embedded source",null===(_window$text2LessonEm2=window.text2LessonEmbeddedData)||void 0===_window$text2LessonEm2?void 0:_window$text2LessonEm2.source),LessonOrigin.EMBEDDED])}return _inherits(EmbeddedLesson,_UnmanagedLesson2),_createClass(EmbeddedLesson,[{key:"rootUrl",get:function(){var _window$text2LessonEm3;return null===(_window$text2LessonEm3=window.text2LessonEmbeddedData)||void 0===_window$text2LessonEm3?void 0:_window$text2LessonEm3.rootUrl}},{key:"translations",get:function(){var _window$text2LessonEm4;return null===(_window$text2LessonEm4=window.text2LessonEmbeddedData)||void 0===_window$text2LessonEm4?void 0:_window$text2LessonEm4.translations}}])}(UnmanagedLesson)),_usingLocalLibrary=new WeakMap,_libraries=new WeakMap,_remoteLibraryKey=new WeakMap,_currentLibraryKey=new WeakMap,_currentBookIndex=new WeakMap,_currentChapterIndex=new WeakMap,_currentLessonIndex=new WeakMap,_cachedLesson=new WeakMap,_LessonManager_brand=new WeakSet,LessonManager=function(){return _createClass((function LessonManager(){_classCallCheck(this,LessonManager),_classPrivateMethodInitSpec(this,_LessonManager_brand),_classPrivateFieldInitSpec(this,_usingLocalLibrary,!1),_classPrivateFieldInitSpec(this,_libraries,new Map),_classPrivateFieldInitSpec(this,_remoteLibraryKey,void 0),_classPrivateFieldInitSpec(this,_currentLibraryKey,void 0),_classPrivateFieldInitSpec(this,_currentBookIndex,0),_classPrivateFieldInitSpec(this,_currentChapterIndex,0),_classPrivateFieldInitSpec(this,_currentLessonIndex,0),_classPrivateFieldInitSpec(this,_cachedLesson,void 0)}),[{key:"getFirstRemoteKey",value:function(){var _step5,_iterator5=_createForOfIteratorHelper(_classPrivateFieldGet(_libraries,this).keys());try{for(_iterator5.s();!(_step5=_iterator5.n()).done;){var key=_step5.value;if(key!==LocalLibrary.LOCAL_LIBRARY_KEY)return key}}catch(err){_iterator5.e(err)}finally{_iterator5.f()}return""}},{key:"remoteLibraryKey",set:function(key){_classPrivateFieldGet(_libraries,this).has(key)||(console.error("Ignored attempt to set invalid remote library key ".concat(key,".")),key=this.getFirstRemoteKey()),_classPrivateFieldSet(_remoteLibraryKey,this,key),_classPrivateFieldGet(_usingLocalLibrary,this)||_classPrivateFieldSet(_currentLibraryKey,this,_classPrivateFieldGet(_remoteLibraryKey,this))}},{key:"usingLocalLibrary",get:function(){return _classPrivateFieldGet(_usingLocalLibrary,this)},set:function(value){_classPrivateFieldSet(_usingLocalLibrary,this,value),_classPrivateFieldSet(_currentLibraryKey,this,_classPrivateFieldGet(_usingLocalLibrary,this)?LocalLibrary.LOCAL_LIBRARY_KEY:_classPrivateFieldGet(_remoteLibraryKey,this))}},{key:"isRemoteLibraryAvailable",get:function(){var _classPrivateFieldGet5;return(null===(_classPrivateFieldGet5=_classPrivateFieldGet(_libraries,this).get(_classPrivateFieldGet(_remoteLibraryKey,this)))||void 0===_classPrivateFieldGet5?void 0:_classPrivateFieldGet5.books.length)>0}},{key:"bookIndex",set:function(index){_classPrivateFieldGet(_libraries,this).get(_classPrivateFieldGet(_currentLibraryKey,this))?_classPrivateFieldSet(_currentBookIndex,this,_assertClassBrand(_LessonManager_brand,this,_ensurePositiveInt).call(this,index)):_classPrivateFieldSet(_currentBookIndex,this,0)}},{key:"chapterIndex",set:function(index){_classPrivateFieldSet(_currentChapterIndex,this,_assertClassBrand(_LessonManager_brand,this,_ensurePositiveInt).call(this,index))}},{key:"lessonIndex",set:function(index){_classPrivateFieldSet(_currentLessonIndex,this,_assertClassBrand(_LessonManager_brand,this,_ensurePositiveInt).call(this,index))}},{key:"remoteLibraryTitle",get:function(){var _classPrivateFieldGet6,title=null===(_classPrivateFieldGet6=_classPrivateFieldGet(_libraries,this).get(_classPrivateFieldGet(_remoteLibraryKey,this)))||void 0===_classPrivateFieldGet6?void 0:_classPrivateFieldGet6.title;return null!=title?title:""}},{key:"libraryTitle",get:function(){var _classPrivateFieldGet7,title=null===(_classPrivateFieldGet7=_classPrivateFieldGet(_libraries,this).get(_classPrivateFieldGet(_currentLibraryKey,this)))||void 0===_classPrivateFieldGet7?void 0:_classPrivateFieldGet7.title;return null!=title?title:""}},{key:"libraryTitles",get:function(){var options=new Map;return _classPrivateFieldGet(_libraries,this).forEach((function(value,key){options.set(key,value.title)})),options}},{key:"remoteLibraryTitles",get:function(){var options=new Map;return _classPrivateFieldGet(_libraries,this).forEach((function(value,key){key!==LocalLibrary.LOCAL_LIBRARY_KEY&&options.set(key,value.title)})),options}},{key:"bookTitle",get:function(){var _assertClassBrand$cal,title=null===(_assertClassBrand$cal=_assertClassBrand(_LessonManager_brand,this,_getCurrentBook).call(this))||void 0===_assertClassBrand$cal?void 0:_assertClassBrand$cal.title;return null!=title?title:""}},{key:"bookTitles",get:function(){var _classPrivateFieldGet8,titles=[];return null===(_classPrivateFieldGet8=_classPrivateFieldGet(_libraries,this).get(_classPrivateFieldGet(_currentLibraryKey,this)))||void 0===_classPrivateFieldGet8||_classPrivateFieldGet8.books.forEach((function(value){titles.push(value.title)})),titles}},{key:"chapterTitle",get:function(){var _assertClassBrand$cal2,title=null===(_assertClassBrand$cal2=_assertClassBrand(_LessonManager_brand,this,_getCurrentBook).call(this))||void 0===_assertClassBrand$cal2||null===(_assertClassBrand$cal2=_assertClassBrand$cal2.chapters[_classPrivateFieldGet(_currentChapterIndex,this)])||void 0===_assertClassBrand$cal2?void 0:_assertClassBrand$cal2.title;return null!=title?title:""}},{key:"chapterTitles",get:function(){var titles=[];return _assertClassBrand(_LessonManager_brand,this,_getCurrentBook).call(this).chapters.forEach((function(value){titles.push(value.title)})),titles}},{key:"lessonTitle",get:function(){var _assertClassBrand$cal3,title=null===(_assertClassBrand$cal3=_assertClassBrand(_LessonManager_brand,this,_getCurrentBook).call(this))||void 0===_assertClassBrand$cal3||null===(_assertClassBrand$cal3=_assertClassBrand$cal3.chapters[_classPrivateFieldGet(_currentChapterIndex,this)])||void 0===_assertClassBrand$cal3||null===(_assertClassBrand$cal3=_assertClassBrand$cal3.lessons[_classPrivateFieldGet(_currentLessonIndex,this)])||void 0===_assertClassBrand$cal3?void 0:_assertClassBrand$cal3.title;return null!=title?title:""}},{key:"lessonTitles",get:function(){var titles=[];return _assertClassBrand(_LessonManager_brand,this,_getCurrentBook).call(this).chapters[_classPrivateFieldGet(_currentChapterIndex,this)].lessons.forEach((function(value){titles.push(value.title)})),titles}},{key:"currentLessonInfo",get:function(){return _assertClassBrand(_LessonManager_brand,this,_buildCurrentLessonInfo).call(this)}},{key:"formUrlForLesson",value:function(){var books=_classPrivateFieldGet(_libraries,this).get(_classPrivateFieldGet(_currentLibraryKey,this)).books,fileLocation=books[_classPrivateFieldGet(_currentBookIndex,this)].location,fileName=books[_classPrivateFieldGet(_currentBookIndex,this)].chapters[_classPrivateFieldGet(_currentChapterIndex,this)].lessons[_classPrivateFieldGet(_currentLessonIndex,this)].file;return"".concat(fileLocation).concat(fileName)}},{key:"loadAllLibraries",value:function(librariesFileLocation){var _this6=this;_classPrivateFieldSet(_libraries,this,new Map);var localLibrary=new LocalLibrary;return _classPrivateFieldGet(_libraries,this).set(localLibrary.key,localLibrary.info),librariesFileLocation?fetchJson(librariesFileLocation).then((function(entries){for(var key in entries){var entry=entries[key];entry.title=escapeHtml(entry.title),_classPrivateFieldGet(_libraries,_this6).set(key,entries[key]),_classPrivateFieldGet(_libraries,_this6).get(key).books=[]}return null})).catch((function(errorIgnored){return new Error(i18n(_templateObject55||(_templateObject55=_taggedTemplateLiteral(["65bd72f2c7d25e779a582b1600fc665b::",""])),librariesFileLocation))})):Promise.resolve(null)}},{key:"loadAllLibraryContent",value:function(){var _this7=this;return _assertClassBrand(_LessonManager_brand,this,_loadLibraryContent).call(this,LocalLibrary.LOCAL_LIBRARY_KEY).then((function(){return _assertClassBrand(_LessonManager_brand,_this7,_loadLibraryContent).call(_this7,_classPrivateFieldGet(_remoteLibraryKey,_this7))}))}},{key:"loadCurrentLesson",value:function(){_assertClassBrand(_LessonManager_brand,this,_ensureIndexesValid).call(this);var contentLoader=_assertClassBrand(_LessonManager_brand,this,_getCurrentBook).call(this).chapters[_classPrivateFieldGet(_currentChapterIndex,this)].lessons[_classPrivateFieldGet(_currentLessonIndex,this)].contentLoader;return contentLoader?_assertClassBrand(_LessonManager_brand,this,_loadLessonUsingContentLoader).call(this,contentLoader):_assertClassBrand(_LessonManager_brand,this,_loadRemoteLesson).call(this).catch((function(error){return console.error(error),null}))}},{key:"updateCurrentLessonContent",value:function(title,content){if(!_classPrivateFieldGet(_usingLocalLibrary,this))throw new Error("Attempt made to update a remote library.");return(new LocalLibrary).saveLocalLessonAtIndex(_classPrivateFieldGet(_currentLessonIndex,this),{title:title,content:content}),_assertClassBrand(_LessonManager_brand,this,_loadLibraryContent).call(this,LocalLibrary.LOCAL_LIBRARY_KEY,!0)}},{key:"addLessonToLocalLibrary",value:function(){var localLibrary=new LocalLibrary;return localLibrary.addNewLessonSlot(),_classPrivateFieldGet(_libraries,this).set(localLibrary.key,localLibrary.info),_assertClassBrand(_LessonManager_brand,this,_loadLibraryContent).call(this,localLibrary.key,!0)}},{key:"deleteLocalLibraryCurrentLesson",value:function(){if(!_classPrivateFieldGet(_usingLocalLibrary,this))return console.error("Ignored attempt to delete local library when it is not the active library."),Promise.resolve();var localLibrary=new LocalLibrary;return localLibrary.deleteLessonAtIndex(_classPrivateFieldGet(_currentLessonIndex,this)),_classPrivateFieldGet(_libraries,this).set(localLibrary.key,localLibrary.info),_assertClassBrand(_LessonManager_brand,this,_loadLibraryContent).call(this,localLibrary.key,!0)}}])}();function _buildCurrentLessonInfo(url){var _book$chapters$_class,_classPrivateFieldGet14,_book$chapters$_class2,_book$chapters$_class3;_assertClassBrand(_LessonManager_brand,this,_ensureIndexesValid).call(this);var book=_assertClassBrand(_LessonManager_brand,this,_getCurrentBook).call(this);return{origin:_classPrivateFieldGet(_usingLocalLibrary,this)?LessonOrigin.LOCAL:LessonOrigin.REMOTE,usingLocalLibrary:_classPrivateFieldGet(_usingLocalLibrary,this),libraryKey:_classPrivateFieldGet(_currentLibraryKey,this),file:null==book||null===(_book$chapters$_class=book.chapters[_classPrivateFieldGet(_currentChapterIndex,this)])||void 0===_book$chapters$_class||null===(_book$chapters$_class=_book$chapters$_class.lessons[_classPrivateFieldGet(_currentLessonIndex,this)])||void 0===_book$chapters$_class?void 0:_book$chapters$_class.file,url:url,indexes:{book:_classPrivateFieldGet(_currentBookIndex,this),chapter:_classPrivateFieldGet(_currentChapterIndex,this),lesson:_classPrivateFieldGet(_currentLessonIndex,this)},titles:{library:null===(_classPrivateFieldGet14=_classPrivateFieldGet(_libraries,this).get(_classPrivateFieldGet(_currentLibraryKey,this)))||void 0===_classPrivateFieldGet14?void 0:_classPrivateFieldGet14.title,book:null==book?void 0:book.title,chapter:null==book||null===(_book$chapters$_class2=book.chapters[_classPrivateFieldGet(_currentChapterIndex,this)])||void 0===_book$chapters$_class2?void 0:_book$chapters$_class2.title,lesson:null==book||null===(_book$chapters$_class3=book.chapters[_classPrivateFieldGet(_currentChapterIndex,this)])||void 0===_book$chapters$_class3||null===(_book$chapters$_class3=_book$chapters$_class3.lessons[_classPrivateFieldGet(_currentLessonIndex,this)])||void 0===_book$chapters$_class3?void 0:_book$chapters$_class3.title}}}function _ensurePositiveInt(index){return index=parseInt(index),isNaN(index)||index<0?0:index}function _ensureIndexesValid(){var library=_classPrivateFieldGet(_libraries,this).get(_classPrivateFieldGet(_currentLibraryKey,this));_assertClassBrand(_LessonManager_brand,this,_indexInvalid).call(this,_classPrivateFieldGet(_currentBookIndex,this),null==library?void 0:library.books)&&_classPrivateFieldSet(_currentBookIndex,this,0);var book=null==library?void 0:library.books[_classPrivateFieldGet(_currentBookIndex,this)];_assertClassBrand(_LessonManager_brand,this,_indexInvalid).call(this,_classPrivateFieldGet(_currentChapterIndex,this),null==book?void 0:book.chapters)&&_classPrivateFieldSet(_currentChapterIndex,this,0);var chapter=null==book?void 0:book.chapters[_classPrivateFieldGet(_currentChapterIndex,this)];_assertClassBrand(_LessonManager_brand,this,_indexInvalid).call(this,_classPrivateFieldGet(_currentLessonIndex,this),null==chapter?void 0:chapter.lessons.length)&&_classPrivateFieldSet(_currentLessonIndex,this,0)}function _indexInvalid(index,arrayData){return null!=arrayData&&(isNaN(index)||index<0||index>=arrayData.length)}function _getCurrentBook(){return _classPrivateFieldGet(_libraries,this).get(_classPrivateFieldGet(_currentLibraryKey,this)).books[_classPrivateFieldGet(_currentBookIndex,this)]}function _loadLibraryContent(key,force){var _library$books,_this56=this,library=_classPrivateFieldGet(_libraries,this).get(key);return(null===(_library$books=library.books)||void 0===_library$books?void 0:_library$books.length)>0&&!force?Promise.resolve():library.contentLoader?(library.books=library.contentLoader(),_assertClassBrand(_LessonManager_brand,this,_escapeAllTitles).call(this,library.books),_assertClassBrand(_LessonManager_brand,this,_ensureIndexesValid).call(this),Promise.resolve(null)):fetchJson(library.url).then((function(value){return library.books=value,_assertClassBrand(_LessonManager_brand,_this56,_escapeAllTitles).call(_this56,library.books),_assertClassBrand(_LessonManager_brand,_this56,_ensureIndexesValid).call(_this56),null})).catch((function(errorIgnored){return new Error(i18n(_templateObject128||(_templateObject128=_taggedTemplateLiteral(["c79030f53fb54a65f7f7b8294cf6b87c::",""])),library.url))}))}function _escapeAllTitles(books){books.forEach((function(book){book.title=escapeHtml(book.title),book.chapters.forEach((function(chapter){chapter.title=escapeHtml(chapter.title),chapter.lessons.forEach((function(lesson){lesson.title=escapeHtml(lesson.title)}))}))}))}function _loadLessonUsingContentLoader(contentLoader){return Promise.resolve(new CachedLesson(_assertClassBrand(_LessonManager_brand,this,_buildCurrentLessonInfo).call(this,""),contentLoader()))}function _loadRemoteLesson(){var _classPrivateFieldGet15,_classPrivateFieldGet16,_this57=this,url=this.formUrlForLesson();return(null===(_classPrivateFieldGet15=_classPrivateFieldGet(_cachedLesson,this))||void 0===_classPrivateFieldGet15?void 0:_classPrivateFieldGet15.info.url)===url&&null!==(_classPrivateFieldGet16=_classPrivateFieldGet(_cachedLesson,this))&&void 0!==_classPrivateFieldGet16&&_classPrivateFieldGet16.content?(console.info("Using cached version of lesson: ".concat(url)),Promise.resolve(CachedLesson.clone(_classPrivateFieldGet(_cachedLesson,this)))):(_classPrivateFieldSet(_cachedLesson,this,new CachedLesson(_assertClassBrand(_LessonManager_brand,this,_buildCurrentLessonInfo).call(this,url))),function(url){return fetchFile(url,"text")}(url).then((function(text){return console.info("Loaded lesson: ".concat(url)),_classPrivateFieldGet(_cachedLesson,_this57).content=text,CachedLesson.clone(_classPrivateFieldGet(_cachedLesson,_this57))})))}var EmbeddedLessonManager=function(){return _createClass((function EmbeddedLessonManager(){_classCallCheck(this,EmbeddedLessonManager)}),[{key:"loadAllLibraries",value:function(librariesFileLocation){console.debug("Embedded lesson manager ignore attempt to load ".concat(librariesFileLocation))}},{key:"loadAllLibraryContent",value:function(){console.debug("Embedded lesson manager ignored attempt to load all library content")}}])}(),lessonManager=embeddedLesson.hasLesson?new EmbeddedLessonManager:new LessonManager,GOOD_SOUND_URLS=[null,"assets/audio/good1.mp3","assets/audio/good2.mp3"],BAD_SOUND_URLS=[null,"assets/audio/bad1.mp3","assets/audio/bad2.mp3"],Enthusiasm={OFF:0,LOW:1,HIGH:2},_enthusiasm=new WeakMap,_goodAudio=new WeakMap,_badAudio=new WeakMap,_SoundManager_brand=new WeakSet;function _loadAudio(){_classPrivateFieldSet(_goodAudio,this,_assertClassBrand(_SoundManager_brand,this,_createAudioIfNotNull).call(this,GOOD_SOUND_URLS[_classPrivateFieldGet(_enthusiasm,this)])),_classPrivateFieldSet(_badAudio,this,_assertClassBrand(_SoundManager_brand,this,_createAudioIfNotNull).call(this,BAD_SOUND_URLS[_classPrivateFieldGet(_enthusiasm,this)]))}function _createAudioIfNotNull(url){return url?new Audio(url):null}var soundManager=new(function(){return _createClass((function SoundManager(){_classCallCheck(this,SoundManager),_classPrivateMethodInitSpec(this,_SoundManager_brand),_classPrivateFieldInitSpec(this,_enthusiasm,void 0),_classPrivateFieldInitSpec(this,_goodAudio,void 0),_classPrivateFieldInitSpec(this,_badAudio,void 0),_classPrivateFieldSet(_enthusiasm,this,Enthusiasm.OFF),_assertClassBrand(_SoundManager_brand,this,_loadAudio).call(this)}),[{key:"enthusiasm",get:function(){return _classPrivateFieldGet(_enthusiasm,this)},set:function(value){isNaN(value)||value<Enthusiasm.OFF||value>Enthusiasm.HIGH?console.error("Attempt to set enthusiasm to invalid level of ".concat(value," ignored.")):value!==_classPrivateFieldGet(_enthusiasm,this)&&(_classPrivateFieldSet(_enthusiasm,this,value),_assertClassBrand(_SoundManager_brand,this,_loadAudio).call(this))}},{key:"playGood",value:function(){var _classPrivateFieldGet9;null===(_classPrivateFieldGet9=_classPrivateFieldGet(_goodAudio,this))||void 0===_classPrivateFieldGet9||_classPrivateFieldGet9.play()}},{key:"playBad",value:function(){var _classPrivateFieldGet10;null===(_classPrivateFieldGet10=_classPrivateFieldGet(_badAudio,this))||void 0===_classPrivateFieldGet10||_classPrivateFieldGet10.play()}}])}()),DEFAULT_HUE=120,DEFAULT_SATURATION=50,DEFAULT_COLOR_SPREAD=120,DEFAULT_DARK_MODE=!1,DEFAULT_FONT_SIZE=15,DEFAULT_LIBRARY_KEY="EN",DEFAULT_READING_SPEED="180";function setPalette(settings){var _settings$hue,_settings$saturation,_settings$spread,_settings$dark;settings.hue=null!==(_settings$hue=settings.hue)&&void 0!==_settings$hue?_settings$hue:persistentData.getFromStorage("hue",DEFAULT_HUE),settings.saturation=null!==(_settings$saturation=settings.saturation)&&void 0!==_settings$saturation?_settings$saturation:persistentData.getFromStorage("saturation",DEFAULT_SATURATION),settings.spread=null!==(_settings$spread=settings.spread)&&void 0!==_settings$spread?_settings$spread:persistentData.getFromStorage("spread",DEFAULT_COLOR_SPREAD),settings.dark=null!==(_settings$dark=settings.dark)&&void 0!==_settings$dark?_settings$dark:persistentData.getFromStorage("darkMode",DEFAULT_DARK_MODE),function(palette){for(var entryKey in palette)setCssFromPaletteEntry(entryKey,palette[entryKey])}(function(settings){var primaryRgb=hslToRgb(new HSL(settings.hue,settings.saturation,settings.dark?70:30)),colors=[primaryRgb],complementA=shiftHue(primaryRgb,settings.spread),complementB=shiftHue(primaryRgb,-settings.spread);colors.push(complementA,complementB),colors.sort((function(a,b){var relLuminanceA=relativeLuminance(a),relLuminanceB=relativeLuminance(b);return relLuminanceA>relLuminanceB?1:relLuminanceA<relLuminanceB?-1:0})),colors[0]=getDarker(colors[0],5),colors[2]=getLighter(colors[0],5);var errorHsl=new HSL(0,settings.saturation,50),backgroundHsl=new HSL(settings.hue,0,settings.dark?5:95),windowHsl=new HSL(settings.hue,0,settings.dark?0:100);return new Palette({primary:getPaletteEntry(primaryRgb),secondary:getPaletteEntry(complementA),tertiary:getPaletteEntry(complementB),background:getPaletteEntry(hslToRgb(backgroundHsl)),window:getPaletteEntry(hslToRgb(windowHsl)),error:getPaletteEntry(hslToRgb(errorHsl))})}(settings))}var hourglass,BarButton=function(_ManagedElement3){function BarButton(detail){var _this8;return _classCallCheck(this,BarButton),_this8=_callSuper(this,BarButton,["button"]),detail.content?icons.applyIconToElement(detail,_this8.element):_this8.innerHTML=detail,_this8}return _inherits(BarButton,_ManagedElement3),_createClass(BarButton)}(ManagedElement),ButtonBar=function(_ManagedElement4){function ButtonBar(){return _classCallCheck(this,ButtonBar),_callSuper(this,ButtonBar,["div","utils-button-bar"])}return _inherits(ButtonBar,_ManagedElement4),_createClass(ButtonBar,[{key:"showButtons",value:function(buttons,focusedButtonIndex){var _buttons,_this9=this;null!==(_buttons=buttons)&&void 0!==_buttons&&_buttons.length||(buttons=[icons.ok]),this.resolutionFunction=null;var promise=new Promise((function(resolve){_this9.resolutionFunction=resolve})),focusSet=!1;return buttons.forEach((function(value,index){var button=new BarButton(value);button.setAttribute("data-index",index),_this9.appendChild(button,index),_this9.listenToEventOn("click",button,index),index===focusedButtonIndex&&(button.focus(),focusSet=!0)})),focusSet||focusManager.findBestFocus(),promise}},{key:"handleClickEvent",value:function(eventIgnored,eventId){var index=parseInt(eventId);this.resolutionFunction(index)}}])}(ManagedElement),mask=document.getElementById("modal-mask"),standardSelectionIds=["title-bar","content","footer"],referenceCount=0,itemsToRestore=[];function deactivateItems(){standardSelectionIds.forEach((function(id){document.getElementById(id).querySelectorAll("button,.selectable,input,textarea").forEach((function(element){!function(element){console.debug("Deactivating ".concat(element.tagName,": ").concat(element.className));var elementDetails={element:element,"aria-hidden":element.getAttribute("aria-hidden"),disabled:element.disabled,tabIndex:element.tabIndex};itemsToRestore.push(elementDetails),element.setAttribute("aria-hidden",!0),void 0!==element.disabled&&(element.disabled=!0),element.tabIndex=-1}(element)}))}))}function showMask(withHourglass){mask.style.visibility="visible",0===referenceCount?deactivateItems():console.debug("Reference count ".concat(referenceCount," is > 0 so mask already in place.")),withHourglass&&(hourglass||((hourglass=document.createElement("div")).className="hourglass",mask.appendChild(hourglass))),referenceCount++}function hideMask(){var _hourglass;null===(_hourglass=hourglass)||void 0===_hourglass||_hourglass.remove(),hourglass=null,--referenceCount>0?console.debug("Reference count ".concat(referenceCount," is > 0 so leave mask in place.")):(itemsToRestore.forEach((function(item){item.ariaHidden?item.element.setAttribute("aria-hidden",item.ariaHidden):item.element.removeAttribute("aria-hidden"),void 0!==item.disabled&&(item.element.disabled=item.disabled),void 0!==item.tabIndex&&(item.element.tabIndex=item.tabIndex)})),itemsToRestore=[],mask.style.visibility="hidden")}function getIconDetailsForType(dialogType){switch(dialogType){case ModalDialog.DialogType.WARNING:return icons.warning;case ModalDialog.DialogType.ERROR:return icons.error;case ModalDialog.DialogType.FATAL:return icons.fatal;case ModalDialog.DialogType.QUESTION:return icons.question;case ModalDialog.DialogType.SETTINGS:return icons.settings;case ModalDialog.DialogType.INFO:default:return icons.info}}var _dialog=new WeakMap,_titleText=new WeakMap,_icon=new WeakMap,_content2=new WeakMap,_buttonBar=new WeakMap,_ModalDialog_brand=new WeakSet,ModalDialog=function(){function ModalDialog(){if(_classCallCheck(this,ModalDialog),_classPrivateMethodInitSpec(this,_ModalDialog_brand),_classPrivateFieldInitSpec(this,_dialog,void 0),_classPrivateFieldInitSpec(this,_titleText,void 0),_classPrivateFieldInitSpec(this,_icon,void 0),_classPrivateFieldInitSpec(this,_content2,void 0),_classPrivateFieldInitSpec(this,_buttonBar,void 0),!_isConstructing4._)throw new Error("ModalDialog should be instantiated via factory method.");_assertClassBrand(_ModalDialog_brand,this,_createHtml).call(this)}return _createClass(ModalDialog,null,[{key:"showDialog",value:function(title,content,options){var dialog=_constructDialog.call(ModalDialog);(null==options?void 0:options.dialogType)===ModalDialog.DialogType.FATAL&&(content=_addReloadWarning.call(ModalDialog,content));var iconDetails=getIconDetailsForType(null==options?void 0:options.dialogType),dialogDefinition={title:title&&title.length>0?title:":",buttons:null==options?void 0:options.buttons,content:content,dialogType:null==options?void 0:options.dialogType,iconDetails:iconDetails,focusedButtonIndex:options.focusedButtonIndex};return _assertClassBrand(_ModalDialog_brand,dialog,_showDialogDefinition).call(dialog,dialogDefinition)}},{key:"showSettingsDialog",value:function(content){var options={dialogType:ModalDialog.DialogType.SETTINGS,buttons:[icons.ok,icons.resetToFactory]};return ModalDialog.showDialog(i18n(_templateObject70||(_templateObject70=_taggedTemplateLiteral(["f4f70727dc34561dfde1a3c529b6205c::"]))),content,options)}},{key:"showWarning",value:function(content,title){return ModalDialog.showDialog(null!=title?title:i18n(_templateObject71||(_templateObject71=_taggedTemplateLiteral(["0eaadb4fcb48a0a0ed7bc9868be9fbaa::"]))),content,{dialogType:ModalDialog.DialogType.WARNING})}},{key:"showError",value:function(content,title){return ModalDialog.showDialog(null!=title?title:i18n(_templateObject72||(_templateObject72=_taggedTemplateLiteral(["902b0d55fddef6f8d651fe1035b7d4bd::"]))),content,{dialogType:ModalDialog.DialogType.ERROR})}},{key:"showInfo",value:function(content,title){return ModalDialog.showDialog(null!=title?title:i18n(_templateObject73||(_templateObject73=_taggedTemplateLiteral(["a82be0f551b8708bc08eb33cd9ded0cf::"]))),content,{dialogType:ModalDialog.DialogType.INFO})}},{key:"showConfirm",value:function(content,title){var defaultToYes=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];return ModalDialog.showDialog(null!=title?title:i18n(_templateObject74||(_templateObject74=_taggedTemplateLiteral(["a97ea56b0e00b2379736ae60869ff66a::"]))),content,{dialogType:ModalDialog.DialogType.QUESTION,buttons:[icons.yes,icons.no],focusedButtonIndex:defaultToYes?0:1})}},{key:"showFatal",value:function(content,title){return ModalDialog.showDialog(null!=title?title:i18n(_templateObject75||(_templateObject75=_taggedTemplateLiteral(["355f26b47eff3302c93a1c49676f078e::"]))),content,{dialogType:ModalDialog.DialogType.FATAL})}}])}();function _constructDialog(){_isConstructing4._=!0;var dialog=new _ModalDialog;return _isConstructing4._=!1,dialog}function _createHtml(){_classPrivateFieldSet(_dialog,this,new ManagedElement("div","utils-dialog")),_classPrivateFieldGet(_dialog,this).classList.add("framed","modal");var titleBar=new ManagedElement("div","utils-title-bar");titleBar.classList.add("container"),_classPrivateFieldSet(_icon,this,new ManagedElement("span","utils-dialog-icon")),titleBar.appendChild(_classPrivateFieldGet(_icon,this)),_classPrivateFieldSet(_titleText,this,new ManagedElement("span")),titleBar.appendChild(_classPrivateFieldGet(_titleText,this));var contentFrame=new ManagedElement("div","utils-dialog-content-frame");contentFrame.classList.add("container"),_classPrivateFieldSet(_content2,this,new ManagedElement("div","utils-dialog-content")),contentFrame.appendChild(_classPrivateFieldGet(_content2,this)),_classPrivateFieldSet(_buttonBar,this,new ButtonBar),_classPrivateFieldGet(_dialog,this).appendChild(titleBar),_classPrivateFieldGet(_dialog,this).appendChild(contentFrame),_classPrivateFieldGet(_dialog,this).appendChild(_classPrivateFieldGet(_buttonBar,this)),_classPrivateFieldGet(_dialog,this).appendTo(document.body)}function _showDialogDefinition(dialogDefinition){var _this58=this;return _classPrivateFieldGet(_titleText,this).textContent=dialogDefinition.title,dialogDefinition.content instanceof Element||dialogDefinition.content instanceof ManagedElement?(_classPrivateFieldGet(_content2,this).textContent="",_classPrivateFieldGet(_content2,this).appendChild(dialogDefinition.content)):_classPrivateFieldGet(_content2,this).innerHTML=dialogDefinition.content,icons.applyIconToElement(dialogDefinition.iconDetails,_classPrivateFieldGet(_icon,this),{hideText:!0}),showMask(),_classPrivateFieldGet(_buttonBar,this).showButtons(dialogDefinition.buttons,dialogDefinition.focusedButtonIndex).then((function(index){return _assertClassBrand(_ModalDialog_brand,_this58,_hideDialog).call(_this58),focusManager.findBestFocus(),index}))}function _hideDialog(){hideMask(),_classPrivateFieldGet(_dialog,this).remove()}function _addReloadWarning(content){var reloadText=i18n(_templateObject129||(_templateObject129=_taggedTemplateLiteral(["b33bb0b4617140c80c80b10436a0dbb2::"])));if(""===reloadText&&(reloadText="A serious error has occurred and languages cannot be loaded. Wait a few minutes and then close this dialog to try to reload the application."),content instanceof Element){var para=document.createElement("p");return para.textContent=reloadText,content.appendChild(para),content}return"".concat(content,"<p>").concat(reloadText,"</p>")}_ModalDialog=ModalDialog,_defineProperty(ModalDialog,"DialogType",{ERROR:"error",FATAL:"fatal",INFO:"info",QUESTION:"question",SETTINGS:"settings",WARNING:"warning"}),_defineProperty(ModalDialog,"DialogIndex",{SETTINGS_OK:0,SETTINGS_RESET:1,CONFIRM_YES:0,CONFIRM_NO:1});var _isConstructing4={_:!1},_reloadRequired=new WeakMap,_reason=new WeakMap,reloader=new(function(){return _createClass((function Reloader(){_classCallCheck(this,Reloader),_classPrivateFieldInitSpec(this,_reloadRequired,!1),_classPrivateFieldInitSpec(this,_reason,"")}),[{key:"flagAsRequired",value:function(reason){_classPrivateFieldSet(_reason,this,reason),_classPrivateFieldSet(_reloadRequired,this,!0)}},{key:"reloadIfRequired",value:function(){if(_classPrivateFieldGet(_reloadRequired,this)){var warning=i18n(_templateObject76||(_templateObject76=_taggedTemplateLiteral(["5a1ee4a311c51fa4b76d3c7edd6bdda6::"])));return ModalDialog.showWarning("<p>".concat(warning,"</p><p>").concat(_classPrivateFieldGet(_reason,this),"</p>")).then((function(){window.location.reload()}))}return Promise.resolve()}}])}()),_storedValues=new WeakMap,SettingsValueCache=function(){return _createClass((function SettingsValueCache(definitions){for(var key in _classCallCheck(this,SettingsValueCache),_classPrivateFieldInitSpec(this,_storedValues,new Map),definitions)if(definitions[key].reloadIfChanged){var cachedValue={value:persistentData.getFromStorage(key),label:definitions[key].label};_classPrivateFieldGet(_storedValues,this).set(key,cachedValue)}}),[{key:"changes",get:function(){var labels=[];return _classPrivateFieldGet(_storedValues,this).forEach((function(cachedValue,key){persistentData.getFromStorage(key)!==cachedValue.value&&labels.push(cachedValue.label)})),labels.join(", ")}}])}(),RangeIndicator=function(_ManagedElement5){function RangeIndicator(control){var _this10;return _classCallCheck(this,RangeIndicator),(_this10=_callSuper(this,RangeIndicator,["div","utils-range-value"])).classList.add("on-top"),_this10.control=control,_this10.listenToEventOn("input",_this10.control,""),_this10.hide(),_this10}return _inherits(RangeIndicator,_ManagedElement5),_createClass(RangeIndicator,[{key:"handleInputEvent",value:function(event){var _controlEl$min,_controlEl$max,_this11=this;this.timerId||(this.timerId=setTimeout((function(){_this11.hide(),_this11.timerId=null}),500));var controlEl=this.control.element,minValue=parseFloat(null!==(_controlEl$min=controlEl.min)&&void 0!==_controlEl$min?_controlEl$min:0),maxValue=parseFloat(null!==(_controlEl$max=controlEl.max)&&void 0!==_controlEl$max?_controlEl$max:100),proportion=(parseFloat(controlEl.value)-minValue)/(maxValue-minValue);this.textContent=event.target.value,this.style.opacity=100;var top=controlEl.offsetTop-this.offsetHeight,left=controlEl.offsetLeft+controlEl.offsetWidth*proportion-this.offsetWidth/2;left=Math.max(controlEl.offsetLeft,left),left=Math.min(controlEl.offsetLeft+controlEl.offsetWidth-this.offsetWidth,left),this.style.left="".concat(left,"px"),this.style.top="".concat(top,"px"),this.show()}},{key:"hide",value:function(){this.style.opacity=0,this.style.visibility="hidden"}},{key:"show",value:function(){this.style.visibility="visible",this.style.opacity=100}}])}(ManagedElement),SeparatorControl=function(_ManagedElement6){function SeparatorControl(key,definition){var _this12;return _classCallCheck(this,SeparatorControl),(_this12=_callSuper(this,SeparatorControl,["div","utils-separator"])).innerHTML='<span class="utils-hr"><hr></span>'+"<span> ".concat(escapeHtml(definition.label)," </span>")+'<span class="utils-hr"><hr></span>',_this12}return _inherits(SeparatorControl,_ManagedElement6),_createClass(SeparatorControl)}(ManagedElement),InputControl=function(_ManagedElement7){function InputControl(key,definition){var _this13;return _classCallCheck(this,InputControl),(_this13=_callSuper(this,InputControl,["input"])).type=definition.type,_this13.setAttribute("type",definition.type),_this13.setAttribute("min",definition.min),_this13.setAttribute("max",definition.max),_this13.className=definition.type,_this13}return _inherits(InputControl,_ManagedElement7),_createClass(InputControl,[{key:"setValue",value:function(value){"checkbox"!==this.type?this.value=value:this.checked=value}},{key:"getValue",value:function(){switch(this.type){case"checkbox":return this.checked;case"range":return parseFloat(this.value);default:return this.value}}}])}(ManagedElement),_SelectControl_brand=new WeakSet,SelectControl=function(_ManagedElement8){function SelectControl(_key3,definition){var _this14;return _classCallCheck(this,SelectControl),_classPrivateMethodInitSpec(_this14=_callSuper(this,SelectControl,["select"]),_SelectControl_brand),_this14.definition=definition,definition.type&&(_this14.className=definition.type),_assertClassBrand(_SelectControl_brand,_this14,_addOptions).call(_this14),_this14}return _inherits(SelectControl,_ManagedElement8),_createClass(SelectControl,[{key:"setValue",value:function(value){console.log(value);var index=_toConsumableArray(this.$.options).findIndex((function(option){return option.value===value}));index>=0?this.$.selectedIndex=index:console.warn("Could not set select control to value of ".concat(value))}},{key:"getValue",value:function(){return this.$.selectedOptions[0].value}},{key:"getText",value:function(){return this.$.selectedOptions[0].text}},{key:"reloadOptions",value:function(){if(this.options=this.definition.options,"function"==typeof this.definition.options)for(var n=this.$.length;n-- >0;)this.$.remove(0);_assertClassBrand(_SelectControl_brand,this,_addOptions).call(this)}}])}(ManagedElement);function _addOptions(){var _this$options,_this59=this;this.options=this.definition.options,"function"==typeof this.options&&(this.options=this.options.call(this)),"function"==typeof this.options&&(this.options=this.options.call(this)),null===(_this$options=this.options)||void 0===_this$options||_this$options.forEach((function(value,key){var option=new Option(value,key);_this59.$.add(option)}))}var _managedControls=new WeakMap,LabeledControlManager=function(){return _createClass((function LabeledControlManager(){_classCallCheck(this,LabeledControlManager),_classPrivateFieldInitSpec(this,_managedControls,[])}),[{key:"createLabeledControl",value:function(key,definition,storage){var control=new LabeledControl(key,definition,{storage:storage,manager:this});return _classPrivateFieldGet(_managedControls,this).push(control),control}},{key:"removeControls",value:function(){_classPrivateFieldGet(_managedControls,this).forEach((function(control){control.remove()}))}},{key:"reloadSelectOptions",value:function(keys){var _this15=this;null==keys||keys.forEach((function(value){var dependentControl=_classPrivateFieldGet(_managedControls,_this15).find((function(control){return control.key===value}));dependentControl&&(dependentControl.control instanceof SelectControl?dependentControl.control.reloadOptions():console.log("Ignoring dependent ".concat(value," as it is not a select type.")))}))}}])}(),_storage2=new WeakMap,_manager=new WeakMap,LabeledControl=function(_ManagedElement9){function LabeledControl(key,definition,options){var _this16;return _classCallCheck(this,LabeledControl),_classPrivateFieldInitSpec(_this16=_callSuper(this,LabeledControl,["div"]),_storage2,void 0),_classPrivateFieldInitSpec(_this16,_manager,void 0),_classPrivateFieldSet(_storage2,_this16,null==options?void 0:options.storage),_classPrivateFieldSet(_manager,_this16,null==options?void 0:options.manager),_this16.className="labeled-control-container",_this16.label=new ManagedElement("label"),_this16.appendChild(_this16.label),_this16.key=key,_this16.definition=definition,_this16.label.innerHTML="<span>".concat(escapeHtml(definition.label),"</span>"),"select"===definition.type?_this16.control=new SelectControl(key,definition):_this16.control=new InputControl(key,definition),_this16.control.setValue(_classPrivateFieldGet(_storage2,_this16)?_classPrivateFieldGet(_storage2,_this16).getFromStorage(key,definition.defaultValue):definition.defaultValue),_this16.label.appendChild(_this16.control),_this16.error=_this16.appendChild(new ManagedElement("div","utils-input-error-message")),"range"===definition.type&&_this16.label.appendChild(new RangeIndicator(_this16.control)),_this16.listenToEventOn("input",_this16.control,""),_this16}return _inherits(LabeledControl,_ManagedElement9),_createClass(LabeledControl,[{key:"setValue",value:function(value){var _this$control;null===(_this$control=this.control)||void 0===_this$control||_this$control.setValue(value)}},{key:"handleInputEvent",value:function(eventIgnored){var _classPrivateFieldGet11,value=this.control.getValue();if(this.definition.validate){var validation=this.definition.validate(value);if(!validation.pass)return this.error.textContent=validation.errorMessage,void this.classList.add("utils-error")}this.classList.remove("utils-error"),null===(_classPrivateFieldGet11=_classPrivateFieldGet(_storage2,this))||void 0===_classPrivateFieldGet11||_classPrivateFieldGet11.saveToStorage(this.key,value),this.definition.onupdate&&(this.definition.onupdate(value),_classPrivateFieldGet(_manager,this)?_classPrivateFieldGet(_manager,this).reloadSelectOptions(this.definition.dependents):console.debug("LabeledControl has no manager, so unable to handle dependencies."))}}])}(ManagedElement),manager=null,settingDefinitions={};function resetIfConfirmed(){return ModalDialog.showConfirm(i18n(_templateObject77||(_templateObject77=_taggedTemplateLiteral(["0ee1cf8d6fe2d39a293bc82ddbc60666::"])))).then((function(value){if(value===ModalDialog.DialogIndex.CONFIRM_YES)return function(){for(var key in settingDefinitions){console.info("Resetting ".concat(key," to its default."));var definition=settingDefinitions[key];if(!isSeparator(definition)){var _definition$onupdate,value=definition.defaultValue;persistentData.saveToStorage(key,value),null===(_definition$onupdate=definition.onupdate)||void 0===_definition$onupdate||_definition$onupdate.call(definition,value)}}}()}))}function isSeparator(definition){return"separator"===definition.type}function loadSettingDefinitions(definitions){!function(definitions){for(var key in definitions){var _definitions$key$init,_definitions$key;null===(_definitions$key$init=(_definitions$key=definitions[key]).initialise)||void 0===_definitions$key$init||_definitions$key$init.call(_definitions$key)}}(definitions),function(definitions){for(var key in settingDefinitions=definitions)if(!isSeparator(settingDefinitions[key])){var _settingDefinitions$k,storedValue=persistentData.getFromStorage(key,settingDefinitions[key].defaultValue);null===(_settingDefinitions$k=settingDefinitions[key].onupdate)||void 0===_settingDefinitions$k||_settingDefinitions$k.call(this,storedValue)}}(definitions)}var rootUrl=embeddedLesson.hasLesson?embeddedLesson.rootUrl:window.location.href.replace(/index\.html(\?.*)?$/,"");rootUrl.endsWith("/")||(rootUrl+="/");var Urls={NON_LOCAL_ROOT:"https://henspace.github.io/text2lesson/",ROOT:"".concat(rootUrl),LOGO:"".concat(rootUrl,"assets/images/logo/bordered_logo_128.png"),HELP:"".concat(DOCS_ROOT_URL,"app-help.html"),PRIVACY:"".concat(DOCS_ROOT_URL,"privacy.html"),DOCS_HOME:"".concat(DOCS_ROOT_URL,"index.html")};function getMainMenuItems(){return[{iconDetails:icons.settings,command:{execute:function(){return function(){if(manager)return Promise.reject(new Error("Attempt made to show settings on top of another."));manager=new LabeledControlManager;var dialogContent=new ManagedElement("div");for(var key in dialogContent.innerHTML="\n    <div class='utils-palette'>\n    <span class='utils-primary'></span>\n    <span class='utils-secondary'></span>\n    <span class='utils-tertiary'></span>\n    </div>\n  ",settingDefinitions){var setting=settingDefinitions[key],control=void 0;control=isSeparator(setting)?new SeparatorControl(key,setting):manager.createLabeledControl(key,setting,persistentData),dialogContent.appendChild(control)}var settingsValueCache=new SettingsValueCache(settingDefinitions);return ModalDialog.showSettingsDialog(dialogContent).then((function(value){return value===ModalDialog.DialogIndex.SETTINGS_RESET?resetIfConfirmed():value})).then((function(value){return manager.removeControls(),manager=null,reloader.reloadIfRequired(),value})).then((function(value){var changes=settingsValueCache.changes;return""!==changes&&(reloader.flagAsRequired("".concat(i18n(_templateObject78||(_templateObject78=_taggedTemplateLiteral(["3c5d22824f5b26b56b4edfc952f083f7::"])))," ").concat(changes,".")),reloader.reloadIfRequired()),value}))}()}}},{iconDetails:null,command:null},{iconDetails:icons.privacy,command:{execute:function(){return window.open(Urls.PRIVACY,"_blank"),Promise.resolve()}}}]}function registerServiceWorker(buildMode){try{"serviceWorker"in navigator&&navigator.serviceWorker.register("./sw.js").then((function(registration){console.info("SW registered: ",registration);var controller=navigator.serviceWorker.controller;console.info("Page controlled by ".concat(controller,"."))})).catch((function(registrationError){console.error("SW registration failed: ",registrationError)}))}catch(error){console.error("Error during service worker registration",error)}}var I18nResolutionError=function(){function I18nResolutionError(error,fetchSummary){var _this17;return _classCallCheck(this,I18nResolutionError),error instanceof Error?(_this17=_callSuper(this,I18nResolutionError,[error.message])).cause=error:_this17=_callSuper(this,I18nResolutionError,[error]),_this17.fetchSummary=fetchSummary,_assertThisInitialized(_this17)}return _inherits(I18nResolutionError,_wrapNativeSuper(Error)),_createClass(I18nResolutionError)}();function resolveLanguages(languagesListingUrl){var languagesListing={},languagesBaseUrl="",fetchSummary=[];return fetchJson(languagesListingUrl).then((function(languages){languagesListing=languages,languagesBaseUrl=new URL(languages.location,window.location.href);var url=new URL(languages.meta.master,languagesBaseUrl);return fetchSummary.push({url:url,read:!1}),fetchJson(url.href)})).then((function(masterTranslations){fetchSummary[0].read=!0,setActiveTranslations(masterTranslations);var preferredLanguages,availableLanguageFiles,availableSubTags,preferredSubTags,bestMatch,bestFile=(preferredLanguages=navigator.languages,availableLanguageFiles=languagesListing.files,availableSubTags=availableLanguageFiles.map((function(entry){return extractLanguageSubTags(entry.toLowerCase().replace(/\.json$/i,""))})),preferredSubTags=preferredLanguages.map((function(entry){return extractLanguageSubTags(entry)})),bestMatch={weight:0,file:null},preferredSubTags.forEach((function(prefSubTag,prefIndexIgnored){var languageIndex=preferredSubTags.findIndex((function(element){return element.language===prefSubTag.language})),prefSubTagRank=preferredSubTags.length-languageIndex;availableSubTags.forEach((function(availSubTag,availIndex){var weight=0;prefSubTag.language===availSubTag.language&&(weight+=100*prefSubTagRank,""!==prefSubTag.region&&prefSubTag.region===availSubTag.region&&(weight+=10),""!==prefSubTag.script&&prefSubTag.script===availSubTag.script&&(weight+=1),weight>bestMatch.weight&&(bestMatch.weight=weight,bestMatch.file=availableLanguageFiles[availIndex]))}))})),bestMatch.file);if(bestFile===languagesListing.meta.master)return Promise.resolve(null);var url=new URL(bestFile,languagesBaseUrl);return fetchSummary.push({url:url,read:!1}),fetchJson(url.href)})).then((function(bestTranslations){return bestTranslations&&(fetchSummary[1].read=!0,setActiveTranslations(bestTranslations)),fetchSummary})).catch((function(error){return Promise.reject(new I18nResolutionError(error,fetchSummary))}))}function getLanguages(embeddedLanguages){if(!BuildInfo.isBuilt())return Promise.resolve(void 0);if(embeddedLanguages)try{var languages=JSON.parse(base64ToString(embeddedLanguages));return languages.fallback&&setActiveTranslations(languages.fallback),setActiveTranslations(languages.active),Promise.resolve(void 0)}catch(error){console.error("Unable to decode embedded languages ${embeddedLanguages}.",error)}return resolveLanguages("./languages.json").then((function(){console.info("Build information: ".concat(BuildInfo.getBundleName," ").concat(BuildInfo.getVersion()," ").concat(BuildInfo.getMode()))})).catch((function(error){var fetchSummary=error.fetchSummary;if(!(fetchSummary&&fetchSummary.length>0&&fetchSummary[0].read))return console.error(error.message),Promise.reject(error);console.error("".concat(error,"\nUsing translation ").concat(fetchSummary[0].url))}))}var _stage=new WeakMap,StageManager=function(){return _createClass((function StageManager(stageElement){_classCallCheck(this,StageManager),_classPrivateFieldInitSpec(this,_stage,void 0),_classPrivateFieldSet(_stage,this,new ManagedElement(stageElement))}),[{key:"startShow",value:(_startShow=_asyncToGenerator(_regeneratorRuntime().mark((function _callee(presenter){return _regeneratorRuntime().wrap((function(_context){for(;;)switch(_context.prev=_context.next){case 0:_classPrivateFieldGet(_stage,this).removeChildren();case 1:return _context.next=3,presenter.presentOnStage(_classPrivateFieldGet(_stage,this));case 3:if(presenter=_context.sent,_classPrivateFieldGet(_stage,this).removeChildren(),null!==presenter){_context.next=7;break}return _context.abrupt("return");case 7:_context.next=1;break;case 9:case"end":return _context.stop()}}),_callee,this)}))),function(_x){return _startShow.apply(this,arguments)})}]);var _startShow}(),_items=new WeakMap,_wrap=new WeakMap,_index=new WeakMap,ArrayIndexer=function(){return _createClass((function ArrayIndexer(items){var wrap=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];_classCallCheck(this,ArrayIndexer),_classPrivateFieldInitSpec(this,_items,void 0),_classPrivateFieldInitSpec(this,_wrap,void 0),_classPrivateFieldInitSpec(this,_index,void 0),_classPrivateFieldSet(_items,this,items),_classPrivateFieldSet(_wrap,this,wrap),_classPrivateFieldSet(_index,this,0)}),[{key:"items",get:function(){return _classPrivateFieldGet(_items,this)}},{key:"reset",value:function(){_classPrivateFieldSet(_index,this,0)}},{key:"decrement",value:function(){var _this$index;_classPrivateFieldGet(_index,this)>0?_classPrivateFieldSet(_index,this,(_this$index=_classPrivateFieldGet(_index,this),--_this$index)):_classPrivateFieldSet(_index,this,_classPrivateFieldGet(_wrap,this)?_classPrivateFieldGet(_items,this).length-1:_classPrivateFieldGet(_index,this)-1);return _classPrivateFieldGet(_items,this)[_classPrivateFieldGet(_index,this)]}},{key:"increment",value:function(){var _this$index2;_classPrivateFieldGet(_index,this)<_classPrivateFieldGet(_items,this).length-1?_classPrivateFieldSet(_index,this,(_this$index2=_classPrivateFieldGet(_index,this),++_this$index2)):_classPrivateFieldSet(_index,this,_classPrivateFieldGet(_wrap,this)?0:_classPrivateFieldGet(_index,this));return _classPrivateFieldGet(_items,this)[_classPrivateFieldGet(_index,this)]}}])}(),HelpButton=function(_ManagedElement10){function HelpButton(){var _this18;return _classCallCheck(this,HelpButton),(_this18=_callSuper(this,HelpButton,["button","help-button"])).classList.add("icon-only-button"),icons.applyIconToElement(icons.help,_this18,{hideText:!0}),_this18.listenToOwnEvent("click","HELP"),_this18}return _inherits(HelpButton,_ManagedElement10),_createClass(HelpButton,[{key:"handleClickEvent",value:function(eventIgnored,eventIdIgnored){var presenter=document.querySelector(".Presenter");console.debug("Help triggered from ".concat(null==presenter?void 0:presenter.className)),window.open(Urls.HELP,"_blank")}}],[{key:"createInside",value:function(container){var button=new HelpButton(container);return button.appendTo(container),button}}])}(ManagedElement),_menuContent=new WeakMap,_menuItems=new WeakMap,_Menu_brand=new WeakSet,Menu=function(_ManagedElement11){function Menu(){var _this19;return _classCallCheck(this,Menu),_classPrivateMethodInitSpec(_this19=_callSuper(this,Menu,["button"]),_Menu_brand),_classPrivateFieldInitSpec(_this19,_menuContent,void 0),_classPrivateFieldInitSpec(_this19,_menuItems,void 0),_this19.setAttribute("aria-haspopup",!0),icons.applyIconToElement(icons.openMenu,_this19,{hideText:!0}),_this19.classList.add("utils-menu-icon-open","icon-only-button"),_assertClassBrand(_Menu_brand,_this19,_createMenuContentHtml).call(_this19),_classPrivateFieldSet(_menuItems,_this19,new MenuItems),_this19}return _inherits(Menu,_ManagedElement11),_createClass(Menu,[{key:"setMenuItems",value:function(items){_classPrivateFieldGet(_menuItems,this).setMenuItems(items)}},{key:"handleClickEvent",value:function(eventIgnored,eventId){if("OPEN"===eventId)_assertClassBrand(_Menu_brand,this,_showMenuItems).call(this);else _assertClassBrand(_Menu_brand,this,_hideMenuItems).call(this)}},{key:"handleKeydownEvent",value:function(event,eventIdIgnored){"Escape"===event.key&&_assertClassBrand(_Menu_brand,this,_hideMenuItems).call(this)}}])}(ManagedElement);function _createMenuContentHtml(){var menuTitleBar=new ManagedElement("div");menuTitleBar.classList.add("utils-menu-title"),_classPrivateFieldSet(_menuContent,this,new ManagedElement("div","utils-menu-content")),_classPrivateFieldGet(_menuContent,this).style.visibility="hidden",document.body.insertBefore(_classPrivateFieldGet(_menuContent,this).element,document.getElementById("modal-mask").nextSibling);var menuItemsElement=new ManagedElement("div");menuItemsElement.classList.add("container","utils-menu-items"),menuItemsElement.setAttribute("aria-role","menu"),_classPrivateFieldGet(_menuContent,this).appendChild(menuTitleBar),_classPrivateFieldGet(_menuContent,this).appendChild(menuItemsElement),this.listenToOwnEvent("click","OPEN"),this.listenToEventOn("click",_classPrivateFieldGet(_menuContent,this),"CONTENT-ACTION"),this.listenToEventOn("keydown",_classPrivateFieldGet(_menuContent,this),"CONTENT-ACTION")}function _showMenuItems(){showMask(),this.style.visibility="hidden",_classPrivateFieldGet(_menuContent,this).classList.add("modal"),_classPrivateFieldGet(_menuContent,this).style.visibility="visible",_classPrivateFieldGet(_menuContent,this).style.transform="translateX(0)",_classPrivateFieldGet(_menuContent,this).querySelector("button.utils-menu-item").focus()}function _hideMenuItems(){hideMask(),this.style.visibility="visible",_classPrivateFieldGet(_menuContent,this).style.transform="translateX(-100%)",_classPrivateFieldGet(_menuContent,this).style.visibility="hidden",_classPrivateFieldGet(_menuContent,this).classList.remove("modal"),focusManager.findBestFocus()}var MenuItem=function(_ManagedElement12){function MenuItem(iconDetails){var _this20;return _classCallCheck(this,MenuItem),_this20=_callSuper(this,MenuItem,["button","utils-menu-item"]),icons.applyIconToElement(iconDetails,_this20),_this20.setAttributes({"aria-role":"menuitem"}),_this20}return _inherits(MenuItem,_ManagedElement12),_createClass(MenuItem)}(ManagedElement),_navigator=new WeakMap,_menuIconClose=new WeakMap,MenuItems=function(_ManagedElement13){function MenuItems(){var _this21;_classCallCheck(this,MenuItems);var parent=document.querySelector(".utils-menu-items");if(!parent)throw"Html structure not in place. createMenuHtml should have been called.";_classPrivateFieldInitSpec(_this21=_callSuper(this,MenuItems,[parent]),_navigator,void 0),_classPrivateFieldInitSpec(_this21,_menuIconClose,void 0),_this21.setAttributes({"aria-role":"menu"}),_this21.menuDefinition=null,_classPrivateFieldSet(_menuIconClose,_this21,new ManagedElement("button")),icons.applyIconToElement(icons.closeMenu,_classPrivateFieldGet(_menuIconClose,_this21),{hideText:!0}),_classPrivateFieldGet(_menuIconClose,_this21).classList.add("utils-menu-icon-close","icon-only-button");var logo=new ManagedElement("img");logo.setAttribute("src",Urls.LOGO);var title=document.querySelector(".utils-menu-title");return title.appendChild(logo.element),title.appendChild(_classPrivateFieldGet(_menuIconClose,_this21).element),_this21.listenToEventOn("click",_classPrivateFieldGet(_menuIconClose,_this21),MenuItems.CLOSE_EVENT_ID),_this21}return _inherits(MenuItems,_ManagedElement13),_createClass(MenuItems,[{key:"setMenuItems",value:function(menuDefinition){var _this22=this;this.menuDefinition&&this.remove(),this.menuDefinition=menuDefinition;var commandItems=[_classPrivateFieldGet(_menuIconClose,this)];this.menuDefinition.forEach((function(menuDef,index){var item;menuDef.command?(item=new MenuItem(menuDef.iconDetails),_this22.listenToEventOn("click",item,index),_this22.listenToEventOn("keydown",item,index),commandItems.push(item)):item=new ManagedElement("hr"),_this22.appendChild(item),_classPrivateFieldSet(_navigator,_this22,new ArrayIndexer(commandItems))}))}},{key:"handleClickEvent",value:function(event,eventId){var index=parseInt(eventId);isNaN(index)||(console.debug("Handling event ".concat(event.type," with id ").concat(eventId)),this.menuDefinition[index].command.execute().then((function(value){console.debug("Finished handling menu option ".concat(value,"."))})))}}])}(ManagedElement);_defineProperty(MenuItems,"CLOSE_EVENT_ID","close");var Header=function(){return _createClass((function Header(){_classCallCheck(this,Header)}),[{key:"setup",value:function(menuItems){var _titleElement$childre,titleElement=document.getElementById("title-bar");if(titleElement)if((null===(_titleElement$childre=titleElement.children)||void 0===_titleElement$childre?void 0:_titleElement$childre.length)>0)console.error("Second attempt made to setup title bar ignored.");else{var headerTextContainer=document.createElement("span");headerTextContainer.innerHTML=BuildInfo.getProductName();var helpButtonContainer=document.createElement("span");HelpButton.createInside(helpButtonContainer);var menu=new Menu;menu.setMenuItems(menuItems),titleElement.appendChild(menu.element),titleElement.appendChild(headerTextContainer),titleElement.appendChild(helpButtonContainer)}else console.error('Cannot find element with id of "title-bar".')}}])}(),_buttonBar2=new WeakMap,footer=new(function(){return _createClass((function Footer(){_classCallCheck(this,Footer),_classPrivateFieldInitSpec(this,_buttonBar2,void 0)}),[{key:"buttonBar",get:function(){return _classPrivateFieldGet(_buttonBar2,this)}},{key:"setup",value:function(){var _footerElement$childr,footerElement=document.getElementById("footer");if(footerElement)if((null===(_footerElement$childr=footerElement.children)||void 0===_footerElement$childr?void 0:_footerElement$childr.length)>0)console.error("Second attempt made to setup footer ignored.");else{_classPrivateFieldSet(_buttonBar2,this,new ManagedElement("div","button-bar")),footerElement.appendChild(_classPrivateFieldGet(_buttonBar2,this).element);var footerTextContainer=document.createElement("div");footerTextContainer.className="footer-text";var devTag="PRODUCTION"!==BuildInfo.getMode().toUpperCase()?"[".concat(BuildInfo.getMode(),"]"):"";footerTextContainer.innerHTML="".concat(BuildInfo.getProductName()," ").concat(BuildInfo.getVersion()).concat(devTag," ").concat(BuildInfo.getBuildDate()),footerElement.appendChild(footerTextContainer)}else console.error('Cannot find element with id of "footer".')}}])}()),header=new Header;function createLink(href,text){return'<a href="'.concat(href,'" target="_blank">').concat(text,"</a>").concat(getPrintableLink(href,text))}function getLicenceUrl(licenceName){if(/^\s*&CC0\s*$/.test(licenceName))return"https://creativecommons.org/publicdomain/zero/1.0/";if(/^\s*unsplash\s*$/i.test(licenceName))return"https://unsplash.com/license";var matchCC=/^\s*CC[ -](BY(?:-(?:SA|NC|NC-SA|ND|NC-ND))?) ?(\d+[.]\d)?\s*$/i.exec(licenceName);return matchCC?"https://creativecommons.org/licenses/".concat(matchCC[1].toLowerCase(),"/").concat(matchCC[2]||"4.0","/"):""}function buildAttribution(extendedTitle){var container=new ManagedElement("li","attribution");return extendedTitle.source?(function(container,imageSource,imageTitle){container.createAndAppendChild("span","",createLink(imageSource,imageTitle||"Untitled"))}(container,extendedTitle.source,extendedTitle.title),function(container,authors){authors&&container.createAndAppendChild("span",""," by ".concat(authors))}(container,extendedTitle.authors),function(container,notes){notes&&container.createAndAppendChild("span",""," [".concat(parseMarkdownSpanOnly(notes),"]"))}(container,extendedTitle.notes),function(container,licenceName,licenceUrl){var text;(licenceName||licenceUrl)&&(text=(licenceUrl=licenceUrl||getLicenceUrl(licenceName))?", licence: ".concat(createLink(licenceUrl,licenceName||licenceUrl)):", ".concat(licenceName),container.createAndAppendChild("span","",text))}(container,extendedTitle.licenceName,extendedTitle.licenceUrl),container):(container.createAndAppendChild("span","",parseMarkdownSpanOnly(extendedTitle.title)),container)}var _resolutionExecutor=new WeakMap,_navigator2=new WeakMap,_preamble=new WeakMap,_presentation=new WeakMap,_postamble=new WeakMap,_buttonBar3=new WeakMap,_homeButton=new WeakMap,_backwardsButton=new WeakMap,_forwardsButton=new WeakMap,_creditsButton=new WeakMap,_attributions=new WeakMap,_nextInPostamble=new WeakMap,_Presenter_brand=new WeakSet,Presenter=function(_ManagedElement14){function Presenter(config,nextInPostamble){var _this23;return _classCallCheck(this,Presenter),_classPrivateMethodInitSpec(_this23=_callSuper(this,Presenter,["div"]),_Presenter_brand),_classPrivateFieldInitSpec(_this23,_resolutionExecutor,void 0),_defineProperty(_this23,"config",void 0),_classPrivateFieldInitSpec(_this23,_navigator2,void 0),_classPrivateFieldInitSpec(_this23,_preamble,void 0),_classPrivateFieldInitSpec(_this23,_presentation,void 0),_classPrivateFieldInitSpec(_this23,_postamble,void 0),_classPrivateFieldInitSpec(_this23,_buttonBar3,void 0),_classPrivateFieldInitSpec(_this23,_homeButton,void 0),_classPrivateFieldInitSpec(_this23,_backwardsButton,void 0),_classPrivateFieldInitSpec(_this23,_forwardsButton,void 0),_classPrivateFieldInitSpec(_this23,_creditsButton,void 0),_classPrivateFieldInitSpec(_this23,_attributions,void 0),_classPrivateFieldInitSpec(_this23,_nextInPostamble,void 0),_classPrivateFieldSet(_nextInPostamble,_this23,nextInPostamble),_assertClassBrand(_Presenter_brand,_this23,_addClassNames).call(_this23),_this23.config=config,footer.buttonBar.removeChildren(),_assertClassBrand(_Presenter_brand,_this23,_buildContent).call(_this23),_this23}return _inherits(Presenter,_ManagedElement14),_createClass(Presenter,[{key:"presentation",get:function(){return _classPrivateFieldGet(_presentation,this)}},{key:"expandPresentation",value:function(){_classPrivateFieldGet(_presentation,this).classList.add("expanded")}},{key:"addButtonToBar",value:function(managedButton){_classPrivateFieldGet(_buttonBar3,this).element.insertBefore(managedButton.element,_classPrivateFieldGet(_buttonBar3,this).element.lastElementChild)}},{key:"addPreamble",value:function(data){"string"==typeof data?_classPrivateFieldGet(_preamble,this).createAndAppendChild("div",null,data):_classPrivateFieldGet(_preamble,this).appendChild(data)}},{key:"addPostamble",value:function(data){"string"==typeof data?_classPrivateFieldGet(_postamble,this).createAndAppendChild("div",null,data):_classPrivateFieldGet(_postamble,this).appendChild(data)}},{key:"hideHomeButton",value:function(){_classPrivateFieldGet(_homeButton,this).hide()}},{key:"enableHomeButton",value:function(){_classPrivateFieldGet(_homeButton,this).disabled=!1}},{key:"disableHomeButton",value:function(){_classPrivateFieldGet(_homeButton,this).disabled=!0}},{key:"showBackButton",value:function(){_classPrivateFieldGet(_backwardsButton,this).show(),focus&&_classPrivateFieldGet(_backwardsButton,this).focus()}},{key:"showNextButton",value:function(focus){_classPrivateFieldGet(_forwardsButton,this).show(),focus&&_classPrivateFieldGet(_forwardsButton,this).focus()}},{key:"applyIconToNextButton",value:function(iconDetails,overrideText){icons.applyIconToElement(iconDetails,_classPrivateFieldGet(_forwardsButton,this),{overrideText:overrideText})}},{key:"autoAddKeydownEvents",value:function(managedElements){var _this24=this;if(_classPrivateFieldGet(_navigator2,this))console.error("autoAddKeydownEvents can only be called once.");else{var items=null!=managedElements?managedElements:_classPrivateFieldGet(_presentation,this).managedChildren;_classPrivateFieldSet(_navigator2,this,new ArrayIndexer(items,!0)),items.forEach((function(item,index){_this24.listenToEventOn("keydown",item,index)}))}}},{key:"next",value:function(indexIgnored){return this.config.factory.getNext(this,this.config)}},{key:"previous",value:function(){return this.config.factory.getPrevious(this,this.config)}},{key:"presentOnStage",value:function(stageElement){var _this25=this;return new Promise((function(resolve){_classPrivateFieldSet(_resolutionExecutor,_this25,resolve),stageElement.appendChild(_this25),_this25.addAttributions(),_assertClassBrand(_Presenter_brand,_this25,_addLinkGuardians).call(_this25),_this25.onPostPresentActions(),focusManager.findBestFocus()}))}},{key:"onPostPresentActions",value:function(){}},{key:"addAttributions",value:function(){var parent,container,images;_classPrivateFieldGet(_attributions,this)&&_classPrivateFieldGet(_attributions,this).remove(),_classPrivateFieldSet(_attributions,this,(parent=document.getElementById("stage"),container=new ManagedElement("ul","attributions"),0===(images=ManagedElement.getElement(parent).querySelectorAll("img[title]")).length?null:(images.forEach((function(image){var extendedTitle=function(image){var _parts$0$trim,_parts$,_parts$1$trim,_parts$2,_parts$2$trim,_parts$3,_parts$3$trim,_parts$4,_parts$4$trim,_parts$5,_parts$5$trim,_parts$6,title=image.getAttribute("title");if(!title)return null;var parts=title.split("|");return{title:null!==(_parts$0$trim=null===(_parts$=parts[0])||void 0===_parts$?void 0:_parts$.trim())&&void 0!==_parts$0$trim?_parts$0$trim:"",source:null!==(_parts$1$trim=null===(_parts$2=parts[1])||void 0===_parts$2?void 0:_parts$2.trim())&&void 0!==_parts$1$trim?_parts$1$trim:"",authors:null!==(_parts$2$trim=null===(_parts$3=parts[2])||void 0===_parts$3?void 0:_parts$3.trim())&&void 0!==_parts$2$trim?_parts$2$trim:"",licenceName:null!==(_parts$3$trim=null===(_parts$4=parts[3])||void 0===_parts$4?void 0:_parts$4.trim())&&void 0!==_parts$3$trim?_parts$3$trim:"",licenceUrl:null!==(_parts$4$trim=null===(_parts$5=parts[4])||void 0===_parts$5?void 0:_parts$5.trim())&&void 0!==_parts$4$trim?_parts$4$trim:"",notes:null!==(_parts$5$trim=null===(_parts$6=parts[5])||void 0===_parts$6?void 0:_parts$6.trim())&&void 0!==_parts$5$trim?_parts$5$trim:""}}(image);if(extendedTitle){var attribution=buildAttribution(extendedTitle);container.appendChild(attribution)}})),container))),_classPrivateFieldGet(_attributions,this)?(_classPrivateFieldGet(_attributions,this).classList.add("for-print-only"),this.addPostamble(_classPrivateFieldGet(_attributions,this)),_classPrivateFieldGet(_creditsButton,this).show()):_classPrivateFieldGet(_creditsButton,this)&&_classPrivateFieldGet(_creditsButton,this).hide()}},{key:"askIfOkayToLeave",value:(_askIfOkayToLeave=_asyncToGenerator(_regeneratorRuntime().mark((function _callee2(message){var confirmation;return _regeneratorRuntime().wrap((function(_context2){for(;;)switch(_context2.prev=_context2.next){case 0:return _context2.next=2,ModalDialog.showConfirm(message,null,!1);case 2:return confirmation=_context2.sent,_context2.abrupt("return",confirmation===ModalDialog.DialogIndex.CONFIRM_YES);case 4:case"end":return _context2.stop()}}),_callee2)}))),function(_x2){return _askIfOkayToLeave.apply(this,arguments)})},{key:"allowNavigation",value:(_allowNavigation=_asyncToGenerator(_regeneratorRuntime().mark((function _callee3(eventIgnored,eventIdIgnored){return _regeneratorRuntime().wrap((function(_context3){for(;;)switch(_context3.prev=_context3.next){case 0:return _context3.abrupt("return",!0);case 1:case"end":return _context3.stop()}}),_callee3)}))),function(_x3,_x4){return _allowNavigation.apply(this,arguments)})},{key:"handleClickEvent",value:(_handleClickEvent=_asyncToGenerator(_regeneratorRuntime().mark((function _callee4(event,eventId){var index,upperCaseId,nextPresenter;return _regeneratorRuntime().wrap((function(_context4){for(;;)switch(_context4.prev=_context4.next){case 0:return index=parseInt(eventId),upperCaseId=eventId?eventId.toString().toUpperCase():"",_context4.next=4,this.allowNavigation(event,eventId);case 4:if(_context4.sent){_context4.next=6;break}return _context4.abrupt("return",!0);case 6:nextPresenter=null,upperCaseId===Presenter.IMAGE_INFO?ModalDialog.showConfirm(i18n(_templateObject79||(_templateObject79=_taggedTemplateLiteral(["539b541530f5235acbd3dde8b2240018::"])))).then((function(response){return response===ModalDialog.DialogIndex.CONFIRM_YES?ModalDialog.showInfo(document.querySelector(".attributions").innerHTML,i18n(_templateObject80||(_templateObject80=_taggedTemplateLiteral(["0407c27180c9b019e644e8ad4c6a9324::"])))):null})):nextPresenter=upperCaseId===Presenter.PREVIOUS_ID?this.previous():upperCaseId===Presenter.NEXT_ID?this.next(Presenter.NEXT_ID):upperCaseId===Presenter.HOME_ID?this.config.factory.getHome(this.config):this.next(isNaN(index)?eventId:index),nextPresenter&&_classPrivateFieldGet(_resolutionExecutor,this).call(this,nextPresenter);case 9:case"end":return _context4.stop()}}),_callee4,this)}))),function(_x5,_x6){return _handleClickEvent.apply(this,arguments)})},{key:"handleKeydownEvent",value:function(event,eventId){var index=parseInt(eventId);if(console.debug("Key ".concat(event.key," down for index ").concat(index)),!isNaN(index))switch(event.key){case" ":case"Enter":this.handleClickEvent(event,eventId)}}}]);var _handleClickEvent,_allowNavigation,_askIfOkayToLeave}(ManagedElement);function _addClassNames(){var item=this;do{this.classList.add(item.constructor.name),item=Object.getPrototypeOf(item)}while("Object"!==item.constructor.name)}function _buildContent(){_classPrivateFieldSet(_preamble,this,new ManagedElement("div","preamble")),_classPrivateFieldSet(_presentation,this,new ManagedElement("div","presentation")),_classPrivateFieldSet(_postamble,this,new ManagedElement("div","postamble")),_classPrivateFieldSet(_buttonBar3,this,footer.buttonBar),_assertClassBrand(_Presenter_brand,this,_addNavigationButtons).call(this),this.appendChild(_classPrivateFieldGet(_preamble,this)),this.appendChild(_classPrivateFieldGet(_presentation,this)),this.appendChild(_classPrivateFieldGet(_postamble,this)),_assertClassBrand(_Presenter_brand,this,_addAttributionButton).call(this)}function _addNavigationButtons(){_classPrivateFieldSet(_homeButton,this,new ManagedElement("button","home-navigation")),icons.applyIconToElement(icons.home,_classPrivateFieldGet(_homeButton,this)),this.listenToEventOn("click",_classPrivateFieldGet(_homeButton,this),_Presenter.HOME_ID),_classPrivateFieldGet(_buttonBar3,this).appendChild(_classPrivateFieldGet(_homeButton,this)),_classPrivateFieldSet(_backwardsButton,this,new ManagedElement("button","back-navigation")),icons.applyIconToElement(icons.back,_classPrivateFieldGet(_backwardsButton,this)),this.listenToEventOn("click",_classPrivateFieldGet(_backwardsButton,this),_Presenter.PREVIOUS_ID),_classPrivateFieldGet(_buttonBar3,this).appendChild(_classPrivateFieldGet(_backwardsButton,this)),_classPrivateFieldGet(_backwardsButton,this).hide(),_classPrivateFieldSet(_forwardsButton,this,new ManagedElement("button","forward-navigation")),icons.applyIconToElement(icons.forward,_classPrivateFieldGet(_forwardsButton,this)),this.listenToEventOn("click",_classPrivateFieldGet(_forwardsButton,this),_Presenter.NEXT_ID),_classPrivateFieldGet(_nextInPostamble,this)?this.addPostamble(_classPrivateFieldGet(_forwardsButton,this)):_classPrivateFieldGet(_buttonBar3,this).appendChild(_classPrivateFieldGet(_forwardsButton,this)),_classPrivateFieldGet(_forwardsButton,this).hide()}function _addAttributionButton(){var attributionsContainer=new ManagedElement("div","attribution-button-container");_classPrivateFieldSet(_creditsButton,this,new ManagedElement("button")),attributionsContainer.appendChild(_classPrivateFieldGet(_creditsButton,this)),icons.applyIconToElement(icons.imageInfo,_classPrivateFieldGet(_creditsButton,this),{hideText:!0}),this.listenToEventOn("click",_classPrivateFieldGet(_creditsButton,this),_Presenter.IMAGE_INFO),this.addPostamble(attributionsContainer),_classPrivateFieldGet(_creditsButton,this).hide()}function _addLinkGuardians(){var _document$getElementB,_this60=this;null===(_document$getElementB=document.getElementById("content"))||void 0===_document$getElementB||null===(_document$getElementB=_document$getElementB.querySelectorAll("a"))||void 0===_document$getElementB||_document$getElementB.forEach((function(anchor){var href=anchor.getAttribute("href");href&&new URL(href).origin!==window.location.origin&&anchor.addEventListener("click",function(){var _ref2=_asyncToGenerator(_regeneratorRuntime().mark((function _callee9(event){return _regeneratorRuntime().wrap((function(_context9){for(;;)switch(_context9.prev=_context9.next){case 0:return _context9.abrupt("return",_assertClassBrand(_Presenter_brand,_this60,_confirmOpeningLink).call(_this60,event));case 1:case"end":return _context9.stop()}}),_callee9)})));return function(_x15){return _ref2.apply(this,arguments)}}())}))}function _confirmOpeningLink(event){var destination=event.currentTarget.getAttribute("href"),question=i18n(_templateObject130||(_templateObject130=_taggedTemplateLiteral(["9204402858fd7d0731ed5eefb8e65660::",""])),destination)+"\n"+i18n(_templateObject131||(_templateObject131=_taggedTemplateLiteral(["84aa1011fb02d4087756a4a8737bae7a::",""])),BuildInfo.getProductName())+"\n"+i18n(_templateObject132||(_templateObject132=_taggedTemplateLiteral(["b67083b6acb177c627162692fceb7086::"])));confirm(question)||event.preventDefault()}_Presenter=Presenter,_defineProperty(Presenter,"HOME_ID","HOME"),_defineProperty(Presenter,"PREVIOUS_ID","BACKWARDS"),_defineProperty(Presenter,"NEXT_ID","FORWARDS"),_defineProperty(Presenter,"IMAGE_INFO","IMAGE_INFO"),_defineProperty(Presenter,"DO_NOT_CLOSE_CLASS_NAME","do-not-close");var _input=new WeakMap,FileInputButton=function(_ManagedElement15){function FileInputButton(options){var _this26;return _classCallCheck(this,FileInputButton),_classPrivateFieldInitSpec(_this26=_callSuper(this,FileInputButton,["label","file-input-button"]),_input,void 0),_this26.classList.add("selectable"),_classPrivateFieldSet(_input,_this26,new ManagedElement("input")),_classPrivateFieldGet(_input,_this26).setAttribute("type","file"),icons.applyIconToElement(icons.import,_this26,options),_classPrivateFieldGet(_input,_this26).style.visibility="hidden",_classPrivateFieldGet(_input,_this26).style.height="1em",_this26.appendChild(_classPrivateFieldGet(_input,_this26)),_this26.setAttribute("tabindex",0),_this26.listenToEventOn("change",_classPrivateFieldGet(_input,_this26)),_this26.listenToOwnEvent("keydown","KEY"),_this26}return _inherits(FileInputButton,_ManagedElement15),_createClass(FileInputButton,[{key:"handleChangeEvent",value:function(eventIgnored,eventIdIgnored){var file=_classPrivateFieldGet(_input,this).element.files[0];if(file){var reader=new FileReader,control=this;reader.addEventListener("load",(function(){reader.result,control.dispatchEvent(new CustomEvent(FileInputButton.DATA_AVAILABLE_EVENT_NAME,{detail:{file:file,content:reader.result}}))})),reader.readAsText(file)}}},{key:"handleKeydownEvent",value:function(event,eventIdIgnored){var _this27=this;switch(event.key){case" ":case"Enter":setTimeout((function(){return _this27.element.click()}))}}}])}(ManagedElement);function makeSafeFilename(filename,extension){var safename=filename.replace(/[^A-Za-z0-9_-]/g,"_").substring(0,32);return"".concat(safename,".").concat(extension)}_defineProperty(FileInputButton,"DATA_AVAILABLE_EVENT_NAME","dataAvailable");var _title3=new WeakMap,_content3=new WeakMap,_LessonExporter_brand=new WeakSet,LessonExporter=function(){return _createClass((function LessonExporter(title,content){_classCallCheck(this,LessonExporter),_classPrivateMethodInitSpec(this,_LessonExporter_brand),_classPrivateFieldInitSpec(this,_title3,void 0),_classPrivateFieldInitSpec(this,_content3,void 0),_classPrivateFieldSet(_title3,this,title),_classPrivateFieldSet(_content3,this,content)}),[{key:"exportLesson",value:function(){var _this29=this;return ModalDialog.showDialog(i18n(_templateObject82||(_templateObject82=_taggedTemplateLiteral(["b68686a697ec08b09db6d729aed81c71::"]))),i18n(_templateObject83||(_templateObject83=_taggedTemplateLiteral(["5ae903bf09202faef9d5fcedbf21cf14::"]))),{dialogType:ModalDialog.DialogType.QUESTION,buttons:[icons.export,icons.exportAutoRun]}).then((function(index){return 0===index?_this29.exportBase64Lesson():_this29.exportAutorunLesson()}))}},{key:"exportBase64Lesson",value:function(){this.saveDataToFile(stringToBase64(_classPrivateGetter(_LessonExporter_brand,this,_get_lessonAsString)),"txt")}},{key:"createAutorunLessonHtml",value:function(){var html=function(data){var rootUrl=Urls.NON_LOCAL_ROOT;return'<!DOCTYPE html>\n  <html lang="en">\n    <head>\n      <meta charset="UTF-8" />\n      <meta name="viewport" content="width=device-width, initial-scale=1.0" />\n      <title>RapidQandA</title>\n      <link\n        rel="icon"\n        type="image/png"\n        sizes="48x48"\n        href="'.concat(rootUrl,'assets/images/favicon.appiconset/favicon_48.png"\n      />\n      <link\n        rel="apple-touch-icon"\n        type="image/png"\n        sizes="167x167"\n        href="').concat(rootUrl,'assets/images/favicon.appiconset/favicon_167.png"\n      />\n      <link\n        rel="apple-touch-icon"\n        type="image/png"\n        sizes="180x180"\n        href="').concat(rootUrl,'assets/images/favicon.appiconset/favicon_180.png"\n      />\n      <link\n        rel="icon"\n        type="image/png"\n        sizes="192x192"\n        href="').concat(rootUrl,'assets/images/favicon.appiconset/favicon_192.png"\n      />\n  \n      <link rel="stylesheet" href="').concat(rootUrl,'assets/styles/style.css" />\n      <link\n        href="').concat(rootUrl,'assets/third-party/font-awesome/css/fontawesome.min.css"\n        rel="stylesheet"\n      />\n      <link\n        href="').concat(rootUrl,'assets/third-party/font-awesome/css/brands.min.css"\n        rel="stylesheet"\n      />\n      <link\n        href="').concat(rootUrl,'assets/third-party/font-awesome/css/solid.min.css"\n        rel="stylesheet"\n      />\n    </head>\n  <script>\n      window.text2LessonEmbeddedData = {\n        title: "').concat(data.b64Title,'",\n        source: "').concat(data.b64LessonData,'",\n        translations: "').concat(data.b64Translations,'",\n        rootUrl: "').concat(rootUrl,'",\n      }    \n  <\/script>\n    <body>\n      <div id="modal-mask"></div>\n      <div id="title-bar"></div>\n      <div id="content" class="container">\n        <div id="stage">\n          <p style="line-height: 100vh; text-align: center; opacity: 0.5">\n            The application is loading. Please wait a few moments.\n          </p>\n        </div>\n      </div>\n      <div id="footer" class="container"></div>\n      <script type="module" src="').concat(rootUrl,'text2lesson.js"><\/script>\n      <noscript class="always-on-top">\n        <p>\n          Your browser does not support scripts and so this application cannot\n          run. If you\'ve disabled scripts, you will need to enable them to\n          proceed. Sorry.\n        </p>\n      </noscript>\n      <div id="browser-css-not-supported">\n        <p>\n          Sorry, but your browser does not support the features necessary to run\n          this application. Try upgrading your browser to the latest version.\n        </p>\n      </div>\n    </body>\n  </html>\n  ')}({b64Title:stringToBase64(_classPrivateFieldGet(_title3,this)),b64LessonData:stringToBase64(_classPrivateFieldGet(_content3,this)),b64Translations:stringToBase64(JSON.stringify({active:activeTranslations,fallback:fallbackTranslations}))});return html}},{key:"exportAutorunLesson",value:function(){var html=this.createAutorunLessonHtml();this.saveDataToFile(html,"html")}},{key:"saveDataToFile",value:function(data,extension){var tempA=document.createElement("a");tempA.setAttribute("href",_assertClassBrand(_LessonExporter_brand,this,_getDataUri).call(this,data)),tempA.setAttribute("download",_assertClassBrand(_LessonExporter_brand,this,_getFilename).call(this,extension)),tempA.addEventListener("click",(function(){document.body.removeChild(tempA)})),document.body.appendChild(tempA),tempA.click()}}])}();function _getDataUri(data){return"data:text/plain;charset=utf-8,".concat(safeEncodeURIComponent(data))}function _get_lessonAsString(_this28){return JSON.stringify({title:_classPrivateFieldGet(_title3,_this28),content:_classPrivateFieldGet(_content3,_this28)})}function _getFilename(extension){return makeSafeFilename(_classPrivateFieldGet(_title3,this),extension)}var _LessonImporter_brand=new WeakSet,LessonImporter=function(){return _createClass((function LessonImporter(){_classCallCheck(this,LessonImporter),_classPrivateMethodInitSpec(this,_LessonImporter_brand)}),[{key:"convert",value:function(exportedData){var result=_assertClassBrand(_LessonImporter_brand,this,_getSummaryFromBase64File).call(this,exportedData);return result||((result=_assertClassBrand(_LessonImporter_brand,this,_getSummaryFromAutorunFile).call(this,exportedData))?(console.log(result.languages),result):_assertClassBrand(_LessonImporter_brand,this,_getSummaryFromPlainTextFile).call(this,exportedData))}}])}();function _getSummaryFromBase64File(data){if(data.match(/^[a-zA-Z0-9+/=]+$/))try{return JSON.parse(base64ToString(data))}catch(error){console.error(error)}return null}function _getSummaryFromAutorunFile(data){var match=data.match(/title:\s*['"]([a-zA-Z0-9+/=]+)['"]\s*,\s*source:\s*['"]([a-zA-Z0-9+/=]+)['"]/);if(match)try{return{title:base64ToString(match[1]),content:base64ToString(match[2])}}catch(error){console.error(error)}return null}function _getSummaryFromPlainTextFile(data){return data.match(/^[-#_* ]{0,3}(?:\(*([i?=xX&_\xD7])\1*[_) ]+)(.*)$/m)?{title:"",content:data}:null}var _importSummary=new WeakMap,_HomePresenter_brand=new WeakSet,HomePresenter=function(_Presenter2){function HomePresenter(config){var _this30;return _classCallCheck(this,HomePresenter),config.titles=[],config.itemClassName="library",_classPrivateMethodInitSpec(_this30=_callSuper(this,HomePresenter,[config]),_HomePresenter_brand),_classPrivateFieldInitSpec(_this30,_importSummary,void 0),_assertClassBrand(_HomePresenter_brand,_this30,_buildContent2).call(_this30),_this30.hideHomeButton(),_this30}return _inherits(HomePresenter,_Presenter2),_createClass(HomePresenter,[{key:"handleDataAvailableEvent",value:function(event,eventIdIgnored){var _event$detail,importer=new LessonImporter;(_classPrivateFieldSet(_importSummary,this,importer.convert(event.detail.content)),_classPrivateFieldGet(_importSummary,this))?this.handleClickEvent(event,HomePresenter.FILE_LIBRARY_ID):toast("Unable to import the file ".concat(null===(_event$detail=event.detail)||void 0===_event$detail||null===(_event$detail=_event$detail.file)||void 0===_event$detail?void 0:_event$detail.name,". The file may be corrupt or the wrong type of file."))}},{key:"next",value:function(index){if(index===HomePresenter.FILE_LIBRARY_ID){var unmanagedLesson=new UnmanagedLesson(_classPrivateFieldGet(_importSummary,this).title,_classPrivateFieldGet(_importSummary,this).content,LessonOrigin.FILE_SYSTEM);return this.config.lesson=unmanagedLesson.lesson,this.config.lessonInfo=unmanagedLesson.lessonInfo,this.config.factory.getSuitableProblemPresenter(this.config)}return lessonManager.usingLocalLibrary=index===HomePresenter.LOCAL_LIBRARY_ID,_get(_getPrototypeOf(HomePresenter.prototype),"next",this).call(this,index)}}])}(Presenter);function _buildContent2(){var button=new ManagedElement("button");icons.applyIconToElement(icons.library,button,{overrideText:i18n(_templateObject133||(_templateObject133=_taggedTemplateLiteral(["3f5dfb4c6fd14bfc5f2790307ab8712a::",""])),lessonManager.remoteLibraryTitle),hideText:!1}),lessonManager.isRemoteLibraryAvailable||button.setAttribute("disabled"),this.presentation.appendChild(button),this.listenToEventOn("click",button,_HomePresenter.REMOTE_LIBRARY_ID),button=new ManagedElement("button"),icons.applyIconToElement(icons.library,button,{overrideText:i18n(_templateObject134||(_templateObject134=_taggedTemplateLiteral(["d63e17b8da99189aff04b37070c61c8e::"]))),hideText:!1}),this.presentation.appendChild(button),this.listenToEventOn("click",button,_HomePresenter.LOCAL_LIBRARY_ID),button=new FileInputButton({overrideText:i18n(_templateObject135||(_templateObject135=_taggedTemplateLiteral(["9148a8aa9f535484f03b98ae018a76b6::"]))),hideText:!1}),this.presentation.appendChild(button),this.listenToEventOn(FileInputButton.DATA_AVAILABLE_EVENT_NAME,button,_HomePresenter.FILE_LIBRARY_ID),this.addPreamble(parseMarkdown(i18n(_templateObject81||(_templateObject81=_taggedTemplateLiteral(["5a62ae5db3f4f824aa6f41465bab07da::",""])),BuildInfo.getProductName())))}_HomePresenter=HomePresenter,_defineProperty(HomePresenter,"REMOTE_LIBRARY_ID","REMOTE"),_defineProperty(HomePresenter,"LOCAL_LIBRARY_ID","LOCAL"),_defineProperty(HomePresenter,"FILE_LIBRARY_ID","FILE_SYSTEM");var _ListPresenter_brand=new WeakSet,ListPresenter=function(_Presenter3){function ListPresenter(config){var _this31;return _classCallCheck(this,ListPresenter),_classPrivateMethodInitSpec(_this31=_callSuper(this,ListPresenter,[config]),_ListPresenter_brand),_assertClassBrand(_ListPresenter_brand,_this31,_buildContent3).call(_this31),_this31}return _inherits(ListPresenter,_Presenter3),_createClass(ListPresenter)}(Presenter);function _buildContent3(){var _this$config,_this$config2,_this61=this;null===(_this$config=this.config)||void 0===_this$config||null===(_this$config=_this$config.titles)||void 0===_this$config||_this$config.forEach((function(title,index){var itemElement=new ManagedElement("button",_this61.config.itemClassName);itemElement.setAttribute("tabindex","0"),_this61.presentation.appendChild(itemElement),itemElement.innerHTML=title,_this61.listenToEventOn("click",itemElement,index)})),null!==(_this$config2=this.config)&&void 0!==_this$config2&&null!==(_this$config2=_this$config2.factory)&&void 0!==_this$config2&&_this$config2.hasPrevious(this)&&this.showBackButton()}var _LibraryPresenter_brand=new WeakSet,LibraryPresenter=function(_ListPresenter2){function LibraryPresenter(config){var _this32;return _classCallCheck(this,LibraryPresenter),config.titles=lessonManager.bookTitles,config.itemClassName="book",_classPrivateMethodInitSpec(_this32=_callSuper(this,LibraryPresenter,[config]),_LibraryPresenter_brand),_assertClassBrand(_LibraryPresenter_brand,_this32,_buildPreamble).call(_this32),_this32.autoAddKeydownEvents(),_this32}return _inherits(LibraryPresenter,_ListPresenter2),_createClass(LibraryPresenter,[{key:"next",value:function(index){return lessonManager.bookIndex=index,_get(_getPrototypeOf(LibraryPresenter.prototype),"next",this).call(this,index)}}])}(ListPresenter);function _buildPreamble(){this.addPreamble("<span class='library-title'>".concat(lessonManager.libraryTitle,"</span>"))}var _BookPresenter_brand=new WeakSet,BookPresenter=function(_ListPresenter3){function BookPresenter(config){var _this33;return _classCallCheck(this,BookPresenter),config.titles=lessonManager.chapterTitles,config.itemClassName="chapter",_classPrivateMethodInitSpec(_this33=_callSuper(this,BookPresenter,[config]),_BookPresenter_brand),_this33.autoAddKeydownEvents(),_assertClassBrand(_BookPresenter_brand,_this33,_buildPreamble2).call(_this33),_this33}return _inherits(BookPresenter,_ListPresenter3),_createClass(BookPresenter,[{key:"next",value:function(index){return lessonManager.chapterIndex=index,_get(_getPrototypeOf(BookPresenter.prototype),"next",this).call(this,index)}}])}(ListPresenter);function _buildPreamble2(){this.addPreamble("<span class='library-title'>".concat(lessonManager.libraryTitle,"</span>\n    <span class='book-title'>").concat(lessonManager.bookTitle,"</span>\n    "))}var _ChapterPresenter_brand=new WeakSet,ChapterPresenter=function(_ListPresenter4){function ChapterPresenter(config){var _this34;return _classCallCheck(this,ChapterPresenter),config.titles=lessonManager.lessonTitles,config.itemClassName="lesson",_classPrivateMethodInitSpec(_this34=_callSuper(this,ChapterPresenter,[config]),_ChapterPresenter_brand),_defineProperty(_this34,"ADD_LESSON_EVENT_ID","add-lesson"),_assertClassBrand(_ChapterPresenter_brand,_this34,_buildPreamble3).call(_this34),lessonManager.usingLocalLibrary&&_assertClassBrand(_ChapterPresenter_brand,_this34,_addNewSlotButton).call(_this34),_this34.autoAddKeydownEvents(),_this34}return _inherits(ChapterPresenter,_ListPresenter4),_createClass(ChapterPresenter,[{key:"onPostPresentActions",value:function(){if(lessonManager.usingLocalLibrary){var stage=document.getElementById("stage");stage.scrollTo({top:stage.scrollHeight,behavior:"smooth"})}}},{key:"handleClickEvent",value:function(event,eventId){var _this35=this;if(eventId===this.ADD_LESSON_EVENT_ID)return lessonManager.addLessonToLocalLibrary().then((function(){_get(_getPrototypeOf(ChapterPresenter.prototype),"handleClickEvent",_this35).call(_this35,event,eventId)}));_get(_getPrototypeOf(ChapterPresenter.prototype),"handleClickEvent",this).call(this,event,eventId)}},{key:"next",value:function(index){return index===this.ADD_LESSON_EVENT_ID?new ChapterPresenter(this.config):(lessonManager.lessonIndex=index,_get(_getPrototypeOf(ChapterPresenter.prototype),"next",this).call(this,index))}}])}(ListPresenter);function _buildPreamble3(){lessonManager.usingLocalLibrary?this.addPreamble("<span class='library-title'>".concat(lessonManager.libraryTitle,"</span>")):this.addPreamble("<span class='library-title'>".concat(lessonManager.libraryTitle,"</span>\n        <span class='book-title'>").concat(lessonManager.bookTitle,"</span>\n        <span class='chapter-title'>").concat(lessonManager.chapterTitle,"</span>\n        "))}function _addNewSlotButton(){var button=new ManagedElement("button");icons.applyIconToElement(icons.addLesson,button),this.listenToEventOn("click",button,this.ADD_LESSON_EVENT_ID),this.addButtonToBar(button)}var _LessonPresenter_brand=new WeakSet,LessonPresenter=function(_Presenter4){function LessonPresenter(config){var _this36$config,_this36;return _classCallCheck(this,LessonPresenter),config.titles=["placeholder"],config.itemClassName="lesson-summary",_classPrivateMethodInitSpec(_this36=_callSuper(this,LessonPresenter,[config]),_LessonPresenter_brand),_this36.config.lessonInfo=lessonManager.currentLessonInfo,_assertClassBrand(_LessonPresenter_brand,_this36,_buildCustomContent).call(_this36),null!==(_this36$config=_this36.config)&&void 0!==_this36$config&&null!==(_this36$config=_this36$config.factory)&&void 0!==_this36$config&&_this36$config.hasPrevious(_this36)&&_this36.showBackButton(),_this36}return _inherits(LessonPresenter,_Presenter4),_createClass(LessonPresenter,[{key:"handleClickEvent",value:(_handleClickEvent2=_asyncToGenerator(_regeneratorRuntime().mark((function _callee5(event,eventId){var _this37=this;return _regeneratorRuntime().wrap((function(_context5){for(;;)switch(_context5.prev=_context5.next){case 0:_context5.t0=eventId,_context5.next=_context5.t0===LessonPresenter.PRINT_EVENT_ID||_context5.t0===Presenter.NEXT_ID?3:6;break;case 3:return _context5.next=5,_assertClassBrand(_LessonPresenter_brand,this,_loadLessonIntoConfig).call(this).then((function(loaded){if(loaded)return _get(_getPrototypeOf(LessonPresenter.prototype),"handleClickEvent",_this37).call(_this37,event,eventId);toast(i18n(_templateObject84||(_templateObject84=_taggedTemplateLiteral(["f5454c4849575729f2cd9635026e9cf5::"]))))}));case 5:return _context5.abrupt("break",8);case 6:return _context5.next=8,_get(_getPrototypeOf(LessonPresenter.prototype),"handleClickEvent",this).call(this,event,eventId);case 8:case"end":return _context5.stop()}}),_callee5,this)}))),function(_x7,_x8){return _handleClickEvent2.apply(this,arguments)})},{key:"next",value:function(eventId){switch(eventId){case LessonPresenter.EDIT_EVENT_ID:return this.config.factory.getEditor(this,this.config);case LessonPresenter.PRINT_EVENT_ID:return this.config.factory.getPrintable(this,this.config);default:return this.config.factory.getNext(this,this.config)}}},{key:"previous",value:function(){return this.config.factory.getPrevious(this,this.config)}}]);var _handleClickEvent2}(Presenter);function _buildCustomContent(){this.presentation.createAndAppendChild("p",null,i18n(_templateObject136||(_templateObject136=_taggedTemplateLiteral(["8f8bfb5f6d96fb3113a39f781f6fffe4::"]))));var summaryBlock=this.presentation.createAndAppendChild("button","lesson-summary");summaryBlock.createAndAppendChild("div","library-title",this.config.lessonInfo.titles.library),lessonManager.usingLocalLibrary||(summaryBlock.createAndAppendChild("div","book-title",this.config.lessonInfo.titles.book),summaryBlock.createAndAppendChild("div","chapter-title",this.config.lessonInfo.titles.chapter)),summaryBlock.createAndAppendChild("div","lesson-title",this.config.lessonInfo.titles.lesson),this.presentation.appendChild(summaryBlock),this.applyIconToNextButton(icons.playLesson),this.listenToEventOn("click",summaryBlock,Presenter.NEXT_ID),this.listenToEventOn("keydown",summaryBlock,Presenter.NEXT_ID),_assertClassBrand(_LessonPresenter_brand,this,_showNextButtonIfContent).call(this),_assertClassBrand(_LessonPresenter_brand,this,_addPrintButton).call(this),_assertClassBrand(_LessonPresenter_brand,this,_addEditButtonIfLocal).call(this)}function _addPrintButton(){var printButton=new ManagedElement("button");icons.applyIconToElement(icons.printPreview,printButton),this.addButtonToBar(printButton),this.listenToEventOn("click",printButton,_LessonPresenter.PRINT_EVENT_ID)}function _addEditButtonIfLocal(){if(this.config.lessonInfo.usingLocalLibrary){var editButton=new ManagedElement("button");icons.applyIconToElement(icons.edit,editButton),this.addButtonToBar(editButton),this.listenToEventOn("click",editButton,_LessonPresenter.EDIT_EVENT_ID)}}function _showNextButtonIfContent(){var _this62=this;this.config.lessonInfo.usingLocalLibrary?lessonManager.loadCurrentLesson().then((function(cachedLesson){null!=cachedLesson&&cachedLesson.content&&_this62.showNextButton()})):this.showNextButton()}function _loadLessonIntoConfig(){var _this63=this;return lessonManager.loadCurrentLesson().then((function(cachedLesson){if(cachedLesson){var lessonSource=LessonSource.createFromSource(cachedLesson.content);return _this63.config.lesson=lessonSource.convertToLesson(),!0}return!1}))}_LessonPresenter=LessonPresenter,_defineProperty(LessonPresenter,"EDIT_EVENT_ID","EDIT_LESSON"),_defineProperty(LessonPresenter,"PRINT_EVENT_ID","PRINT_LESSON");var _lessonTitleElement=new WeakMap,_lessonTitleValue=new WeakMap,_mainEditorElement=new WeakMap,_saveButton=new WeakMap,_importForm=new WeakMap,_importButton=new WeakMap,_exportButton=new WeakMap,_dirty=new WeakMap,_LessonEditorPresenter_brand=new WeakSet,LessonEditorPresenter=function(_Presenter5){function LessonEditorPresenter(config){var _this38;return _classCallCheck(this,LessonEditorPresenter),config.titles=["placeholder"],config.itemClassName="lesson-editor",_classPrivateMethodInitSpec(_this38=_callSuper(this,LessonEditorPresenter,[config]),_LessonEditorPresenter_brand),_classPrivateFieldInitSpec(_this38,_lessonTitleElement,void 0),_classPrivateFieldInitSpec(_this38,_lessonTitleValue,void 0),_classPrivateFieldInitSpec(_this38,_mainEditorElement,void 0),_classPrivateFieldInitSpec(_this38,_saveButton,void 0),_classPrivateFieldInitSpec(_this38,_importForm,void 0),_classPrivateFieldInitSpec(_this38,_importButton,void 0),_classPrivateFieldInitSpec(_this38,_exportButton,void 0),_classPrivateFieldInitSpec(_this38,_dirty,void 0),_assertClassBrand(_LessonEditorPresenter_brand,_this38,_buildCustomContent2).call(_this38),_assertClassBrand(_LessonEditorPresenter_brand,_this38,_addSaveButton).call(_this38),_assertClassBrand(_LessonEditorPresenter_brand,_this38,_addImportButton).call(_this38),_assertClassBrand(_LessonEditorPresenter_brand,_this38,_addExportButton).call(_this38),(new LocalLibrary).okayToDeleteSlot&&_assertClassBrand(_LessonEditorPresenter_brand,_this38,_addDeleteButton).call(_this38),_this38.expandPresentation(),_assertClassBrand(_LessonEditorPresenter_brand,_this38,_setEditorAsClean).call(_this38),_this38.applyIconToNextButton(icons.closeEditor),_this38.showNextButton(),_classPrivateFieldSet(_dirty,_this38,!1),_this38}return _inherits(LessonEditorPresenter,_Presenter5),_createClass(LessonEditorPresenter,[{key:"handleDataAvailableEvent",value:function(event,eventIdIgnored){var _this39=this;_classPrivateFieldGet(_importForm,this).element.reset();var _event$detail2,importSummary=(new LessonImporter).convert(event.detail.content);if(importSummary)return ModalDialog.showConfirm(i18n(_templateObject85||(_templateObject85=_taggedTemplateLiteral(["b087a0f6368816df1cbbf2700e7de192::"])))).then((function(answer){answer===ModalDialog.DialogIndex.CONFIRM_YES&&(_classPrivateFieldGet(_lessonTitleElement,_this39).setValue(importSummary.title),_classPrivateFieldSet(_lessonTitleValue,_this39,importSummary.title),_classPrivateFieldGet(_mainEditorElement,_this39).value=importSummary.content,_assertClassBrand(_LessonEditorPresenter_brand,_this39,_setEditorAsDirty).call(_this39))}));toast("Unable to import the file ".concat(null===(_event$detail2=event.detail)||void 0===_event$detail2||null===(_event$detail2=_event$detail2.file)||void 0===_event$detail2?void 0:_event$detail2.name,". The file may be corrupt or the wrong type of file."))}},{key:"handleInputEvent",value:function(eventIgnored,eventIdIgnored){_assertClassBrand(_LessonEditorPresenter_brand,this,_setEditorAsDirty).call(this)}},{key:"allowNavigation",value:(_allowNavigation2=_asyncToGenerator(_regeneratorRuntime().mark((function _callee6(eventIgnored,eventIdIgnored){return _regeneratorRuntime().wrap((function(_context6){for(;;)switch(_context6.prev=_context6.next){case 0:if(!_classPrivateFieldGet(_dirty,this)){_context6.next=4;break}return _context6.abrupt("return",this.askIfOkayToLeave(i18n(_templateObject86||(_templateObject86=_taggedTemplateLiteral(["0fd040b4b27f744bd6c771e624f1a466::"])))));case 4:return _context6.abrupt("return",!0);case 5:case"end":return _context6.stop()}}),_callee6,this)}))),function(_x9,_x10){return _allowNavigation2.apply(this,arguments)})},{key:"handleClickEvent",value:(_handleClickEvent3=_asyncToGenerator(_regeneratorRuntime().mark((function _callee7(event,eventId){return _regeneratorRuntime().wrap((function(_context7){for(;;)switch(_context7.prev=_context7.next){case 0:_context7.t0=eventId,_context7.next=_context7.t0===LessonEditorPresenter.DELETE_EVENT_ID?3:_context7.t0===LessonEditorPresenter.SAVE_EVENT_ID?9:_context7.t0===LessonEditorPresenter.EXPORT_EVENT_ID?10:11;break;case 3:return _context7.next=5,_assertClassBrand(_LessonEditorPresenter_brand,this,_deleteLessonIfConfirmed).call(this);case 5:if(_context7.sent){_context7.next=8;break}return _context7.abrupt("return");case 8:return _context7.abrupt("break",11);case 9:return _context7.abrupt("return",_assertClassBrand(_LessonEditorPresenter_brand,this,_saveLessonLocally).call(this));case 10:return _context7.abrupt("return",_assertClassBrand(_LessonEditorPresenter_brand,this,_exportLesson).call(this));case 11:return _context7.abrupt("return",_get(_getPrototypeOf(LessonEditorPresenter.prototype),"handleClickEvent",this).call(this,event,eventId));case 12:case"end":return _context7.stop()}}),_callee7,this)}))),function(_x11,_x12){return _handleClickEvent3.apply(this,arguments)})},{key:"next",value:function(eventId){return eventId===LessonEditorPresenter.DELETE_EVENT_ID?this.config.factory.getLibraryPresenter(this,this.config):_get(_getPrototypeOf(LessonEditorPresenter.prototype),"next",this).call(this,eventId)}}]);var _handleClickEvent3,_allowNavigation2}(Presenter);function _buildCustomContent2(){return _buildCustomContent3.apply(this,arguments)}function _buildCustomContent3(){return(_buildCustomContent3=_asyncToGenerator(_regeneratorRuntime().mark((function _callee10(){var cachedLesson,anchor,_this74=this;return _regeneratorRuntime().wrap((function(_context10){for(;;)switch(_context10.prev=_context10.next){case 0:return _context10.next=2,lessonManager.loadCurrentLesson();case 2:(cachedLesson=_context10.sent).content||(anchor='<a href="'.concat(Urls.HELP,'" target="_blank">')+i18n(_templateObject159||(_templateObject159=_taggedTemplateLiteral(["fa39fca56a479cf956bbbb1ca3dbfd28::"])))+"</a>",toast(i18n(_templateObject160||(_templateObject160=_taggedTemplateLiteral(["2e6512b31a1ea8a537de7f7075461fe3::"])))+" "+anchor)),_classPrivateFieldSet(_lessonTitleValue,this,this.config.lessonInfo.titles.lesson),_classPrivateFieldSet(_lessonTitleElement,this,new LabeledControl(LocalLibrary,{defaultValue:_classPrivateFieldGet(_lessonTitleValue,this),label:i18n(_templateObject161||(_templateObject161=_taggedTemplateLiteral(["b78a3223503896721cca1303f776159b::"]))),type:"input",onupdate:function(value){_classPrivateFieldSet(_lessonTitleValue,_this74,value),_assertClassBrand(_LessonEditorPresenter_brand,_this74,_setEditorAsDirty).call(_this74)}},{storage:null})),this.addPreamble(_classPrivateFieldGet(_lessonTitleElement,this)),_classPrivateFieldSet(_mainEditorElement,this,this.presentation.createAndAppendChild("textarea","lesson-editor",cachedLesson.content)),this.listenToEventOn("input",_classPrivateFieldGet(_mainEditorElement,this));case 9:case"end":return _context10.stop()}}),_callee10,this)})))).apply(this,arguments)}function _setEditorAsDirty(){_classPrivateFieldGet(_saveButton,this).disabled=!1,_classPrivateFieldSet(_dirty,this,!0),this.classList.add(Presenter.DO_NOT_CLOSE_CLASS_NAME)}function _setEditorAsClean(){_classPrivateFieldGet(_saveButton,this).disabled=!0,_classPrivateFieldSet(_dirty,this,!1),this.classList.remove(Presenter.DO_NOT_CLOSE_CLASS_NAME)}function _addSaveButton(){_classPrivateFieldSet(_saveButton,this,new ManagedElement("button")),icons.applyIconToElement(icons.save,_classPrivateFieldGet(_saveButton,this)),this.listenToEventOn("click",_classPrivateFieldGet(_saveButton,this),_LessonEditorPresenter.SAVE_EVENT_ID),this.addButtonToBar(_classPrivateFieldGet(_saveButton,this))}function _addImportButton(){_classPrivateFieldSet(_importForm,this,new ManagedElement("form","button-wrapper")),_classPrivateFieldSet(_importButton,this,new FileInputButton),_classPrivateFieldGet(_importForm,this).appendChild(_classPrivateFieldGet(_importButton,this)),this.listenToEventOn(FileInputButton.DATA_AVAILABLE_EVENT_NAME,_classPrivateFieldGet(_importButton,this),_LessonEditorPresenter.IMPORT_EVENT_ID),this.addButtonToBar(_classPrivateFieldGet(_importForm,this))}function _addExportButton(){_classPrivateFieldSet(_exportButton,this,new ManagedElement("button")),icons.applyIconToElement(icons.export,_classPrivateFieldGet(_exportButton,this)),this.listenToEventOn("click",_classPrivateFieldGet(_exportButton,this),_LessonEditorPresenter.EXPORT_EVENT_ID),this.addButtonToBar(_classPrivateFieldGet(_exportButton,this))}function _addDeleteButton(){var deleteButton=new ManagedElement("button");icons.applyIconToElement(icons.delete,deleteButton),this.listenToEventOn("click",deleteButton,_LessonEditorPresenter.DELETE_EVENT_ID),this.addButtonToBar(deleteButton)}function _deleteLessonIfConfirmed(){var _this64=this;return ModalDialog.showConfirm(i18n(_templateObject137||(_templateObject137=_taggedTemplateLiteral(["784dc4bc7f2a0374bd038e01caf85d4d::"]))),i18n(_templateObject138||(_templateObject138=_taggedTemplateLiteral(["f89bc18e7afb05b3ac03300bec624b63::"])))).then((function(response){return response===ModalDialog.DialogIndex.CONFIRM_YES&&_assertClassBrand(_LessonEditorPresenter_brand,_this64,_deleteLesson).call(_this64)}))}function _deleteLesson(){return lessonManager.deleteLocalLibraryCurrentLesson().then((function(){return!0}))}function _saveLessonLocally(){lessonManager.updateCurrentLessonContent(_classPrivateFieldGet(_lessonTitleValue,this),_classPrivateFieldGet(_mainEditorElement,this).value),_assertClassBrand(_LessonEditorPresenter_brand,this,_setEditorAsClean).call(this)}function _exportLesson(){new LessonExporter(_classPrivateFieldGet(_lessonTitleValue,this),_classPrivateFieldGet(_mainEditorElement,this).value).exportLesson()}function getRandomBetween(min,max){return Math.floor(Math.random()*(max-min)+min)}_LessonEditorPresenter=LessonEditorPresenter,_defineProperty(LessonEditorPresenter,"SAVE_EVENT_ID","SAVE"),_defineProperty(LessonEditorPresenter,"EXPORT_EVENT_ID","EXPORT"),_defineProperty(LessonEditorPresenter,"IMPORT_EVENT_ID","IMPORT"),_defineProperty(LessonEditorPresenter,"DELETE_EVENT_ID","DELETE");var Random={between:function(min,max){return getRandomBetween(min,max)},itemFrom:function(values){return values[getRandomBetween(0,values.length)]}},CelebrationTypes={HAPPY:["smiley-face","star","party-popper"],SAD:["sad-face","grimacing-face","crying-face"]},ANIMATIONS=["celebrate-left","celebrate-top","celebrate-center"];function performCelebration(className){var celebrator=document.createElement("div");celebrator.style.animationName=Random.itemFrom(ANIMATIONS),celebrator.classList.add("celebrator",className),document.body.appendChild(celebrator),celebrator.addEventListener("animationend",(function(){return celebrator.remove()})),celebrator.addEventListener("animationcancel",(function(){return celebrator.remove()}))}var _progressIndicator=new WeakMap,ProgressBar=function(_ManagedElement16){function ProgressBar(label){var _this40;return _classCallCheck(this,ProgressBar),_classPrivateFieldInitSpec(_this40=_callSuper(this,ProgressBar,["div","utils-progress-bar"]),_progressIndicator,void 0),_classPrivateFieldSet(_progressIndicator,_this40,_this40.createAndAppendChild("div","utils-progress-indicator")),_this40.value=0,_this40.setAttributes({"aria-role":"progressbar","aria-label":null!=label?label:i18n(_templateObject87||(_templateObject87=_taggedTemplateLiteral(["5c62df66d04dc944f18516f8cd6681aa::"])))}),_this40}return _inherits(ProgressBar,_ManagedElement16),_createClass(ProgressBar,[{key:"value",set:function(value){var percentValue=Math.floor(100*value);_classPrivateFieldGet(_progressIndicator,this).style.width="".concat(percentValue,"%"),this.setAttribute("aria-valuenow",percentValue)}}])}(ManagedElement),_bars=new WeakMap,StackedProgressBar=function(_ManagedElement17){function StackedProgressBar(numberOfBars,labels){var _this41;_classCallCheck(this,StackedProgressBar),_classPrivateFieldInitSpec(_this41=_callSuper(this,StackedProgressBar,["div","stacked-progress"]),_bars,[]);for(var n=0;n<numberOfBars;n++){var progressBar=_this41.appendChild(new ProgressBar(labels?labels[n]:null));_classPrivateFieldGet(_bars,_this41).push(progressBar)}return _this41}return _inherits(StackedProgressBar,_ManagedElement17),_createClass(StackedProgressBar,[{key:"setValueForBar",value:function(barIndex,value){_classPrivateFieldGet(_bars,this)[barIndex].value=value}},{key:"hideBar",value:function(index){_classPrivateFieldGet(_bars,this)[index].style.display="none"}},{key:"showBar",value:function(index){_classPrivateFieldGet(_bars,this)[index].style.display="block"}}])}(ManagedElement),ClassName={ANSWER:"problem-answer",ANSWERS:"problem-answers",INCORRECT_ANSWER:"incorrect-answer",CORRECT_ANSWER:"correct-answer",MISSED_ANSWER:"missed-answer",AVOIDED_ANSWER:"avoided-answer",QUESTION:"problem-question",SELECTED_ANSWER:"selected-answer"},ElementId={CLICKED_ANSWER:"answer",CLICKED_SUBMIT:"submit",CLICKED_NEXT:"next"},Attribute={RIGHT_OR_WRONG:"data-code"},AnswerSelectionState={UNDEFINED:0,CORRECT:1,INCORRECT:2,MISSED:3,AVOIDED:4},_problem=new WeakMap,_questionElement=new WeakMap,_answerElement=new WeakMap,_submitButton=new WeakMap,_freezeAnswers=new WeakMap,_autoAdvanceTimer=new WeakMap,_progressBars=new WeakMap,_editButton=new WeakMap,_ProblemPresenter_brand=new WeakSet,ProblemPresenter=function(_Presenter6){function ProblemPresenter(config,nextInPostamble){var _this42;return _classCallCheck(this,ProblemPresenter),config.titles=[],config.itemClassName="",_classPrivateMethodInitSpec(_this42=_callSuper(this,ProblemPresenter,[config,nextInPostamble]),_ProblemPresenter_brand),_classPrivateFieldInitSpec(_this42,_problem,void 0),_classPrivateFieldInitSpec(_this42,_questionElement,void 0),_classPrivateFieldInitSpec(_this42,_answerElement,void 0),_classPrivateFieldInitSpec(_this42,_submitButton,void 0),_classPrivateFieldInitSpec(_this42,_freezeAnswers,void 0),_classPrivateFieldInitSpec(_this42,_autoAdvanceTimer,void 0),_classPrivateFieldInitSpec(_this42,_progressBars,void 0),_classPrivateFieldInitSpec(_this42,_editButton,void 0),_assertClassBrand(_ProblemPresenter_brand,_this42,_addProgressBars).call(_this42),_classPrivateFieldSet(_problem,_this42,config.lesson.getNextProblem()),_assertClassBrand(_ProblemPresenter_brand,_this42,_updateLessonProgress).call(_this42),_classPrivateFieldSet(_questionElement,_this42,new ManagedElement("div",ClassName.QUESTION)),_classPrivateFieldGet(_questionElement,_this42).innerHTML=_classPrivateFieldGet(_problem,_this42).question.html,_classPrivateFieldSet(_answerElement,_this42,new ManagedElement("div",ClassName.ANSWERS)),_this42.presentation.appendChild(_classPrivateFieldGet(_questionElement,_this42)),_this42.presentation.appendChild(_classPrivateFieldGet(_answerElement,_this42)),_this42.addButtons(),_classPrivateFieldGet(_submitButton,_this42).show(),_classPrivateFieldSet(_freezeAnswers,_this42,!1),_this42.config.lessonInfo.origin===LessonOrigin.EMBEDDED&&_this42.hideHomeButton(),_this42.classList.add(Presenter.DO_NOT_CLOSE_CLASS_NAME),focusManager.findBestFocus(),_this42}return _inherits(ProblemPresenter,_Presenter6),_createClass(ProblemPresenter,[{key:"problem",get:function(){return _classPrivateFieldGet(_problem,this)}},{key:"questionElement",get:function(){return _classPrivateFieldGet(_questionElement,this)}},{key:"answerElement",get:function(){return _classPrivateFieldGet(_answerElement,this)}},{key:"submitButton",get:function(){return _classPrivateFieldGet(_submitButton,this)}},{key:"slideshowProgress",set:function(value){_classPrivateFieldGet(_progressBars,this).setValueForBar(ProblemPresenter.SLIDE_BAR_INDEX,value)}},{key:"showSlideshowProgress",value:function(){_classPrivateFieldGet(_progressBars,this).showBar(ProblemPresenter.SLIDE_BAR_INDEX)}},{key:"addButtons",value:function(){_assertClassBrand(_ProblemPresenter_brand,this,_addEditButtonIfLocal2).call(this),_assertClassBrand(_ProblemPresenter_brand,this,_addSubmitButton).call(this)}},{key:"enableEditButton",value:function(){_classPrivateFieldGet(_editButton,this)&&(_classPrivateFieldGet(_editButton,this).disabled=!1)}},{key:"disableEditButton",value:function(){_classPrivateFieldGet(_editButton,this)&&(_classPrivateFieldGet(_editButton,this).disabled=!0)}},{key:"presentOnStage",value:function(stage){var _this43=this;return""!==_classPrivateFieldGet(_problem,this).intro.html&&_classPrivateFieldGet(_problem,this).questionType!==QuestionType.SLIDE?ModalDialog.showInfo(_classPrivateFieldGet(_problem,this).intro.html).then((function(){return _get(_getPrototypeOf(ProblemPresenter.prototype),"presentOnStage",_this43).call(_this43,stage)})):_get(_getPrototypeOf(ProblemPresenter.prototype),"presentOnStage",this).call(this,stage)}},{key:"handleClickEvent",value:function(event,eventId){switch(eventId){case ElementId.CLICKED_ANSWER:_classPrivateFieldGet(_freezeAnswers,this)||this.processClickedAnswer(event.currentTarget);break;case ElementId.CLICKED_SUBMIT:_classPrivateFieldSet(_freezeAnswers,this,!0),_assertClassBrand(_ProblemPresenter_brand,this,_processClickedSubmit).call(this,event);break;case ProblemPresenter.EDIT_EVENT_ID:case Presenter.NEXT_ID:clearTimeout(_classPrivateFieldGet(_autoAdvanceTimer,this)),_get(_getPrototypeOf(ProblemPresenter.prototype),"handleClickEvent",this).call(this,event,eventId);break;default:_get(_getPrototypeOf(ProblemPresenter.prototype),"handleClickEvent",this).call(this,event,eventId)}}},{key:"next",value:function(eventId){return eventId===ProblemPresenter.EDIT_EVENT_ID?this.config.factory.getEditor(this,this.config):_get(_getPrototypeOf(ProblemPresenter.prototype),"next",this).call(this,eventId)}},{key:"allowNavigation",value:(_allowNavigation3=_asyncToGenerator(_regeneratorRuntime().mark((function _callee8(event,eventId){return _regeneratorRuntime().wrap((function(_context8){for(;;)switch(_context8.prev=_context8.next){case 0:if(eventId!==Presenter.HOME_ID&&eventId!==Presenter.PREVIOUS_ID&&eventId!==ProblemPresenter.EDIT_EVENT_ID){_context8.next=4;break}return _context8.abrupt("return",this.askIfOkayToLeave(i18n(_templateObject88||(_templateObject88=_taggedTemplateLiteral(["d54132fd8e2fa9a6c89e8c27bc122fc2::"])))));case 4:return _context8.abrupt("return",!0);case 5:case"end":return _context8.stop()}}),_callee8,this)}))),function(_x13,_x14){return _allowNavigation3.apply(this,arguments)})},{key:"processClickedAnswer",value:function(target){console.debug("Process ".concat(target.tagName,":").concat(target.className))}},{key:"areAnswersCorrect",value:function(){return console.debug("Override markAnswers should be overridden."),!1}},{key:"onPostPresentActions",value:function(){document.getElementById("stage").querySelectorAll("img").forEach((function(image){image.setAttribute("title",i18n(_templateObject89||(_templateObject89=_taggedTemplateLiteral(["46fa94290d78068abd7c076a5e44e446::"]))))}))}}]);var _allowNavigation3}(Presenter);function _addEditButtonIfLocal2(){this.config.lessonInfo.usingLocalLibrary&&(_classPrivateFieldSet(_editButton,this,new ManagedElement("button")),icons.applyIconToElement(icons.edit,_classPrivateFieldGet(_editButton,this)),this.addButtonToBar(_classPrivateFieldGet(_editButton,this)),this.listenToEventOn("click",_classPrivateFieldGet(_editButton,this),_ProblemPresenter.EDIT_EVENT_ID))}function _addProgressBars(){_classPrivateFieldSet(_progressBars,this,new StackedProgressBar(2,[i18n(_templateObject139||(_templateObject139=_taggedTemplateLiteral(["41c3bc7cfe5e54b683dbf2be1e24de0d::"]))),i18n(_templateObject140||(_templateObject140=_taggedTemplateLiteral(["edce7995450d7bea756c7e3f1f51c2cd::"])))])),_classPrivateFieldGet(_progressBars,this).hideBar(_ProblemPresenter.SLIDE_BAR_INDEX),_classPrivateFieldGet(_progressBars,this).setValueForBar(_ProblemPresenter.LESSON_BAR_INDEX,this.config.lesson.progress),this.addPreamble(_classPrivateFieldGet(_progressBars,this))}function _updateLessonProgress(){var _this65=this;setTimeout((function(){_classPrivateFieldGet(_progressBars,_this65).setValueForBar(_ProblemPresenter.LESSON_BAR_INDEX,_this65.config.lesson.progress)}),100)}function _addSubmitButton(){_classPrivateFieldSet(_submitButton,this,new ManagedElement("button",ClassName.ANSWER_SUBMIT)),icons.applyIconToElement(icons.submitAnswer,_classPrivateFieldGet(_submitButton,this).element),this.listenToEventOn("click",_classPrivateFieldGet(_submitButton,this),ElementId.CLICKED_SUBMIT),this.addPostamble(_classPrivateFieldGet(_submitButton,this))}function _processClickedSubmit(){var correct=this.areAnswersCorrect();this.config.lesson.markProblem(_classPrivateFieldGet(_problem,this),correct?MarkState.CORRECT:MarkState.INCORRECT),_classPrivateFieldGet(_submitButton,this).hide(),correct?_assertClassBrand(_ProblemPresenter_brand,this,_handleCorrectAnswer).call(this):_assertClassBrand(_ProblemPresenter_brand,this,_handleIncorrectAnswer).call(this)}function _handleCorrectAnswer(){var _this66=this;this.disableHomeButton(),this.disableEditButton(),performCelebration(Random.itemFrom(CelebrationTypes.HAPPY)),soundManager.playGood(),_classPrivateFieldSet(_autoAdvanceTimer,this,setTimeout((function(){return _get(_getPrototypeOf(_ProblemPresenter.prototype),"handleClickEvent",_this66).call(_this66,event,Presenter.NEXT_ID)}),_ProblemPresenter.ADVANCE_DELAY_MS))}function _handleIncorrectAnswer(){var _this67=this;setTimeout((function(){return _this67.showNextButton(!0)}),_ProblemPresenter.ADVANCE_DELAY_MS),performCelebration(Random.itemFrom(CelebrationTypes.SAD)),soundManager.playBad();var explanation=_classPrivateFieldGet(_problem,this).explanation;if(explanation.html)return ModalDialog.showInfo(explanation.html,i18n(_templateObject141||(_templateObject141=_taggedTemplateLiteral(["629851f3c76328ed4e32d0439fe0231a::"]))))}function shuffle(data){for(var count=data.length;count;){var index=Math.floor(Math.random()*count--),_ref=[data[index],data[count]];data[count]=_ref[0],data[index]=_ref[1]}return data}_ProblemPresenter=ProblemPresenter,_defineProperty(ProblemPresenter,"EDIT_EVENT_ID","EDIT"),_defineProperty(ProblemPresenter,"ADVANCE_DELAY_MS",3e3),_defineProperty(ProblemPresenter,"SLIDE_BAR_INDEX",0),_defineProperty(ProblemPresenter,"LESSON_BAR_INDEX",1);var _answerListElement=new WeakMap,_ChoiceProblemPresenter_brand=new WeakSet,ChoiceProblemPresenter=function(_ProblemPresenter2){function ChoiceProblemPresenter(config){var _this44;return _classCallCheck(this,ChoiceProblemPresenter),_classPrivateMethodInitSpec(_this44=_callSuper(this,ChoiceProblemPresenter,[config,!0]),_ChoiceProblemPresenter_brand),_classPrivateFieldInitSpec(_this44,_answerListElement,void 0),_assertClassBrand(_ChoiceProblemPresenter_brand,_this44,_buildSimpleOrMultiple).call(_this44),_this44}return _inherits(ChoiceProblemPresenter,_ProblemPresenter2),_createClass(ChoiceProblemPresenter,[{key:"processClickedAnswer",value:function(element){switch(this.problem.questionType){case QuestionType.MULTI:element.classList.toggle(ClassName.SELECTED_ANSWER);break;case QuestionType.SIMPLE:var selected=element.classList.contains(ClassName.SELECTED_ANSWER);_assertClassBrand(_ChoiceProblemPresenter_brand,this,_deselectAllAnswers).call(this),selected||_assertClassBrand(_ChoiceProblemPresenter_brand,this,_selectAnswer).call(this,element);break;default:console.error("Wrong presenter ".concat(this.constructor.name," being used for ").concat(this.problem.questionType))}}},{key:"areAnswersCorrect",value:function(){var _this45=this,correct=!0;return document.querySelectorAll(".".concat(ClassName.ANSWER)).forEach((function(element){_assertClassBrand(_ChoiceProblemPresenter_brand,_this45,_processAnswerState).call(_this45,element)||(correct=!1),element.classList.replace("selectable","selectable-off"),element.setAttribute("tabindex","-1")})),correct}},{key:"handleKeydownEvent",value:function(event,eventId){if(eventId!==ElementId.CLICKED_ANSWER)return _get(_getPrototypeOf(ChoiceProblemPresenter.prototype),"handleKeydownEvent",this).call(this,event,eventId);switch(event.key){case" ":case"Enter":event.stopPropagation(),this.handleClickEvent(event,eventId)}}}])}(ProblemPresenter);function _buildSimpleOrMultiple(){_assertClassBrand(_ChoiceProblemPresenter_brand,this,_buildAnswers).call(this),this.autoAddKeydownEvents(this.answerElement.managedChildren)}function _buildAnswers(){var _this68=this;_classPrivateFieldSet(_answerListElement,this,new ManagedElement("div")),this.answerElement.appendChild(_classPrivateFieldGet(_answerListElement,this)),_classPrivateFieldGet(_answerListElement,this).setAttributes({"aria-label":i18n(_templateObject142||(_templateObject142=_taggedTemplateLiteral(["3e67adbbda024584ca573026d35039d0::"]))),"aria-role":this.problem.questionType===QuestionType.MULTI?"":"radiogroup"});var answers=[];_assertClassBrand(_ChoiceProblemPresenter_brand,this,_pushAnswerElementsToArray).call(this,this.problem.rightAnswers,answers,!0),_assertClassBrand(_ChoiceProblemPresenter_brand,this,_pushAnswerElementsToArray).call(this,this.problem.wrongAnswers,answers,!1),shuffle(answers),answers.forEach((function(element){_classPrivateFieldGet(_answerListElement,_this68).appendChild(element),_this68.listenToEventOn("click",element,ElementId.CLICKED_ANSWER),_this68.listenToEventOn("keydown",element,ElementId.CLICKED_ANSWER)}))}function _pushAnswerElementsToArray(answers,destination,areRight){var role=this.problem.questionType===QuestionType.MULTI?"checkbox":"radio";answers.forEach((function(value){var element=new ManagedElement("button",ClassName.ANSWER);element.innerHTML=value.html,element.setSafeAttribute(Attribute.RIGHT_OR_WRONG,areRight),element.setAttributes({tabindex:"0","aria-role":role,"aria-checked":!1,"aria-label":i18n(_templateObject143||(_templateObject143=_taggedTemplateLiteral(["e5f965d7cf958839a31acefa71728846::"])))}),destination.push(element)}))}function _selectAnswer(element){element.setAttribute("aria-checked","true"),element.classList.add(ClassName.SELECTED_ANSWER)}function _deselectAnswer(element){element.setAttribute("aria-checked","false"),element.classList.remove(ClassName.SELECTED_ANSWER)}function _deselectAllAnswers(){var _this69=this;document.querySelectorAll(".".concat(ClassName.ANSWER)).forEach((function(element){_assertClassBrand(_ChoiceProblemPresenter_brand,_this69,_deselectAnswer).call(_this69,element)}))}function _processAnswerState(element){this.freezeAnswers=!0;var answerState,elementIsCorrect="true"===ManagedElement.getSafeAttribute(element,Attribute.RIGHT_OR_WRONG).toLowerCase(),selected=element.classList.contains(ClassName.SELECTED_ANSWER);return answerState=elementIsCorrect?selected?AnswerSelectionState.CORRECT:AnswerSelectionState.MISSED:selected?AnswerSelectionState.INCORRECT:AnswerSelectionState.AVOIDED,_assertClassBrand(_ChoiceProblemPresenter_brand,this,_showAnswerState).call(this,element,answerState),answerState===AnswerSelectionState.CORRECT||answerState===AnswerSelectionState.AVOIDED}function _showAnswerState(element,answerState){var className="";switch(answerState){case AnswerSelectionState.AVOIDED:className=ClassName.AVOIDED_ANSWER;break;case AnswerSelectionState.CORRECT:className=ClassName.CORRECT_ANSWER;break;case AnswerSelectionState.INCORRECT:className=ClassName.INCORRECT_ANSWER;break;case AnswerSelectionState.MISSED:className=ClassName.MISSED_ANSWER}element.classList.add(className)}function replaceSelectControl(selectControl,givenAnswer,expectedAnswer){var container=selectControl.parentElement;selectControl.remove();var givenElement=new ManagedElement("span","given-answer"),givenElementTextElement=new ManagedElement("span","given-answer-text");givenElementTextElement.textContent=givenAnswer,givenElement.appendChild(givenElementTextElement);var expectedElement=new ManagedElement("span","expected-answer");expectedElement.textContent=expectedAnswer,container.appendChild(givenElement.element),container.appendChild(expectedElement.element)}var _missingWordSelectors=new WeakMap,_missingWordCorrectAnswers=new WeakMap,_FillProblemPresenter_brand=new WeakSet,FillProblemPresenter=function(_ProblemPresenter3){function FillProblemPresenter(config){var _this46;return _classCallCheck(this,FillProblemPresenter),_classPrivateMethodInitSpec(_this46=_callSuper(this,FillProblemPresenter,[config,!0]),_FillProblemPresenter_brand),_classPrivateFieldInitSpec(_this46,_missingWordSelectors,void 0),_classPrivateFieldInitSpec(_this46,_missingWordCorrectAnswers,void 0),_assertClassBrand(_FillProblemPresenter_brand,_this46,_createMissingWordSelectors).call(_this46),_this46.answerElement.hide(),_this46}return _inherits(FillProblemPresenter,_ProblemPresenter3),_createClass(FillProblemPresenter,[{key:"areAnswersCorrect",value:function(){var _this47=this,correct=!0;return _classPrivateFieldGet(_missingWordSelectors,this).forEach((function(selectControl,index){var givenAnswer=selectControl.getText(),expectedAnswer=_classPrivateFieldGet(_missingWordCorrectAnswers,_this47)[index],container=selectControl.parentElement;replaceSelectControl(selectControl,givenAnswer,expectedAnswer),givenAnswer===expectedAnswer?_assertClassBrand(_FillProblemPresenter_brand,_this47,_showAnswerState2).call(_this47,container,AnswerSelectionState.CORRECT):(_assertClassBrand(_FillProblemPresenter_brand,_this47,_showAnswerState2).call(_this47,container,AnswerSelectionState.INCORRECT),correct=!1)})),correct}}])}(ProblemPresenter);function _createMissingWordSelectors(){var _this70=this,questionWordElements=this.questionElement.querySelectorAll(".missing-word");_classPrivateFieldSet(_missingWordCorrectAnswers,this,[]),questionWordElements.forEach((function(element){var correctAnswer=ManagedElement.getSafeAttribute(element,"data-missing-word");_classPrivateFieldGet(_missingWordCorrectAnswers,_this70).push(correctAnswer)}));var redHerrings=this.problem.firstWordsOfWrongAnswers,options=[].concat(_toConsumableArray(_classPrivateFieldGet(_missingWordCorrectAnswers,this)),_toConsumableArray(redHerrings)),settingDefinition={defaultValue:"...",options:options=["..."].concat(_toConsumableArray(shuffle(options)))};_classPrivateFieldSet(_missingWordSelectors,this,[]),questionWordElements.forEach((function(element,index){var selector=new SelectControl(index,settingDefinition);element.appendChild(selector.element),_classPrivateFieldGet(_missingWordSelectors,_this70).push(selector)})),this.autoAddKeydownEvents(_classPrivateFieldGet(_missingWordSelectors,this))}function _showAnswerState2(element,answerState){var className="";switch(answerState){case AnswerSelectionState.AVOIDED:className=ClassName.AVOIDED_ANSWER;break;case AnswerSelectionState.CORRECT:className=ClassName.CORRECT_ANSWER;break;case AnswerSelectionState.INCORRECT:className=ClassName.INCORRECT_ANSWER;break;case AnswerSelectionState.MISSED:className=ClassName.MISSED_ANSWER}element.classList.add(className)}var _missingWordSelectors2=new WeakMap,_missingWordCorrectAnswers2=new WeakMap,_OrderProblemPresenter_brand=new WeakSet,OrderProblemPresenter=function(_ProblemPresenter4){function OrderProblemPresenter(config){var _this48;return _classCallCheck(this,OrderProblemPresenter),_classPrivateMethodInitSpec(_this48=_callSuper(this,OrderProblemPresenter,[config,!0]),_OrderProblemPresenter_brand),_classPrivateFieldInitSpec(_this48,_missingWordSelectors2,void 0),_classPrivateFieldInitSpec(_this48,_missingWordCorrectAnswers2,void 0),_assertClassBrand(_OrderProblemPresenter_brand,_this48,_buildOrder).call(_this48),_this48}return _inherits(OrderProblemPresenter,_ProblemPresenter4),_createClass(OrderProblemPresenter,[{key:"areAnswersCorrect",value:function(){var _this49=this,correct=!0;return _classPrivateFieldGet(_missingWordSelectors2,this).forEach((function(selectControl,index){var givenAnswer=selectControl.getText(),expectedAnswer=_classPrivateFieldGet(_missingWordCorrectAnswers2,_this49)[index],container=selectControl.parentElement;replaceSelectControl(selectControl,givenAnswer,expectedAnswer),givenAnswer===expectedAnswer?_assertClassBrand(_OrderProblemPresenter_brand,_this49,_showAnswerState3).call(_this49,container,AnswerSelectionState.CORRECT):(_assertClassBrand(_OrderProblemPresenter_brand,_this49,_showAnswerState3).call(_this49,container,AnswerSelectionState.INCORRECT),correct=!1)})),correct}}])}(ProblemPresenter);function _buildOrder(){var _this$problem$rightAn,_this$problem$wrongAn;_classPrivateFieldSet(_missingWordCorrectAnswers2,this,null===(_this$problem$rightAn=this.problem.rightAnswers)||void 0===_this$problem$rightAn?void 0:_this$problem$rightAn.map((function(value){return value instanceof TextItem?value.plainText.trim():value.trim()})));var redHerrings=null===(_this$problem$wrongAn=this.problem.wrongAnswers)||void 0===_this$problem$wrongAn?void 0:_this$problem$wrongAn.map((function(value){return value instanceof TextItem?value.plainText.trim():value.trim()})),options=[].concat(_toConsumableArray(_classPrivateFieldGet(_missingWordCorrectAnswers2,this)),_toConsumableArray(redHerrings)),settingDefinition={defaultValue:"...",options:options=["..."].concat(_toConsumableArray(shuffle(options)))},orderedAnswers=new ManagedElement("div","problem-ordered-answers");_classPrivateFieldSet(_missingWordSelectors2,this,[]);for(var index=0;index<this.problem.rightAnswers.length;index++){var span=new ManagedElement("span","missing-word"),selectControl=new SelectControl(index,settingDefinition);_classPrivateFieldGet(_missingWordSelectors2,this).push(selectControl),span.appendChild(selectControl),orderedAnswers.appendChild(span)}this.answerElement.appendChild(orderedAnswers),this.autoAddKeydownEvents(_classPrivateFieldGet(_missingWordSelectors2,this))}function _showAnswerState3(element,answerState){var className="";switch(answerState){case AnswerSelectionState.AVOIDED:className=ClassName.AVOIDED_ANSWER;break;case AnswerSelectionState.CORRECT:className=ClassName.CORRECT_ANSWER;break;case AnswerSelectionState.INCORRECT:className=ClassName.INCORRECT_ANSWER;break;case AnswerSelectionState.MISSED:className=ClassName.MISSED_ANSWER}element.classList.add(className)}var _secondsPerWord=new WeakMap,ReadSpeedCalculator=function(){function ReadSpeedCalculator(){var wordsPerMinute=arguments.length>0&&void 0!==arguments[0]?arguments[0]:130;_classCallCheck(this,ReadSpeedCalculator),_classPrivateFieldInitSpec(this,_secondsPerWord,void 0),this.setWordsPerMinute(wordsPerMinute)}return _createClass(ReadSpeedCalculator,[{key:"setWordsPerMinute",value:function(wordsPerMinute){var wpm=parseInt(wordsPerMinute);isNaN(wpm)?console.error("Attempt made to set words per minute to non-numeric value of ".concat(wordsPerMinute)):(wpm=Math.max(wordsPerMinute,ReadSpeedCalculator.MIN_WPM),wpm=Math.min(wpm,ReadSpeedCalculator.MAX_WPM),_classPrivateFieldSet(_secondsPerWord,this,60/wpm))}},{key:"getSecondsToRead",value:function(data){return getPlainTextFromHtml(data).trim().split(/\s+/).length*_classPrivateFieldGet(_secondsPerWord,this)}}])}();_defineProperty(ReadSpeedCalculator,"MIN_WPM",80),_defineProperty(ReadSpeedCalculator,"MAX_WPM",1e3);var _blocks=new WeakMap,_index2=new WeakMap,_readSpeedCalculator=new WeakMap,_DisplayCards_brand=new WeakSet,DisplayCards=function(){return _createClass((function DisplayCards(_html2){_classCallCheck(this,DisplayCards),_classPrivateMethodInitSpec(this,_DisplayCards_brand),_classPrivateFieldInitSpec(this,_blocks,void 0),_classPrivateFieldInitSpec(this,_index2,void 0),_classPrivateFieldInitSpec(this,_readSpeedCalculator,void 0),_classPrivateFieldSet(_blocks,this,_assertClassBrand(_DisplayCards_brand,this,_splitHtml).call(this,_html2)),_classPrivateFieldSet(_index2,this,0),_classPrivateFieldSet(_readSpeedCalculator,this,new ReadSpeedCalculator)}),[{key:"progress",get:function(){return 0===_classPrivateFieldGet(_blocks,this).length?1:_classPrivateFieldGet(_index2,this)/_classPrivateFieldGet(_blocks,this).length}},{key:"getNext",value:function(){if(_classPrivateFieldGet(_index2,this)<_classPrivateFieldGet(_blocks,this).length){var _this$index3,_this$index4,html=_classPrivateFieldGet(_blocks,this)[(_classPrivateFieldSet(_index2,this,(_this$index3=_classPrivateFieldGet(_index2,this),_this$index4=_this$index3++,_this$index3)),_this$index4)];return{html:html,readTimeSecs:_classPrivateFieldGet(_readSpeedCalculator,this).getSecondsToRead(html)}}return null}},{key:"hasMore",get:function(){return _classPrivateFieldGet(_index2,this)<_classPrivateFieldGet(_blocks,this).length}},{key:"reset",value:function(){_classPrivateFieldSet(_index2,this,0)}},{key:"setWordsPerMinute",value:function(wpm){_classPrivateFieldGet(_readSpeedCalculator,this).setWordsPerMinute(wpm)}}])}();function _splitHtml(html){for(var blocks=html.split(/(<\/(?:p|div|pre)>)/i),result=[],iterations=Math.ceil(blocks.length/2),index=0;index<iterations;index++){var _blocks2,tail=null!==(_blocks2=blocks[2*index+1])&&void 0!==_blocks2?_blocks2:"";result.push("".concat(blocks[2*index]).concat(tail).trim())}return result.filter((function(e){return!!e.replace(/(<\/?[a-zA-Z]+>|\s+)/g,"")}))}var supportsPassive=!1;try{var opts=Object.defineProperty({},"passive",{get:function(){supportsPassive=!0}});window.addEventListener("testPassive",null,opts),window.removeEventListener("testPassive",null,opts)}catch(errorIgnored){console.log("Passive option for listeners not supported.")}var _startX=new WeakMap,_startY=new WeakMap,_distanceX=new WeakMap,_distanceY=new WeakMap,_gesturing=new WeakMap,_startTime=new WeakMap,_maxTimeMs=new WeakMap,_minRadius=new WeakMap,Gesture=function(_ManagedElement18){function Gesture(element){var _this50;_classCallCheck(this,Gesture),_classPrivateFieldInitSpec(_this50=_callSuper(this,Gesture,[element]),_startX,void 0),_classPrivateFieldInitSpec(_this50,_startY,void 0),_classPrivateFieldInitSpec(_this50,_distanceX,void 0),_classPrivateFieldInitSpec(_this50,_distanceY,void 0),_classPrivateFieldInitSpec(_this50,_gesturing,!1),_classPrivateFieldInitSpec(_this50,_startTime,void 0),_classPrivateFieldInitSpec(_this50,_maxTimeMs,500),_classPrivateFieldInitSpec(_this50,_minRadius,100);var options=supportsPassive?{passive:!0}:void 0;return _this50.listenToOwnEvent("touchstart","start",options),_this50.listenToOwnEvent("touchend","end"),_this50.listenToOwnEvent("touchcancel","cancel"),_this50}return _inherits(Gesture,_ManagedElement18),_createClass(Gesture,[{key:"handleTouchstartEvent",value:function(event,eventIdIgnored){_classPrivateFieldSet(_gesturing,this,!0),_classPrivateFieldSet(_startTime,this,(new Date).getTime()),_classPrivateFieldSet(_startX,this,event.touches[0].pageX),_classPrivateFieldSet(_startY,this,event.touches[0].pageY)}},{key:"handleTouchendEvent",value:function(event,eventIdIgnored){if(event.changedTouches.length>1)console.debug("Ignore multiple touches.");else{_classPrivateFieldSet(_distanceX,this,event.changedTouches[0].pageX-_classPrivateFieldGet(_startX,this)),_classPrivateFieldSet(_distanceY,this,_classPrivateFieldGet(_startY,this)-event.changedTouches[0].pageY),_classPrivateFieldSet(_gesturing,this,!1);var elapsedMs=(new Date).getTime()-_classPrivateFieldGet(_startTime,this);if(elapsedMs>_classPrivateFieldGet(_maxTimeMs,this))console.debug("Gesture too slow at ".concat(elapsedMs," ms"));else{var radius=Math.sqrt(_classPrivateFieldGet(_distanceX,this)*_classPrivateFieldGet(_distanceX,this)+_classPrivateFieldGet(_distanceY,this)*_classPrivateFieldGet(_distanceY,this));if(radius<_classPrivateFieldGet(_minRadius,this))console.debug("Gesture too short at ".concat(radius," px"));else{var angle=this.calcAngleInDeg(_classPrivateFieldGet(_distanceX,this),_classPrivateFieldGet(_distanceY,this));console.debug("Direction ".concat(angle," degrees"));var direction=this.getDirection(angle);this.element.dispatchEvent(new CustomEvent("gesture",{detail:direction}))}}}}},{key:"handleTouchcancelEvent",value:function(eventIgnored,eventIdIgnored){_classPrivateFieldSet(_gesturing,this,!1)}},{key:"getDirection",value:function(angle){return angle<0&&(angle+=360),angle<45?Gesture.Direction.RIGHT:angle<135?Gesture.Direction.UP:angle<225?Gesture.Direction.LEFT:angle<315?Gesture.Direction.DOWN:Gesture.Direction.RIGHT}},{key:"calcAngleInDeg",value:function(x,y){return 180*Math.atan2(y,x)/Math.PI}}])}(ManagedElement);_defineProperty(Gesture,"Direction",{UP:0,RIGHT:1,DOWN:2,LEFT:3});var MediaClass={PAUSE:"pause",PLAY:"play",SKIP:"skip"},MediaID={PAUSE:"pause",PLAY:"play",SKIP:"skip"},CardState={INACTIVE:0,ARRIVING:1,READING:2,LEAVING:3},ENTRY_CLASS_NAMES=["card-onscreen-slide","card-onscreen-spin"],_cards=new WeakMap,_visualCard=new WeakMap,_skipButton=new WeakMap,_playButton=new WeakMap,_pauseButton=new WeakMap,_readTimerId=new WeakMap,_cardState=new WeakMap,_currentCardDetail=new WeakMap,_paused=new WeakMap,_lastAnimationClass=new WeakMap,_SlideProblemPresenter_brand=new WeakSet,SlideProblemPresenter=function(_ProblemPresenter5){function SlideProblemPresenter(config){var _this51;return _classCallCheck(this,SlideProblemPresenter),config.nextInPostamble=!1,_classPrivateMethodInitSpec(_this51=_callSuper(this,SlideProblemPresenter,[config]),_SlideProblemPresenter_brand),_classPrivateFieldInitSpec(_this51,_cards,void 0),_classPrivateFieldInitSpec(_this51,_visualCard,void 0),_classPrivateFieldInitSpec(_this51,_skipButton,void 0),_classPrivateFieldInitSpec(_this51,_playButton,void 0),_classPrivateFieldInitSpec(_this51,_pauseButton,void 0),_classPrivateFieldInitSpec(_this51,_readTimerId,void 0),_classPrivateFieldInitSpec(_this51,_cardState,CardState.INACTIVE),_classPrivateFieldInitSpec(_this51,_currentCardDetail,void 0),_classPrivateFieldInitSpec(_this51,_paused,void 0),_classPrivateFieldInitSpec(_this51,_lastAnimationClass,void 0),_assertClassBrand(_SlideProblemPresenter_brand,_this51,_buildSlideShow).call(_this51),_this51.submitButton.hide(),_this51}return _inherits(SlideProblemPresenter,_ProblemPresenter5),_createClass(SlideProblemPresenter,[{key:"presentOnStage",value:function(stageElement){var _this52=this;return _assertClassBrand(_SlideProblemPresenter_brand,this,_showMediaButtons).call(this,!0),setTimeout((function(){return _assertClassBrand(_SlideProblemPresenter_brand,_this52,_showNextCard).call(_this52)})),_get(_getPrototypeOf(SlideProblemPresenter.prototype),"presentOnStage",this).call(this,stageElement)}},{key:"handleClickEvent",value:function(event,eventId){switch(eventId){case MediaID.PAUSE:return void _assertClassBrand(_SlideProblemPresenter_brand,this,_pauseTheShow).call(this);case MediaID.PLAY:return clearTimeout(_classPrivateFieldGet(_readTimerId,this)),_assertClassBrand(_SlideProblemPresenter_brand,this,_showMediaButtons).call(this,!0),_classPrivateFieldGet(_cardState,this)===CardState.READING&&_assertClassBrand(_SlideProblemPresenter_brand,this,_removeCard).call(this),void _classPrivateFieldSet(_paused,this,!1);case MediaID.SKIP:return void _assertClassBrand(_SlideProblemPresenter_brand,this,_skip).call(this);case ProblemPresenter.EDIT_EVENT_ID:case Presenter.HOME_ID:_assertClassBrand(_SlideProblemPresenter_brand,this,_pauseTheShow).call(this)}_get(_getPrototypeOf(SlideProblemPresenter.prototype),"handleClickEvent",this).call(this,event,eventId)}},{key:"next",value:function(eventId){return clearTimeout(_classPrivateFieldGet(_readTimerId,this)),_get(_getPrototypeOf(SlideProblemPresenter.prototype),"next",this).call(this,eventId)}},{key:"handleAnimationendEvent",value:function(eventIgnored,eventIdIgnored){switch(_classPrivateFieldGet(_cardState,this)){case CardState.ARRIVING:_assertClassBrand(_SlideProblemPresenter_brand,this,_readCard).call(this);break;case CardState.LEAVING:_assertClassBrand(_SlideProblemPresenter_brand,this,_showNextCard).call(this);break;default:console.error("Animation unexpectedly ended with card in state ".concat(_classPrivateFieldGet(_cardState,this)))}}},{key:"handleGestureEvent",value:function(event,eventIdIgnored){console.debug("Gesture direction ".concat(event.detail)),_assertClassBrand(_SlideProblemPresenter_brand,this,_skip).call(this,event.detail)}}])}(ProblemPresenter);function _buildSlideShow(){var cardHtml=this.problem.intro.html||"";this.problem.question.html&&(toast(i18n(_templateObject144||(_templateObject144=_taggedTemplateLiteral(["16646c2ea6b771d167bbcd871072f930::"])))),cardHtml+=this.problem.question.html),_classPrivateFieldSet(_cards,this,new DisplayCards(cardHtml)),_classPrivateFieldSet(_visualCard,this,new ManagedElement("div","display-card")),this.managedChildren.push(new Gesture(_classPrivateFieldGet(_visualCard,this).element)),this.listenToEventOn("gesture",_classPrivateFieldGet(_visualCard,this)),this.listenToEventOn("animationend",_classPrivateFieldGet(_visualCard,this)),this.questionElement.removeChildren(),this.questionElement.appendChild(_classPrivateFieldGet(_visualCard,this)),this.expandPresentation(),_assertClassBrand(_SlideProblemPresenter_brand,this,_addMediaButtons).call(this),this.showSlideshowProgress()}function _addMediaButtons(){_classPrivateFieldSet(_playButton,this,new ManagedElement("button",MediaClass.PLAY)),_assertClassBrand(_SlideProblemPresenter_brand,this,_addButtonToButtonBar).call(this,_classPrivateFieldGet(_playButton,this),icons.play,MediaID.PLAY),_classPrivateFieldSet(_pauseButton,this,new ManagedElement("button",MediaClass.PAUSE)),_assertClassBrand(_SlideProblemPresenter_brand,this,_addButtonToButtonBar).call(this,_classPrivateFieldGet(_pauseButton,this),icons.pause,MediaID.PAUSE),_classPrivateFieldSet(_skipButton,this,new ManagedElement("button",MediaClass.SKIP)),_assertClassBrand(_SlideProblemPresenter_brand,this,_addButtonToButtonBar).call(this,_classPrivateFieldGet(_skipButton,this),icons.skip,MediaID.SKIP)}function _addButtonToButtonBar(button,icon,eventId){icons.applyIconToElement(icon,button.element),this.listenToEventOn("click",button,eventId),this.addButtonToBar(button)}function _setCardState(cardState,direction){switch(cardState){case CardState.ARRIVING:_assertClassBrand(_SlideProblemPresenter_brand,this,_applyAnimationClass).call(this,Random.itemFrom(ENTRY_CLASS_NAMES));break;case CardState.LEAVING:_assertClassBrand(_SlideProblemPresenter_brand,this,_applyAnimationClass).call(this,_assertClassBrand(_SlideProblemPresenter_brand,this,_getExitClassForDirection).call(this,direction))}_classPrivateFieldSet(_cardState,this,cardState)}function _applyAnimationClass(className){_assertClassBrand(_SlideProblemPresenter_brand,this,_removeLastAnimationClass).call(this),_classPrivateFieldSet(_lastAnimationClass,this,className),_classPrivateFieldGet(_visualCard,this).classList.add(className)}function _removeLastAnimationClass(){_classPrivateFieldGet(_lastAnimationClass,this)&&_classPrivateFieldGet(_visualCard,this).classList.remove(_classPrivateFieldGet(_lastAnimationClass,this)),_classPrivateFieldSet(_lastAnimationClass,this,"")}function _getExitClassForDirection(direction){var rootClass="card-offscreen";switch(direction){case Gesture.Direction.UP:return"".concat(rootClass,"-up");case Gesture.Direction.LEFT:return"".concat(rootClass,"-left");case Gesture.Direction.DOWN:return"".concat(rootClass,"-down");case Gesture.Direction.RIGHT:default:return"".concat(rootClass,"-right")}}function _showNextCard(){if(console.log("Show the next card"),_assertClassBrand(_SlideProblemPresenter_brand,this,_endShowIfLastCard).call(this))this.handleClickEvent(new Event("click"),Presenter.NEXT_ID);else{var readingSpeed=persistentData.getFromStorage("readingSpeed",130);_classPrivateFieldGet(_cards,this).setWordsPerMinute(readingSpeed),_classPrivateFieldSet(_currentCardDetail,this,_classPrivateFieldGet(_cards,this).getNext()),this.slideshowProgress=_classPrivateFieldGet(_cards,this).progress,_classPrivateFieldGet(_visualCard,this).innerHTML=_classPrivateFieldGet(_currentCardDetail,this).html,this.addAttributions(),_assertClassBrand(_SlideProblemPresenter_brand,this,_autoPauseIfAppropriate).call(this,_classPrivateFieldGet(_currentCardDetail,this).html),_classPrivateFieldGet(_visualCard,this).element.scrollTo(0,0),_assertClassBrand(_SlideProblemPresenter_brand,this,_limitCardSize).call(this),_assertClassBrand(_SlideProblemPresenter_brand,this,_setCardState).call(this,CardState.ARRIVING),_assertClassBrand(_SlideProblemPresenter_brand,this,_endShowIfLastCard).call(this)}}function _limitCardSize(){var container=this.questionElement.element.getBoundingClientRect();_classPrivateFieldGet(_visualCard,this).style.maxHeight="".concat(container.height-5,"px")}function _autoPauseIfAppropriate(cardHtml){_classPrivateFieldGet(_paused,this)||(/<a\s*[^>]*href=[^>]+\s*>.*?<\/a>/i.test(cardHtml)||/<iframe[^>]+><\/iframe>/.test(cardHtml))&&(_assertClassBrand(_SlideProblemPresenter_brand,this,_pauseTheShow).call(this),toast(i18n(_templateObject145||(_templateObject145=_taggedTemplateLiteral(["16c592cb26e97758cde37bda13b3bc4e::"])))))}function _readCard(){var _this71=this;_assertClassBrand(_SlideProblemPresenter_brand,this,_setCardState).call(this,CardState.READING);var readTimeMs=Math.max(_SlideProblemPresenter.MIN_READ_TIME_MS,1e3*_classPrivateFieldGet(_currentCardDetail,this).readTimeSecs);_classPrivateFieldGet(_paused,this)||_classPrivateFieldSet(_readTimerId,this,setTimeout((function(){_assertClassBrand(_SlideProblemPresenter_brand,_this71,_removeCard).call(_this71)}),readTimeMs))}function _removeCard(direction){_assertClassBrand(_SlideProblemPresenter_brand,this,_setCardState).call(this,CardState.LEAVING,direction)}function _endShowIfLastCard(){return!_classPrivateFieldGet(_cards,this).hasMore}function _pauseTheShow(){clearTimeout(_classPrivateFieldGet(_readTimerId,this)),_assertClassBrand(_SlideProblemPresenter_brand,this,_showMediaButtons).call(this,!1),_classPrivateFieldSet(_paused,this,!0)}function _skip(direction){clearTimeout(_classPrivateFieldGet(_readTimerId,this)),_classPrivateFieldGet(_cardState,this)!==CardState.ARRIVING&&_classPrivateFieldGet(_cardState,this)!==CardState.READING||_assertClassBrand(_SlideProblemPresenter_brand,this,_removeCard).call(this,direction)}function _showMediaButtons(playing){playing?(_classPrivateFieldGet(_pauseButton,this).show(),_classPrivateFieldGet(_playButton,this).hide(),_classPrivateFieldGet(_skipButton,this).show(),_classPrivateFieldGet(_pauseButton,this).focus(),this.disableEditButton(),this.disableHomeButton()):(_classPrivateFieldGet(_pauseButton,this).hide(),_classPrivateFieldGet(_playButton,this).show(),_classPrivateFieldGet(_skipButton,this).show(),_classPrivateFieldGet(_playButton,this).focus(),this.enableEditButton(),this.enableHomeButton())}_SlideProblemPresenter=SlideProblemPresenter,_defineProperty(SlideProblemPresenter,"MIN_READ_TIME_MS",3e3);var MAX_CONFETTI=20,CONFETTI_CLASSES=["square","heart","star"],MIN_FALL_TIME_MS=3e3,MAX_FALL_TIME_MS=6e3,MIN_ROTATION_DEG=-45,MAX_ROTATION_DEG=45;function shareByEmail(data){var url=function(options){var url="mailto:".concat(options.to,"?subject=").concat(options.subject,"&body=").concat(options.body);return encodeURI(url)}(data);window.open(url,"_blank")}function shareCertificateContent(content){var html=function(content){return"<!DOCTYPE html>\n  <html lang=\"en\">\n    <head>\n      <meta charset=\"UTF-8\" />\n      <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\" />\n      <title>RapidQandA</title>\n      <style>\n        html {\n          font-family: Verdana, Geneva, Tahoma, sans-serif;\n          font-size: calc(15px + 0.390625vw);\n          margin: 0;\n          overflow-x: hidden;\n          padding: 0;\n        }\n        \n        .MarksPresenter .answer-summary {\n          overflow: hidden;\n          text-overflow: ellipsis;\n          white-space: nowrap;\n        }\n        \n        .MarksPresenter .answer-summary div,\n        .MarksPresenter .answer-summary p,\n        .MarksPresenter .answer-summary table,\n        .MarksPresenter .answer-summary tr,\n        .MarksPresenter .answer-summary td,\n        .MarksPresenter .answer-summary h1,\n        .MarksPresenter .answer-summary h2,\n        .MarksPresenter .answer-summary h3,\n        .MarksPresenter .answer-summary h4,\n        .MarksPresenter .answer-summary h5,\n        .MarksPresenter .answer-summary h6 {\n          display: inline;\n          padding: 0px;\n        }\n        \n        .MarksPresenter .removed-image::before,\n        .MarksPresenter .removed-iframe::before {\n          content: '🖼️';\n        }\n        \n        .MarksPresenter .answer-summary tr {\n          border: none;\n          margin-right: 0px;\n          vertical-align: baseline;\n        }\n        \n        .MarksPresenter .maths::before {\n          content: '{';\n        }\n        \n        .MarksPresenter .maths::after {\n          content: '}';\n        }\n        \n        .MarksPresenter .answer-summary .maths tr:first-child::after {\n          content: '\\00f7';\n        }\n         \n        .MarksPresenter .answer-summary.correct::before {\n          content: '\\2714 \\FE0F';\n        }\n        \n        .MarksPresenter .answer-summary.incorrect::before {\n          content: '\\274c';\n        }\n        \n        .MarksPresenter .answer-summary.skipped::before {\n          content: '\\274c';\n        }\n        .MarksPresenter {\n          margin: 0.3rem;\n          padding: 0.3rem;\n          border: double 2px;\n        }\n        \n        .MarksPresenter h1,\n        .MarksPresenter h2,\n        .MarksPresenter h3 {\n          margin-top: 0.3rem;\n          text-align: center;\n        }\n        \n        .MarksPresenter h1,\n        .MarksPresenter .result-summary {\n          text-align: center;\n        }\n        .MarksPresenter .result-summary::after {\n          font-size: 3em;\n        }\n        .MarksPresenter .result-summary.poor::after {\n          content: '\\1f62c';\n        }\n        .MarksPresenter .result-summary.bad::after {\n          content: '\\1f614';\n        }\n        .MarksPresenter .result-summary.good::after {\n          content: '\\1f948';\n        }\n        .MarksPresenter .result-summary.excellent::after {\n          content: '\\1f947';\n        }\n        \n        .MarksPresenter .certificate-date {\n          text-align: center;\n        }\n\n      </style>\n    </head>\n    <body>\n        <div id=\"content\" class='container'>\n          ".concat(content,'\n        </div>\n        <div id="footer">\n          Content generated by <a href ="').concat(Urls.DOCS_HOME,'">RapidQandA</a>.\n        </div>\n    </body>\n  </html>\n  ')}(content);return shareHtmlFile({filename:"RapidQandA_certificate.html",text:i18n(_templateObject90||(_templateObject90=_taggedTemplateLiteral(["dfd6f9728bcb769f1e9a952bb09639f9::"]))),title:i18n(_templateObject91||(_templateObject91=_taggedTemplateLiteral(["e2a379f488c6d5cdaea817a49233f8f7::"]))),html:html}).then((function(shareResult){return shareResult||toast(shareResult.message),shareResult.success}))}function shareHtmlFile(data){var _navigator3,fileToShare=new File([data.html],data.filename,{type:"text/html"}),shareData={text:data.text,title:data.title,files:[fileToShare]};return null!==(_navigator3=navigator)&&void 0!==_navigator3&&_navigator3.canShare(shareData)?navigator.share(shareData).then((function(){return console.debug("Share completed okay."),{success:!0,errorMessage:""}})).catch((function(error){return console.error(error.message),{success:!1,errorMessage:error.message}})):(console.error("Cannot share:",shareData),Promise.resolve({success:!1,errorMessage:i18n(_templateObject93||(_templateObject93=_taggedTemplateLiteral(["0e6df631691794b9ba4dafed9f559b62::"])))}))}function getLicenceElement(metadata){var author=parseMarkdownSpanOnly(metadata.getValue("AUTHOR","")),copyright=metadata.getValue("COPYRIGHT",""),licence=metadata.getValue("LICENCE",metadata.getValue("LICENSE","")),licenceUrl=getLicenceUrl(licence);licence&&licenceUrl&&(licence='<a href="'.concat(licenceUrl,'" target="_blank">').concat(licence,"</a>").concat(getPrintableLink(licenceUrl,!0)));var attribution=metadata.getValue("ATTRIBUTION","");if(author||copyright){var metaContainer=new ManagedElement("div","lesson-metadata");metaContainer.createAndAppendChild("span","",i18n(_templateObject94||(_templateObject94=_taggedTemplateLiteral(["c88f4d8367545a6a659429ec8315cd8c::"])))+" ");var showAuthor=copyright.toLowerCase().indexOf(author.toLowerCase())<0;return showAuthor&&metaContainer.createAndAppendChild("span","",i18n(_templateObject95||(_templateObject95=_taggedTemplateLiteral(["14ad0a45bab24bb09057ed42dfc0a927::",""])),author)),copyright&&metaContainer.createAndAppendChild("span","","".concat(showAuthor?"; ":"","&copy; ").concat(copyright)),licence&&metaContainer.createAndAppendChild("span","","; "+i18n(_templateObject96||(_templateObject96=_taggedTemplateLiteral(["8165ebe4d62ee0c0f4b9dda713446b75::",""])),licence)),attribution&&metaContainer.createAndAppendChild("span","","; ".concat(attribution)),metaContainer}return null}var MedalDetails={POOR:{upperLimit:25,cssClass:"poor",emojiCode:"😬"},BAD:{upperLimit:50,cssClass:"bad",emojiCode:"😔"},GOOD:{upperLimit:75,cssClass:"good",emojiCode:"🥈"},EXCELLENT:{upperLimit:100,cssClass:"excellent",emojiCode:"🥇"}},_marks=new WeakMap,_assignedMedal=new WeakMap,_completionDateText=new WeakMap,_scoreSummaryText=new WeakMap,_MarksPresenter_brand=new WeakSet,MarksPresenter=function(_Presenter7){function MarksPresenter(config){var _this53;return _classCallCheck(this,MarksPresenter),_classPrivateMethodInitSpec(_this53=_callSuper(this,MarksPresenter,[config]),_MarksPresenter_brand),_classPrivateFieldInitSpec(_this53,_marks,void 0),_classPrivateFieldInitSpec(_this53,_assignedMedal,void 0),_classPrivateFieldInitSpec(_this53,_completionDateText,void 0),_classPrivateFieldInitSpec(_this53,_scoreSummaryText,void 0),_assertClassBrand(_MarksPresenter_brand,_this53,_buildContent4).call(_this53),_this53}return _inherits(MarksPresenter,_Presenter7),_createClass(MarksPresenter,[{key:"next",value:function(eventId){switch(eventId){case MarksPresenter.EMAIL_ID:return _assertClassBrand(_MarksPresenter_brand,this,_emailResults).call(this);case MarksPresenter.WEBSHARE_CERTIFICATE_ID:return _assertClassBrand(_MarksPresenter_brand,this,_webShareResults).call(this);case MarksPresenter.WEBSHARE_AUTORUN_ID:return _assertClassBrand(_MarksPresenter_brand,this,_webShareAutorun).call(this);case MarksPresenter.RETRY_LESSON_ID:return this.config.factory.getProblemAgain(this,this.config);case MarksPresenter.EDIT_LESSON_ID:return this.config.factory.getEditor(this,this.config);case Presenter.NEXT_ID:if(this.config.lessonInfo.origin===LessonOrigin.EMBEDDED)return void window.top.location.replace(embeddedLesson.rootUrl)}return _get(_getPrototypeOf(MarksPresenter.prototype),"next",this).call(this,eventId)}}])}(Presenter);function _buildContent4(){_assertClassBrand(_MarksPresenter_brand,this,_addMetadata).call(this),_assertClassBrand(_MarksPresenter_brand,this,_addHeadings).call(this),_assertClassBrand(_MarksPresenter_brand,this,_addAnswers).call(this),_assertClassBrand(_MarksPresenter_brand,this,_addResult).call(this),_assertClassBrand(_MarksPresenter_brand,this,_addEditButtonIfLocal3).call(this),_assertClassBrand(_MarksPresenter_brand,this,_addRetryButton).call(this),_assertClassBrand(_MarksPresenter_brand,this,_addShareButtons).call(this),_assertClassBrand(_MarksPresenter_brand,this,_adjustButtonsForOrigin).call(this)}function _adjustButtonsForOrigin(){switch(this.config.lessonInfo.origin){case LessonOrigin.EMBEDDED:this.hideHomeButton(),this.applyIconToNextButton(icons.exit),this.showNextButton();break;case LessonOrigin.REMOTE:this.applyIconToNextButton(icons.selectLesson),this.showNextButton()}}function _addMetadata(){var licenceElement=getLicenceElement(this.config.lesson.metadata);licenceElement&&this.addPostamble(licenceElement)}function _addHeadings(){var lessonTitle=this.config.lessonInfo.titles.lesson||this.config.lesson.metadata.getValue("TITLE",i18n(_templateObject146||(_templateObject146=_taggedTemplateLiteral(["80ba26f176878a8c09fed91eec1847ac::"]))));this.presentation.createAndAppendChild("h1",null,i18n(_templateObject147||(_templateObject147=_taggedTemplateLiteral(["8a7b5ed72835af8c2804d8f5047da3d3::"])))),this.presentation.createAndAppendChild("h2",null,lessonTitle),_assertClassBrand(_MarksPresenter_brand,this,_addBookDetailsIfManaged).call(this)}function _addBookDetailsIfManaged(){if(this.config.lessonInfo.managed){var bookDetails="<p>from:</p>";lessonManager.usingLocalLibrary?bookDetails+="<span class='library-title'>".concat(this.config.lessonInfo.titles.library,"</span>"):bookDetails+="<span class='library-title'>".concat(this.config.lessonInfo.titles.library,"</span> \n        <span class='book-title'>").concat(this.config.lessonInfo.titles.book,"</span>\n        <span class='chapter-title'>").concat(this.config.lessonInfo.titles.chapter,"</span>"),this.presentation.createAndAppendChild("div",null,bookDetails)}}function _addRetryButton(){if(!this.config.lesson.isEmpty){var repeatButton=new ManagedElement("button");icons.applyIconToElement(icons.repeatLesson,repeatButton),this.addButtonToBar(repeatButton),this.listenToEventOn("click",repeatButton,_MarksPresenter.RETRY_LESSON_ID)}}function _addEditButtonIfLocal3(){if(this.config.lessonInfo.usingLocalLibrary){var editButton=new ManagedElement("button");icons.applyIconToElement(icons.edit,editButton),this.addButtonToBar(editButton),this.listenToEventOn("click",editButton,_MarksPresenter.EDIT_LESSON_ID)}}function _addAnswers(){var _this72=this,answers=new ManagedElement("div");this.config.lesson.marks.markedItems.forEach((function(markedItem){var item=new ManagedElement("div","answer-summary"),html=_assertClassBrand(_MarksPresenter_brand,_this72,_stripImages).call(_this72,markedItem.item.question.html);html=function(html){return html.replace(/<math[^>]*?>/g,(function(match){return match.replace(/display\s*=\s*"\w*"/,'display="inline"')}))}(html),item.innerHTML=html,item.classList.add(_assertClassBrand(_MarksPresenter_brand,_this72,_getClassForMarkState).call(_this72,markedItem.state)),answers.appendChild(item)})),this.presentation.appendChild(answers)}function _addResult(){var marks=this.config.lesson.marks,totalQuestions=marks.correct+marks.incorrect+marks.skipped,percent=0==totalQuestions?100:Math.round(100*marks.correct/totalQuestions);_classPrivateFieldSet(_scoreSummaryText,this,i18n(_templateObject148||(_templateObject148=_taggedTemplateLiteral(["dba099f02fa6e674228bce51535a5cc4::","","",""])),percent,marks.correct,totalQuestions));var summaryItem=this.presentation.createAndAppendChild("p","result-summary",_classPrivateFieldGet(_scoreSummaryText,this)),formattedDate=this.config.lesson.lastUpdated.toUTCString();_classPrivateFieldSet(_completionDateText,this,i18n(_templateObject149||(_templateObject149=_taggedTemplateLiteral(["53e3d2e5830fd971a267c3eafc432a8e::",""])),formattedDate)),this.presentation.createAndAppendChild("p","certificate-date",_classPrivateFieldGet(_completionDateText,this)),summaryItem.classList.add(_assertClassBrand(_MarksPresenter_brand,this,_calcMedalClass).call(this,percent)),percent>=MedalDetails.GOOD.upperLimit&&function(){for(var _loop=function(){var piece=document.createElement("div");piece.className="confetti";var pieceContent=document.createElement("div");pieceContent.style.transform="rotate(".concat(Random.between(MIN_ROTATION_DEG,MAX_ROTATION_DEG),"deg)"),piece.appendChild(pieceContent),piece.classList.add(Random.itemFrom(CONFETTI_CLASSES)),piece.style.animationDuration="".concat(Random.between(MIN_FALL_TIME_MS,MAX_FALL_TIME_MS),"ms"),document.body.appendChild(piece),piece.addEventListener("animationend",(function(){console.debug("remove confetti"),piece.remove()})),piece.addEventListener("animationcancel",(function(){console.debug("remove confetti"),piece.remove()}));var width=document.body.getBoundingClientRect().width,pieceWidth=piece.getBoundingClientRect().width;piece.style.left="".concat(Random.between(pieceWidth,width-pieceWidth),"px")},n=0;n<MAX_CONFETTI;n++)_loop()}()}function _calcMedalClass(percent){for(var key in MedalDetails){var details=MedalDetails[key];if(percent<details.upperLimit)return _classPrivateFieldSet(_assignedMedal,this,details),details.cssClass}return _classPrivateFieldSet(_assignedMedal,this,MedalDetails.EXCELLENT),MedalDetails.EXCELLENT.cssClass}function _getClassForMarkState(state){switch(state){case MarkState.CORRECT:return"correct";case MarkState.INCORRECT:return"incorrect";case MarkState.SKIPPED:return"skipped"}return"unknown-state"}function _addShareButtons(){window.navigator.canShare?(_assertClassBrand(_MarksPresenter_brand,this,_addWebShareCertificateButton).call(this),_assertClassBrand(_MarksPresenter_brand,this,_addWebShareAutorunButton).call(this)):_assertClassBrand(_MarksPresenter_brand,this,_addEmailButton).call(this)}function _addEmailButton(){var button=new ManagedElement("button");icons.applyIconToElement(icons.email,button),this.addButtonToBar(button),this.listenToEventOn("click",button,_MarksPresenter.EMAIL_ID)}function _addWebShareCertificateButton(){var button=new ManagedElement("button");icons.applyIconToElement(icons.webshareCertificate,button),this.addButtonToBar(button),this.listenToEventOn("click",button,_MarksPresenter.WEBSHARE_CERTIFICATE_ID)}function _addWebShareAutorunButton(){var button=new ManagedElement("button");icons.applyIconToElement(icons.webshareAutorun,button),this.addButtonToBar(button),this.listenToEventOn("click",button,_MarksPresenter.WEBSHARE_AUTORUN_ID)}function _getPlainTextResults(){var lines=[];return lines.push(i18n(_templateObject150||(_templateObject150=_taggedTemplateLiteral(["5360706c803a759e3a9f2ca54a651950::"])))),lines.push(i18n(_templateObject151||(_templateObject151=_taggedTemplateLiteral(["a72d7818259186043d2f433a9f561cf2::"])))),lines.push("  "+this.config.lessonInfo.titles.lesson),this.config.lessonInfo.managed&&(lines.push(i18n(_templateObject152||(_templateObject152=_taggedTemplateLiteral(["e1a6cba340f937b5c357f57a6a0d45d8::",""])),this.config.lessonInfo.titles.library)),lessonManager.usingLocalLibrary||(lines.push("  "+i18n(_templateObject153||(_templateObject153=_taggedTemplateLiteral(["2c0ada6268b7e2c54130e00745611f1c::",""])),this.config.lessonInfo.titles.book)),lines.push("  "+i18n(_templateObject154||(_templateObject154=_taggedTemplateLiteral(["6b529e195602103a6e254f133c41564b::",""])),this.config.lessonInfo.titles.chapter)))),lines.push("\n"),lines.push("____________________"),lines.push(_classPrivateFieldGet(_scoreSummaryText,this)+" ".concat(_classPrivateFieldGet(_assignedMedal,this).emojiCode)),lines.push(_classPrivateFieldGet(_completionDateText,this)),lines.push("____________________"),lines.push("\n"),lines.push(i18n(_templateObject155||(_templateObject155=_taggedTemplateLiteral(["Find out more about "," at ",""])),BuildInfo.getProductName(),Urls.DOCS_HOME)),lines.join("\n")}function _emailResults(){shareByEmail({to:"",subject:i18n(_templateObject156||(_templateObject156=_taggedTemplateLiteral(["8f18d381d525fbb0ac77c0839ccdee27::",""])),BuildInfo.getProductName()),body:_assertClassBrand(_MarksPresenter_brand,this,_getPlainTextResults).call(this)})}function _webShareResults(){shareCertificateContent(document.getElementById("content").innerHTML)}function _webShareAutorun(){var title,lesson,html;title=this.config.lessonInfo.titles.lesson,lesson=this.config.lesson,html=new LessonExporter(title,lesson.rawSource).createAutorunLessonHtml(),shareHtmlFile({filename:makeSafeFilename("autorun_"+title,"html"),text:title,title:i18n(_templateObject92||(_templateObject92=_taggedTemplateLiteral(["7d110d77edd2c8dbdd7b09a8a75abddf::"]))),html:html}).then((function(shareResult){return shareResult||toast(shareResult.message),shareResult.success}))}function _stripImages(html){return html=(html=html.replace(/<img[^>]*?>(?:<\/img>)?/g,'<span class="removed-image"</span>')).replace(/<iframe[^>]*?><\/iframe>/g,'<span class="removed-iframe"</span>')}_MarksPresenter=MarksPresenter,_defineProperty(MarksPresenter,"RETRY_LESSON_ID","RETRY_LESSON"),_defineProperty(MarksPresenter,"EMAIL_ID","EMAIL"),_defineProperty(MarksPresenter,"WEBSHARE_CERTIFICATE_ID","WEBSHARE_CERTIFICATE"),_defineProperty(MarksPresenter,"WEBSHARE_AUTORUN_ID","WEBSHARE_AUTORUN"),_defineProperty(MarksPresenter,"EDIT_LESSON_ID","EDIT_LESSON");var _PrintableLessonPresenter_brand=new WeakSet,PrintableLessonPresenter=function(_Presenter8){function PrintableLessonPresenter(config){var _this54;return _classCallCheck(this,PrintableLessonPresenter),_classPrivateMethodInitSpec(_this54=_callSuper(this,PrintableLessonPresenter,[config]),_PrintableLessonPresenter_brand),_assertClassBrand(_PrintableLessonPresenter_brand,_this54,_buildContent5).call(_this54),_assertClassBrand(_PrintableLessonPresenter_brand,_this54,_addPrintButton2).call(_this54),_assertClassBrand(_PrintableLessonPresenter_brand,_this54,_addFontButton).call(_this54),_this54.showBackButton(),_this54}return _inherits(PrintableLessonPresenter,_Presenter8),_createClass(PrintableLessonPresenter,[{key:"addAttributions",value:function(){_get(_getPrototypeOf(PrintableLessonPresenter.prototype),"addAttributions",this).call(this),this.addPostamble(i18n(_templateObject97||(_templateObject97=_taggedTemplateLiteral(["a70fd8f5681fff49ff36d2db5d3f63a0::",""])),(new Date).toLocaleDateString()))}},{key:"handleClickEvent",value:function(event,eventId){switch(eventId){case PrintableLessonPresenter.FONT_EVENT_ID:return void _assertClassBrand(_PrintableLessonPresenter_brand,this,_toggleFontSize).call(this);case PrintableLessonPresenter.PRINT_EVENT_ID:return void window.print();default:_get(_getPrototypeOf(PrintableLessonPresenter.prototype),"handleClickEvent",this).call(this,event,eventId)}}}])}(Presenter);function _buildContent5(){_assertClassBrand(_PrintableLessonPresenter_brand,this,_addMetadata2).call(this),_assertClassBrand(_PrintableLessonPresenter_brand,this,_addTitleBlock).call(this),_assertClassBrand(_PrintableLessonPresenter_brand,this,_addProblems).call(this)}function _addMetadata2(){var licenceElement=getLicenceElement(this.config.lesson.metadata);licenceElement&&this.addPostamble(licenceElement)}function _addTitleBlock(){var titleBlock=new ManagedElement("div","lesson-summary");titleBlock.createAndAppendChild("p","library-title",this.config.lessonInfo.titles.library),lessonManager.usingLocalLibrary||(titleBlock.createAndAppendChild("p","book-title",this.config.lessonInfo.titles.book),titleBlock.createAndAppendChild("p","chapter-title",this.config.lessonInfo.titles.chapter)),titleBlock.createAndAppendChild("p","lesson-title",this.config.lessonInfo.titles.lesson),this.addPreamble(titleBlock)}function _addPrintButton2(){var printButton=new ManagedElement("button");icons.applyIconToElement(icons.print,printButton),this.addButtonToBar(printButton),this.listenToEventOn("click",printButton,_PrintableLessonPresenter.PRINT_EVENT_ID)}function _addFontButton(){var fontButton=new ManagedElement("button");icons.applyIconToElement(icons.fontSize,fontButton),this.addButtonToBar(fontButton),this.listenToEventOn("click",fontButton,_PrintableLessonPresenter.FONT_EVENT_ID)}function _addProblems(){var _this73=this,questionList=this.presentation.createAndAppendChild("ol","print-problems");this.config.lesson.problems.forEach((function(problem){_assertClassBrand(_PrintableLessonPresenter_brand,_this73,_addProblem).call(_this73,questionList,problem)}))}function _addProblem(listContainer,problem){var listItem=listContainer.createAndAppendChild("li");switch(problem.questionType){case QuestionType.SIMPLE:case QuestionType.MULTI:_assertClassBrand(_PrintableLessonPresenter_brand,this,_addMultipleChoiceProblem).call(this,listItem,problem);break;case QuestionType.FILL:_assertClassBrand(_PrintableLessonPresenter_brand,this,_addFillInProblem).call(this,listItem,problem);break;case QuestionType.ORDER:_assertClassBrand(_PrintableLessonPresenter_brand,this,_addOrderProblem).call(this,listItem,problem);break;case QuestionType.SLIDE:_assertClassBrand(_PrintableLessonPresenter_brand,this,_addSlideshowProblem).call(this,listItem,problem)}}function _addMultipleChoiceProblem(listItem,problem){listItem.classList.add("multiple-choice-problem"),listItem.createAndAppendChild("p","print-intro",problem.intro.html),listItem.createAndAppendChild("p","print-question",problem.question.html);var _step7,answersContainer=listItem.createAndAppendChild("div","print-answers"),_iterator7=_createForOfIteratorHelper(shuffle([].concat(_toConsumableArray(problem.rightAnswers),_toConsumableArray(problem.wrongAnswers))));try{for(_iterator7.s();!(_step7=_iterator7.n()).done;){var answer=_step7.value;answersContainer.createAndAppendChild("div","print-option",answer.html)}}catch(err){_iterator7.e(err)}finally{_iterator7.f()}}function _addFillInProblem(listItem,problem){listItem.classList.add("fill-in-blanks-problem"),listItem.createAndAppendChild("p","print-intro",problem.intro.html),listItem.createAndAppendChild("p","print-question",problem.question.html);var answersContainer=listItem.createAndAppendChild("p","print-word-options");answersContainer.createAndAppendChild("span",null,i18n(_templateObject157||(_templateObject157=_taggedTemplateLiteral(["486e338518ccf29db06728f35e5cbe7a::"]))));var redHerrings=problem.firstWordsOfWrongAnswers,missingWords=problem.question.missingWords;shuffle([].concat(_toConsumableArray(missingWords),_toConsumableArray(redHerrings))).forEach((function(answer,index){answersContainer.createAndAppendChild("span","print-option","".concat(0===index?"":", ").concat(answer))}))}function _addOrderProblem(listItem,problem){listItem.classList.add("order-problem"),listItem.createAndAppendChild("p","print-intro",problem.intro.html),listItem.createAndAppendChild("p","print-question",problem.question.html),listItem.createAndAppendChild("p",null,i18n(_templateObject158||(_templateObject158=_taggedTemplateLiteral(["2c31a9b339ff3547cf370d814f7d20df::"]))));var answersContainer=listItem.createAndAppendChild("div","print-word-options");shuffle([].concat(_toConsumableArray(problem.firstWordsOfRightAnswers),_toConsumableArray(problem.firstWordsOfWrongAnswers))).forEach((function(answer){var option=answersContainer.createAndAppendChild("div","print-order-option");option.createAndAppendChild("span","number-box"," "),option.createAndAppendChild("span","print-option",answer)}))}function _addSlideshowProblem(listItem,problem){listItem.classList.add("slideshow-problem"),listItem.createAndAppendChild("p","print-intro",problem.intro.html)}function _toggleFontSize(){this.classList.toggle("use-large-font")}_PrintableLessonPresenter=PrintableLessonPresenter,_defineProperty(PrintableLessonPresenter,"PRINT_EVENT_ID","PRINT_LESSON"),_defineProperty(PrintableLessonPresenter,"FONT_EVENT_ID","CHANGE_FONT");var NAVIGATION={HomePresenter:{previous:null,next:LibraryPresenter},LibraryPresenter:{previous:HomePresenter,next:BookPresenter},BookPresenter:{previous:LibraryPresenter,next:ChapterPresenter},ChapterPresenter:{previous:BookPresenter,next:LessonPresenter},LessonPresenter:{previous:ChapterPresenter,next:ProblemPresenter},LessonEditorPresenter:{previous:LessonPresenter,next:LessonPresenter},PrintableLessonPresenter:{previous:LessonPresenter,next:LessonPresenter},ProblemPresenter:{previous:null,next:ProblemPresenter},ChoiceProblemPresenter:{previous:null,next:ProblemPresenter},FillProblemPresenter:{previous:null,next:ProblemPresenter},OrderProblemPresenter:{previous:null,next:ProblemPresenter},SlideProblemPresenter:{previous:null,next:ProblemPresenter},MarksPresenter:{previous:null,next:ChapterPresenter}},_PresenterFactory_brand=new WeakSet,PresenterFactory=function(){function PresenterFactory(){_classCallCheck(this,PresenterFactory),_classPrivateMethodInitSpec(this,_PresenterFactory_brand)}return _createClass(PresenterFactory,[{key:"getSuitableProblemPresenter",value:function(config){switch(config.lesson.peekAtNextProblem().questionType){case QuestionType.ORDER:return new OrderProblemPresenter(config);case QuestionType.FILL:return new FillProblemPresenter(config);case QuestionType.MULTI:case QuestionType.SIMPLE:return new ChoiceProblemPresenter(config);case QuestionType.SLIDE:default:return new SlideProblemPresenter(config)}}},{key:"hasNext",value:function(caller){return!!NAVIGATION[caller.constructor.name].next}},{key:"hasPrevious",value:function(caller){return!!NAVIGATION[caller.constructor.name].previous}},{key:"getHome",value:function(config){return new HomePresenter(config)}},{key:"getEditor",value:function(caller,config){return caller instanceof LessonPresenter||caller instanceof ProblemPresenter||caller instanceof MarksPresenter?new LessonEditorPresenter(config):(console.error("Attempt to edit a presenter for which there is no editor. Going home."),new HomePresenter(config))}},{key:"getNext",value:function(caller,config){if(caller instanceof ProblemPresenter||caller instanceof LessonPresenter)return config.lesson.hasMoreProblems?this.getSuitableProblemPresenter(config):new MarksPresenter(config);var klass=_assertClassBrand(_PresenterFactory_brand,this,_skipUnnecessaryListPresenters).call(this,NAVIGATION[caller.constructor.name].next);return klass?new klass(config):null}},{key:"getPrevious",value:function(caller,config){var klass=NAVIGATION[caller.constructor.name].previous;return klass?new klass(config):null}},{key:"getProblemAgain",value:function(caller,config){return caller instanceof MarksPresenter?(config.lesson.restart(),config.lesson.hasMoreProblems?this.getSuitableProblemPresenter(config):new MarksPresenter(config)):(console.error("Attempt to retry problem from other than a MarksPresenter."),this.getHome(config))}},{key:"getLibraryPresenter",value:function(callerIgnored,config){return new(_assertClassBrand(_PresenterFactory_brand,this,_skipUnnecessaryListPresenters).call(this,LibraryPresenter))(config)}},{key:"getPrintable",value:function(caller,config){return caller instanceof LessonPresenter?new PrintableLessonPresenter(config):(console.error("Attempt to get a printable presenter from other than a LessonPresenter."),this.config.lesson=null,new HomePresenter(config))}}],[{key:"getInitial",value:function(){var config={factory:new PresenterFactory};return embeddedLesson.hasLesson?(config.lesson=embeddedLesson.lesson,config.lessonInfo=embeddedLesson.lessonInfo,config.lesson.hasMoreProblems?config.factory.getSuitableProblemPresenter(config):new MarksPresenter(config)):new HomePresenter(config)}}])}();function _skipUnnecessaryListPresenters(presenterClass){for(;;){var nextClass=_assertClassBrand(_PresenterFactory_brand,this,_moveToNextPresenterIfUnnecessary).call(this,presenterClass);if(nextClass===presenterClass)return presenterClass;presenterClass=nextClass}}function _moveToNextPresenterIfUnnecessary(presenterClass){switch(presenterClass.name){case"LibraryPresenter":if(lessonManager.bookTitles.length<=1)return lessonManager.bookIndex=0,BookPresenter;break;case"BookPresenter":if(lessonManager.chapterTitles.length<=1)return lessonManager.chapterIndex=0,ChapterPresenter;break;case"ChapterPresenter":if(lessonManager.lessonTitles.length<=1)return lessonManager.lessonIndex=0,LessonPresenter}return presenterClass}var throttleTimer=null;function setVhCssVariable(){var vh=.01*window.innerHeight;document.documentElement.style.setProperty("--vh","".concat(vh,"px"))}function showFatalError(error){var html="<h1>Whoops!</h1>\n  <p>An error has occurred from which I can't recover on my own.</p>\n  <ul>\n  <li>Name: ".concat(error.name,"</li>\n  <li>Cause: ").concat(error.cause,"</li>\n  <li>Message: ").concat(error.message,"</li>\n  </ul>\n  <p>Try reloading the application.</p>\n  ");console.error(error),document.getElementById("content").innerHTML=html}function loadApplication(){console.info("Launching application."),persistentData.setStorageKeyPrefix("LR_".concat(BuildInfo.getBundleName().replace(".","_")));var librariesLocation=BuildInfo.isBuilt()?"assets/lessons/libraries.json":"assets/lessons/lessons.test.data/libraries.test.json";return getLanguages(embeddedLesson.translations).then((function(){return lessonManager.loadAllLibraries(librariesLocation)})).then((function(error){return error?function(error){var _error$message,paragraphs=[i18n(_templateObject112||(_templateObject112=_taggedTemplateLiteral(["f3f0b4f55fc291c94d6ccc7f4dc2c22f::"]))),i18n(_templateObject113||(_templateObject113=_taggedTemplateLiteral(["de24ccc27cfdfb2a644948575f2af415::"]))),i18n(_templateObject114||(_templateObject114=_taggedTemplateLiteral(["cc63df6959a88e968e5e937687cdae40::"]))),"<br><br>",i18n(_templateObject115||(_templateObject115=_taggedTemplateLiteral(["ff154bcad7ab72998d209789e2ad3cbe::"]))),"<br><br>",null!==(_error$message=error.message)&&void 0!==_error$message?_error$message:error];return ModalDialog.showError(paragraphs.join(" "))}(error):null})).then((function(){return loadSettingDefinitions({palette:{type:"separator",label:i18n(_templateObject56||(_templateObject56=_taggedTemplateLiteral(["54016c9d89a98aa8bf2e8a8e7ba6f352::"])))},hue:{type:"range",label:i18n(_templateObject57||(_templateObject57=_taggedTemplateLiteral(["d86cbd21656e6a16eeebdf3041f7d9b0::"]))),defaultValue:DEFAULT_HUE,min:0,max:360,onupdate:function(value){setPalette({hue:value=parseInt(value)})}},saturation:{type:"range",label:i18n(_templateObject58||(_templateObject58=_taggedTemplateLiteral(["0b0d1a40638f299b733e0c7c90344698::"]))),defaultValue:DEFAULT_SATURATION,min:0,max:100,onupdate:function(value){setPalette({saturation:value=parseInt(value)})}},spread:{type:"range",label:i18n(_templateObject59||(_templateObject59=_taggedTemplateLiteral(["c13970d8379e2f9daef71a2d63e2233d::"]))),defaultValue:DEFAULT_COLOR_SPREAD,min:0,max:180,onupdate:function(value){setPalette({spread:value=parseInt(value)})}},darkMode:{type:"checkbox",label:i18n(_templateObject60||(_templateObject60=_taggedTemplateLiteral(["3924c958175e666737225e86a68ac4b4::"]))),defaultValue:DEFAULT_DARK_MODE,onupdate:function(value){setPalette({dark:value})}},ui:{type:"separator",label:i18n(_templateObject61||(_templateObject61=_taggedTemplateLiteral(["382f24d48bc1efa5dd974e166ac8df58::"])))},fontSize:{type:"range",label:i18n(_templateObject62||(_templateObject62=_taggedTemplateLiteral(["c4943062b634c56348c67fdebba808eb::"]))),defaultValue:DEFAULT_FONT_SIZE,min:10,max:22,onupdate:function(value){setProperty("--font-base-size","".concat(value,"px"))}},hideButtonText:{type:"checkbox",label:i18n(_templateObject63||(_templateObject63=_taggedTemplateLiteral(["63d171a5c8e1018a70b682bc3eca413f::"]))),defaultValue:!1,onupdate:function(value){icons.hideText=value}},focusOnStage:{type:"checkbox",label:i18n(_templateObject64||(_templateObject64=_taggedTemplateLiteral(["374352215837c62611f5473cf56d6812::"]))),defaultValue:!1,onupdate:function(value){focusManager.focusOnStage=value}},readingSpeed:{type:"range",label:i18n(_templateObject65||(_templateObject65=_taggedTemplateLiteral(["23944ac1bff1399fe70064067e3e4804::"]))),defaultValue:DEFAULT_READING_SPEED,min:80,max:1e3},enthusiasm:{type:"range",label:i18n(_templateObject66||(_templateObject66=_taggedTemplateLiteral(["fe36ab47806d98a669104c75909baa79::"]))),defaultValue:Enthusiasm.LOW,min:Enthusiasm.OFF,max:Enthusiasm.HIGH,onupdate:function(value){return soundManager.enthusiasm=value}},showFirstUseMessage:{type:"checkbox",label:i18n(_templateObject67||(_templateObject67=_taggedTemplateLiteral(["5bb6f06649fe039d8738eab53560e644::"]))),defaultValue:!0},lessonInfo:{type:"separator",label:i18n(_templateObject68||(_templateObject68=_taggedTemplateLiteral(["16c6a433b76133c6204c165f24374006::"])))},library:{type:"select",label:i18n(_templateObject69||(_templateObject69=_taggedTemplateLiteral(["b0ef546d26b0e0a6ad6a89b8f81b9170::"]))),defaultValue:DEFAULT_LIBRARY_KEY,onupdate:function(value){lessonManager.remoteLibraryKey=value},options:function(){return lessonManager.remoteLibraryTitles},reloadIfChanged:!0}})})).then((function(){var language=i18n(_templateObject122||(_templateObject122=_taggedTemplateLiteral(["language::"])));return""!==language&&(console.info("Language ".concat(language)),document.documentElement.setAttribute("lang",language)),!0})).then((function(){return menuItems=getMainMenuItems(),header.setup(menuItems),void footer.setup();var menuItems})).then((function(){return lessonManager.loadAllLibraryContent()})).then((function(error){return error?function(error){var _error$message2,paragraphs=[i18n(_templateObject116||(_templateObject116=_taggedTemplateLiteral(["007acecc18c3ad1ae9936101830d97ea::"]))),i18n(_templateObject117||(_templateObject117=_taggedTemplateLiteral(["4a3592179f792ce3636583d79b3022df::"]))),i18n(_templateObject118||(_templateObject118=_taggedTemplateLiteral(["fec8d71691789e72ce6db83ca0802a0f::"]))),i18n(_templateObject119||(_templateObject119=_taggedTemplateLiteral(["de24ccc27cfdfb2a644948575f2af415::"]))),i18n(_templateObject120||(_templateObject120=_taggedTemplateLiteral(["cc63df6959a88e968e5e937687cdae40::"]))),"<br><br>",i18n(_templateObject121||(_templateObject121=_taggedTemplateLiteral(["ff154bcad7ab72998d209789e2ad3cbe::"]))),"<br><br>",null!==(_error$message2=error.message)&&void 0!==_error$message2?_error$message2:error];return ModalDialog.showError(paragraphs.join(" "))}(error):null})).then((function(){return toast('<span style="font-size:3rem;">&#x1F642;</span>'+i18n(_templateObject123||(_templateObject123=_taggedTemplateLiteral(["e116432c045daf0416e5b73aed34c511::",""])),BuildInfo.getProductName()))})).then((function(){return function(){if(persistentData.getFromStorage("showFirstUseMessage",!0)){var appName=BuildInfo.getProductName(),privacyLinkLabel=i18n(_templateObject98||(_templateObject98=_taggedTemplateLiteral(["c5f29bb36f9158d2e00f5d4dc213a0ff::"]))),privacyLink="[".concat(privacyLinkLabel,"](").concat(Urls.PRIVACY,")"),message=[i18n(_templateObject99||(_templateObject99=_taggedTemplateLiteral(["46a1c80cd6288f041a5e39d0408ce93d::",""])),appName),i18n(_templateObject100||(_templateObject100=_taggedTemplateLiteral(["547ce4c1965d6423bacf07e726e81901::"]))),"",i18n(_templateObject101||(_templateObject101=_taggedTemplateLiteral(["c3ce94c8d1e37b8fa65432575cc115de::"]))),i18n(_templateObject102||(_templateObject102=_taggedTemplateLiteral(["a4052da0992bf8d527ecf075654e212a::",""])),"[GNU General Public License](https://www.gnu.org/licenses/gpl-3.0.en.html#license-text)"),i18n(_templateObject103||(_templateObject103=_taggedTemplateLiteral(["977e06d0da5c3f584962b1de1cb139bf::",""])),appName),i18n(_templateObject104||(_templateObject104=_taggedTemplateLiteral(["09c78e9bf1c7828280e85b6422d6e712::",""])),appName),i18n(_templateObject105||(_templateObject105=_taggedTemplateLiteral(["01ba1c378214b718ca7d379cb6028f97::"]))),i18n(_templateObject106||(_templateObject106=_taggedTemplateLiteral(["85320d2bf19b4540dfca0365564a452e::"]))),i18n(_templateObject107||(_templateObject107=_taggedTemplateLiteral(["9c56fddb40ff68400351826fd5d07d45::"]))),i18n(_templateObject108||(_templateObject108=_taggedTemplateLiteral(["d41d8cd98f00b204e9800998ecf8427e::"]))),i18n(_templateObject109||(_templateObject109=_taggedTemplateLiteral(["34e7746c584070981014ce2d69f4fd6f::"]))),i18n(_templateObject110||(_templateObject110=_taggedTemplateLiteral(["5390717707f947080d2e2dc05ed87e13::",""])),privacyLink)].join("\n");return ModalDialog.showInfo(parseMarkdown(message),i18n(_templateObject111||(_templateObject111=_taggedTemplateLiteral(["83218ac34c1834c26781fe4bde918ee4::"])))).then((function(){return persistentData.saveToStorage("showFirstUseMessage",!1)}))}return Promise.resolve()}()})).then((function(){var stage=document.getElementById("stage");return new StageManager(stage).startShow(PresenterFactory.getInitial())})).then((function(){console.warn("Did not expect to get here."),ModalDialog.showInfo(i18n(_templateObject124||(_templateObject124=_taggedTemplateLiteral(["c55bdbb47fee32f4ca56a977427374bf::"])))).then((function(){return window.location.reload()}))})).catch((function(error){showFatalError(error),ModalDialog.showFatal(error).then((function(){return window.location.reload()}))}))}window.addEventListener("resize",(function(){null===throttleTimer&&(throttleTimer=window.setTimeout((function(){throttleTimer=null,setVhCssVariable()}),200))})),setVhCssVariable(),window.addEventListener("load",(function(){try{return BuildInfo.isBuilt()&&registerServiceWorker(),function(){var container=document.createElement("div");if(container.style.position="absolute",container.innerHTML="<".concat("math",' xmlns="http://www.w3.org/1998/Math/MathML"><mspace width="').concat(100,'px" height="').concat(20,'px"></mspace></').concat("math",">"),document.body.appendChild(container),container.offsetWidth<100||container.offsetHeight<20){console.debug("MathMl not supported so loading fallback CSS");var cssLink=document.createElement("link");cssLink.href="".concat("https://henspace.github.io/text2lesson/","assets/styles/mathml.css"),cssLink.rel="stylesheet",document.head.appendChild(cssLink)}else console.debug("MathMl supported by browser");container.remove()}(),window.addEventListener("beforeunload",(function(event){if(document.querySelector(".".concat(Presenter.DO_NOT_CLOSE_CLASS_NAME)))return event.preventDefault(),event.returnValue=""})),loadApplication()}catch(error){showFatalError(error)}}))}();